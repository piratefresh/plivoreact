/*!
 * Copyright 2018 Plivo Inc.
 * 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *     http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * 
 * This software includes JsSIP under the following License.
 * 
 *     Name: JsSIP
 *     Author: José Luis Millán <jmillan@aliax.net>
 *     Core Developer: Iñaki Baz Castillo <ibc@aliax.net>
 *     Copyright (c) 2012-2015 José Luis Millán - Versatica <https://github.com/versatica/>
 * 
 * 
 *     License: The MIT License
 * 
 *     Permission is hereby granted, free of charge, to any person obtaining
 *     a copy of this software and associated documentation files (the
 *     "Software"), to deal in the Software without restriction, including
 *     without limitation the rights to use, copy, modify, merge, publish,
 *     distribute, sublicense, and/or sell copies of the Software, and to
 *     permit persons to whom the Software is furnished to do so, subject to
 *     the following conditions:
 * 
 *     The above copyright notice and this permission notice shall be
 *     included in all copies or substantial portions of the Software.
 * 
 *     THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 *     EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 *     MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 *     NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 *     LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 *     OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 *     WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 *     
 * This software includes callstats.io under the following License.
 * 
 *     Copyright (c) 2013-2018, callstats.io
 *     All rights reserved.
 * 
 *     THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 *     AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 *     IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 *     ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE
 *     LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 *     CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 *     SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 *     INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 *     CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 *     ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 *     POSSIBILITY OF SUCH DAMAGE.
 * 
 */
var Plivo=function(e){var n={};function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var i in e)t.d(r,i,function(n){return e[n]}.bind(null,i));return r},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=25)}([function(e,n,t){(function(r){function i(){var e;try{e=n.storage.debug}catch(e){}return!e&&void 0!==r&&"env"in r&&(e=r.env.DEBUG),e}(n=e.exports=t(47)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},n.formatArgs=function(e){var t=window._PlivoUseColorLog;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+n.humanize(this.diff),!t)return;var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var i=0,a=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&"%c"===e&&(a=++i)}),e.splice(a,0,r)},n.save=function(e){try{null==e?n.storage.removeItem("debug"):n.storage.debug=e}catch(e){}},n.load=i,n.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},n.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),n.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],n.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},n.enable(i())}).call(this,t(21))},function(e,n,t){const r=t(12);e.exports={USER_AGENT:`${r.title} ${r.version}`,SIP:"sip",SIPS:"sips",causes:{CONNECTION_ERROR:"Connection Error",REQUEST_TIMEOUT:"Request Timeout",SIP_FAILURE_CODE:"SIP Failure Code",INTERNAL_ERROR:"Internal Error",BUSY:"Busy",REJECTED:"Rejected",REDIRECTED:"Redirected",UNAVAILABLE:"Unavailable",NOT_FOUND:"Not Found",ADDRESS_INCOMPLETE:"Address Incomplete",INCOMPATIBLE_SDP:"Incompatible SDP",MISSING_SDP:"Missing SDP",AUTHENTICATION_ERROR:"Authentication Error",BYE:"Terminated",WEBRTC_ERROR:"WebRTC Error",CANCELED:"Canceled",NO_ANSWER:"No Answer",EXPIRES:"Expires",NO_ACK:"No ACK",DIALOG_ERROR:"Dialog Error",USER_DENIED_MEDIA_ACCESS:"User Denied Media Access",BAD_MEDIA_DESCRIPTION:"Bad Media Description",RTP_TIMEOUT:"RTP Timeout"},SIP_ERROR_CAUSES:{REDIRECTED:[300,301,302,305,380],BUSY:[486,600],REJECTED:[403,603],NOT_FOUND:[404,604],UNAVAILABLE:[480,410,408,430],ADDRESS_INCOMPLETE:[484,424],INCOMPATIBLE_SDP:[488,606],AUTHENTICATION_ERROR:[401,407]},ACK:"ACK",BYE:"BYE",CANCEL:"CANCEL",INFO:"INFO",INVITE:"INVITE",MESSAGE:"MESSAGE",NOTIFY:"NOTIFY",OPTIONS:"OPTIONS",REGISTER:"REGISTER",REFER:"REFER",UPDATE:"UPDATE",SUBSCRIBE:"SUBSCRIBE",REASON_PHRASE:{100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",424:"Bad Location Information",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"JsSIP Internal Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"},ALLOWED_METHODS:"INVITE,ACK,CANCEL,BYE,UPDATE,MESSAGE,OPTIONS,REFER,INFO",ACCEPTED_BODY_TYPES:"application/sdp, application/dtmf-relay",MAX_FORWARDS:69,SESSION_EXPIRES:90,MIN_SESSION_EXPIRES:60}},function(e,n,t){const r=t(1),i=t(9),a=t(3);n.str_utf8_length=(e=>unescape(encodeURIComponent(e)).length);const s=n.isFunction=(e=>void 0!==e&&"[object Function]"===Object.prototype.toString.call(e));n.isString=(e=>void 0!==e&&"[object String]"===Object.prototype.toString.call(e)),n.isDecimal=(e=>!isNaN(e)&&parseFloat(e)===parseInt(e,10)),n.isEmpty=(e=>null===e||""===e||void 0===e||Array.isArray(e)&&0===e.length||"number"==typeof e&&isNaN(e)),n.hasMethods=function(e,...n){for(const t of n)if(s(e[t]))return!1;return!0};const o=n.createRandomToken=((e,n=32)=>{let t,r,i="";for(t=0;t<e;t++)i+=(r=Math.random()*n|0).toString(n);return i});n.newTag=(()=>o(10)),n.newUUID=(()=>{return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const n=16*Math.random()|0;return("x"===e?n:3&n|8).toString(16)})}),n.hostType=(e=>{if(e)return-1!==(e=a.parse(e,"host"))?e.host_type:void 0});const c=n.escapeUser=(e=>encodeURIComponent(decodeURIComponent(e)).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/"));n.normalizeTarget=((e,n)=>{if(e){if(e instanceof i)return e;if("string"==typeof e){const t=e.split("@");let a,s,o;switch(t.length){case 1:if(!n)return;a=e,s=n;break;case 2:a=t[0],s=t[1];break;default:a=t.slice(0,t.length-1).join("@"),s=t[t.length-1]}return a=a.replace(/^(sips?|tel):/i,""),/^[-.()]*\+?[0-9\-.()]+$/.test(a)&&(a=a.replace(/[-.()]/g,"")),e=`${r.SIP}:${c(a)}@${s}`,(o=i.parse(e))?o:void 0}}else;}),n.headerize=(e=>{const n={"Call-Id":"Call-ID",Cseq:"CSeq","Www-Authenticate":"WWW-Authenticate"},t=e.toLowerCase().replace(/_/g,"-").split("-");let r="";const i=t.length;let a;for(a=0;a<i;a++)0!==a&&(r+="-"),r+=t[a].charAt(0).toUpperCase()+t[a].substring(1);return n[r]&&(r=n[r]),r}),n.sipErrorCause=(e=>{for(const n in r.SIP_ERROR_CAUSES)if(-1!==r.SIP_ERROR_CAUSES[n].indexOf(e))return r.causes[n];return r.causes.SIP_FAILURE_CODE}),n.getRandomTestNetIP=(()=>{return`192.0.2.${function(e,n){return Math.floor(Math.random()*(n-e+1)+e)}(1,254)}`}),n.calculateMD5=(e=>{function n(e,n){return e<<n|e>>>32-n}function t(e,n){const t=2147483648&e,r=2147483648&n,i=1073741824&e,a=1073741824&n,s=(1073741823&e)+(1073741823&n);return i&a?2147483648^s^t^r:i|a?1073741824&s?3221225472^s^t^r:1073741824^s^t^r:s^t^r}function r(e,r,i,a,s,o,c){return t(n(e=t(e,t(t(function(e,n,t){return e&n|~e&t}(r,i,a),s),c)),o),r)}function i(e,r,i,a,s,o,c){return t(n(e=t(e,t(t(function(e,n,t){return e&t|n&~t}(r,i,a),s),c)),o),r)}function a(e,r,i,a,s,o,c){return t(n(e=t(e,t(t(function(e,n,t){return e^n^t}(r,i,a),s),c)),o),r)}function s(e,r,i,a,s,o,c){return t(n(e=t(e,t(t(function(e,n,t){return n^(e|~t)}(r,i,a),s),c)),o),r)}function o(e){let n,t,r="",i="";for(t=0;t<=3;t++)r+=(i=`0${(n=e>>>8*t&255).toString(16)}`).substr(i.length-2,2);return r}let c,l,u,d,h,f,p,g,b,v=[];for(v=function(e){let n;const t=e.length,r=t+8,i=16*((r-r%64)/64+1),a=new Array(i-1);let s=0,o=0;for(;o<t;)s=o%4*8,a[n=(o-o%4)/4]=a[n]|e.charCodeAt(o)<<s,o++;return s=o%4*8,a[n=(o-o%4)/4]=a[n]|128<<s,a[i-2]=t<<3,a[i-1]=t>>>29,a}(e=function(e){e=e.replace(/\r\n/g,"\n");let n="";for(let t=0;t<e.length;t++){const r=e.charCodeAt(t);r<128?n+=String.fromCharCode(r):r>127&&r<2048?(n+=String.fromCharCode(r>>6|192),n+=String.fromCharCode(63&r|128)):(n+=String.fromCharCode(r>>12|224),n+=String.fromCharCode(r>>6&63|128),n+=String.fromCharCode(63&r|128))}return n}(e)),f=1732584193,p=4023233417,g=2562383102,b=271733878,c=0;c<v.length;c+=16)l=f,u=p,d=g,h=b,p=s(p=s(p=s(p=s(p=a(p=a(p=a(p=a(p=i(p=i(p=i(p=i(p=r(p=r(p=r(p=r(p,g=r(g,b=r(b,f=r(f,p,g,b,v[c+0],7,3614090360),p,g,v[c+1],12,3905402710),f,p,v[c+2],17,606105819),b,f,v[c+3],22,3250441966),g=r(g,b=r(b,f=r(f,p,g,b,v[c+4],7,4118548399),p,g,v[c+5],12,1200080426),f,p,v[c+6],17,2821735955),b,f,v[c+7],22,4249261313),g=r(g,b=r(b,f=r(f,p,g,b,v[c+8],7,1770035416),p,g,v[c+9],12,2336552879),f,p,v[c+10],17,4294925233),b,f,v[c+11],22,2304563134),g=r(g,b=r(b,f=r(f,p,g,b,v[c+12],7,1804603682),p,g,v[c+13],12,4254626195),f,p,v[c+14],17,2792965006),b,f,v[c+15],22,1236535329),g=i(g,b=i(b,f=i(f,p,g,b,v[c+1],5,4129170786),p,g,v[c+6],9,3225465664),f,p,v[c+11],14,643717713),b,f,v[c+0],20,3921069994),g=i(g,b=i(b,f=i(f,p,g,b,v[c+5],5,3593408605),p,g,v[c+10],9,38016083),f,p,v[c+15],14,3634488961),b,f,v[c+4],20,3889429448),g=i(g,b=i(b,f=i(f,p,g,b,v[c+9],5,568446438),p,g,v[c+14],9,3275163606),f,p,v[c+3],14,4107603335),b,f,v[c+8],20,1163531501),g=i(g,b=i(b,f=i(f,p,g,b,v[c+13],5,2850285829),p,g,v[c+2],9,4243563512),f,p,v[c+7],14,1735328473),b,f,v[c+12],20,2368359562),g=a(g,b=a(b,f=a(f,p,g,b,v[c+5],4,4294588738),p,g,v[c+8],11,2272392833),f,p,v[c+11],16,1839030562),b,f,v[c+14],23,4259657740),g=a(g,b=a(b,f=a(f,p,g,b,v[c+1],4,2763975236),p,g,v[c+4],11,1272893353),f,p,v[c+7],16,4139469664),b,f,v[c+10],23,3200236656),g=a(g,b=a(b,f=a(f,p,g,b,v[c+13],4,681279174),p,g,v[c+0],11,3936430074),f,p,v[c+3],16,3572445317),b,f,v[c+6],23,76029189),g=a(g,b=a(b,f=a(f,p,g,b,v[c+9],4,3654602809),p,g,v[c+12],11,3873151461),f,p,v[c+15],16,530742520),b,f,v[c+2],23,3299628645),g=s(g,b=s(b,f=s(f,p,g,b,v[c+0],6,4096336452),p,g,v[c+7],10,1126891415),f,p,v[c+14],15,2878612391),b,f,v[c+5],21,4237533241),g=s(g,b=s(b,f=s(f,p,g,b,v[c+12],6,1700485571),p,g,v[c+3],10,2399980690),f,p,v[c+10],15,4293915773),b,f,v[c+1],21,2240044497),g=s(g,b=s(b,f=s(f,p,g,b,v[c+8],6,1873313359),p,g,v[c+15],10,4264355552),f,p,v[c+6],15,2734768916),b,f,v[c+13],21,1309151649),g=s(g,b=s(b,f=s(f,p,g,b,v[c+4],6,4149444226),p,g,v[c+11],10,3174756917),f,p,v[c+2],15,718787259),b,f,v[c+9],21,3951481745),f=t(f,l),p=t(p,u),g=t(g,d),b=t(b,h);return(o(f)+o(p)+o(g)+o(b)).toLowerCase()}),n.closeMediaStream=(e=>{if(e)try{let n;if(e.getTracks){n=e.getTracks();for(const e of n)e.stop()}else{n=e.getAudioTracks();for(const e of n)e.stop();n=e.getVideoTracks();for(const e of n)e.stop()}}catch(n){"function"!=typeof e.stop&&"object"!=typeof e.stop||e.stop()}}),n.cloneArray=(e=>e&&e.slice()||[])},function(e,n,t){e.exports=function(){function e(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var n={parse:function(n,r){var i={CRLF:u,DIGIT:d,ALPHA:h,HEXDIG:f,WSP:p,OCTET:g,DQUOTE:b,SP:v,HTAB:m,alphanum:y,reserved:_,unreserved:S,mark:C,escaped:T,LWS:w,SWS:E,HCOLON:k,TEXT_UTF8_TRIM:R,TEXT_UTF8char:I,UTF8_NONASCII:P,UTF8_CONT:A,LHEX:function(){var e;null===(e=d())&&(/^[a-f]/.test(n.charAt(a))?(e=n.charAt(a),a++):(e=null,0===s&&l("[a-f]")));return e},token:O,token_nodot:D,separators:function(){var e;40===n.charCodeAt(a)?(e="(",a++):(e=null,0===s&&l('"("'));null===e&&(41===n.charCodeAt(a)?(e=")",a++):(e=null,0===s&&l('")"')),null===e&&(60===n.charCodeAt(a)?(e="<",a++):(e=null,0===s&&l('"<"')),null===e&&(62===n.charCodeAt(a)?(e=">",a++):(e=null,0===s&&l('">"')),null===e&&(64===n.charCodeAt(a)?(e="@",a++):(e=null,0===s&&l('"@"')),null===e&&(44===n.charCodeAt(a)?(e=",",a++):(e=null,0===s&&l('","')),null===e&&(59===n.charCodeAt(a)?(e=";",a++):(e=null,0===s&&l('";"')),null===e&&(58===n.charCodeAt(a)?(e=":",a++):(e=null,0===s&&l('":"')),null===e&&(92===n.charCodeAt(a)?(e="\\",a++):(e=null,0===s&&l('"\\\\"')),null===e&&null===(e=b())&&(47===n.charCodeAt(a)?(e="/",a++):(e=null,0===s&&l('"/"')),null===e&&(91===n.charCodeAt(a)?(e="[",a++):(e=null,0===s&&l('"["')),null===e&&(93===n.charCodeAt(a)?(e="]",a++):(e=null,0===s&&l('"]"')),null===e&&(63===n.charCodeAt(a)?(e="?",a++):(e=null,0===s&&l('"?"')),null===e&&(61===n.charCodeAt(a)?(e="=",a++):(e=null,0===s&&l('"="')),null===e&&(123===n.charCodeAt(a)?(e="{",a++):(e=null,0===s&&l('"{"')),null===e&&(125===n.charCodeAt(a)?(e="}",a++):(e=null,0===s&&l('"}"')),null===e&&null===(e=v())&&(e=m()))))))))))))))));return e},word:j,STAR:M,SLASH:x,EQUAL:N,LPAREN:F,RPAREN:U,RAQUOT:L,LAQUOT:H,COMMA:q,SEMI:B,COLON:G,LDQUOT:$,RDQUOT:V,comment:function e(){var n,t,r;var i;i=a;n=F();if(null!==n){for(t=[],null===(r=W())&&null===(r=Q())&&(r=e());null!==r;)t.push(r),null===(r=W())&&null===(r=Q())&&(r=e());null!==t&&null!==(r=U())?n=[n,t,r]:(n=null,a=i)}else n=null,a=i;return n},ctext:W,quoted_string:z,quoted_string_clean:K,qdtext:J,quoted_pair:Q,SIP_URI_noparams:X,SIP_URI:Y,uri_scheme:Z,uri_scheme_sips:ee,uri_scheme_sip:ne,userinfo:te,user:re,user_unreserved:ie,password:ae,hostport:se,host:oe,hostname:ce,domainlabel:le,toplabel:ue,IPv6reference:de,IPv6address:he,h16:fe,ls32:pe,IPv4address:ge,dec_octet:be,port:ve,uri_parameters:me,uri_parameter:ye,transport_param:_e,user_param:Se,method_param:Ce,ttl_param:Te,maddr_param:we,lr_param:Ee,other_param:ke,pname:Re,pvalue:Ie,paramchar:Pe,param_unreserved:Ae,headers:Oe,header:De,hname:je,hvalue:Me,hnv_unreserved:xe,Request_Response:function(){var e;null===(e=hn())&&(e=Ne());return e},Request_Line:Ne,Request_URI:Fe,absoluteURI:Ue,hier_part:Le,net_path:He,abs_path:qe,opaque_part:Be,uric:Ge,uric_no_slash:$e,path_segments:Ve,segment:We,param:ze,pchar:Ke,scheme:Je,authority:Qe,srvr:Xe,reg_name:Ye,query:Ze,SIP_Version:en,INVITEm:nn,ACKm:tn,OPTIONSm:rn,BYEm:an,CANCELm:sn,REGISTERm:on,SUBSCRIBEm:cn,NOTIFYm:ln,REFERm:un,Method:dn,Status_Line:hn,Status_Code:fn,extension_code:pn,Reason_Phrase:gn,Allow_Events:function(){var e,n,t,r,i,s;if(i=a,null!==(e=Ln())){for(n=[],s=a,null!==(t=q())&&null!==(r=Ln())?t=[t,r]:(t=null,a=s);null!==t;)n.push(t),s=a,null!==(t=q())&&null!==(r=Ln())?t=[t,r]:(t=null,a=s);null!==n?e=[e,n]:(e=null,a=i)}else e=null,a=i;return e},Call_ID:function(){var e,t,r,i,o,c;i=a,o=a,null!==(e=j())?(c=a,64===n.charCodeAt(a)?(t="@",a++):(t=null,0===s&&l('"@"')),null!==t&&null!==(r=j())?t=[t,r]:(t=null,a=c),null!==(t=null!==t?t:"")?e=[e,t]:(e=null,a=o)):(e=null,a=o);null!==e&&(e=function(e){Ht=n.substring(a,e)}(i));null===e&&(a=i);return e},Contact:function(){var e,n,t,r,i,s,o;if(i=a,null===(e=M()))if(s=a,null!==(e=bn())){for(n=[],o=a,null!==(t=q())&&null!==(r=bn())?t=[t,r]:(t=null,a=o);null!==t;)n.push(t),o=a,null!==(t=q())&&null!==(r=bn())?t=[t,r]:(t=null,a=o);null!==n?e=[e,n]:(e=null,a=s)}else e=null,a=s;null!==e&&(e=function(e){var n,t;for(t=Ht.multi_header.length,n=0;n<t;n++)if(null===Ht.multi_header[n].parsed){Ht=null;break}Ht=null!==Ht?Ht.multi_header:-1}());null===e&&(a=i);return e},contact_param:bn,name_addr:vn,display_name:mn,contact_params:yn,c_p_q:_n,c_p_expires:Sn,delta_seconds:Cn,qvalue:Tn,generic_param:wn,gen_value:En,Content_Disposition:function(){var e,n,t,r,i,s;if(i=a,null!==(e=kn())){for(n=[],s=a,null!==(t=B())&&null!==(r=Rn())?t=[t,r]:(t=null,a=s);null!==t;)n.push(t),s=a,null!==(t=B())&&null!==(r=Rn())?t=[t,r]:(t=null,a=s);null!==n?e=[e,n]:(e=null,a=i)}else e=null,a=i;return e},disp_type:kn,disp_param:Rn,handling_param:In,Content_Encoding:function(){var e,n,t,r,i,s;if(i=a,null!==(e=O())){for(n=[],s=a,null!==(t=q())&&null!==(r=O())?t=[t,r]:(t=null,a=s);null!==t;)n.push(t),s=a,null!==(t=q())&&null!==(r=O())?t=[t,r]:(t=null,a=s);null!==n?e=[e,n]:(e=null,a=i)}else e=null,a=i;return e},Content_Length:function(){var e,n,t;if(t=a,null!==(n=d()))for(e=[];null!==n;)e.push(n),n=d();else e=null;null!==e&&(e=function(e,n){Ht=parseInt(n.join(""))}(0,e));null===e&&(a=t);return e},Content_Type:function(){var e,t;t=a,null!==(e=Pn())&&(e=function(e){Ht=n.substring(a,e)}(t));null===e&&(a=t);return e},media_type:Pn,m_type:An,discrete_type:On,composite_type:Dn,extension_token:jn,x_token:Mn,m_subtype:xn,m_parameter:Nn,m_value:Fn,CSeq:function(){var e,n,t,r;r=a,null!==(e=Un())&&null!==(n=w())&&null!==(t=dn())?e=[e,n,t]:(e=null,a=r);return e},CSeq_value:Un,Expires:function(){var e,n;n=a,null!==(e=Cn())&&(e=function(e,n){Ht=n}(0,e));null===e&&(a=n);return e},Event:function(){var e,n,t,r,i,s,o;if(i=a,s=a,null!==(e=Ln())){for(n=[],o=a,null!==(t=B())&&null!==(r=wn())?t=[t,r]:(t=null,a=o);null!==t;)n.push(t),o=a,null!==(t=B())&&null!==(r=wn())?t=[t,r]:(t=null,a=o);null!==n?e=[e,n]:(e=null,a=s)}else e=null,a=s;null!==e&&(e=function(e,n){Ht.event=n.join("").toLowerCase()}(0,e[0]));null===e&&(a=i);return e},event_type:Ln,From:function(){var e,n,t,r,i,s,o;i=a,s=a,null===(e=X())&&(e=vn());if(null!==e){for(n=[],o=a,null!==(t=B())&&null!==(r=Hn())?t=[t,r]:(t=null,a=o);null!==t;)n.push(t),o=a,null!==(t=B())&&null!==(r=Hn())?t=[t,r]:(t=null,a=o);null!==n?e=[e,n]:(e=null,a=s)}else e=null,a=s;null!==e&&(e=function(e){var n=Ht.tag;try{Ht=new Lt(Ht.uri,Ht.display_name,Ht.params),n&&Ht.setParam("tag",n)}catch(e){Ht=-1}}());null===e&&(a=i);return e},from_param:Hn,tag_param:qn,Max_Forwards:function(){var e,n,t;if(t=a,null!==(n=d()))for(e=[];null!==n;)e.push(n),n=d();else e=null;null!==e&&(e=function(e,n){Ht=parseInt(n.join(""))}(0,e));null===e&&(a=t);return e},Min_Expires:function(){var e,n;n=a,null!==(e=Cn())&&(e=function(e,n){Ht=n}(0,e));null===e&&(a=n);return e},Name_Addr_Header:function(){var e,n,t,r,i,s,o,c,l,u;c=a,l=a,e=[],n=mn();for(;null!==n;)e.push(n),n=mn();if(null!==e)if(null!==(n=H()))if(null!==(t=Y()))if(null!==(r=L())){for(i=[],u=a,null!==(s=B())&&null!==(o=wn())?s=[s,o]:(s=null,a=u);null!==s;)i.push(s),u=a,null!==(s=B())&&null!==(o=wn())?s=[s,o]:(s=null,a=u);null!==i?e=[e,n,t,r,i]:(e=null,a=l)}else e=null,a=l;else e=null,a=l;else e=null,a=l;else e=null,a=l;null!==e&&(e=function(e){try{Ht=new Lt(Ht.uri,Ht.display_name,Ht.params)}catch(e){Ht=-1}}());null===e&&(a=c);return e},Proxy_Authenticate:function(){return Bn()},challenge:Bn,other_challenge:Gn,auth_param:$n,digest_cln:Vn,realm:Wn,realm_value:zn,domain:Kn,URI:Jn,nonce:Qn,nonce_value:Xn,opaque:Yn,stale:Zn,algorithm:et,qop_options:nt,qop_value:tt,Proxy_Require:function(){var e,n,t,r,i,s;if(i=a,null!==(e=O())){for(n=[],s=a,null!==(t=q())&&null!==(r=O())?t=[t,r]:(t=null,a=s);null!==t;)n.push(t),s=a,null!==(t=q())&&null!==(r=O())?t=[t,r]:(t=null,a=s);null!==n?e=[e,n]:(e=null,a=i)}else e=null,a=i;return e},Record_Route:function(){var e,n,t,r,i,s,o;if(i=a,s=a,null!==(e=rt())){for(n=[],o=a,null!==(t=q())&&null!==(r=rt())?t=[t,r]:(t=null,a=o);null!==t;)n.push(t),o=a,null!==(t=q())&&null!==(r=rt())?t=[t,r]:(t=null,a=o);null!==n?e=[e,n]:(e=null,a=s)}else e=null,a=s;null!==e&&(e=function(e){var n,t;for(t=Ht.multi_header.length,n=0;n<t;n++)if(null===Ht.multi_header[n].parsed){Ht=null;break}Ht=null!==Ht?Ht.multi_header:-1}());null===e&&(a=i);return e},rec_route:rt,Reason:function(){var e,t,r,i,o,c,u;o=a,c=a,"sip"===n.substr(a,3).toLowerCase()?(e=n.substr(a,3),a+=3):(e=null,0===s&&l('"SIP"'));null===e&&(e=O());if(null!==e){for(t=[],u=a,null!==(r=B())&&null!==(i=it())?r=[r,i]:(r=null,a=u);null!==r;)t.push(r),u=a,null!==(r=B())&&null!==(i=it())?r=[r,i]:(r=null,a=u);null!==t?e=[e,t]:(e=null,a=c)}else e=null,a=c;null!==e&&(e=function(e,n){if(Ht.protocol=n.toLowerCase(),Ht.params||(Ht.params={}),Ht.params.text&&'"'===Ht.params.text[0]){var t=Ht.params.text;Ht.text=t.substring(1,t.length-1),delete Ht.params.text}}(0,e[0]));null===e&&(a=o);return e},reason_param:it,reason_cause:at,Require:function(){var e,n,t,r,i,s;if(i=a,null!==(e=O())){for(n=[],s=a,null!==(t=q())&&null!==(r=O())?t=[t,r]:(t=null,a=s);null!==t;)n.push(t),s=a,null!==(t=q())&&null!==(r=O())?t=[t,r]:(t=null,a=s);null!==n?e=[e,n]:(e=null,a=i)}else e=null,a=i;return e},Route:function(){var e,n,t,r,i,s;if(i=a,null!==(e=st())){for(n=[],s=a,null!==(t=q())&&null!==(r=st())?t=[t,r]:(t=null,a=s);null!==t;)n.push(t),s=a,null!==(t=q())&&null!==(r=st())?t=[t,r]:(t=null,a=s);null!==n?e=[e,n]:(e=null,a=i)}else e=null,a=i;return e},route_param:st,Subscription_State:function(){var e,n,t,r,i,s;if(i=a,null!==(e=ot())){for(n=[],s=a,null!==(t=B())&&null!==(r=ct())?t=[t,r]:(t=null,a=s);null!==t;)n.push(t),s=a,null!==(t=B())&&null!==(r=ct())?t=[t,r]:(t=null,a=s);null!==n?e=[e,n]:(e=null,a=i)}else e=null,a=i;return e},substate_value:ot,subexp_params:ct,event_reason_value:lt,Subject:function(){var e;return e=null!==(e=R())?e:""},Supported:function(){var e,n,t,r,i,s;if(i=a,null!==(e=O())){for(n=[],s=a,null!==(t=q())&&null!==(r=O())?t=[t,r]:(t=null,a=s);null!==t;)n.push(t),s=a,null!==(t=q())&&null!==(r=O())?t=[t,r]:(t=null,a=s);null!==n?e=[e,n]:(e=null,a=i)}else e=null,a=i;return e=null!==e?e:""},To:function(){var e,n,t,r,i,s,o;i=a,s=a,null===(e=X())&&(e=vn());if(null!==e){for(n=[],o=a,null!==(t=B())&&null!==(r=ut())?t=[t,r]:(t=null,a=o);null!==t;)n.push(t),o=a,null!==(t=B())&&null!==(r=ut())?t=[t,r]:(t=null,a=o);null!==n?e=[e,n]:(e=null,a=s)}else e=null,a=s;null!==e&&(e=function(e){var n=Ht.tag;try{Ht=new Lt(Ht.uri,Ht.display_name,Ht.params),n&&Ht.setParam("tag",n)}catch(e){Ht=-1}}());null===e&&(a=i);return e},to_param:ut,Via:function(){var e,n,t,r,i,s;if(i=a,null!==(e=dt())){for(n=[],s=a,null!==(t=q())&&null!==(r=dt())?t=[t,r]:(t=null,a=s);null!==t;)n.push(t),s=a,null!==(t=q())&&null!==(r=dt())?t=[t,r]:(t=null,a=s);null!==n?e=[e,n]:(e=null,a=i)}else e=null,a=i;return e},via_param:dt,via_params:ht,via_ttl:ft,via_maddr:pt,via_received:gt,via_branch:bt,response_port:vt,sent_protocol:mt,protocol_name:yt,transport:_t,sent_by:St,via_host:Ct,via_port:Tt,ttl:wt,WWW_Authenticate:function(){return Bn()},Session_Expires:function(){var e,n,t,r,i,s;if(i=a,null!==(e=Et())){for(n=[],s=a,null!==(t=B())&&null!==(r=kt())?t=[t,r]:(t=null,a=s);null!==t;)n.push(t),s=a,null!==(t=B())&&null!==(r=kt())?t=[t,r]:(t=null,a=s);null!==n?e=[e,n]:(e=null,a=i)}else e=null,a=i;return e},s_e_expires:Et,s_e_params:kt,s_e_refresher:Rt,extension_header:function(){var e,n,t,r;r=a,null!==(e=O())&&null!==(n=k())&&null!==(t=It())?e=[e,n,t]:(e=null,a=r);return e},header_value:It,message_body:function(){var e,n;e=[],n=g();for(;null!==n;)e.push(n),n=g();return e},uuid_URI:function(){var e,t,r;r=a,"uuid:"===n.substr(a,5)?(e="uuid:",a+=5):(e=null,0===s&&l('"uuid:"'));null!==e&&null!==(t=Pt())?e=[e,t]:(e=null,a=r);return e},uuid:Pt,hex4:At,hex8:Ot,hex12:Dt,Refer_To:function(){var e,n,t,r,i,s,o;i=a,s=a,null===(e=X())&&(e=vn());if(null!==e){for(n=[],o=a,null!==(t=B())&&null!==(r=wn())?t=[t,r]:(t=null,a=o);null!==t;)n.push(t),o=a,null!==(t=B())&&null!==(r=wn())?t=[t,r]:(t=null,a=o);null!==n?e=[e,n]:(e=null,a=s)}else e=null,a=s;null!==e&&(e=function(e){try{Ht=new Lt(Ht.uri,Ht.display_name,Ht.params)}catch(e){Ht=-1}}());null===e&&(a=i);return e},Replaces:function(){var e,n,t,r,i,s;if(i=a,null!==(e=jt())){for(n=[],s=a,null!==(t=B())&&null!==(r=Mt())?t=[t,r]:(t=null,a=s);null!==t;)n.push(t),s=a,null!==(t=B())&&null!==(r=Mt())?t=[t,r]:(t=null,a=s);null!==n?e=[e,n]:(e=null,a=i)}else e=null,a=i;return e},call_id:jt,replaces_param:Mt,to_tag:xt,from_tag:Nt,early_flag:Ft};if(void 0!==r){if(void 0===i[r])throw new Error("Invalid rule name: "+e(r)+".")}else r="CRLF";var a=0,s=0,o=0,c=[];function l(e){a<o||(a>o&&(o=a,c=[]),c.push(e))}function u(){var e;return"\r\n"===n.substr(a,2)?(e="\r\n",a+=2):(e=null,0===s&&l('"\\r\\n"')),e}function d(){var e;return/^[0-9]/.test(n.charAt(a))?(e=n.charAt(a),a++):(e=null,0===s&&l("[0-9]")),e}function h(){var e;return/^[a-zA-Z]/.test(n.charAt(a))?(e=n.charAt(a),a++):(e=null,0===s&&l("[a-zA-Z]")),e}function f(){var e;return/^[0-9a-fA-F]/.test(n.charAt(a))?(e=n.charAt(a),a++):(e=null,0===s&&l("[0-9a-fA-F]")),e}function p(){var e;return null===(e=v())&&(e=m()),e}function g(){var e;return/^[\0-\xFF]/.test(n.charAt(a))?(e=n.charAt(a),a++):(e=null,0===s&&l("[\\0-\\xFF]")),e}function b(){var e;return/^["]/.test(n.charAt(a))?(e=n.charAt(a),a++):(e=null,0===s&&l('["]')),e}function v(){var e;return 32===n.charCodeAt(a)?(e=" ",a++):(e=null,0===s&&l('" "')),e}function m(){var e;return 9===n.charCodeAt(a)?(e="\t",a++):(e=null,0===s&&l('"\\t"')),e}function y(){var e;return/^[a-zA-Z0-9]/.test(n.charAt(a))?(e=n.charAt(a),a++):(e=null,0===s&&l("[a-zA-Z0-9]")),e}function _(){var e;return 59===n.charCodeAt(a)?(e=";",a++):(e=null,0===s&&l('";"')),null===e&&(47===n.charCodeAt(a)?(e="/",a++):(e=null,0===s&&l('"/"')),null===e&&(63===n.charCodeAt(a)?(e="?",a++):(e=null,0===s&&l('"?"')),null===e&&(58===n.charCodeAt(a)?(e=":",a++):(e=null,0===s&&l('":"')),null===e&&(64===n.charCodeAt(a)?(e="@",a++):(e=null,0===s&&l('"@"')),null===e&&(38===n.charCodeAt(a)?(e="&",a++):(e=null,0===s&&l('"&"')),null===e&&(61===n.charCodeAt(a)?(e="=",a++):(e=null,0===s&&l('"="')),null===e&&(43===n.charCodeAt(a)?(e="+",a++):(e=null,0===s&&l('"+"')),null===e&&(36===n.charCodeAt(a)?(e="$",a++):(e=null,0===s&&l('"$"')),null===e&&(44===n.charCodeAt(a)?(e=",",a++):(e=null,0===s&&l('","'))))))))))),e}function S(){var e;return null===(e=y())&&(e=C()),e}function C(){var e;return 45===n.charCodeAt(a)?(e="-",a++):(e=null,0===s&&l('"-"')),null===e&&(95===n.charCodeAt(a)?(e="_",a++):(e=null,0===s&&l('"_"')),null===e&&(46===n.charCodeAt(a)?(e=".",a++):(e=null,0===s&&l('"."')),null===e&&(33===n.charCodeAt(a)?(e="!",a++):(e=null,0===s&&l('"!"')),null===e&&(126===n.charCodeAt(a)?(e="~",a++):(e=null,0===s&&l('"~"')),null===e&&(42===n.charCodeAt(a)?(e="*",a++):(e=null,0===s&&l('"*"')),null===e&&(39===n.charCodeAt(a)?(e="'",a++):(e=null,0===s&&l('"\'"')),null===e&&(40===n.charCodeAt(a)?(e="(",a++):(e=null,0===s&&l('"("')),null===e&&(41===n.charCodeAt(a)?(e=")",a++):(e=null,0===s&&l('")"')))))))))),e}function T(){var e,t,r,i,o;return i=a,o=a,37===n.charCodeAt(a)?(e="%",a++):(e=null,0===s&&l('"%"')),null!==e&&null!==(t=f())&&null!==(r=f())?e=[e,t,r]:(e=null,a=o),null!==e&&(e=e.join("")),null===e&&(a=i),e}function w(){var e,n,t,r,i,s;for(r=a,i=a,s=a,e=[],n=p();null!==n;)e.push(n),n=p();if(null!==e&&null!==(n=u())?e=[e,n]:(e=null,a=s),null!==(e=null!==e?e:"")){if(null!==(t=p()))for(n=[];null!==t;)n.push(t),t=p();else n=null;null!==n?e=[e,n]:(e=null,a=i)}else e=null,a=i;return null!==e&&(e=" "),null===e&&(a=r),e}function E(){var e;return e=null!==(e=w())?e:""}function k(){var e,t,r,i,o;for(i=a,o=a,e=[],null===(t=v())&&(t=m());null!==t;)e.push(t),null===(t=v())&&(t=m());return null!==e?(58===n.charCodeAt(a)?(t=":",a++):(t=null,0===s&&l('":"')),null!==t&&null!==(r=E())?e=[e,t,r]:(e=null,a=o)):(e=null,a=o),null!==e&&(e=":"),null===e&&(a=i),e}function R(){var e,t,r,i,s,o,c;if(s=a,o=a,null!==(t=I()))for(e=[];null!==t;)e.push(t),t=I();else e=null;if(null!==e){for(t=[],c=a,r=[],i=w();null!==i;)r.push(i),i=w();for(null!==r&&null!==(i=I())?r=[r,i]:(r=null,a=c);null!==r;){for(t.push(r),c=a,r=[],i=w();null!==i;)r.push(i),i=w();null!==r&&null!==(i=I())?r=[r,i]:(r=null,a=c)}null!==t?e=[e,t]:(e=null,a=o)}else e=null,a=o;return null!==e&&(e=function(e){return n.substring(a,e)}(s)),null===e&&(a=s),e}function I(){var e;return/^[!-~]/.test(n.charAt(a))?(e=n.charAt(a),a++):(e=null,0===s&&l("[!-~]")),null===e&&(e=P()),e}function P(){var e;return/^[\x80-\uFFFF]/.test(n.charAt(a))?(e=n.charAt(a),a++):(e=null,0===s&&l("[\\x80-\\uFFFF]")),e}function A(){var e;return/^[\x80-\xBF]/.test(n.charAt(a))?(e=n.charAt(a),a++):(e=null,0===s&&l("[\\x80-\\xBF]")),e}function O(){var e,t,r;if(r=a,null===(t=y())&&(45===n.charCodeAt(a)?(t="-",a++):(t=null,0===s&&l('"-"')),null===t&&(46===n.charCodeAt(a)?(t=".",a++):(t=null,0===s&&l('"."')),null===t&&(33===n.charCodeAt(a)?(t="!",a++):(t=null,0===s&&l('"!"')),null===t&&(37===n.charCodeAt(a)?(t="%",a++):(t=null,0===s&&l('"%"')),null===t&&(42===n.charCodeAt(a)?(t="*",a++):(t=null,0===s&&l('"*"')),null===t&&(95===n.charCodeAt(a)?(t="_",a++):(t=null,0===s&&l('"_"')),null===t&&(43===n.charCodeAt(a)?(t="+",a++):(t=null,0===s&&l('"+"')),null===t&&(96===n.charCodeAt(a)?(t="`",a++):(t=null,0===s&&l('"`"')),null===t&&(39===n.charCodeAt(a)?(t="'",a++):(t=null,0===s&&l('"\'"')),null===t&&(126===n.charCodeAt(a)?(t="~",a++):(t=null,0===s&&l('"~"')))))))))))),null!==t)for(e=[];null!==t;)e.push(t),null===(t=y())&&(45===n.charCodeAt(a)?(t="-",a++):(t=null,0===s&&l('"-"')),null===t&&(46===n.charCodeAt(a)?(t=".",a++):(t=null,0===s&&l('"."')),null===t&&(33===n.charCodeAt(a)?(t="!",a++):(t=null,0===s&&l('"!"')),null===t&&(37===n.charCodeAt(a)?(t="%",a++):(t=null,0===s&&l('"%"')),null===t&&(42===n.charCodeAt(a)?(t="*",a++):(t=null,0===s&&l('"*"')),null===t&&(95===n.charCodeAt(a)?(t="_",a++):(t=null,0===s&&l('"_"')),null===t&&(43===n.charCodeAt(a)?(t="+",a++):(t=null,0===s&&l('"+"')),null===t&&(96===n.charCodeAt(a)?(t="`",a++):(t=null,0===s&&l('"`"')),null===t&&(39===n.charCodeAt(a)?(t="'",a++):(t=null,0===s&&l('"\'"')),null===t&&(126===n.charCodeAt(a)?(t="~",a++):(t=null,0===s&&l('"~"'))))))))))));else e=null;return null!==e&&(e=function(e){return n.substring(a,e)}(r)),null===e&&(a=r),e}function D(){var e,t,r;if(r=a,null===(t=y())&&(45===n.charCodeAt(a)?(t="-",a++):(t=null,0===s&&l('"-"')),null===t&&(33===n.charCodeAt(a)?(t="!",a++):(t=null,0===s&&l('"!"')),null===t&&(37===n.charCodeAt(a)?(t="%",a++):(t=null,0===s&&l('"%"')),null===t&&(42===n.charCodeAt(a)?(t="*",a++):(t=null,0===s&&l('"*"')),null===t&&(95===n.charCodeAt(a)?(t="_",a++):(t=null,0===s&&l('"_"')),null===t&&(43===n.charCodeAt(a)?(t="+",a++):(t=null,0===s&&l('"+"')),null===t&&(96===n.charCodeAt(a)?(t="`",a++):(t=null,0===s&&l('"`"')),null===t&&(39===n.charCodeAt(a)?(t="'",a++):(t=null,0===s&&l('"\'"')),null===t&&(126===n.charCodeAt(a)?(t="~",a++):(t=null,0===s&&l('"~"'))))))))))),null!==t)for(e=[];null!==t;)e.push(t),null===(t=y())&&(45===n.charCodeAt(a)?(t="-",a++):(t=null,0===s&&l('"-"')),null===t&&(33===n.charCodeAt(a)?(t="!",a++):(t=null,0===s&&l('"!"')),null===t&&(37===n.charCodeAt(a)?(t="%",a++):(t=null,0===s&&l('"%"')),null===t&&(42===n.charCodeAt(a)?(t="*",a++):(t=null,0===s&&l('"*"')),null===t&&(95===n.charCodeAt(a)?(t="_",a++):(t=null,0===s&&l('"_"')),null===t&&(43===n.charCodeAt(a)?(t="+",a++):(t=null,0===s&&l('"+"')),null===t&&(96===n.charCodeAt(a)?(t="`",a++):(t=null,0===s&&l('"`"')),null===t&&(39===n.charCodeAt(a)?(t="'",a++):(t=null,0===s&&l('"\'"')),null===t&&(126===n.charCodeAt(a)?(t="~",a++):(t=null,0===s&&l('"~"')))))))))));else e=null;return null!==e&&(e=function(e){return n.substring(a,e)}(r)),null===e&&(a=r),e}function j(){var e,t,r;if(r=a,null===(t=y())&&(45===n.charCodeAt(a)?(t="-",a++):(t=null,0===s&&l('"-"')),null===t&&(46===n.charCodeAt(a)?(t=".",a++):(t=null,0===s&&l('"."')),null===t&&(33===n.charCodeAt(a)?(t="!",a++):(t=null,0===s&&l('"!"')),null===t&&(37===n.charCodeAt(a)?(t="%",a++):(t=null,0===s&&l('"%"')),null===t&&(42===n.charCodeAt(a)?(t="*",a++):(t=null,0===s&&l('"*"')),null===t&&(95===n.charCodeAt(a)?(t="_",a++):(t=null,0===s&&l('"_"')),null===t&&(43===n.charCodeAt(a)?(t="+",a++):(t=null,0===s&&l('"+"')),null===t&&(96===n.charCodeAt(a)?(t="`",a++):(t=null,0===s&&l('"`"')),null===t&&(39===n.charCodeAt(a)?(t="'",a++):(t=null,0===s&&l('"\'"')),null===t&&(126===n.charCodeAt(a)?(t="~",a++):(t=null,0===s&&l('"~"')),null===t&&(40===n.charCodeAt(a)?(t="(",a++):(t=null,0===s&&l('"("')),null===t&&(41===n.charCodeAt(a)?(t=")",a++):(t=null,0===s&&l('")"')),null===t&&(60===n.charCodeAt(a)?(t="<",a++):(t=null,0===s&&l('"<"')),null===t&&(62===n.charCodeAt(a)?(t=">",a++):(t=null,0===s&&l('">"')),null===t&&(58===n.charCodeAt(a)?(t=":",a++):(t=null,0===s&&l('":"')),null===t&&(92===n.charCodeAt(a)?(t="\\",a++):(t=null,0===s&&l('"\\\\"')),null===t&&null===(t=b())&&(47===n.charCodeAt(a)?(t="/",a++):(t=null,0===s&&l('"/"')),null===t&&(91===n.charCodeAt(a)?(t="[",a++):(t=null,0===s&&l('"["')),null===t&&(93===n.charCodeAt(a)?(t="]",a++):(t=null,0===s&&l('"]"')),null===t&&(63===n.charCodeAt(a)?(t="?",a++):(t=null,0===s&&l('"?"')),null===t&&(123===n.charCodeAt(a)?(t="{",a++):(t=null,0===s&&l('"{"')),null===t&&(125===n.charCodeAt(a)?(t="}",a++):(t=null,0===s&&l('"}"')))))))))))))))))))))))),null!==t)for(e=[];null!==t;)e.push(t),null===(t=y())&&(45===n.charCodeAt(a)?(t="-",a++):(t=null,0===s&&l('"-"')),null===t&&(46===n.charCodeAt(a)?(t=".",a++):(t=null,0===s&&l('"."')),null===t&&(33===n.charCodeAt(a)?(t="!",a++):(t=null,0===s&&l('"!"')),null===t&&(37===n.charCodeAt(a)?(t="%",a++):(t=null,0===s&&l('"%"')),null===t&&(42===n.charCodeAt(a)?(t="*",a++):(t=null,0===s&&l('"*"')),null===t&&(95===n.charCodeAt(a)?(t="_",a++):(t=null,0===s&&l('"_"')),null===t&&(43===n.charCodeAt(a)?(t="+",a++):(t=null,0===s&&l('"+"')),null===t&&(96===n.charCodeAt(a)?(t="`",a++):(t=null,0===s&&l('"`"')),null===t&&(39===n.charCodeAt(a)?(t="'",a++):(t=null,0===s&&l('"\'"')),null===t&&(126===n.charCodeAt(a)?(t="~",a++):(t=null,0===s&&l('"~"')),null===t&&(40===n.charCodeAt(a)?(t="(",a++):(t=null,0===s&&l('"("')),null===t&&(41===n.charCodeAt(a)?(t=")",a++):(t=null,0===s&&l('")"')),null===t&&(60===n.charCodeAt(a)?(t="<",a++):(t=null,0===s&&l('"<"')),null===t&&(62===n.charCodeAt(a)?(t=">",a++):(t=null,0===s&&l('">"')),null===t&&(58===n.charCodeAt(a)?(t=":",a++):(t=null,0===s&&l('":"')),null===t&&(92===n.charCodeAt(a)?(t="\\",a++):(t=null,0===s&&l('"\\\\"')),null===t&&null===(t=b())&&(47===n.charCodeAt(a)?(t="/",a++):(t=null,0===s&&l('"/"')),null===t&&(91===n.charCodeAt(a)?(t="[",a++):(t=null,0===s&&l('"["')),null===t&&(93===n.charCodeAt(a)?(t="]",a++):(t=null,0===s&&l('"]"')),null===t&&(63===n.charCodeAt(a)?(t="?",a++):(t=null,0===s&&l('"?"')),null===t&&(123===n.charCodeAt(a)?(t="{",a++):(t=null,0===s&&l('"{"')),null===t&&(125===n.charCodeAt(a)?(t="}",a++):(t=null,0===s&&l('"}"'))))))))))))))))))))))));else e=null;return null!==e&&(e=function(e){return n.substring(a,e)}(r)),null===e&&(a=r),e}function M(){var e,t,r,i,o;return i=a,o=a,null!==(e=E())?(42===n.charCodeAt(a)?(t="*",a++):(t=null,0===s&&l('"*"')),null!==t&&null!==(r=E())?e=[e,t,r]:(e=null,a=o)):(e=null,a=o),null!==e&&(e="*"),null===e&&(a=i),e}function x(){var e,t,r,i,o;return i=a,o=a,null!==(e=E())?(47===n.charCodeAt(a)?(t="/",a++):(t=null,0===s&&l('"/"')),null!==t&&null!==(r=E())?e=[e,t,r]:(e=null,a=o)):(e=null,a=o),null!==e&&(e="/"),null===e&&(a=i),e}function N(){var e,t,r,i,o;return i=a,o=a,null!==(e=E())?(61===n.charCodeAt(a)?(t="=",a++):(t=null,0===s&&l('"="')),null!==t&&null!==(r=E())?e=[e,t,r]:(e=null,a=o)):(e=null,a=o),null!==e&&(e="="),null===e&&(a=i),e}function F(){var e,t,r,i,o;return i=a,o=a,null!==(e=E())?(40===n.charCodeAt(a)?(t="(",a++):(t=null,0===s&&l('"("')),null!==t&&null!==(r=E())?e=[e,t,r]:(e=null,a=o)):(e=null,a=o),null!==e&&(e="("),null===e&&(a=i),e}function U(){var e,t,r,i,o;return i=a,o=a,null!==(e=E())?(41===n.charCodeAt(a)?(t=")",a++):(t=null,0===s&&l('")"')),null!==t&&null!==(r=E())?e=[e,t,r]:(e=null,a=o)):(e=null,a=o),null!==e&&(e=")"),null===e&&(a=i),e}function L(){var e,t,r,i;return r=a,i=a,62===n.charCodeAt(a)?(e=">",a++):(e=null,0===s&&l('">"')),null!==e&&null!==(t=E())?e=[e,t]:(e=null,a=i),null!==e&&(e=">"),null===e&&(a=r),e}function H(){var e,t,r,i;return r=a,i=a,null!==(e=E())?(60===n.charCodeAt(a)?(t="<",a++):(t=null,0===s&&l('"<"')),null!==t?e=[e,t]:(e=null,a=i)):(e=null,a=i),null!==e&&(e="<"),null===e&&(a=r),e}function q(){var e,t,r,i,o;return i=a,o=a,null!==(e=E())?(44===n.charCodeAt(a)?(t=",",a++):(t=null,0===s&&l('","')),null!==t&&null!==(r=E())?e=[e,t,r]:(e=null,a=o)):(e=null,a=o),null!==e&&(e=","),null===e&&(a=i),e}function B(){var e,t,r,i,o;return i=a,o=a,null!==(e=E())?(59===n.charCodeAt(a)?(t=";",a++):(t=null,0===s&&l('";"')),null!==t&&null!==(r=E())?e=[e,t,r]:(e=null,a=o)):(e=null,a=o),null!==e&&(e=";"),null===e&&(a=i),e}function G(){var e,t,r,i,o;return i=a,o=a,null!==(e=E())?(58===n.charCodeAt(a)?(t=":",a++):(t=null,0===s&&l('":"')),null!==t&&null!==(r=E())?e=[e,t,r]:(e=null,a=o)):(e=null,a=o),null!==e&&(e=":"),null===e&&(a=i),e}function $(){var e,n,t,r;return t=a,r=a,null!==(e=E())&&null!==(n=b())?e=[e,n]:(e=null,a=r),null!==e&&(e='"'),null===e&&(a=t),e}function V(){var e,n,t,r;return t=a,r=a,null!==(e=b())&&null!==(n=E())?e=[e,n]:(e=null,a=r),null!==e&&(e='"'),null===e&&(a=t),e}function W(){var e;return/^[!-']/.test(n.charAt(a))?(e=n.charAt(a),a++):(e=null,0===s&&l("[!-']")),null===e&&(/^[*-[]/.test(n.charAt(a))?(e=n.charAt(a),a++):(e=null,0===s&&l("[*-[]")),null===e&&(/^[\]-~]/.test(n.charAt(a))?(e=n.charAt(a),a++):(e=null,0===s&&l("[\\]-~]")),null===e&&null===(e=P())&&(e=w()))),e}function z(){var e,t,r,i,s,o;if(s=a,o=a,null!==(e=E()))if(null!==(t=b())){for(r=[],null===(i=J())&&(i=Q());null!==i;)r.push(i),null===(i=J())&&(i=Q());null!==r&&null!==(i=b())?e=[e,t,r,i]:(e=null,a=o)}else e=null,a=o;else e=null,a=o;return null!==e&&(e=function(e){return n.substring(a,e)}(s)),null===e&&(a=s),e}function K(){var e,t,r,i,s,o;if(s=a,o=a,null!==(e=E()))if(null!==(t=b())){for(r=[],null===(i=J())&&(i=Q());null!==i;)r.push(i),null===(i=J())&&(i=Q());null!==r&&null!==(i=b())?e=[e,t,r,i]:(e=null,a=o)}else e=null,a=o;else e=null,a=o;return null!==e&&(e=function(e){return n.substring(a-1,e+1)}(s)),null===e&&(a=s),e}function J(){var e;return null===(e=w())&&(33===n.charCodeAt(a)?(e="!",a++):(e=null,0===s&&l('"!"')),null===e&&(/^[#-[]/.test(n.charAt(a))?(e=n.charAt(a),a++):(e=null,0===s&&l("[#-[]")),null===e&&(/^[\]-~]/.test(n.charAt(a))?(e=n.charAt(a),a++):(e=null,0===s&&l("[\\]-~]")),null===e&&(e=P())))),e}function Q(){var e,t,r;return r=a,92===n.charCodeAt(a)?(e="\\",a++):(e=null,0===s&&l('"\\\\"')),null!==e?(/^[\0-\t]/.test(n.charAt(a))?(t=n.charAt(a),a++):(t=null,0===s&&l("[\\0-\\t]")),null===t&&(/^[\x0B-\f]/.test(n.charAt(a))?(t=n.charAt(a),a++):(t=null,0===s&&l("[\\x0B-\\f]")),null===t&&(/^[\x0E-]/.test(n.charAt(a))?(t=n.charAt(a),a++):(t=null,0===s&&l("[\\x0E-]")))),null!==t?e=[e,t]:(e=null,a=r)):(e=null,a=r),e}function X(){var e,t,r,i,o,c;return o=a,c=a,null!==(e=Z())?(58===n.charCodeAt(a)?(t=":",a++):(t=null,0===s&&l('":"')),null!==t&&null!==(r=null!==(r=te())?r:"")&&null!==(i=se())?e=[e,t,r,i]:(e=null,a=c)):(e=null,a=c),null!==e&&(e=function(e){try{Ht.uri=new Ut(Ht.scheme,Ht.user,Ht.host,Ht.port),delete Ht.scheme,delete Ht.user,delete Ht.host,delete Ht.host_type,delete Ht.port}catch(e){Ht=-1}}()),null===e&&(a=o),e}function Y(){var e,t,i,o,c,u,d,h;return d=a,h=a,null!==(e=Z())?(58===n.charCodeAt(a)?(t=":",a++):(t=null,0===s&&l('":"')),null!==t&&null!==(i=null!==(i=te())?i:"")&&null!==(o=se())&&null!==(c=me())&&null!==(u=null!==(u=Oe())?u:"")?e=[e,t,i,o,c,u]:(e=null,a=h)):(e=null,a=h),null!==e&&(e=function(e){try{Ht.uri=new Ut(Ht.scheme,Ht.user,Ht.host,Ht.port,Ht.uri_params,Ht.uri_headers),delete Ht.scheme,delete Ht.user,delete Ht.host,delete Ht.host_type,delete Ht.port,delete Ht.uri_params,"SIP_URI"===r&&(Ht=Ht.uri)}catch(e){Ht=-1}}()),null===e&&(a=d),e}function Z(){var e;return null===(e=ee())&&(e=ne()),e}function ee(){var e,t;return t=a,"sips"===n.substr(a,4).toLowerCase()?(e=n.substr(a,4),a+=4):(e=null,0===s&&l('"sips"')),null!==e&&(e=function(e,n){Ht.scheme=n.toLowerCase()}(0,e)),null===e&&(a=t),e}function ne(){var e,t;return t=a,"sip"===n.substr(a,3).toLowerCase()?(e=n.substr(a,3),a+=3):(e=null,0===s&&l('"sip"')),null!==e&&(e=function(e,n){Ht.scheme=n.toLowerCase()}(0,e)),null===e&&(a=t),e}function te(){var e,t,r,i,o,c;return i=a,o=a,null!==(e=re())?(c=a,58===n.charCodeAt(a)?(t=":",a++):(t=null,0===s&&l('":"')),null!==t&&null!==(r=ae())?t=[t,r]:(t=null,a=c),null!==(t=null!==t?t:"")?(64===n.charCodeAt(a)?(r="@",a++):(r=null,0===s&&l('"@"')),null!==r?e=[e,t,r]:(e=null,a=o)):(e=null,a=o)):(e=null,a=o),null!==e&&(e=function(e){Ht.user=decodeURIComponent(n.substring(a-1,e))}(i)),null===e&&(a=i),e}function re(){var e,n;if(null===(n=S())&&null===(n=T())&&(n=ie()),null!==n)for(e=[];null!==n;)e.push(n),null===(n=S())&&null===(n=T())&&(n=ie());else e=null;return e}function ie(){var e;return 38===n.charCodeAt(a)?(e="&",a++):(e=null,0===s&&l('"&"')),null===e&&(61===n.charCodeAt(a)?(e="=",a++):(e=null,0===s&&l('"="')),null===e&&(43===n.charCodeAt(a)?(e="+",a++):(e=null,0===s&&l('"+"')),null===e&&(36===n.charCodeAt(a)?(e="$",a++):(e=null,0===s&&l('"$"')),null===e&&(44===n.charCodeAt(a)?(e=",",a++):(e=null,0===s&&l('","')),null===e&&(59===n.charCodeAt(a)?(e=";",a++):(e=null,0===s&&l('";"')),null===e&&(63===n.charCodeAt(a)?(e="?",a++):(e=null,0===s&&l('"?"')),null===e&&(47===n.charCodeAt(a)?(e="/",a++):(e=null,0===s&&l('"/"'))))))))),e}function ae(){var e,t,r;for(r=a,e=[],null===(t=S())&&null===(t=T())&&(38===n.charCodeAt(a)?(t="&",a++):(t=null,0===s&&l('"&"')),null===t&&(61===n.charCodeAt(a)?(t="=",a++):(t=null,0===s&&l('"="')),null===t&&(43===n.charCodeAt(a)?(t="+",a++):(t=null,0===s&&l('"+"')),null===t&&(36===n.charCodeAt(a)?(t="$",a++):(t=null,0===s&&l('"$"')),null===t&&(44===n.charCodeAt(a)?(t=",",a++):(t=null,0===s&&l('","')))))));null!==t;)e.push(t),null===(t=S())&&null===(t=T())&&(38===n.charCodeAt(a)?(t="&",a++):(t=null,0===s&&l('"&"')),null===t&&(61===n.charCodeAt(a)?(t="=",a++):(t=null,0===s&&l('"="')),null===t&&(43===n.charCodeAt(a)?(t="+",a++):(t=null,0===s&&l('"+"')),null===t&&(36===n.charCodeAt(a)?(t="$",a++):(t=null,0===s&&l('"$"')),null===t&&(44===n.charCodeAt(a)?(t=",",a++):(t=null,0===s&&l('","')))))));return null!==e&&(e=function(e){Ht.password=n.substring(a,e)}(r)),null===e&&(a=r),e}function se(){var e,t,r,i,o;return i=a,null!==(e=oe())?(o=a,58===n.charCodeAt(a)?(t=":",a++):(t=null,0===s&&l('":"')),null!==t&&null!==(r=ve())?t=[t,r]:(t=null,a=o),null!==(t=null!==t?t:"")?e=[e,t]:(e=null,a=i)):(e=null,a=i),e}function oe(){var e,t;return t=a,null===(e=ce())&&null===(e=ge())&&(e=de()),null!==e&&(e=function(e){return Ht.host=n.substring(a,e).toLowerCase(),Ht.host}(t)),null===e&&(a=t),e}function ce(){var e,t,r,i,o,c;for(i=a,o=a,e=[],c=a,null!==(t=le())?(46===n.charCodeAt(a)?(r=".",a++):(r=null,0===s&&l('"."')),null!==r?t=[t,r]:(t=null,a=c)):(t=null,a=c);null!==t;)e.push(t),c=a,null!==(t=le())?(46===n.charCodeAt(a)?(r=".",a++):(r=null,0===s&&l('"."')),null!==r?t=[t,r]:(t=null,a=c)):(t=null,a=c);return null!==e&&null!==(t=ue())?(46===n.charCodeAt(a)?(r=".",a++):(r=null,0===s&&l('"."')),null!==(r=null!==r?r:"")?e=[e,t,r]:(e=null,a=o)):(e=null,a=o),null!==e&&(e=function(e){return Ht.host_type="domain",n.substring(a,e)}(i)),null===e&&(a=i),e}function le(){var e,t,r,i;if(i=a,null!==(e=y())){for(t=[],null===(r=y())&&(45===n.charCodeAt(a)?(r="-",a++):(r=null,0===s&&l('"-"')),null===r&&(95===n.charCodeAt(a)?(r="_",a++):(r=null,0===s&&l('"_"'))));null!==r;)t.push(r),null===(r=y())&&(45===n.charCodeAt(a)?(r="-",a++):(r=null,0===s&&l('"-"')),null===r&&(95===n.charCodeAt(a)?(r="_",a++):(r=null,0===s&&l('"_"'))));null!==t?e=[e,t]:(e=null,a=i)}else e=null,a=i;return e}function ue(){var e,t,r,i;if(i=a,null!==(e=h())){for(t=[],null===(r=y())&&(45===n.charCodeAt(a)?(r="-",a++):(r=null,0===s&&l('"-"')),null===r&&(95===n.charCodeAt(a)?(r="_",a++):(r=null,0===s&&l('"_"'))));null!==r;)t.push(r),null===(r=y())&&(45===n.charCodeAt(a)?(r="-",a++):(r=null,0===s&&l('"-"')),null===r&&(95===n.charCodeAt(a)?(r="_",a++):(r=null,0===s&&l('"_"'))));null!==t?e=[e,t]:(e=null,a=i)}else e=null,a=i;return e}function de(){var e,t,r,i,o;return i=a,o=a,91===n.charCodeAt(a)?(e="[",a++):(e=null,0===s&&l('"["')),null!==e&&null!==(t=he())?(93===n.charCodeAt(a)?(r="]",a++):(r=null,0===s&&l('"]"')),null!==r?e=[e,t,r]:(e=null,a=o)):(e=null,a=o),null!==e&&(e=function(e){return Ht.host_type="IPv6",n.substring(a,e)}(i)),null===e&&(a=i),e}function he(){var e,t,r,i,o,c,u,d,h,f,p,g,b,v,m,y;return v=a,m=a,null!==(e=fe())?(58===n.charCodeAt(a)?(t=":",a++):(t=null,0===s&&l('":"')),null!==t&&null!==(r=fe())?(58===n.charCodeAt(a)?(i=":",a++):(i=null,0===s&&l('":"')),null!==i&&null!==(o=fe())?(58===n.charCodeAt(a)?(c=":",a++):(c=null,0===s&&l('":"')),null!==c&&null!==(u=fe())?(58===n.charCodeAt(a)?(d=":",a++):(d=null,0===s&&l('":"')),null!==d&&null!==(h=fe())?(58===n.charCodeAt(a)?(f=":",a++):(f=null,0===s&&l('":"')),null!==f&&null!==(p=fe())?(58===n.charCodeAt(a)?(g=":",a++):(g=null,0===s&&l('":"')),null!==g&&null!==(b=pe())?e=[e,t,r,i,o,c,u,d,h,f,p,g,b]:(e=null,a=m)):(e=null,a=m)):(e=null,a=m)):(e=null,a=m)):(e=null,a=m)):(e=null,a=m)):(e=null,a=m),null===e&&(m=a,"::"===n.substr(a,2)?(e="::",a+=2):(e=null,0===s&&l('"::"')),null!==e&&null!==(t=fe())?(58===n.charCodeAt(a)?(r=":",a++):(r=null,0===s&&l('":"')),null!==r&&null!==(i=fe())?(58===n.charCodeAt(a)?(o=":",a++):(o=null,0===s&&l('":"')),null!==o&&null!==(c=fe())?(58===n.charCodeAt(a)?(u=":",a++):(u=null,0===s&&l('":"')),null!==u&&null!==(d=fe())?(58===n.charCodeAt(a)?(h=":",a++):(h=null,0===s&&l('":"')),null!==h&&null!==(f=fe())?(58===n.charCodeAt(a)?(p=":",a++):(p=null,0===s&&l('":"')),null!==p&&null!==(g=pe())?e=[e,t,r,i,o,c,u,d,h,f,p,g]:(e=null,a=m)):(e=null,a=m)):(e=null,a=m)):(e=null,a=m)):(e=null,a=m)):(e=null,a=m),null===e&&(m=a,"::"===n.substr(a,2)?(e="::",a+=2):(e=null,0===s&&l('"::"')),null!==e&&null!==(t=fe())?(58===n.charCodeAt(a)?(r=":",a++):(r=null,0===s&&l('":"')),null!==r&&null!==(i=fe())?(58===n.charCodeAt(a)?(o=":",a++):(o=null,0===s&&l('":"')),null!==o&&null!==(c=fe())?(58===n.charCodeAt(a)?(u=":",a++):(u=null,0===s&&l('":"')),null!==u&&null!==(d=fe())?(58===n.charCodeAt(a)?(h=":",a++):(h=null,0===s&&l('":"')),null!==h&&null!==(f=pe())?e=[e,t,r,i,o,c,u,d,h,f]:(e=null,a=m)):(e=null,a=m)):(e=null,a=m)):(e=null,a=m)):(e=null,a=m),null===e&&(m=a,"::"===n.substr(a,2)?(e="::",a+=2):(e=null,0===s&&l('"::"')),null!==e&&null!==(t=fe())?(58===n.charCodeAt(a)?(r=":",a++):(r=null,0===s&&l('":"')),null!==r&&null!==(i=fe())?(58===n.charCodeAt(a)?(o=":",a++):(o=null,0===s&&l('":"')),null!==o&&null!==(c=fe())?(58===n.charCodeAt(a)?(u=":",a++):(u=null,0===s&&l('":"')),null!==u&&null!==(d=pe())?e=[e,t,r,i,o,c,u,d]:(e=null,a=m)):(e=null,a=m)):(e=null,a=m)):(e=null,a=m),null===e&&(m=a,"::"===n.substr(a,2)?(e="::",a+=2):(e=null,0===s&&l('"::"')),null!==e&&null!==(t=fe())?(58===n.charCodeAt(a)?(r=":",a++):(r=null,0===s&&l('":"')),null!==r&&null!==(i=fe())?(58===n.charCodeAt(a)?(o=":",a++):(o=null,0===s&&l('":"')),null!==o&&null!==(c=pe())?e=[e,t,r,i,o,c]:(e=null,a=m)):(e=null,a=m)):(e=null,a=m),null===e&&(m=a,"::"===n.substr(a,2)?(e="::",a+=2):(e=null,0===s&&l('"::"')),null!==e&&null!==(t=fe())?(58===n.charCodeAt(a)?(r=":",a++):(r=null,0===s&&l('":"')),null!==r&&null!==(i=pe())?e=[e,t,r,i]:(e=null,a=m)):(e=null,a=m),null===e&&(m=a,"::"===n.substr(a,2)?(e="::",a+=2):(e=null,0===s&&l('"::"')),null!==e&&null!==(t=pe())?e=[e,t]:(e=null,a=m),null===e&&(m=a,"::"===n.substr(a,2)?(e="::",a+=2):(e=null,0===s&&l('"::"')),null!==e&&null!==(t=fe())?e=[e,t]:(e=null,a=m),null===e&&(m=a,null!==(e=fe())?("::"===n.substr(a,2)?(t="::",a+=2):(t=null,0===s&&l('"::"')),null!==t&&null!==(r=fe())?(58===n.charCodeAt(a)?(i=":",a++):(i=null,0===s&&l('":"')),null!==i&&null!==(o=fe())?(58===n.charCodeAt(a)?(c=":",a++):(c=null,0===s&&l('":"')),null!==c&&null!==(u=fe())?(58===n.charCodeAt(a)?(d=":",a++):(d=null,0===s&&l('":"')),null!==d&&null!==(h=fe())?(58===n.charCodeAt(a)?(f=":",a++):(f=null,0===s&&l('":"')),null!==f&&null!==(p=pe())?e=[e,t,r,i,o,c,u,d,h,f,p]:(e=null,a=m)):(e=null,a=m)):(e=null,a=m)):(e=null,a=m)):(e=null,a=m)):(e=null,a=m),null===e&&(m=a,null!==(e=fe())?(y=a,58===n.charCodeAt(a)?(t=":",a++):(t=null,0===s&&l('":"')),null!==t&&null!==(r=fe())?t=[t,r]:(t=null,a=y),null!==(t=null!==t?t:"")?("::"===n.substr(a,2)?(r="::",a+=2):(r=null,0===s&&l('"::"')),null!==r&&null!==(i=fe())?(58===n.charCodeAt(a)?(o=":",a++):(o=null,0===s&&l('":"')),null!==o&&null!==(c=fe())?(58===n.charCodeAt(a)?(u=":",a++):(u=null,0===s&&l('":"')),null!==u&&null!==(d=fe())?(58===n.charCodeAt(a)?(h=":",a++):(h=null,0===s&&l('":"')),null!==h&&null!==(f=pe())?e=[e,t,r,i,o,c,u,d,h,f]:(e=null,a=m)):(e=null,a=m)):(e=null,a=m)):(e=null,a=m)):(e=null,a=m)):(e=null,a=m),null===e&&(m=a,null!==(e=fe())?(y=a,58===n.charCodeAt(a)?(t=":",a++):(t=null,0===s&&l('":"')),null!==t&&null!==(r=fe())?t=[t,r]:(t=null,a=y),null!==(t=null!==t?t:"")?(y=a,58===n.charCodeAt(a)?(r=":",a++):(r=null,0===s&&l('":"')),null!==r&&null!==(i=fe())?r=[r,i]:(r=null,a=y),null!==(r=null!==r?r:"")?("::"===n.substr(a,2)?(i="::",a+=2):(i=null,0===s&&l('"::"')),null!==i&&null!==(o=fe())?(58===n.charCodeAt(a)?(c=":",a++):(c=null,0===s&&l('":"')),null!==c&&null!==(u=fe())?(58===n.charCodeAt(a)?(d=":",a++):(d=null,0===s&&l('":"')),null!==d&&null!==(h=pe())?e=[e,t,r,i,o,c,u,d,h]:(e=null,a=m)):(e=null,a=m)):(e=null,a=m)):(e=null,a=m)):(e=null,a=m)):(e=null,a=m),null===e&&(m=a,null!==(e=fe())?(y=a,58===n.charCodeAt(a)?(t=":",a++):(t=null,0===s&&l('":"')),null!==t&&null!==(r=fe())?t=[t,r]:(t=null,a=y),null!==(t=null!==t?t:"")?(y=a,58===n.charCodeAt(a)?(r=":",a++):(r=null,0===s&&l('":"')),null!==r&&null!==(i=fe())?r=[r,i]:(r=null,a=y),null!==(r=null!==r?r:"")?(y=a,58===n.charCodeAt(a)?(i=":",a++):(i=null,0===s&&l('":"')),null!==i&&null!==(o=fe())?i=[i,o]:(i=null,a=y),null!==(i=null!==i?i:"")?("::"===n.substr(a,2)?(o="::",a+=2):(o=null,0===s&&l('"::"')),null!==o&&null!==(c=fe())?(58===n.charCodeAt(a)?(u=":",a++):(u=null,0===s&&l('":"')),null!==u&&null!==(d=pe())?e=[e,t,r,i,o,c,u,d]:(e=null,a=m)):(e=null,a=m)):(e=null,a=m)):(e=null,a=m)):(e=null,a=m)):(e=null,a=m),null===e&&(m=a,null!==(e=fe())?(y=a,58===n.charCodeAt(a)?(t=":",a++):(t=null,0===s&&l('":"')),null!==t&&null!==(r=fe())?t=[t,r]:(t=null,a=y),null!==(t=null!==t?t:"")?(y=a,58===n.charCodeAt(a)?(r=":",a++):(r=null,0===s&&l('":"')),null!==r&&null!==(i=fe())?r=[r,i]:(r=null,a=y),null!==(r=null!==r?r:"")?(y=a,58===n.charCodeAt(a)?(i=":",a++):(i=null,0===s&&l('":"')),null!==i&&null!==(o=fe())?i=[i,o]:(i=null,a=y),null!==(i=null!==i?i:"")?(y=a,58===n.charCodeAt(a)?(o=":",a++):(o=null,0===s&&l('":"')),null!==o&&null!==(c=fe())?o=[o,c]:(o=null,a=y),null!==(o=null!==o?o:"")?("::"===n.substr(a,2)?(c="::",a+=2):(c=null,0===s&&l('"::"')),null!==c&&null!==(u=pe())?e=[e,t,r,i,o,c,u]:(e=null,a=m)):(e=null,a=m)):(e=null,a=m)):(e=null,a=m)):(e=null,a=m)):(e=null,a=m),null===e&&(m=a,null!==(e=fe())?(y=a,58===n.charCodeAt(a)?(t=":",a++):(t=null,0===s&&l('":"')),null!==t&&null!==(r=fe())?t=[t,r]:(t=null,a=y),null!==(t=null!==t?t:"")?(y=a,58===n.charCodeAt(a)?(r=":",a++):(r=null,0===s&&l('":"')),null!==r&&null!==(i=fe())?r=[r,i]:(r=null,a=y),null!==(r=null!==r?r:"")?(y=a,58===n.charCodeAt(a)?(i=":",a++):(i=null,0===s&&l('":"')),null!==i&&null!==(o=fe())?i=[i,o]:(i=null,a=y),null!==(i=null!==i?i:"")?(y=a,58===n.charCodeAt(a)?(o=":",a++):(o=null,0===s&&l('":"')),null!==o&&null!==(c=fe())?o=[o,c]:(o=null,a=y),null!==(o=null!==o?o:"")?(y=a,58===n.charCodeAt(a)?(c=":",a++):(c=null,0===s&&l('":"')),null!==c&&null!==(u=fe())?c=[c,u]:(c=null,a=y),null!==(c=null!==c?c:"")?("::"===n.substr(a,2)?(u="::",a+=2):(u=null,0===s&&l('"::"')),null!==u&&null!==(d=fe())?e=[e,t,r,i,o,c,u,d]:(e=null,a=m)):(e=null,a=m)):(e=null,a=m)):(e=null,a=m)):(e=null,a=m)):(e=null,a=m)):(e=null,a=m),null===e&&(m=a,null!==(e=fe())?(y=a,58===n.charCodeAt(a)?(t=":",a++):(t=null,0===s&&l('":"')),null!==t&&null!==(r=fe())?t=[t,r]:(t=null,a=y),null!==(t=null!==t?t:"")?(y=a,58===n.charCodeAt(a)?(r=":",a++):(r=null,0===s&&l('":"')),null!==r&&null!==(i=fe())?r=[r,i]:(r=null,a=y),null!==(r=null!==r?r:"")?(y=a,58===n.charCodeAt(a)?(i=":",a++):(i=null,0===s&&l('":"')),null!==i&&null!==(o=fe())?i=[i,o]:(i=null,a=y),null!==(i=null!==i?i:"")?(y=a,58===n.charCodeAt(a)?(o=":",a++):(o=null,0===s&&l('":"')),null!==o&&null!==(c=fe())?o=[o,c]:(o=null,a=y),null!==(o=null!==o?o:"")?(y=a,58===n.charCodeAt(a)?(c=":",a++):(c=null,0===s&&l('":"')),null!==c&&null!==(u=fe())?c=[c,u]:(c=null,a=y),null!==(c=null!==c?c:"")?(y=a,58===n.charCodeAt(a)?(u=":",a++):(u=null,0===s&&l('":"')),null!==u&&null!==(d=fe())?u=[u,d]:(u=null,a=y),null!==(u=null!==u?u:"")?("::"===n.substr(a,2)?(d="::",a+=2):(d=null,0===s&&l('"::"')),null!==d?e=[e,t,r,i,o,c,u,d]:(e=null,a=m)):(e=null,a=m)):(e=null,a=m)):(e=null,a=m)):(e=null,a=m)):(e=null,a=m)):(e=null,a=m)):(e=null,a=m))))))))))))))),null!==e&&(e=function(e){return Ht.host_type="IPv6",n.substring(a,e)}(v)),null===e&&(a=v),e}function fe(){var e,n,t,r,i;return i=a,null!==(e=f())&&null!==(n=null!==(n=f())?n:"")&&null!==(t=null!==(t=f())?t:"")&&null!==(r=null!==(r=f())?r:"")?e=[e,n,t,r]:(e=null,a=i),e}function pe(){var e,t,r,i;return i=a,null!==(e=fe())?(58===n.charCodeAt(a)?(t=":",a++):(t=null,0===s&&l('":"')),null!==t&&null!==(r=fe())?e=[e,t,r]:(e=null,a=i)):(e=null,a=i),null===e&&(e=ge()),e}function ge(){var e,t,r,i,o,c,u,d,h;return d=a,h=a,null!==(e=be())?(46===n.charCodeAt(a)?(t=".",a++):(t=null,0===s&&l('"."')),null!==t&&null!==(r=be())?(46===n.charCodeAt(a)?(i=".",a++):(i=null,0===s&&l('"."')),null!==i&&null!==(o=be())?(46===n.charCodeAt(a)?(c=".",a++):(c=null,0===s&&l('"."')),null!==c&&null!==(u=be())?e=[e,t,r,i,o,c,u]:(e=null,a=h)):(e=null,a=h)):(e=null,a=h)):(e=null,a=h),null!==e&&(e=function(e){return Ht.host_type="IPv4",n.substring(a,e)}(d)),null===e&&(a=d),e}function be(){var e,t,r,i;return i=a,"25"===n.substr(a,2)?(e="25",a+=2):(e=null,0===s&&l('"25"')),null!==e?(/^[0-5]/.test(n.charAt(a))?(t=n.charAt(a),a++):(t=null,0===s&&l("[0-5]")),null!==t?e=[e,t]:(e=null,a=i)):(e=null,a=i),null===e&&(i=a,50===n.charCodeAt(a)?(e="2",a++):(e=null,0===s&&l('"2"')),null!==e?(/^[0-4]/.test(n.charAt(a))?(t=n.charAt(a),a++):(t=null,0===s&&l("[0-4]")),null!==t&&null!==(r=d())?e=[e,t,r]:(e=null,a=i)):(e=null,a=i),null===e&&(i=a,49===n.charCodeAt(a)?(e="1",a++):(e=null,0===s&&l('"1"')),null!==e&&null!==(t=d())&&null!==(r=d())?e=[e,t,r]:(e=null,a=i),null===e&&(i=a,/^[1-9]/.test(n.charAt(a))?(e=n.charAt(a),a++):(e=null,0===s&&l("[1-9]")),null!==e&&null!==(t=d())?e=[e,t]:(e=null,a=i),null===e&&(e=d())))),e}function ve(){var e,n,t,r,i,s,o;return s=a,o=a,null!==(e=null!==(e=d())?e:"")&&null!==(n=null!==(n=d())?n:"")&&null!==(t=null!==(t=d())?t:"")&&null!==(r=null!==(r=d())?r:"")&&null!==(i=null!==(i=d())?i:"")?e=[e,n,t,r,i]:(e=null,a=o),null!==e&&(e=function(e,n){return n=parseInt(n.join("")),Ht.port=n,n}(0,e)),null===e&&(a=s),e}function me(){var e,t,r,i;for(e=[],i=a,59===n.charCodeAt(a)?(t=";",a++):(t=null,0===s&&l('";"')),null!==t&&null!==(r=ye())?t=[t,r]:(t=null,a=i);null!==t;)e.push(t),i=a,59===n.charCodeAt(a)?(t=";",a++):(t=null,0===s&&l('";"')),null!==t&&null!==(r=ye())?t=[t,r]:(t=null,a=i);return e}function ye(){var e;return null===(e=_e())&&null===(e=Se())&&null===(e=Ce())&&null===(e=Te())&&null===(e=we())&&null===(e=Ee())&&(e=ke()),e}function _e(){var e,t,r,i;return r=a,i=a,"transport="===n.substr(a,10).toLowerCase()?(e=n.substr(a,10),a+=10):(e=null,0===s&&l('"transport="')),null!==e?("udp"===n.substr(a,3).toLowerCase()?(t=n.substr(a,3),a+=3):(t=null,0===s&&l('"udp"')),null===t&&("tcp"===n.substr(a,3).toLowerCase()?(t=n.substr(a,3),a+=3):(t=null,0===s&&l('"tcp"')),null===t&&("sctp"===n.substr(a,4).toLowerCase()?(t=n.substr(a,4),a+=4):(t=null,0===s&&l('"sctp"')),null===t&&("tls"===n.substr(a,3).toLowerCase()?(t=n.substr(a,3),a+=3):(t=null,0===s&&l('"tls"')),null===t&&(t=O())))),null!==t?e=[e,t]:(e=null,a=i)):(e=null,a=i),null!==e&&(e=function(e,n){Ht.uri_params||(Ht.uri_params={}),Ht.uri_params.transport=n.toLowerCase()}(0,e[1])),null===e&&(a=r),e}function Se(){var e,t,r,i;return r=a,i=a,"user="===n.substr(a,5).toLowerCase()?(e=n.substr(a,5),a+=5):(e=null,0===s&&l('"user="')),null!==e?("phone"===n.substr(a,5).toLowerCase()?(t=n.substr(a,5),a+=5):(t=null,0===s&&l('"phone"')),null===t&&("ip"===n.substr(a,2).toLowerCase()?(t=n.substr(a,2),a+=2):(t=null,0===s&&l('"ip"')),null===t&&(t=O())),null!==t?e=[e,t]:(e=null,a=i)):(e=null,a=i),null!==e&&(e=function(e,n){Ht.uri_params||(Ht.uri_params={}),Ht.uri_params.user=n.toLowerCase()}(0,e[1])),null===e&&(a=r),e}function Ce(){var e,t,r,i;return r=a,i=a,"method="===n.substr(a,7).toLowerCase()?(e=n.substr(a,7),a+=7):(e=null,0===s&&l('"method="')),null!==e&&null!==(t=dn())?e=[e,t]:(e=null,a=i),null!==e&&(e=function(e,n){Ht.uri_params||(Ht.uri_params={}),Ht.uri_params.method=n}(0,e[1])),null===e&&(a=r),e}function Te(){var e,t,r,i;return r=a,i=a,"ttl="===n.substr(a,4).toLowerCase()?(e=n.substr(a,4),a+=4):(e=null,0===s&&l('"ttl="')),null!==e&&null!==(t=wt())?e=[e,t]:(e=null,a=i),null!==e&&(e=function(e,n){Ht.params||(Ht.params={}),Ht.params.ttl=n}(0,e[1])),null===e&&(a=r),e}function we(){var e,t,r,i;return r=a,i=a,"maddr="===n.substr(a,6).toLowerCase()?(e=n.substr(a,6),a+=6):(e=null,0===s&&l('"maddr="')),null!==e&&null!==(t=oe())?e=[e,t]:(e=null,a=i),null!==e&&(e=function(e,n){Ht.uri_params||(Ht.uri_params={}),Ht.uri_params.maddr=n}(0,e[1])),null===e&&(a=r),e}function Ee(){var e,t,r,i,o,c;return i=a,o=a,"lr"===n.substr(a,2).toLowerCase()?(e=n.substr(a,2),a+=2):(e=null,0===s&&l('"lr"')),null!==e?(c=a,61===n.charCodeAt(a)?(t="=",a++):(t=null,0===s&&l('"="')),null!==t&&null!==(r=O())?t=[t,r]:(t=null,a=c),null!==(t=null!==t?t:"")?e=[e,t]:(e=null,a=o)):(e=null,a=o),null!==e&&(Ht.uri_params||(Ht.uri_params={}),e=void(Ht.uri_params.lr=void 0)),null===e&&(a=i),e}function ke(){var e,t,r,i,o,c;return i=a,o=a,null!==(e=Re())?(c=a,61===n.charCodeAt(a)?(t="=",a++):(t=null,0===s&&l('"="')),null!==t&&null!==(r=Ie())?t=[t,r]:(t=null,a=c),null!==(t=null!==t?t:"")?e=[e,t]:(e=null,a=o)):(e=null,a=o),null!==e&&(e=function(e,n,t){Ht.uri_params||(Ht.uri_params={}),t=void 0===t?void 0:t[1],Ht.uri_params[n.toLowerCase()]=t}(0,e[0],e[1])),null===e&&(a=i),e}function Re(){var e,n,t;if(t=a,null!==(n=Pe()))for(e=[];null!==n;)e.push(n),n=Pe();else e=null;return null!==e&&(e=e.join("")),null===e&&(a=t),e}function Ie(){var e,n,t;if(t=a,null!==(n=Pe()))for(e=[];null!==n;)e.push(n),n=Pe();else e=null;return null!==e&&(e=e.join("")),null===e&&(a=t),e}function Pe(){var e;return null===(e=Ae())&&null===(e=S())&&(e=T()),e}function Ae(){var e;return 91===n.charCodeAt(a)?(e="[",a++):(e=null,0===s&&l('"["')),null===e&&(93===n.charCodeAt(a)?(e="]",a++):(e=null,0===s&&l('"]"')),null===e&&(47===n.charCodeAt(a)?(e="/",a++):(e=null,0===s&&l('"/"')),null===e&&(58===n.charCodeAt(a)?(e=":",a++):(e=null,0===s&&l('":"')),null===e&&(38===n.charCodeAt(a)?(e="&",a++):(e=null,0===s&&l('"&"')),null===e&&(43===n.charCodeAt(a)?(e="+",a++):(e=null,0===s&&l('"+"')),null===e&&(36===n.charCodeAt(a)?(e="$",a++):(e=null,0===s&&l('"$"')))))))),e}function Oe(){var e,t,r,i,o,c,u;if(c=a,63===n.charCodeAt(a)?(e="?",a++):(e=null,0===s&&l('"?"')),null!==e)if(null!==(t=De())){for(r=[],u=a,38===n.charCodeAt(a)?(i="&",a++):(i=null,0===s&&l('"&"')),null!==i&&null!==(o=De())?i=[i,o]:(i=null,a=u);null!==i;)r.push(i),u=a,38===n.charCodeAt(a)?(i="&",a++):(i=null,0===s&&l('"&"')),null!==i&&null!==(o=De())?i=[i,o]:(i=null,a=u);null!==r?e=[e,t,r]:(e=null,a=c)}else e=null,a=c;else e=null,a=c;return e}function De(){var e,t,r,i,o;return i=a,o=a,null!==(e=je())?(61===n.charCodeAt(a)?(t="=",a++):(t=null,0===s&&l('"="')),null!==t&&null!==(r=Me())?e=[e,t,r]:(e=null,a=o)):(e=null,a=o),null!==e&&(e=function(e,n,t){n=n.join("").toLowerCase(),t=t.join(""),Ht.uri_headers||(Ht.uri_headers={}),Ht.uri_headers[n]?Ht.uri_headers[n].push(t):Ht.uri_headers[n]=[t]}(0,e[0],e[2])),null===e&&(a=i),e}function je(){var e,n;if(null===(n=xe())&&null===(n=S())&&(n=T()),null!==n)for(e=[];null!==n;)e.push(n),null===(n=xe())&&null===(n=S())&&(n=T());else e=null;return e}function Me(){var e,n;for(e=[],null===(n=xe())&&null===(n=S())&&(n=T());null!==n;)e.push(n),null===(n=xe())&&null===(n=S())&&(n=T());return e}function xe(){var e;return 91===n.charCodeAt(a)?(e="[",a++):(e=null,0===s&&l('"["')),null===e&&(93===n.charCodeAt(a)?(e="]",a++):(e=null,0===s&&l('"]"')),null===e&&(47===n.charCodeAt(a)?(e="/",a++):(e=null,0===s&&l('"/"')),null===e&&(63===n.charCodeAt(a)?(e="?",a++):(e=null,0===s&&l('"?"')),null===e&&(58===n.charCodeAt(a)?(e=":",a++):(e=null,0===s&&l('":"')),null===e&&(43===n.charCodeAt(a)?(e="+",a++):(e=null,0===s&&l('"+"')),null===e&&(36===n.charCodeAt(a)?(e="$",a++):(e=null,0===s&&l('"$"')))))))),e}function Ne(){var e,n,t,r,i,s;return s=a,null!==(e=dn())&&null!==(n=v())&&null!==(t=Fe())&&null!==(r=v())&&null!==(i=en())?e=[e,n,t,r,i]:(e=null,a=s),e}function Fe(){var e;return null===(e=Y())&&(e=Ue()),e}function Ue(){var e,t,r,i;return i=a,null!==(e=Je())?(58===n.charCodeAt(a)?(t=":",a++):(t=null,0===s&&l('":"')),null!==t?(null===(r=Le())&&(r=Be()),null!==r?e=[e,t,r]:(e=null,a=i)):(e=null,a=i)):(e=null,a=i),e}function Le(){var e,t,r,i,o;return i=a,null===(e=He())&&(e=qe()),null!==e?(o=a,63===n.charCodeAt(a)?(t="?",a++):(t=null,0===s&&l('"?"')),null!==t&&null!==(r=Ze())?t=[t,r]:(t=null,a=o),null!==(t=null!==t?t:"")?e=[e,t]:(e=null,a=i)):(e=null,a=i),e}function He(){var e,t,r,i;return i=a,"//"===n.substr(a,2)?(e="//",a+=2):(e=null,0===s&&l('"//"')),null!==e&&null!==(t=Qe())&&null!==(r=null!==(r=qe())?r:"")?e=[e,t,r]:(e=null,a=i),e}function qe(){var e,t,r;return r=a,47===n.charCodeAt(a)?(e="/",a++):(e=null,0===s&&l('"/"')),null!==e&&null!==(t=Ve())?e=[e,t]:(e=null,a=r),e}function Be(){var e,n,t,r;if(r=a,null!==(e=$e())){for(n=[],t=Ge();null!==t;)n.push(t),t=Ge();null!==n?e=[e,n]:(e=null,a=r)}else e=null,a=r;return e}function Ge(){var e;return null===(e=_())&&null===(e=S())&&(e=T()),e}function $e(){var e;return null===(e=S())&&null===(e=T())&&(59===n.charCodeAt(a)?(e=";",a++):(e=null,0===s&&l('";"')),null===e&&(63===n.charCodeAt(a)?(e="?",a++):(e=null,0===s&&l('"?"')),null===e&&(58===n.charCodeAt(a)?(e=":",a++):(e=null,0===s&&l('":"')),null===e&&(64===n.charCodeAt(a)?(e="@",a++):(e=null,0===s&&l('"@"')),null===e&&(38===n.charCodeAt(a)?(e="&",a++):(e=null,0===s&&l('"&"')),null===e&&(61===n.charCodeAt(a)?(e="=",a++):(e=null,0===s&&l('"="')),null===e&&(43===n.charCodeAt(a)?(e="+",a++):(e=null,0===s&&l('"+"')),null===e&&(36===n.charCodeAt(a)?(e="$",a++):(e=null,0===s&&l('"$"')),null===e&&(44===n.charCodeAt(a)?(e=",",a++):(e=null,0===s&&l('","'))))))))))),e}function Ve(){var e,t,r,i,o,c;if(o=a,null!==(e=We())){for(t=[],c=a,47===n.charCodeAt(a)?(r="/",a++):(r=null,0===s&&l('"/"')),null!==r&&null!==(i=We())?r=[r,i]:(r=null,a=c);null!==r;)t.push(r),c=a,47===n.charCodeAt(a)?(r="/",a++):(r=null,0===s&&l('"/"')),null!==r&&null!==(i=We())?r=[r,i]:(r=null,a=c);null!==t?e=[e,t]:(e=null,a=o)}else e=null,a=o;return e}function We(){var e,t,r,i,o,c;for(o=a,e=[],t=Ke();null!==t;)e.push(t),t=Ke();if(null!==e){for(t=[],c=a,59===n.charCodeAt(a)?(r=";",a++):(r=null,0===s&&l('";"')),null!==r&&null!==(i=ze())?r=[r,i]:(r=null,a=c);null!==r;)t.push(r),c=a,59===n.charCodeAt(a)?(r=";",a++):(r=null,0===s&&l('";"')),null!==r&&null!==(i=ze())?r=[r,i]:(r=null,a=c);null!==t?e=[e,t]:(e=null,a=o)}else e=null,a=o;return e}function ze(){var e,n;for(e=[],n=Ke();null!==n;)e.push(n),n=Ke();return e}function Ke(){var e;return null===(e=S())&&null===(e=T())&&(58===n.charCodeAt(a)?(e=":",a++):(e=null,0===s&&l('":"')),null===e&&(64===n.charCodeAt(a)?(e="@",a++):(e=null,0===s&&l('"@"')),null===e&&(38===n.charCodeAt(a)?(e="&",a++):(e=null,0===s&&l('"&"')),null===e&&(61===n.charCodeAt(a)?(e="=",a++):(e=null,0===s&&l('"="')),null===e&&(43===n.charCodeAt(a)?(e="+",a++):(e=null,0===s&&l('"+"')),null===e&&(36===n.charCodeAt(a)?(e="$",a++):(e=null,0===s&&l('"$"')),null===e&&(44===n.charCodeAt(a)?(e=",",a++):(e=null,0===s&&l('","'))))))))),e}function Je(){var e,t,r,i,o;if(i=a,o=a,null!==(e=h())){for(t=[],null===(r=h())&&null===(r=d())&&(43===n.charCodeAt(a)?(r="+",a++):(r=null,0===s&&l('"+"')),null===r&&(45===n.charCodeAt(a)?(r="-",a++):(r=null,0===s&&l('"-"')),null===r&&(46===n.charCodeAt(a)?(r=".",a++):(r=null,0===s&&l('"."')))));null!==r;)t.push(r),null===(r=h())&&null===(r=d())&&(43===n.charCodeAt(a)?(r="+",a++):(r=null,0===s&&l('"+"')),null===r&&(45===n.charCodeAt(a)?(r="-",a++):(r=null,0===s&&l('"-"')),null===r&&(46===n.charCodeAt(a)?(r=".",a++):(r=null,0===s&&l('"."')))));null!==t?e=[e,t]:(e=null,a=o)}else e=null,a=o;return null!==e&&(e=function(e){Ht.scheme=n.substring(a,e)}(i)),null===e&&(a=i),e}function Qe(){var e;return null===(e=Xe())&&(e=Ye()),e}function Xe(){var e,t,r,i;return r=a,i=a,null!==(e=te())?(64===n.charCodeAt(a)?(t="@",a++):(t=null,0===s&&l('"@"')),null!==t?e=[e,t]:(e=null,a=i)):(e=null,a=i),null!==(e=null!==e?e:"")&&null!==(t=se())?e=[e,t]:(e=null,a=r),e=null!==e?e:""}function Ye(){var e,t;if(null===(t=S())&&null===(t=T())&&(36===n.charCodeAt(a)?(t="$",a++):(t=null,0===s&&l('"$"')),null===t&&(44===n.charCodeAt(a)?(t=",",a++):(t=null,0===s&&l('","')),null===t&&(59===n.charCodeAt(a)?(t=";",a++):(t=null,0===s&&l('";"')),null===t&&(58===n.charCodeAt(a)?(t=":",a++):(t=null,0===s&&l('":"')),null===t&&(64===n.charCodeAt(a)?(t="@",a++):(t=null,0===s&&l('"@"')),null===t&&(38===n.charCodeAt(a)?(t="&",a++):(t=null,0===s&&l('"&"')),null===t&&(61===n.charCodeAt(a)?(t="=",a++):(t=null,0===s&&l('"="')),null===t&&(43===n.charCodeAt(a)?(t="+",a++):(t=null,0===s&&l('"+"')))))))))),null!==t)for(e=[];null!==t;)e.push(t),null===(t=S())&&null===(t=T())&&(36===n.charCodeAt(a)?(t="$",a++):(t=null,0===s&&l('"$"')),null===t&&(44===n.charCodeAt(a)?(t=",",a++):(t=null,0===s&&l('","')),null===t&&(59===n.charCodeAt(a)?(t=";",a++):(t=null,0===s&&l('";"')),null===t&&(58===n.charCodeAt(a)?(t=":",a++):(t=null,0===s&&l('":"')),null===t&&(64===n.charCodeAt(a)?(t="@",a++):(t=null,0===s&&l('"@"')),null===t&&(38===n.charCodeAt(a)?(t="&",a++):(t=null,0===s&&l('"&"')),null===t&&(61===n.charCodeAt(a)?(t="=",a++):(t=null,0===s&&l('"="')),null===t&&(43===n.charCodeAt(a)?(t="+",a++):(t=null,0===s&&l('"+"'))))))))));else e=null;return e}function Ze(){var e,n;for(e=[],n=Ge();null!==n;)e.push(n),n=Ge();return e}function en(){var e,t,r,i,o,c,u,h;if(u=a,h=a,"sip"===n.substr(a,3).toLowerCase()?(e=n.substr(a,3),a+=3):(e=null,0===s&&l('"SIP"')),null!==e)if(47===n.charCodeAt(a)?(t="/",a++):(t=null,0===s&&l('"/"')),null!==t){if(null!==(i=d()))for(r=[];null!==i;)r.push(i),i=d();else r=null;if(null!==r)if(46===n.charCodeAt(a)?(i=".",a++):(i=null,0===s&&l('"."')),null!==i){if(null!==(c=d()))for(o=[];null!==c;)o.push(c),c=d();else o=null;null!==o?e=[e,t,r,i,o]:(e=null,a=h)}else e=null,a=h;else e=null,a=h}else e=null,a=h;else e=null,a=h;return null!==e&&(e=function(e){Ht.sip_version=n.substring(a,e)}(u)),null===e&&(a=u),e}function nn(){var e;return"INVITE"===n.substr(a,6)?(e="INVITE",a+=6):(e=null,0===s&&l('"INVITE"')),e}function tn(){var e;return"ACK"===n.substr(a,3)?(e="ACK",a+=3):(e=null,0===s&&l('"ACK"')),e}function rn(){var e;return"OPTIONS"===n.substr(a,7)?(e="OPTIONS",a+=7):(e=null,0===s&&l('"OPTIONS"')),e}function an(){var e;return"BYE"===n.substr(a,3)?(e="BYE",a+=3):(e=null,0===s&&l('"BYE"')),e}function sn(){var e;return"CANCEL"===n.substr(a,6)?(e="CANCEL",a+=6):(e=null,0===s&&l('"CANCEL"')),e}function on(){var e;return"REGISTER"===n.substr(a,8)?(e="REGISTER",a+=8):(e=null,0===s&&l('"REGISTER"')),e}function cn(){var e;return"SUBSCRIBE"===n.substr(a,9)?(e="SUBSCRIBE",a+=9):(e=null,0===s&&l('"SUBSCRIBE"')),e}function ln(){var e;return"NOTIFY"===n.substr(a,6)?(e="NOTIFY",a+=6):(e=null,0===s&&l('"NOTIFY"')),e}function un(){var e;return"REFER"===n.substr(a,5)?(e="REFER",a+=5):(e=null,0===s&&l('"REFER"')),e}function dn(){var e,t;return t=a,null===(e=nn())&&null===(e=tn())&&null===(e=rn())&&null===(e=an())&&null===(e=sn())&&null===(e=on())&&null===(e=cn())&&null===(e=ln())&&null===(e=un())&&(e=O()),null!==e&&(e=function(e){return Ht.method=n.substring(a,e),Ht.method}(t)),null===e&&(a=t),e}function hn(){var e,n,t,r,i,s;return s=a,null!==(e=en())&&null!==(n=v())&&null!==(t=fn())&&null!==(r=v())&&null!==(i=gn())?e=[e,n,t,r,i]:(e=null,a=s),e}function fn(){var e,n;return n=a,null!==(e=pn())&&(e=function(e,n){Ht.status_code=parseInt(n.join(""))}(0,e)),null===e&&(a=n),e}function pn(){var e,n,t,r;return r=a,null!==(e=d())&&null!==(n=d())&&null!==(t=d())?e=[e,n,t]:(e=null,a=r),e}function gn(){var e,t,r;for(r=a,e=[],null===(t=_())&&null===(t=S())&&null===(t=T())&&null===(t=P())&&null===(t=A())&&null===(t=v())&&(t=m());null!==t;)e.push(t),null===(t=_())&&null===(t=S())&&null===(t=T())&&null===(t=P())&&null===(t=A())&&null===(t=v())&&(t=m());return null!==e&&(e=function(e){Ht.reason_phrase=n.substring(a,e)}(r)),null===e&&(a=r),e}function bn(){var e,n,t,r,i,s,o;if(i=a,s=a,null===(e=X())&&(e=vn()),null!==e){for(n=[],o=a,null!==(t=B())&&null!==(r=yn())?t=[t,r]:(t=null,a=o);null!==t;)n.push(t),o=a,null!==(t=B())&&null!==(r=yn())?t=[t,r]:(t=null,a=o);null!==n?e=[e,n]:(e=null,a=s)}else e=null,a=s;return null!==e&&(e=function(e){var n;Ht.multi_header||(Ht.multi_header=[]);try{n=new Lt(Ht.uri,Ht.display_name,Ht.params),delete Ht.uri,delete Ht.display_name,delete Ht.params}catch(e){n=null}Ht.multi_header.push({possition:a,offset:e,parsed:n})}(i)),null===e&&(a=i),e}function vn(){var e,n,t,r,i;return i=a,null!==(e=null!==(e=mn())?e:"")&&null!==(n=H())&&null!==(t=Y())&&null!==(r=L())?e=[e,n,t,r]:(e=null,a=i),e}function mn(){var e,t,r,i,s,o,c;if(s=a,o=a,null!==(e=O())){for(t=[],c=a,null!==(r=w())&&null!==(i=O())?r=[r,i]:(r=null,a=c);null!==r;)t.push(r),c=a,null!==(r=w())&&null!==(i=O())?r=[r,i]:(r=null,a=c);null!==t?e=[e,t]:(e=null,a=o)}else e=null,a=o;return null===e&&(e=z()),null!==e&&(e=function(e,t){'"'===(t=n.substring(a,e).trim())[0]&&(t=t.substring(1,t.length-1)),Ht.display_name=t}(s,e)),null===e&&(a=s),e}function yn(){var e;return null===(e=_n())&&null===(e=Sn())&&(e=wn()),e}function _n(){var e,t,r,i,o;return i=a,o=a,"q"===n.substr(a,1).toLowerCase()?(e=n.substr(a,1),a++):(e=null,0===s&&l('"q"')),null!==e&&null!==(t=N())&&null!==(r=Tn())?e=[e,t,r]:(e=null,a=o),null!==e&&(e=function(e,n){Ht.params||(Ht.params={}),Ht.params.q=n}(0,e[2])),null===e&&(a=i),e}function Sn(){var e,t,r,i,o;return i=a,o=a,"expires"===n.substr(a,7).toLowerCase()?(e=n.substr(a,7),a+=7):(e=null,0===s&&l('"expires"')),null!==e&&null!==(t=N())&&null!==(r=Cn())?e=[e,t,r]:(e=null,a=o),null!==e&&(e=function(e,n){Ht.params||(Ht.params={}),Ht.params.expires=n}(0,e[2])),null===e&&(a=i),e}function Cn(){var e,n,t;if(t=a,null!==(n=d()))for(e=[];null!==n;)e.push(n),n=d();else e=null;return null!==e&&(e=parseInt(e.join(""))),null===e&&(a=t),e}function Tn(){var e,t,r,i,o,c,u,h;return c=a,u=a,48===n.charCodeAt(a)?(e="0",a++):(e=null,0===s&&l('"0"')),null!==e?(h=a,46===n.charCodeAt(a)?(t=".",a++):(t=null,0===s&&l('"."')),null!==t&&null!==(r=null!==(r=d())?r:"")&&null!==(i=null!==(i=d())?i:"")&&null!==(o=null!==(o=d())?o:"")?t=[t,r,i,o]:(t=null,a=h),null!==(t=null!==t?t:"")?e=[e,t]:(e=null,a=u)):(e=null,a=u),null!==e&&(e=function(e){return parseFloat(n.substring(a,e))}(c)),null===e&&(a=c),e}function wn(){var e,n,t,r,i,s;return r=a,i=a,null!==(e=O())?(s=a,null!==(n=N())&&null!==(t=En())?n=[n,t]:(n=null,a=s),null!==(n=null!==n?n:"")?e=[e,n]:(e=null,a=i)):(e=null,a=i),null!==e&&(e=function(e,n,t){Ht.params||(Ht.params={}),t=void 0===t?void 0:t[1],Ht.params[n.toLowerCase()]=t}(0,e[0],e[1])),null===e&&(a=r),e}function En(){var e;return null===(e=O())&&null===(e=oe())&&(e=z()),e}function kn(){var e;return"render"===n.substr(a,6).toLowerCase()?(e=n.substr(a,6),a+=6):(e=null,0===s&&l('"render"')),null===e&&("session"===n.substr(a,7).toLowerCase()?(e=n.substr(a,7),a+=7):(e=null,0===s&&l('"session"')),null===e&&("icon"===n.substr(a,4).toLowerCase()?(e=n.substr(a,4),a+=4):(e=null,0===s&&l('"icon"')),null===e&&("alert"===n.substr(a,5).toLowerCase()?(e=n.substr(a,5),a+=5):(e=null,0===s&&l('"alert"')),null===e&&(e=O())))),e}function Rn(){var e;return null===(e=In())&&(e=wn()),e}function In(){var e,t,r,i;return i=a,"handling"===n.substr(a,8).toLowerCase()?(e=n.substr(a,8),a+=8):(e=null,0===s&&l('"handling"')),null!==e&&null!==(t=N())?("optional"===n.substr(a,8).toLowerCase()?(r=n.substr(a,8),a+=8):(r=null,0===s&&l('"optional"')),null===r&&("required"===n.substr(a,8).toLowerCase()?(r=n.substr(a,8),a+=8):(r=null,0===s&&l('"required"')),null===r&&(r=O())),null!==r?e=[e,t,r]:(e=null,a=i)):(e=null,a=i),e}function Pn(){var e,n,t,r,i,s,o,c;if(o=a,null!==(e=An()))if(null!==(n=x()))if(null!==(t=xn())){for(r=[],c=a,null!==(i=B())&&null!==(s=Nn())?i=[i,s]:(i=null,a=c);null!==i;)r.push(i),c=a,null!==(i=B())&&null!==(s=Nn())?i=[i,s]:(i=null,a=c);null!==r?e=[e,n,t,r]:(e=null,a=o)}else e=null,a=o;else e=null,a=o;else e=null,a=o;return e}function An(){var e;return null===(e=On())&&(e=Dn()),e}function On(){var e;return"text"===n.substr(a,4).toLowerCase()?(e=n.substr(a,4),a+=4):(e=null,0===s&&l('"text"')),null===e&&("image"===n.substr(a,5).toLowerCase()?(e=n.substr(a,5),a+=5):(e=null,0===s&&l('"image"')),null===e&&("audio"===n.substr(a,5).toLowerCase()?(e=n.substr(a,5),a+=5):(e=null,0===s&&l('"audio"')),null===e&&("video"===n.substr(a,5).toLowerCase()?(e=n.substr(a,5),a+=5):(e=null,0===s&&l('"video"')),null===e&&("application"===n.substr(a,11).toLowerCase()?(e=n.substr(a,11),a+=11):(e=null,0===s&&l('"application"')),null===e&&(e=jn()))))),e}function Dn(){var e;return"message"===n.substr(a,7).toLowerCase()?(e=n.substr(a,7),a+=7):(e=null,0===s&&l('"message"')),null===e&&("multipart"===n.substr(a,9).toLowerCase()?(e=n.substr(a,9),a+=9):(e=null,0===s&&l('"multipart"')),null===e&&(e=jn())),e}function jn(){var e;return null===(e=O())&&(e=Mn()),e}function Mn(){var e,t,r;return r=a,"x-"===n.substr(a,2).toLowerCase()?(e=n.substr(a,2),a+=2):(e=null,0===s&&l('"x-"')),null!==e&&null!==(t=O())?e=[e,t]:(e=null,a=r),e}function xn(){var e;return null===(e=jn())&&(e=O()),e}function Nn(){var e,n,t,r;return r=a,null!==(e=O())&&null!==(n=N())&&null!==(t=Fn())?e=[e,n,t]:(e=null,a=r),e}function Fn(){var e;return null===(e=O())&&(e=z()),e}function Un(){var e,n,t;if(t=a,null!==(n=d()))for(e=[];null!==n;)e.push(n),n=d();else e=null;return null!==e&&(e=function(e,n){Ht.value=parseInt(n.join(""))}(0,e)),null===e&&(a=t),e}function Ln(){var e,t,r,i,o,c;if(o=a,null!==(e=D())){for(t=[],c=a,46===n.charCodeAt(a)?(r=".",a++):(r=null,0===s&&l('"."')),null!==r&&null!==(i=D())?r=[r,i]:(r=null,a=c);null!==r;)t.push(r),c=a,46===n.charCodeAt(a)?(r=".",a++):(r=null,0===s&&l('"."')),null!==r&&null!==(i=D())?r=[r,i]:(r=null,a=c);null!==t?e=[e,t]:(e=null,a=o)}else e=null,a=o;return e}function Hn(){var e;return null===(e=qn())&&(e=wn()),e}function qn(){var e,t,r,i,o;return i=a,o=a,"tag"===n.substr(a,3).toLowerCase()?(e=n.substr(a,3),a+=3):(e=null,0===s&&l('"tag"')),null!==e&&null!==(t=N())&&null!==(r=O())?e=[e,t,r]:(e=null,a=o),null!==e&&(e=function(e,n){Ht.tag=n}(0,e[2])),null===e&&(a=i),e}function Bn(){var e,t,r,i,o,c,u,d;if(u=a,"digest"===n.substr(a,6).toLowerCase()?(e=n.substr(a,6),a+=6):(e=null,0===s&&l('"Digest"')),null!==e)if(null!==(t=w()))if(null!==(r=Vn())){for(i=[],d=a,null!==(o=q())&&null!==(c=Vn())?o=[o,c]:(o=null,a=d);null!==o;)i.push(o),d=a,null!==(o=q())&&null!==(c=Vn())?o=[o,c]:(o=null,a=d);null!==i?e=[e,t,r,i]:(e=null,a=u)}else e=null,a=u;else e=null,a=u;else e=null,a=u;return null===e&&(e=Gn()),e}function Gn(){var e,n,t,r,i,s,o,c;if(o=a,null!==(e=O()))if(null!==(n=w()))if(null!==(t=$n())){for(r=[],c=a,null!==(i=q())&&null!==(s=$n())?i=[i,s]:(i=null,a=c);null!==i;)r.push(i),c=a,null!==(i=q())&&null!==(s=$n())?i=[i,s]:(i=null,a=c);null!==r?e=[e,n,t,r]:(e=null,a=o)}else e=null,a=o;else e=null,a=o;else e=null,a=o;return e}function $n(){var e,n,t,r;return r=a,null!==(e=O())&&null!==(n=N())?(null===(t=O())&&(t=z()),null!==t?e=[e,n,t]:(e=null,a=r)):(e=null,a=r),e}function Vn(){var e;return null===(e=Wn())&&null===(e=Kn())&&null===(e=Qn())&&null===(e=Yn())&&null===(e=Zn())&&null===(e=et())&&null===(e=nt())&&(e=$n()),e}function Wn(){var e,t,r,i;return i=a,"realm"===n.substr(a,5).toLowerCase()?(e=n.substr(a,5),a+=5):(e=null,0===s&&l('"realm"')),null!==e&&null!==(t=N())&&null!==(r=zn())?e=[e,t,r]:(e=null,a=i),e}function zn(){var e,n;return n=a,null!==(e=K())&&(e=function(e,n){Ht.realm=n}(0,e)),null===e&&(a=n),e}function Kn(){var e,t,r,i,o,c,u,d,h;if(d=a,"domain"===n.substr(a,6).toLowerCase()?(e=n.substr(a,6),a+=6):(e=null,0===s&&l('"domain"')),null!==e)if(null!==(t=N()))if(null!==(r=$()))if(null!==(i=Jn())){if(o=[],h=a,null!==(u=v()))for(c=[];null!==u;)c.push(u),u=v();else c=null;for(null!==c&&null!==(u=Jn())?c=[c,u]:(c=null,a=h);null!==c;){if(o.push(c),h=a,null!==(u=v()))for(c=[];null!==u;)c.push(u),u=v();else c=null;null!==c&&null!==(u=Jn())?c=[c,u]:(c=null,a=h)}null!==o&&null!==(c=V())?e=[e,t,r,i,o,c]:(e=null,a=d)}else e=null,a=d;else e=null,a=d;else e=null,a=d;else e=null,a=d;return e}function Jn(){var e;return null===(e=Ue())&&(e=qe()),e}function Qn(){var e,t,r,i;return i=a,"nonce"===n.substr(a,5).toLowerCase()?(e=n.substr(a,5),a+=5):(e=null,0===s&&l('"nonce"')),null!==e&&null!==(t=N())&&null!==(r=Xn())?e=[e,t,r]:(e=null,a=i),e}function Xn(){var e,n;return n=a,null!==(e=K())&&(e=function(e,n){Ht.nonce=n}(0,e)),null===e&&(a=n),e}function Yn(){var e,t,r,i,o;return i=a,o=a,"opaque"===n.substr(a,6).toLowerCase()?(e=n.substr(a,6),a+=6):(e=null,0===s&&l('"opaque"')),null!==e&&null!==(t=N())&&null!==(r=K())?e=[e,t,r]:(e=null,a=o),null!==e&&(e=function(e,n){Ht.opaque=n}(0,e[2])),null===e&&(a=i),e}function Zn(){var e,t,r,i,o;return i=a,"stale"===n.substr(a,5).toLowerCase()?(e=n.substr(a,5),a+=5):(e=null,0===s&&l('"stale"')),null!==e&&null!==(t=N())?(o=a,"true"===n.substr(a,4).toLowerCase()?(r=n.substr(a,4),a+=4):(r=null,0===s&&l('"true"')),null!==r&&(r=void(Ht.stale=!0)),null===r&&(a=o),null===r&&(o=a,"false"===n.substr(a,5).toLowerCase()?(r=n.substr(a,5),a+=5):(r=null,0===s&&l('"false"')),null!==r&&(r=void(Ht.stale=!1)),null===r&&(a=o)),null!==r?e=[e,t,r]:(e=null,a=i)):(e=null,a=i),e}function et(){var e,t,r,i,o;return i=a,o=a,"algorithm"===n.substr(a,9).toLowerCase()?(e=n.substr(a,9),a+=9):(e=null,0===s&&l('"algorithm"')),null!==e&&null!==(t=N())?("md5"===n.substr(a,3).toLowerCase()?(r=n.substr(a,3),a+=3):(r=null,0===s&&l('"MD5"')),null===r&&("md5-sess"===n.substr(a,8).toLowerCase()?(r=n.substr(a,8),a+=8):(r=null,0===s&&l('"MD5-sess"')),null===r&&(r=O())),null!==r?e=[e,t,r]:(e=null,a=o)):(e=null,a=o),null!==e&&(e=function(e,n){Ht.algorithm=n.toUpperCase()}(0,e[2])),null===e&&(a=i),e}function nt(){var e,t,r,i,o,c,u,d,h,f;if(d=a,"qop"===n.substr(a,3).toLowerCase()?(e=n.substr(a,3),a+=3):(e=null,0===s&&l('"qop"')),null!==e)if(null!==(t=N()))if(null!==(r=$())){if(h=a,null!==(i=tt())){for(o=[],f=a,44===n.charCodeAt(a)?(c=",",a++):(c=null,0===s&&l('","')),null!==c&&null!==(u=tt())?c=[c,u]:(c=null,a=f);null!==c;)o.push(c),f=a,44===n.charCodeAt(a)?(c=",",a++):(c=null,0===s&&l('","')),null!==c&&null!==(u=tt())?c=[c,u]:(c=null,a=f);null!==o?i=[i,o]:(i=null,a=h)}else i=null,a=h;null!==i&&null!==(o=V())?e=[e,t,r,i,o]:(e=null,a=d)}else e=null,a=d;else e=null,a=d;else e=null,a=d;return e}function tt(){var e,t;return t=a,"auth-int"===n.substr(a,8).toLowerCase()?(e=n.substr(a,8),a+=8):(e=null,0===s&&l('"auth-int"')),null===e&&("auth"===n.substr(a,4).toLowerCase()?(e=n.substr(a,4),a+=4):(e=null,0===s&&l('"auth"')),null===e&&(e=O())),null!==e&&(e=function(e,n){Ht.qop||(Ht.qop=[]),Ht.qop.push(n.toLowerCase())}(0,e)),null===e&&(a=t),e}function rt(){var e,n,t,r,i,s,o;if(i=a,s=a,null!==(e=vn())){for(n=[],o=a,null!==(t=B())&&null!==(r=wn())?t=[t,r]:(t=null,a=o);null!==t;)n.push(t),o=a,null!==(t=B())&&null!==(r=wn())?t=[t,r]:(t=null,a=o);null!==n?e=[e,n]:(e=null,a=s)}else e=null,a=s;return null!==e&&(e=function(e){var n;Ht.multi_header||(Ht.multi_header=[]);try{n=new Lt(Ht.uri,Ht.display_name,Ht.params),delete Ht.uri,delete Ht.display_name,delete Ht.params}catch(e){n=null}Ht.multi_header.push({possition:a,offset:e,parsed:n})}(i)),null===e&&(a=i),e}function it(){var e;return null===(e=at())&&(e=wn()),e}function at(){var e,t,r,i,o,c;if(o=a,c=a,"cause"===n.substr(a,5).toLowerCase()?(e=n.substr(a,5),a+=5):(e=null,0===s&&l('"cause"')),null!==e)if(null!==(t=N())){if(null!==(i=d()))for(r=[];null!==i;)r.push(i),i=d();else r=null;null!==r?e=[e,t,r]:(e=null,a=c)}else e=null,a=c;else e=null,a=c;return null!==e&&(e=function(e,n){Ht.cause=parseInt(n.join(""))}(0,e[2])),null===e&&(a=o),e}function st(){var e,n,t,r,i,s;if(i=a,null!==(e=vn())){for(n=[],s=a,null!==(t=B())&&null!==(r=wn())?t=[t,r]:(t=null,a=s);null!==t;)n.push(t),s=a,null!==(t=B())&&null!==(r=wn())?t=[t,r]:(t=null,a=s);null!==n?e=[e,n]:(e=null,a=i)}else e=null,a=i;return e}function ot(){var e,t;return t=a,"active"===n.substr(a,6).toLowerCase()?(e=n.substr(a,6),a+=6):(e=null,0===s&&l('"active"')),null===e&&("pending"===n.substr(a,7).toLowerCase()?(e=n.substr(a,7),a+=7):(e=null,0===s&&l('"pending"')),null===e&&("terminated"===n.substr(a,10).toLowerCase()?(e=n.substr(a,10),a+=10):(e=null,0===s&&l('"terminated"')),null===e&&(e=O()))),null!==e&&(e=function(e){Ht.state=n.substring(a,e)}(t)),null===e&&(a=t),e}function ct(){var e,t,r,i,o;return i=a,o=a,"reason"===n.substr(a,6).toLowerCase()?(e=n.substr(a,6),a+=6):(e=null,0===s&&l('"reason"')),null!==e&&null!==(t=N())&&null!==(r=lt())?e=[e,t,r]:(e=null,a=o),null!==e&&(e=function(e,n){void 0!==n&&(Ht.reason=n)}(0,e[2])),null===e&&(a=i),null===e&&(i=a,o=a,"expires"===n.substr(a,7).toLowerCase()?(e=n.substr(a,7),a+=7):(e=null,0===s&&l('"expires"')),null!==e&&null!==(t=N())&&null!==(r=Cn())?e=[e,t,r]:(e=null,a=o),null!==e&&(e=function(e,n){void 0!==n&&(Ht.expires=n)}(0,e[2])),null===e&&(a=i),null===e&&(i=a,o=a,"retry_after"===n.substr(a,11).toLowerCase()?(e=n.substr(a,11),a+=11):(e=null,0===s&&l('"retry_after"')),null!==e&&null!==(t=N())&&null!==(r=Cn())?e=[e,t,r]:(e=null,a=o),null!==e&&(e=function(e,n){void 0!==n&&(Ht.retry_after=n)}(0,e[2])),null===e&&(a=i),null===e&&(e=wn()))),e}function lt(){var e;return"deactivated"===n.substr(a,11).toLowerCase()?(e=n.substr(a,11),a+=11):(e=null,0===s&&l('"deactivated"')),null===e&&("probation"===n.substr(a,9).toLowerCase()?(e=n.substr(a,9),a+=9):(e=null,0===s&&l('"probation"')),null===e&&("rejected"===n.substr(a,8).toLowerCase()?(e=n.substr(a,8),a+=8):(e=null,0===s&&l('"rejected"')),null===e&&("timeout"===n.substr(a,7).toLowerCase()?(e=n.substr(a,7),a+=7):(e=null,0===s&&l('"timeout"')),null===e&&("giveup"===n.substr(a,6).toLowerCase()?(e=n.substr(a,6),a+=6):(e=null,0===s&&l('"giveup"')),null===e&&("noresource"===n.substr(a,10).toLowerCase()?(e=n.substr(a,10),a+=10):(e=null,0===s&&l('"noresource"')),null===e&&("invariant"===n.substr(a,9).toLowerCase()?(e=n.substr(a,9),a+=9):(e=null,0===s&&l('"invariant"')),null===e&&(e=O()))))))),e}function ut(){var e;return null===(e=qn())&&(e=wn()),e}function dt(){var e,n,t,r,i,s,o,c;if(o=a,null!==(e=mt()))if(null!==(n=w()))if(null!==(t=St())){for(r=[],c=a,null!==(i=B())&&null!==(s=ht())?i=[i,s]:(i=null,a=c);null!==i;)r.push(i),c=a,null!==(i=B())&&null!==(s=ht())?i=[i,s]:(i=null,a=c);null!==r?e=[e,n,t,r]:(e=null,a=o)}else e=null,a=o;else e=null,a=o;else e=null,a=o;return e}function ht(){var e;return null===(e=ft())&&null===(e=pt())&&null===(e=gt())&&null===(e=bt())&&null===(e=vt())&&(e=wn()),e}function ft(){var e,t,r,i,o;return i=a,o=a,"ttl"===n.substr(a,3).toLowerCase()?(e=n.substr(a,3),a+=3):(e=null,0===s&&l('"ttl"')),null!==e&&null!==(t=N())&&null!==(r=wt())?e=[e,t,r]:(e=null,a=o),null!==e&&(e=function(e,n){Ht.ttl=n}(0,e[2])),null===e&&(a=i),e}function pt(){var e,t,r,i,o;return i=a,o=a,"maddr"===n.substr(a,5).toLowerCase()?(e=n.substr(a,5),a+=5):(e=null,0===s&&l('"maddr"')),null!==e&&null!==(t=N())&&null!==(r=oe())?e=[e,t,r]:(e=null,a=o),null!==e&&(e=function(e,n){Ht.maddr=n}(0,e[2])),null===e&&(a=i),e}function gt(){var e,t,r,i,o;return i=a,o=a,"received"===n.substr(a,8).toLowerCase()?(e=n.substr(a,8),a+=8):(e=null,0===s&&l('"received"')),null!==e&&null!==(t=N())?(null===(r=ge())&&(r=he()),null!==r?e=[e,t,r]:(e=null,a=o)):(e=null,a=o),null!==e&&(e=function(e,n){Ht.received=n}(0,e[2])),null===e&&(a=i),e}function bt(){var e,t,r,i,o;return i=a,o=a,"branch"===n.substr(a,6).toLowerCase()?(e=n.substr(a,6),a+=6):(e=null,0===s&&l('"branch"')),null!==e&&null!==(t=N())&&null!==(r=O())?e=[e,t,r]:(e=null,a=o),null!==e&&(e=function(e,n){Ht.branch=n}(0,e[2])),null===e&&(a=i),e}function vt(){var e,t,r,i,o,c,u;if(o=a,c=a,"rport"===n.substr(a,5).toLowerCase()?(e=n.substr(a,5),a+=5):(e=null,0===s&&l('"rport"')),null!==e){if(u=a,null!==(t=N())){for(r=[],i=d();null!==i;)r.push(i),i=d();null!==r?t=[t,r]:(t=null,a=u)}else t=null,a=u;null!==(t=null!==t?t:"")?e=[e,t]:(e=null,a=c)}else e=null,a=c;return null!==e&&(e=void("undefined"!=typeof response_port&&(Ht.rport=response_port.join("")))),null===e&&(a=o),e}function mt(){var e,n,t,r,i,s;return s=a,null!==(e=yt())&&null!==(n=x())&&null!==(t=O())&&null!==(r=x())&&null!==(i=_t())?e=[e,n,t,r,i]:(e=null,a=s),e}function yt(){var e,t;return t=a,"sip"===n.substr(a,3).toLowerCase()?(e=n.substr(a,3),a+=3):(e=null,0===s&&l('"SIP"')),null===e&&(e=O()),null!==e&&(e=function(e,n){Ht.protocol=n}(0,e)),null===e&&(a=t),e}function _t(){var e,t;return t=a,"udp"===n.substr(a,3).toLowerCase()?(e=n.substr(a,3),a+=3):(e=null,0===s&&l('"UDP"')),null===e&&("tcp"===n.substr(a,3).toLowerCase()?(e=n.substr(a,3),a+=3):(e=null,0===s&&l('"TCP"')),null===e&&("tls"===n.substr(a,3).toLowerCase()?(e=n.substr(a,3),a+=3):(e=null,0===s&&l('"TLS"')),null===e&&("sctp"===n.substr(a,4).toLowerCase()?(e=n.substr(a,4),a+=4):(e=null,0===s&&l('"SCTP"')),null===e&&(e=O())))),null!==e&&(e=function(e,n){Ht.transport=n}(0,e)),null===e&&(a=t),e}function St(){var e,n,t,r,i;return r=a,null!==(e=Ct())?(i=a,null!==(n=G())&&null!==(t=Tt())?n=[n,t]:(n=null,a=i),null!==(n=null!==n?n:"")?e=[e,n]:(e=null,a=r)):(e=null,a=r),e}function Ct(){var e,t;return t=a,null===(e=ge())&&null===(e=de())&&(e=ce()),null!==e&&(e=function(e){Ht.host=n.substring(a,e)}(t)),null===e&&(a=t),e}function Tt(){var e,n,t,r,i,s,o;return s=a,o=a,null!==(e=null!==(e=d())?e:"")&&null!==(n=null!==(n=d())?n:"")&&null!==(t=null!==(t=d())?t:"")&&null!==(r=null!==(r=d())?r:"")&&null!==(i=null!==(i=d())?i:"")?e=[e,n,t,r,i]:(e=null,a=o),null!==e&&(e=function(e,n){Ht.port=parseInt(n.join(""))}(0,e)),null===e&&(a=s),e}function wt(){var e,n,t,r,i;return r=a,i=a,null!==(e=d())&&null!==(n=null!==(n=d())?n:"")&&null!==(t=null!==(t=d())?t:"")?e=[e,n,t]:(e=null,a=i),null!==e&&(e=parseInt(e.join(""))),null===e&&(a=r),e}function Et(){var e,n;return n=a,null!==(e=Cn())&&(e=function(e,n){Ht.expires=n}(0,e)),null===e&&(a=n),e}function kt(){var e;return null===(e=Rt())&&(e=wn()),e}function Rt(){var e,t,r,i,o;return i=a,o=a,"refresher"===n.substr(a,9).toLowerCase()?(e=n.substr(a,9),a+=9):(e=null,0===s&&l('"refresher"')),null!==e&&null!==(t=N())?("uac"===n.substr(a,3).toLowerCase()?(r=n.substr(a,3),a+=3):(r=null,0===s&&l('"uac"')),null===r&&("uas"===n.substr(a,3).toLowerCase()?(r=n.substr(a,3),a+=3):(r=null,0===s&&l('"uas"'))),null!==r?e=[e,t,r]:(e=null,a=o)):(e=null,a=o),null!==e&&(e=function(e,n){Ht.refresher=n.toLowerCase()}(0,e[2])),null===e&&(a=i),e}function It(){var e,n;for(e=[],null===(n=I())&&null===(n=A())&&(n=w());null!==n;)e.push(n),null===(n=I())&&null===(n=A())&&(n=w());return e}function Pt(){var e,t,r,i,o,c,u,d,h,f,p;return f=a,p=a,null!==(e=Ot())?(45===n.charCodeAt(a)?(t="-",a++):(t=null,0===s&&l('"-"')),null!==t&&null!==(r=At())?(45===n.charCodeAt(a)?(i="-",a++):(i=null,0===s&&l('"-"')),null!==i&&null!==(o=At())?(45===n.charCodeAt(a)?(c="-",a++):(c=null,0===s&&l('"-"')),null!==c&&null!==(u=At())?(45===n.charCodeAt(a)?(d="-",a++):(d=null,0===s&&l('"-"')),null!==d&&null!==(h=Dt())?e=[e,t,r,i,o,c,u,d,h]:(e=null,a=p)):(e=null,a=p)):(e=null,a=p)):(e=null,a=p)):(e=null,a=p),null!==e&&(e=function(e,t){Ht=n.substring(a+5,e)}(f,e[0])),null===e&&(a=f),e}function At(){var e,n,t,r,i;return i=a,null!==(e=f())&&null!==(n=f())&&null!==(t=f())&&null!==(r=f())?e=[e,n,t,r]:(e=null,a=i),e}function Ot(){var e,n,t;return t=a,null!==(e=At())&&null!==(n=At())?e=[e,n]:(e=null,a=t),e}function Dt(){var e,n,t,r;return r=a,null!==(e=At())&&null!==(n=At())&&null!==(t=At())?e=[e,n,t]:(e=null,a=r),e}function jt(){var e,t,r,i,o,c;return i=a,o=a,null!==(e=j())?(c=a,64===n.charCodeAt(a)?(t="@",a++):(t=null,0===s&&l('"@"')),null!==t&&null!==(r=j())?t=[t,r]:(t=null,a=c),null!==(t=null!==t?t:"")?e=[e,t]:(e=null,a=o)):(e=null,a=o),null!==e&&(e=function(e){Ht.call_id=n.substring(a,e)}(i)),null===e&&(a=i),e}function Mt(){var e;return null===(e=xt())&&null===(e=Nt())&&null===(e=Ft())&&(e=wn()),e}function xt(){var e,t,r,i,o;return i=a,o=a,"to-tag"===n.substr(a,6)?(e="to-tag",a+=6):(e=null,0===s&&l('"to-tag"')),null!==e&&null!==(t=N())&&null!==(r=O())?e=[e,t,r]:(e=null,a=o),null!==e&&(e=function(e,n){Ht.to_tag=n}(0,e[2])),null===e&&(a=i),e}function Nt(){var e,t,r,i,o;return i=a,o=a,"from-tag"===n.substr(a,8)?(e="from-tag",a+=8):(e=null,0===s&&l('"from-tag"')),null!==e&&null!==(t=N())&&null!==(r=O())?e=[e,t,r]:(e=null,a=o),null!==e&&(e=function(e,n){Ht.from_tag=n}(0,e[2])),null===e&&(a=i),e}function Ft(){var e,t;return t=a,"early-only"===n.substr(a,10)?(e="early-only",a+=10):(e=null,0===s&&l('"early-only"')),null!==e&&(e=void(Ht.early_only=!0)),null===e&&(a=t),e}var Ut=t(9),Lt=t(14),Ht={};if(null===i[r]()||a!==n.length){var qt=Math.max(a,o),Bt=qt<n.length?n.charAt(qt):null,Gt=function(){for(var e=1,t=1,r=!1,i=0;i<Math.max(a,o);i++){var s=n.charAt(i);"\n"===s?(r||e++,t=1,r=!1):"\r"===s||"\u2028"===s||"\u2029"===s?(e++,t=1,r=!0):(t++,r=!1)}return{line:e,column:t}}();return new this.SyntaxError(function(e){e.sort();for(var n=null,t=[],r=0;r<e.length;r++)e[r]!==n&&(t.push(e[r]),n=e[r]);return t}(c),Bt,qt,Gt.line,Gt.column),-1}return Ht},toSource:function(){return this._source},SyntaxError:function(n,t,r,i,a){this.name="SyntaxError",this.expected=n,this.found=t,this.message=function(n,t){var r;switch(n.length){case 0:r="end of input";break;case 1:r=n[0];break;default:r=n.slice(0,n.length-1).join(", ")+" or "+n[n.length-1]}return"Expected "+r+" but "+(t?e(t):"end of input")+" found."}(n,t),this.offset=r,this.line=i,this.column=a}};return n.SyntaxError.prototype=Error.prototype,n}()},function(e,n,t){"use strict";var r=!0,i=!0;function a(e,n,t){var r=e.match(n);return r&&r.length>=t&&parseInt(r[t],10)}e.exports={extractVersion:a,wrapPeerConnectionEvent:function(e,n,t){if(e.RTCPeerConnection){var r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(e,r){if(e!==n)return i.apply(this,arguments);var a=function(e){var n=t(e);n&&r(n)};return this._eventMap=this._eventMap||{},this._eventMap[r]=a,i.apply(this,[e,a])};var a=r.removeEventListener;r.removeEventListener=function(e,t){if(e!==n||!this._eventMap||!this._eventMap[t])return a.apply(this,arguments);var r=this._eventMap[t];return delete this._eventMap[t],a.apply(this,[e,r])},Object.defineProperty(r,"on"+n,{get:function(){return this["_on"+n]},set:function(e){this["_on"+n]&&(this.removeEventListener(n,this["_on"+n]),delete this["_on"+n]),e&&this.addEventListener(n,this["_on"+n]=e)},enumerable:!0,configurable:!0})}},disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(r=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},disableWarnings:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(i=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},log:function(){if("object"==typeof window){if(r)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},deprecated:function(e,n){i&&console.warn(e+" is deprecated, please use "+n+" instead.")},detectBrowser:function(e){var n=e&&e.navigator,t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;if(n.mozGetUserMedia)t.browser="firefox",t.version=a(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia)t.browser="chrome",t.version=a(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(n.mediaDevices&&n.userAgent.match(/Edge\/(\d+).(\d+)$/))t.browser="edge",t.version=a(n.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=a(n.userAgent,/AppleWebKit\/(\d+)\./,1)}return t}}},function(e,n,t){"use strict";var r,i="object"==typeof Reflect?Reflect:null,a=i&&"function"==typeof i.apply?i.apply:function(e,n,t){return Function.prototype.apply.call(e,n,t)};r=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var c=10;function l(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function u(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function d(e,n,t,r){var i,a,s;if(l(t),void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",n,t.listener?t.listener:t),a=e._events),s=a[n]),void 0===s)s=a[n]=t,++e._eventsCount;else if("function"==typeof s?s=a[n]=r?[t,s]:[s,t]:r?s.unshift(t):s.push(t),(i=u(e))>0&&s.length>i&&!s.warned){s.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(n)+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=e,o.type=n,o.count=s.length,function(e){console&&console.warn&&console.warn(e)}(o)}return e}function h(e,n,t){var r={fired:!1,wrapFn:void 0,target:e,type:n,listener:t},i=function(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}.bind(r);return i.listener=t,r.wrapFn=i,i}function f(e,n,t){var r=e._events;if(void 0===r)return[];var i=r[n];return void 0===i?[]:"function"==typeof i?t?[i.listener||i]:[i]:t?function(e){for(var n=new Array(e.length),t=0;t<n.length;++t)n[t]=e[t].listener||e[t];return n}(i):g(i,i.length)}function p(e){var n=this._events;if(void 0!==n){var t=n[e];if("function"==typeof t)return 1;if(void 0!==t)return t.length}return 0}function g(e,n){for(var t=new Array(n),r=0;r<n;++r)t[r]=e[r];return t}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return u(this)},o.prototype.emit=function(e){for(var n=[],t=1;t<arguments.length;t++)n.push(arguments[t]);var r="error"===e,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var s;if(n.length>0&&(s=n[0]),s instanceof Error)throw s;var o=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw o.context=s,o}var c=i[e];if(void 0===c)return!1;if("function"==typeof c)a(c,this,n);else{var l=c.length,u=g(c,l);for(t=0;t<l;++t)a(u[t],this,n)}return!0},o.prototype.addListener=function(e,n){return d(this,e,n,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,n){return d(this,e,n,!0)},o.prototype.once=function(e,n){return l(n),this.on(e,h(this,e,n)),this},o.prototype.prependOnceListener=function(e,n){return l(n),this.prependListener(e,h(this,e,n)),this},o.prototype.removeListener=function(e,n){var t,r,i,a,s;if(l(n),void 0===(r=this._events))return this;if(void 0===(t=r[e]))return this;if(t===n||t.listener===n)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,t.listener||n));else if("function"!=typeof t){for(i=-1,a=t.length-1;a>=0;a--)if(t[a]===n||t[a].listener===n){s=t[a].listener,i=a;break}if(i<0)return this;0===i?t.shift():function(e,n){for(;n+1<e.length;n++)e[n]=e[n+1];e.pop()}(t,i),1===t.length&&(r[e]=t[0]),void 0!==r.removeListener&&this.emit("removeListener",e,s||n)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var n,t,r;if(void 0===(t=this._events))return this;if(void 0===t.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==t[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete t[e]),this;if(0===arguments.length){var i,a=Object.keys(t);for(r=0;r<a.length;++r)"removeListener"!==(i=a[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(n=t[e]))this.removeListener(e,n);else if(void 0!==n)for(r=n.length-1;r>=0;r--)this.removeListener(e,n[r]);return this},o.prototype.listeners=function(e){return f(this,e,!0)},o.prototype.rawListeners=function(e){return f(this,e,!1)},o.listenerCount=function(e,n){return"function"==typeof e.listenerCount?e.listenerCount(n):p.call(e,n)},o.prototype.listenerCount=p,o.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(e,n,t){const r=t(19),i=t(1),a=t(2),s=t(14),o=t(3),c=t(0)("PlivoSIP:SIPMessage");class l{constructor(e,n,t,r,o,c){if(!e||!n||!t)return null;r=r||{},this.ua=t,this.headers={},this.method=e,this.ruri=n,this.body=c,this.extraHeaders=a.cloneArray(o),r.route_set?this.setHeader("route",r.route_set):t.configuration.use_preloaded_route&&this.setHeader("route",`<${t.transport.sip_uri};lr>`),this.setHeader("via",""),this.setHeader("max-forwards",i.MAX_FORWARDS);let l,u=r.to_display_name||0===r.to_display_name?`"${r.to_display_name}" `:"";u+=`<${r.to_uri||n}>`,u+=r.to_tag?`;tag=${r.to_tag}`:"",this.to=s.parse(u),this.setHeader("to",u),l=r.from_display_name||0===r.from_display_name?`"${r.from_display_name}" `:t.configuration.display_name?`"${t.configuration.display_name}" `:"",l+=`<${r.from_uri||t.configuration.uri}>;tag=`,l+=r.from_tag||a.newTag(),this.from=s.parse(l),this.setHeader("from",l);const d=r.call_id||t.configuration.plivosip_id+a.createRandomToken(15);this.call_id=d,this.setHeader("call-id",d);const h=r.cseq||Math.floor(1e4*Math.random());this.cseq=h,this.setHeader("cseq",`${h} ${e}`)}setHeader(e,n){const t=new RegExp(`^\\s*${e}\\s*:`,"i");for(let e=0;e<this.extraHeaders.length;e++)t.test(this.extraHeaders[e])&&this.extraHeaders.splice(e,1);this.headers[a.headerize(e)]=Array.isArray(n)?n:[n]}getHeader(e){const n=this.headers[a.headerize(e)];if(n){if(n[0])return n[0]}else{const n=new RegExp(`^\\s*${e}\\s*:`,"i");for(const e of this.extraHeaders)if(n.test(e))return e.substring(e.indexOf(":")+1).trim()}}getHeaders(e){const n=this.headers[a.headerize(e)],t=[];if(n){for(const e of n)t.push(e);return t}{const n=new RegExp(`^\\s*${e}\\s*:`,"i");for(const e of this.extraHeaders)n.test(e)&&t.push(e.substring(e.indexOf(":")+1).trim());return t}}hasHeader(e){if(this.headers[a.headerize(e)])return!0;{const n=new RegExp(`^\\s*${e}\\s*:`,"i");for(const e of this.extraHeaders)if(n.test(e))return!0}return!1}parseSDP(e){return!e&&this.sdp?this.sdp:(this.sdp=r.parse(this.body||""),this.sdp)}toString(){let e=`${this.method} ${this.ruri} SIP/2.0\r\n`;for(const n in this.headers)if(Object.prototype.hasOwnProperty.call(this.headers,n))for(const t of this.headers[n])e+=`${n}: ${t}\r\n`;for(const n of this.extraHeaders)e+=`${n.trim()}\r\n`;const n=[];switch(this.method){case i.REGISTER:n.push("path","gruu");break;case i.INVITE:this.ua.configuration.session_timers&&n.push("timer"),(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu)&&n.push("gruu"),n.push("ice","replaces");break;case i.UPDATE:this.ua.configuration.session_timers&&n.push("timer"),n.push("ice")}n.push("outbound");const t=this.ua.configuration.user_agent||i.USER_AGENT;if(e+=`Allow: ${i.ALLOWED_METHODS}\r\n`,e+=`Supported: ${n}\r\n`,e+=`User-Agent: ${t}\r\n`,this.body){e+=`Content-Length: ${a.str_utf8_length(this.body)}\r\n\r\n`,e+=this.body}else e+="Content-Length: 0\r\n\r\n";return e}clone(){const e=new l(this.method,this.ruri,this.ua);return Object.keys(this.headers).forEach(function(n){e.headers[n]=this.headers[n].slice()},this),e.body=this.body,e.extraHeaders=a.cloneArray(this.extraHeaders),e.to=this.to,e.from=this.from,e.call_id=this.call_id,e.cseq=this.cseq,e}}class u extends l{constructor(e,n,t,r,a){super(i.INVITE,e,n,t,r,a),this.transaction=null}cancel(e){this.transaction.cancel(e)}clone(){const e=new u(this.ruri,this.ua);return Object.keys(this.headers).forEach(function(n){e.headers[n]=this.headers[n].slice()},this),e.body=this.body,e.extraHeaders=a.cloneArray(this.extraHeaders),e.to=this.to,e.from=this.from,e.call_id=this.call_id,e.cseq=this.cseq,e.transaction=this.transaction,e}}class d{constructor(){this.data=null,this.headers=null,this.method=null,this.via=null,this.via_branch=null,this.call_id=null,this.cseq=null,this.from=null,this.from_tag=null,this.to=null,this.to_tag=null,this.body=null,this.sdp=null}addHeader(e,n){const t={raw:n};e=a.headerize(e),this.headers[e]?this.headers[e].push(t):this.headers[e]=[t]}getHeader(e){const n=this.headers[a.headerize(e)];if(n)return n[0]?n[0].raw:void 0}getHeaders(e){const n=this.headers[a.headerize(e)],t=[];if(!n)return[];for(const e of n)t.push(e.raw);return t}hasHeader(e){return!!this.headers[a.headerize(e)]}parseHeader(e,n=0){if(e=a.headerize(e),!this.headers[e])return void c(`header "${e}" not present`);if(n>=this.headers[e].length)return void c(`not so many "${e}" headers present`);const t=this.headers[e][n],r=t.raw;if(t.parsed)return t.parsed;const i=o.parse(r,e.replace(/-/g,"_"));return-1===i?(this.headers[e].splice(n,1),void c(`error parsing "${e}" header field with value "${r}"`)):(t.parsed=i,i)}s(e,n){return this.parseHeader(e,n)}setHeader(e,n){const t={raw:n};this.headers[a.headerize(e)]=[t]}parseSDP(e){return!e&&this.sdp?this.sdp:(this.sdp=r.parse(this.body||""),this.sdp)}toString(){return this.data}}e.exports={OutgoingRequest:l,InitialOutgoingInviteRequest:u,IncomingRequest:class extends d{constructor(e){super(),this.ua=e,this.headers={},this.ruri=null,this.transport=null,this.server_transaction=null}reply(e,n,t,r,s,o){const c=[];let l=this.getHeader("To");if(e=e||null,n=n||null,!e||e<100||e>699)throw new TypeError(`Invalid status_code: ${e}`);if(n&&"string"!=typeof n&&!(n instanceof String))throw new TypeError(`Invalid reason_phrase: ${n}`);n=n||i.REASON_PHRASE[e]||"",t=a.cloneArray(t);let u=`SIP/2.0 ${e} ${n}\r\n`;if(this.method===i.INVITE&&e>100&&e<=200){const e=this.getHeaders("record-route");for(const n of e)u+=`Record-Route: ${n}\r\n`}const d=this.getHeaders("via");for(const e of d)u+=`Via: ${e}\r\n`;!this.to_tag&&e>100?l+=`;tag=${a.newTag()}`:this.to_tag&&!this.s("to").hasParam("tag")&&(l+=`;tag=${this.to_tag}`),u+=`To: ${l}\r\n`,u+=`From: ${this.getHeader("From")}\r\n`,u+=`Call-ID: ${this.call_id}\r\n`,u+=`CSeq: ${this.cseq} ${this.method}\r\n`;for(const e of t)u+=`${e.trim()}\r\n`;switch(this.method){case i.INVITE:this.ua.configuration.session_timers&&c.push("timer"),(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu)&&c.push("gruu"),c.push("ice","replaces");break;case i.UPDATE:this.ua.configuration.session_timers&&c.push("timer"),r&&c.push("ice"),c.push("replaces")}c.push("outbound"),this.method===i.OPTIONS?(u+=`Allow: ${i.ALLOWED_METHODS}\r\n`,u+=`Accept: ${i.ACCEPTED_BODY_TYPES}\r\n`):405===e?u+=`Allow: ${i.ALLOWED_METHODS}\r\n`:415===e&&(u+=`Accept: ${i.ACCEPTED_BODY_TYPES}\r\n`),u+=`Supported: ${c}\r\n`,r?(u+="Content-Type: application/sdp\r\n",u+=`Content-Length: ${a.str_utf8_length(r)}\r\n\r\n`,u+=r):u+="Content-Length: 0\r\n\r\n",this.server_transaction.receiveResponse(e,u,s,o)}reply_sl(e=null,n=null){const t=this.getHeaders("via");if(!e||e<100||e>699)throw new TypeError(`Invalid status_code: ${e}`);if(n&&"string"!=typeof n&&!(n instanceof String))throw new TypeError(`Invalid reason_phrase: ${n}`);let r=`SIP/2.0 ${e} ${n=n||i.REASON_PHRASE[e]||""}\r\n`;for(const e of t)r+=`Via: ${e}\r\n`;let s=this.getHeader("To");!this.to_tag&&e>100?s+=`;tag=${a.newTag()}`:this.to_tag&&!this.s("to").hasParam("tag")&&(s+=`;tag=${this.to_tag}`),r+=`To: ${s}\r\n`,r+=`From: ${this.getHeader("From")}\r\n`,r+=`Call-ID: ${this.call_id}\r\n`,r+=`CSeq: ${this.cseq} ${this.method}\r\n`,r+="Content-Length: 0\r\n\r\n",this.transport.send(r)}},IncomingResponse:class extends d{constructor(){super(),this.headers={},this.status_code=null,this.reason_phrase=null}}}},function(e,n){var t=[];e.exports=new function(e){e||(e={});var n=["INFO","DEBUG","WARN","ERROR","ALL","OFF"],r=e.logMethod||"INFO",i=e.enableDate||!1,a=e.loggingName||"",s="undefined"!=typeof chrome&&chrome.storage?chrome.storage.local:window.localStorage,o=["ERROR","WARN","INFO","DEBUG","ALL"],c=function(){function e(){let e=new Date,s="";i&&(s="["+e.toISOString().substring(0,10)+" "+e.toString().split(" ")[4]+"."+e.getMilliseconds()+"]");let u=s+" ["+n+"] "+a+" :: ";if(t.length>=900&&t.shift(),t.push(u+c+l+" \n"),!(o.indexOf(n)>o.indexOf(r)))switch(n){case"OFF":break;case"INFO":console.info(u,c,l);break;case"DEBUG":console.debug(u,c,l);break;case"WARN":console.warn(u,c,l);break;case"ERROR":console.error(u,c,l);break;default:console.log(u,c,l)}}var n=arguments[0].toUpperCase(),s=arguments[1],c=s[0]||" ",l=s[1]||" ";if(-1!=["INFO","DEBUG","WARN","ERROR","ALL","OFF"].indexOf(r))e();else{if(r!=n)return;e()}};return{info:function(){c("info",arguments)},debug:function(){c("debug",arguments)},warn:function(){c("warn",arguments)},error:function(){c("error",arguments)},setLevel:function(e){return e=e.toUpperCase(),-1!=n.indexOf(e)?(r=e,-1==["DEBUG","ALL"].indexOf(e)&&(s.debug=""),"logLevel is now : "+r):"only : "+n.toString()+" are allowed in run time!"},level:function(){return r},consolelogs:function(){return t}}}({enableDate:!0,loggingName:"PlivoSDK",logMethod:"DEBUG"})},function(e,n){e.exports={ConfigurationError:class extends Error{constructor(e,n){super(),this.code=1,this.name="CONFIGURATION_ERROR",this.parameter=e,this.value=n,this.message=this.value?`Invalid value ${JSON.stringify(this.value)} for parameter "${this.parameter}"`:`Missing parameter: ${this.parameter}`}},InvalidStateError:class extends Error{constructor(e){super(),this.code=2,this.name="INVALID_STATE_ERROR",this.status=e,this.message=`Invalid status: ${e}`}},NotSupportedError:class extends Error{constructor(e){super(),this.code=3,this.name="NOT_SUPPORTED_ERROR",this.message=e}},NotReadyError:class extends Error{constructor(e){super(),this.code=4,this.name="NOT_READY_ERROR",this.message=e}}}},function(e,n,t){const r=t(1),i=t(2),a=t(3);e.exports=class e{static parse(e){return-1!==(e=a.parse(e,"SIP_URI"))?e:void 0}constructor(e,n,t,i,a={},s={}){if(!t)throw new TypeError('missing or invalid "host" parameter');this._parameters={},this._headers={},this._scheme=e||r.SIP,this._user=n,this._host=t,this._port=i;for(const e in a)Object.prototype.hasOwnProperty.call(a,e)&&this.setParam(e,a[e]);for(const e in s)Object.prototype.hasOwnProperty.call(s,e)&&this.setHeader(e,s[e])}get scheme(){return this._scheme}set scheme(e){this._scheme=e.toLowerCase()}get user(){return this._user}set user(e){this._user=e}get host(){return this._host}set host(e){this._host=e.toLowerCase()}get port(){return this._port}set port(e){this._port=0===e?e:parseInt(e,10)||null}setParam(e,n){e&&(this._parameters[e.toLowerCase()]=void 0===n||null===n?null:n.toString())}getParam(e){if(e)return this._parameters[e.toLowerCase()]}hasParam(e){if(e)return!!this._parameters.hasOwnProperty(e.toLowerCase())}deleteParam(e){if(e=e.toLowerCase(),this._parameters.hasOwnProperty(e)){const n=this._parameters[e];return delete this._parameters[e],n}}clearParams(){this._parameters={}}setHeader(e,n){this._headers[i.headerize(e)]=Array.isArray(n)?n:[n]}getHeader(e){if(e)return this._headers[i.headerize(e)]}hasHeader(e){if(e)return!!this._headers.hasOwnProperty(i.headerize(e))}deleteHeader(e){if(e=i.headerize(e),this._headers.hasOwnProperty(e)){const n=this._headers[e];return delete this._headers[e],n}}clearHeaders(){this._headers={}}clone(){return new e(this._scheme,this._user,this._host,this._port,JSON.parse(JSON.stringify(this._parameters)),JSON.parse(JSON.stringify(this._headers)))}toString(){const e=[];let n=`${this._scheme}:`;this._user&&(n+=`${i.escapeUser(this._user)}@`),n+=this._host,(this._port||0===this._port)&&(n+=`:${this._port}`);for(const e in this._parameters)Object.prototype.hasOwnProperty.call(this._parameters,e)&&(n+=`;${e}`,null!==this._parameters[e]&&(n+=`=${this._parameters[e]}`));for(const n in this._headers)if(Object.prototype.hasOwnProperty.call(this._headers,n))for(const t of this._headers[n])e.push(`${n}=${t}`);return e.length>0&&(n+=`?${e.join("&")}`),n}toAor(e){let n=`${this._scheme}:`;return this._user&&(n+=`${i.escapeUser(this._user)}@`),n+=this._host,e&&(this._port||0===this._port)&&(n+=`:${this._port}`),n}}},function(e,n,t){const r=t(5).EventEmitter,i=t(1),a=t(6),s=t(22),o=t(0)("PlivoSIP:NonInviteClientTransaction"),c=t(0)("PlivoSIP:InviteClientTransaction"),l=t(0)("PlivoSIP:AckClientTransaction"),u=t(0)("PlivoSIP:NonInviteServerTransaction"),d=t(0)("PlivoSIP:InviteServerTransaction"),h={STATUS_TRYING:1,STATUS_PROCEEDING:2,STATUS_CALLING:3,STATUS_ACCEPTED:4,STATUS_COMPLETED:5,STATUS_TERMINATED:6,STATUS_CONFIRMED:7,NON_INVITE_CLIENT:"nict",NON_INVITE_SERVER:"nist",INVITE_CLIENT:"ict",INVITE_SERVER:"ist"};e.exports={C:h,NonInviteClientTransaction:class extends r{constructor(e,n,t,r){super(),this.type=h.NON_INVITE_CLIENT,this.id=`z9hG4bK${Math.floor(1e7*Math.random())}`,this.ua=e,this.transport=n,this.request=t,this.eventHandlers=r;let i=`SIP/2.0/${n.via_transport}`;i+=` ${e.configuration.via_host};branch=${this.id}`,this.request.setHeader("via",i),this.ua.newTransaction(this)}get C(){return h}stateChanged(e){this.state=e,this.emit("stateChanged")}send(){this.stateChanged(h.STATUS_TRYING),this.F=setTimeout(()=>{this.timer_F()},s.TIMER_F),this.transport.send(this.request)||this.onTransportError()}onTransportError(){o(`transport error occurred, deleting transaction ${this.id}`),clearTimeout(this.F),clearTimeout(this.K),this.stateChanged(h.STATUS_TERMINATED),this.ua.destroyTransaction(this),this.eventHandlers.onTransportError()}timer_F(){o(`Timer F expired for transaction ${this.id}`),this.stateChanged(h.STATUS_TERMINATED),this.ua.destroyTransaction(this),this.eventHandlers.onRequestTimeout()}timer_K(){this.stateChanged(h.STATUS_TERMINATED),this.ua.destroyTransaction(this)}receiveResponse(e){const n=e.status_code;if(n<200)switch(this.state){case h.STATUS_TRYING:case h.STATUS_PROCEEDING:this.stateChanged(h.STATUS_PROCEEDING),this.eventHandlers.onReceiveResponse(e)}else switch(this.state){case h.STATUS_TRYING:case h.STATUS_PROCEEDING:this.stateChanged(h.STATUS_COMPLETED),clearTimeout(this.F),408===n?this.eventHandlers.onRequestTimeout():this.eventHandlers.onReceiveResponse(e),this.K=setTimeout(()=>{this.timer_K()},s.TIMER_K);break;case h.STATUS_COMPLETED:}}},InviteClientTransaction:class extends r{constructor(e,n,t,r){super(),this.type=h.INVITE_CLIENT,this.id=`z9hG4bK${Math.floor(1e7*Math.random())}`,this.ua=e,this.transport=n,this.request=t,this.eventHandlers=r,t.transaction=this;let i=`SIP/2.0/${n.via_transport}`;i+=` ${e.configuration.via_host};branch=${this.id}`,this.request.setHeader("via",i),this.ua.newTransaction(this)}get C(){return h}stateChanged(e){this.state=e,this.emit("stateChanged")}send(){this.stateChanged(h.STATUS_CALLING),this.B=setTimeout(()=>{this.timer_B()},s.TIMER_B),this.transport.send(this.request)||this.onTransportError()}onTransportError(){clearTimeout(this.B),clearTimeout(this.D),clearTimeout(this.M),this.state!==h.STATUS_ACCEPTED&&(c(`transport error occurred, deleting transaction ${this.id}`),this.eventHandlers.onTransportError()),this.stateChanged(h.STATUS_TERMINATED),this.ua.destroyTransaction(this)}timer_M(){c(`Timer M expired for transaction ${this.id}`),this.state===h.STATUS_ACCEPTED&&(clearTimeout(this.B),this.stateChanged(h.STATUS_TERMINATED),this.ua.destroyTransaction(this))}timer_B(){c(`Timer B expired for transaction ${this.id}`),this.state===h.STATUS_CALLING&&(this.stateChanged(h.STATUS_TERMINATED),this.ua.destroyTransaction(this),this.eventHandlers.onRequestTimeout())}timer_D(){c(`Timer D expired for transaction ${this.id}`),clearTimeout(this.B),this.stateChanged(h.STATUS_TERMINATED),this.ua.destroyTransaction(this)}sendACK(e){const n=new a.OutgoingRequest(i.ACK,this.request.ruri,this.ua,{route_set:this.request.getHeader("route"),call_id:this.request.getHeader("call-id"),cseq:this.request.cseq});n.setHeader("from",this.request.getHeader("from")),n.setHeader("via",this.request.getHeader("via")),n.setHeader("to",e.getHeader("to")),this.D=setTimeout(()=>{this.timer_D()},s.TIMER_D),this.transport.send(n)}cancel(e){if(this.state!==h.STATUS_PROCEEDING)return;const n=new a.OutgoingRequest(i.CANCEL,this.request.ruri,this.ua,{route_set:this.request.getHeader("route"),call_id:this.request.getHeader("call-id"),cseq:this.request.cseq});n.setHeader("from",this.request.getHeader("from")),n.setHeader("via",this.request.getHeader("via")),n.setHeader("to",this.request.getHeader("to")),e&&n.setHeader("reason",e),this.transport.send(n)}receiveResponse(e){const n=e.status_code;if(n>=100&&n<=199)switch(this.state){case h.STATUS_CALLING:this.stateChanged(h.STATUS_PROCEEDING),this.eventHandlers.onReceiveResponse(e);break;case h.STATUS_PROCEEDING:this.eventHandlers.onReceiveResponse(e)}else if(n>=200&&n<=299)switch(this.state){case h.STATUS_CALLING:case h.STATUS_PROCEEDING:this.stateChanged(h.STATUS_ACCEPTED),this.M=setTimeout(()=>{this.timer_M()},s.TIMER_M),this.eventHandlers.onReceiveResponse(e);break;case h.STATUS_ACCEPTED:this.eventHandlers.onReceiveResponse(e)}else if(n>=300&&n<=699)switch(this.state){case h.STATUS_CALLING:case h.STATUS_PROCEEDING:this.stateChanged(h.STATUS_COMPLETED),this.sendACK(e),this.eventHandlers.onReceiveResponse(e);break;case h.STATUS_COMPLETED:this.sendACK(e)}}},AckClientTransaction:class extends r{constructor(e,n,t,r){super(),this.id=`z9hG4bK${Math.floor(1e7*Math.random())}`,this.transport=n,this.request=t,this.eventHandlers=r;let i=`SIP/2.0/${n.via_transport}`;i+=` ${e.configuration.via_host};branch=${this.id}`,this.request.setHeader("via",i)}get C(){return h}send(){this.transport.send(this.request)||this.onTransportError()}onTransportError(){l(`transport error occurred for transaction ${this.id}`),this.eventHandlers.onTransportError()}},NonInviteServerTransaction:class extends r{constructor(e,n,t){super(),this.type=h.NON_INVITE_SERVER,this.id=t.via_branch,this.ua=e,this.transport=n,this.request=t,this.last_response="",t.server_transaction=this,this.state=h.STATUS_TRYING,e.newTransaction(this)}get C(){return h}stateChanged(e){this.state=e,this.emit("stateChanged")}timer_J(){u(`Timer J expired for transaction ${this.id}`),this.stateChanged(h.STATUS_TERMINATED),this.ua.destroyTransaction(this)}onTransportError(){this.transportError||(this.transportError=!0,u(`transport error occurred, deleting transaction ${this.id}`),clearTimeout(this.J),this.stateChanged(h.STATUS_TERMINATED),this.ua.destroyTransaction(this))}receiveResponse(e,n,t,r){if(100===e)switch(this.state){case h.STATUS_TRYING:this.stateChanged(h.STATUS_PROCEEDING),this.transport.send(n)||this.onTransportError();break;case h.STATUS_PROCEEDING:this.last_response=n,this.transport.send(n)?t&&t():(this.onTransportError(),r&&r())}else if(e>=200&&e<=699)switch(this.state){case h.STATUS_TRYING:case h.STATUS_PROCEEDING:this.stateChanged(h.STATUS_COMPLETED),this.last_response=n,this.J=setTimeout(()=>{this.timer_J()},s.TIMER_J),this.transport.send(n)?t&&t():(this.onTransportError(),r&&r());break;case h.STATUS_COMPLETED:}}},InviteServerTransaction:class extends r{constructor(e,n,t){super(),this.type=h.INVITE_SERVER,this.id=t.via_branch,this.ua=e,this.transport=n,this.request=t,this.last_response="",t.server_transaction=this,this.state=h.STATUS_PROCEEDING,e.newTransaction(this),this.resendProvisionalTimer=null,t.reply(100)}get C(){return h}stateChanged(e){this.state=e,this.emit("stateChanged")}timer_H(){d(`Timer H expired for transaction ${this.id}`),this.state===h.STATUS_COMPLETED&&d("ACK not received, dialog will be terminated"),this.stateChanged(h.STATUS_TERMINATED),this.ua.destroyTransaction(this)}timer_I(){this.stateChanged(h.STATUS_TERMINATED)}timer_L(){d(`Timer L expired for transaction ${this.id}`),this.state===h.STATUS_ACCEPTED&&(this.stateChanged(h.STATUS_TERMINATED),this.ua.destroyTransaction(this))}onTransportError(){this.transportError||(this.transportError=!0,d(`transport error occurred, deleting transaction ${this.id}`),null!==this.resendProvisionalTimer&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),clearTimeout(this.L),clearTimeout(this.H),clearTimeout(this.I),this.stateChanged(h.STATUS_TERMINATED),this.ua.destroyTransaction(this))}resend_provisional(){this.transport.send(this.last_response)||this.onTransportError()}receiveResponse(e,n,t,r){if(e>=100&&e<=199)switch(this.state){case h.STATUS_PROCEEDING:this.transport.send(n)||this.onTransportError(),this.last_response=n}if(e>100&&e<=199&&this.state===h.STATUS_PROCEEDING)null===this.resendProvisionalTimer&&(this.resendProvisionalTimer=setInterval(()=>{this.resend_provisional()},s.PROVISIONAL_RESPONSE_INTERVAL));else if(e>=200&&e<=299)switch(this.state){case h.STATUS_PROCEEDING:this.stateChanged(h.STATUS_ACCEPTED),this.last_response=n,this.L=setTimeout(()=>{this.timer_L()},s.TIMER_L),null!==this.resendProvisionalTimer&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null);case h.STATUS_ACCEPTED:this.transport.send(n)?t&&t():(this.onTransportError(),r&&r())}else if(e>=300&&e<=699)switch(this.state){case h.STATUS_PROCEEDING:null!==this.resendProvisionalTimer&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),this.transport.send(n)?(this.stateChanged(h.STATUS_COMPLETED),this.H=setTimeout(()=>{this.timer_H()},s.TIMER_H),t&&t()):(this.onTransportError(),r&&r())}}},checkTransaction:function({_transactions:e},n){let t;switch(n.method){case i.INVITE:if(t=e.ist[n.via_branch]){switch(t.state){case h.STATUS_PROCEEDING:t.transport.send(t.last_response);break;case h.STATUS_ACCEPTED:}return!0}break;case i.ACK:if(!(t=e.ist[n.via_branch]))return!1;if(t.state===h.STATUS_ACCEPTED)return!1;if(t.state===h.STATUS_COMPLETED)return t.state=h.STATUS_CONFIRMED,t.I=setTimeout(()=>{t.timer_I()},s.TIMER_I),!0;break;case i.CANCEL:return(t=e.ist[n.via_branch])?(n.reply_sl(200),t.state!==h.STATUS_PROCEEDING):(n.reply_sl(481),!0);default:if(t=e.nist[n.via_branch]){switch(t.state){case h.STATUS_TRYING:break;case h.STATUS_PROCEEDING:case h.STATUS_COMPLETED:t.transport.send(t.last_response)}return!0}}}}},function(e,n,t){"use strict";let r={};r=t(65),e.exports=r,e.exports.DEFAULT_LOG_LEVEL="INFO",e.exports.NUMBER_OF_SIMULTANEOUS_INCOMING_CALLS_ALLOWED=50,e.exports.REGISTER_EXPIRES_SECONDS=120,e.exports.SESSION_TIMERS_EXPIRES=300,e.exports.WS_RECOVERY_MAX_INTERVAL=20,e.exports.WS_RECOVERY_MIN_INTERVAL=2,e.exports.DEFAULT_CODECS=["OPUS","PCMU"],e.exports.STUN_SERVERS=["stun:stun.l.google.com:19302","stun:stun1.l.google.com:19302"],e.exports.LIB_NAME="plivojs",e.exports.DEBUG_MODES=["INFO","DEBUG","WARN","ERROR","ALL","ALL-PLAIN","OFF"],e.exports.REGION=["usa_west","usa_east","australia","europe","asia","south_america"],e.exports.RINGTONE_URL="https://cdn.plivo.com/sdk/browser/audio/us-ring.mp3",e.exports.RINGBACK_URL="https://cdn.plivo.com/sdk/browser/audio/us-ring.mp3?v=ringback",e.exports.CONNECT_TONE_URL="https://cdn.plivo.com/sdk/browser/audio/connect-tone.mp3",e.exports.SELF_VIEW_ID="plivo_webrtc_selfview",e.exports.REMOTE_VIEW_ID="plivo_webrtc_remoteview",e.exports.RINGBACK_ELEMENT_ID="plivo_ringbacktone",e.exports.RINGTONE_ELEMENT_ID="plivo_ringtone",e.exports.CONNECT_TONE_ELEMENT_ID="plivo_connect_tone",e.exports.DTMF_TONE_FLAG={0:!0,1:!0,2:!0,3:!0,4:!0,5:!0,6:!0,7:!0,8:!0,9:!0,"#":!0,"*":!0},e.exports.DEFAULT_COMMENTS={AUDIO_LAG:"audio_lag",BROKEN_AUDIO:"broken_audio",CALL_DROPPED:"call_dropped",CALLERID_ISSUES:"callerid_issue",DIGITS_NOT_CAPTURED:"digits_not_captured",ECHO:"echo",HIGH_CONNECT_TIME:"high_connect_time",LOW_AUDIO_LEVEL:"low_audio_level",ONE_WAY_AUDIO:"one_way_audio",OTHERS:"others",ROBOTIC_AUDIO:"robotic_audio"},e.exports.GETSTATS_INTERVAL=5e3,e.exports.GETSTATS_HEARTBEATINTERVAL=1e5,e.exports.STATSSOCKET_RECONNECT_SEC=1e4,e.exports.STATS_SAMPLE_QUEUE=1,e.exports.SIP_ERROR_CODE={404:"User was not reachable",486:"User was busy",408:"No response from user",480:"No response from user",603:"Call rejected by user",484:"Invalid destination format",503:"Network issue while connecting the call",501:"Incompatible client configuration",487:"Call cancelled by caller",400:"Bad request - Parameters not valid",401:"Call authorization failed",403:"Call authorization failed",404:"Call authorization failed",405:"Call authorization failed",483:"Too many hops detected for call connection",500:"Internal Server Error",502:"There is an issue with the Carrier Gateway"};var i={};"undefined"!=typeof navigator&&navigator.mozGetUserMedia?i={offerToReceiveAudio:!0}:i.mandatory={OfferToReceiveAudio:!0},e.exports.DEFAULT_OFFER_OPTIONS=i,e.exports.STATS_SOURCE="BrowserSDK",e.exports.STATS_VERSION="v1",e.exports.MAX_AVERAGE_BITRATE=48e3,e.exports.MIN_AVERAGE_BITRATE=8e3},function(e){e.exports=JSON.parse('{"name":"plivo-browser-sdk","title":"plivo-browser-sdk","version":"2.1.29","description":"This library allows you to connect with plivo\'s voice enviroment from browser","main":"./dist/plivo.js","scripts":{"start":"webpack-dev-server --env.development --env.PLIVO_ENV=production","start:staging":"webpack-dev-server --env.development --env.PLIVO_ENV=staging","build":"webpack  --env.production --env.PLIVO_ENV=production","build:staging":"webpack  --env.production --env.PLIVO_ENV=staging","build:npm":"webpack  --env.production --env.npm --env.PLIVO_ENV=production","build:nominify":"webpack  --env.production --env.nominify --env.PLIVO_ENV=production","build:nominify:staging":"webpack  --env.production --env.nominify --env.PLIVO_ENV=staging","publish:npm":"rm -rf dist && npm run build:npm && npm publish","test":"node test/server.js & karma start --single-run --browsers FirefoxHeadless,ChromeWebRTC karma.conf.js","beta-version-patch":"npm version $(semver $npm_package_version -i prerelease --preid beta)","beta-version-minor":"npm version $(semver $npm_package_version -i preminor --preid beta)","beta-version-major":"npm version $(semver $npm_package_version -i premajor --preid beta)","rc-version":"npm version $(semver $npm_package_version -i prerelease --preid rc)","final-release":"npm version $(semver $npm_package_version -i)","semver":"npm version $(semver $npm_package_version -i $release --preid $preid)"},"author":"Plivo","license":"Apache-2.0","bugs":{"url":"https://github.com/plivo/plivo-websdk-2.0-example/issues"},"homepage":"https://www.plivo.com/docs/sdk/web/","dependencies":{"debug":"^2.6.3","events":"^2.0.0","sdp-transform":"^2.4.1","semver-parser":"^2.0.4","uuid":"^2.0.3","webrtc-adapter":"^6.3.0","compare-versions":"^3.3.1"},"devDependencies":{"browserify":"^16.2.2","chai":"^4.1.2","karma":"^2.0.3","karma-browserify":"^5.3.0","karma-chai":"^0.1.0","karma-chrome-launcher":"^2.2.0","karma-firefox-launcher":"^1.1.0","karma-mocha":"^1.3.0","karma-mocha-reporter":"^2.2.5","mkdirp":"^0.5.1","mocha":"^5.2.0","replace-in-file-webpack-plugin":"^1.0.6","script-loader":"^0.7.2","string-replace-loader":"^2.1.1","string-replace-webpack-plugin":"^0.1.3","uglifyjs-webpack-plugin":"^1.2.7","webpack":"^4.16.3","webpack-cli":"^3.1.0","webpack-dev-server":"^3.1.5"}}')},function(e,n,t){const r=t(1),i=t(49),a=t(10),s=t(0)("PlivoSIP:RequestSender"),o={onRequestTimeout:()=>{},onTransportError:()=>{},onReceiveResponse:()=>{},onAuthenticated:()=>{}};e.exports=class{constructor(e,n,t){this._ua=e,this._eventHandlers=t,this._method=n.method,this._request=n,this._auth=null,this._challenged=!1,this._staled=!1;for(const e in o)Object.prototype.hasOwnProperty.call(o,e)&&(this._eventHandlers[e]||(this._eventHandlers[e]=o[e]));e.status!==e.C.STATUS_USER_CLOSED||this._method===r.BYE&&this._method===r.ACK||this._eventHandlers.onTransportError()}send(){const e={onRequestTimeout:()=>{this._eventHandlers.onRequestTimeout()},onTransportError:()=>{this._eventHandlers.onTransportError()},onReceiveResponse:e=>{this._receiveResponse(e)}};switch(this._method){case"INVITE":this.clientTransaction=new a.InviteClientTransaction(this._ua,this._ua.transport,this._request,e);break;case"ACK":this.clientTransaction=new a.AckClientTransaction(this._ua,this._ua.transport,this._request,e);break;default:this.clientTransaction=new a.NonInviteClientTransaction(this._ua,this._ua.transport,this._request,e)}this.clientTransaction.send()}_receiveResponse(e){let n,t;const r=e.status_code;if(401!==r&&407!==r||null===this._ua.configuration.password&&null===this._ua.configuration.ha1)this._eventHandlers.onReceiveResponse(e);else{if(401===e.status_code?(n=e.parseHeader("www-authenticate"),t="authorization"):(n=e.parseHeader("proxy-authenticate"),t="proxy-authorization"),!n)return s(`${e.status_code} with wrong or missing challenge, cannot authenticate`),void this._eventHandlers.onReceiveResponse(e);if(!this._challenged||!this._staled&&!0===n.stale){if(this._auth||(this._auth=new i({username:this._ua.configuration.authorization_user,password:this._ua.configuration.password,realm:this._ua.configuration.realm,ha1:this._ua.configuration.ha1})),!this._auth.authenticate(this._request,n))return void this._eventHandlers.onReceiveResponse(e);this._challenged=!0,this._ua.set("realm",this._auth.get("realm")),this._ua.set("ha1",this._auth.get("ha1")),n.stale&&(this._staled=!0),this._request=this._request.clone(),this._request.cseq+=1,this._request.setHeader("cseq",`${this._request.cseq} ${this._method}`),this._request.setHeader(t,this._auth.toString()),this._eventHandlers.onAuthenticated(this._request),this.send()}else this._eventHandlers.onReceiveResponse(e)}}}},function(e,n,t){const r=t(9),i=t(3);e.exports=class e{static parse(e){return-1!==(e=i.parse(e,"Name_Addr_Header"))?e:void 0}constructor(e,n,t){if(!(e&&e instanceof r))throw new TypeError('missing or invalid "uri" parameter');this._uri=e,this._parameters={},this._display_name=n;for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&this.setParam(e,t[e])}get uri(){return this._uri}get display_name(){return this._display_name}set display_name(e){this._display_name=0===e?"0":e}setParam(e,n){e&&(this._parameters[e.toLowerCase()]=void 0===n||null===n?null:n.toString())}getParam(e){if(e)return this._parameters[e.toLowerCase()]}hasParam(e){if(e)return!!this._parameters.hasOwnProperty(e.toLowerCase())}deleteParam(e){if(e=e.toLowerCase(),this._parameters.hasOwnProperty(e)){const n=this._parameters[e];return delete this._parameters[e],n}}clearParams(){this._parameters={}}clone(){return new e(this._uri.clone(),this._display_name,JSON.parse(JSON.stringify(this._parameters)))}toString(){let e=this._display_name||0===this._display_name?`"${this._display_name}" `:"";e+=`<${this._uri.toString()}>`;for(const n in this._parameters)Object.prototype.hasOwnProperty.call(this._parameters,n)&&(e+=`;${n}`,null!==this._parameters[n]&&(e+=`=${this._parameters[n]}`));return e}}},function(e,n,t){t(26)(t(27))},function(e,n,t){"use strict";var r=t(17),i=t(29),a=t(62).inherits,s=t(5).EventEmitter,o=t(11),c=t(66),l=t(67),u=t(7),d=t(68),h=t(69),f=t(70),p=t(71),g=(t(72),t(12)),b=t(73),v=t(74);new r;const m=g.name,y=g.version,_=navigator.userAgent,S=navigator.platform;function C(e){return e===Math.round(e)}const T=v.parseSemVer(y,!1),w=function(){var e,n=navigator.appName,t=_,r=t.match(/(opera|chrome|safari|firefox|msie|trident)\/?\s*(\.?\d+(\.\d+)*)/i);return r&&null!=(e=t.match(/version\/([\.\d]+)/i))&&(r[2]=e[1]),(r=r?[r[1],r[2]]:[n,navigator.appVersion,"-?"])[1]}(),E=function(){var e="Unknown OS";return-1!=navigator.userAgent.indexOf("Win")&&(e="Windows"),-1!=navigator.userAgent.indexOf("Mac")&&(e="Macintosh"),-1!=navigator.userAgent.indexOf("Linux")&&(e="Linux"),-1!=navigator.userAgent.indexOf("Android")&&(e="Android"),-1!=navigator.userAgent.indexOf("like Mac")&&(e="iOS"),-1!=navigator.userAgent.indexOf("CrOS")&&(e="Chromium"),e}(),k=v.parseSemVer(w,!1).matches?v.parseSemVer(w,!1):w.split(".");var R=t(76).getRTPStats,I=t(78).statsSocket;const P={};var A=new Map;function O(e){if(this.browserDetails=i.adapter.browserDetails,!navigator.mediaDevices)throw/Chrome/.test(navigator.userAgent)?new Error("This Chrome version supports microphone access only in HTTPS web applications. https://bit.ly/2SiWjWN"):/Firefox/.test(navigator.userAgent)?new Error("This Firefox version supports microphone access only in HTTPS web applications. https://mzl.la/2LSLIkr"):new Error("This Browser version supports microphone access only in HTTPS web applications.");if("object"==typeof window._PlivoInstance)return P.log.info("window.Plivo object and its instance already exist"),window._PlivoInstance;if(!(this instanceof O))return new O(e);var n={codecs:o.DEFAULT_CODECS,enableTracking:!0,debug:"INFO",permOnClick:!1,enableIPV6:!1,audioConstraints:{},dscp:!0,appId:null,appSecret:null,registrationDomainSocket:null,clientRegion:null,preDetectOwa:!1,disableRtpTimeOut:!1,allowMultipleIncomingCalls:!1,closeProtection:!1,maxAverageBitrate:o.MAX_AVERAGE_BITRATE};if(this.permOnClick=!1,this.ringToneFlag=!0,this.ringToneBackFlag=!0,this.connectToneFlag=!0,this.isLoggedIn=!1,this.reconnectInterval=null,this.reconnectTryCount=0,this.localStorage="undefined"!=typeof chrome&&chrome.storage?chrome.storage.local:window.localStorage,P.log=u,void 0!==e)for(var t in e)switch(t){case"enableTracking":p.isBoolean(t,e[t])&&(n.enableTracking=e[t]);break;case"debug":e[t]=e[t].toUpperCase(),p.debug(e[t],o.DEBUG_MODES)?(n.debug=e[t],"ALL-PLAIN"==e[t]&&(e[t]="ALL"),P.log.setLevel(e[t])):P.log.setLevel("INFO");break;case"permOnClick":p.isBoolean(t,e[t])&&(this.permOnClick=e[t],n.permOnClick=e[t]);break;case"audioConstraints":e[t]&&"object"==typeof e[t]&&(n.audioConstraints=e[t]);break;case"dscp":p.isBoolean(t,e[t])&&(n.dscp=e[t]);break;case"codecs":p.codecs(e[t],o.DEFAULT_CODECS)&&(n.codecs=e[t]);break;case"appSecret":n.appSecret=e[t];break;case"appId":n.appId=e[t];break;case"registrationDomainSocket":n.registrationDomainSocket=e[t];break;case"enableIPV6":break;case"clientRegion":p.region(e[t],o.REGION)&&(n.clientRegion=e[t]);break;case"preDetectOwa":p.isBoolean(t,e[t])&&(n.preDetectOwa=e[t]);break;case"disableRtpTimeOut":p.isBoolean(t,e[t])&&(n.disableRtpTimeOut=e[t]);break;case"allowMultipleIncomingCalls":p.isBoolean(t,e[t])&&(n.allowMultipleIncomingCalls=e[t]);break;case"closeProtection":p.isBoolean(t,e[t])&&(n.closeProtection=e[t]);break;case"maxAverageBitrate":p.isNumber(t,e[t])&&(e[t]>=o.MIN_AVERAGE_BITRATE&&e[t]<=o.MAX_AVERAGE_BITRATE&&C(e[t])?n.maxAverageBitrate=Math.floor(e[t]):P.log.error("maxAverageBitrate should be an integer in between "+o.MIN_AVERAGE_BITRATE+" and "+o.MAX_AVERAGE_BITRATE));break;default:P.log.warn("Ignoring invalid option key "+t)}-1!=["ALL","ALL-PLAIN"].indexOf(n.debug)?(this.localStorage.debug="PlivoSIP:*",window._PlivoUseColorLog=!0,"ALL-PLAIN"==n.debug&&(window._PlivoUseColorLog=!1)):this.localStorage.debug="",s.call(this),this.phone=null,this._currentSession=null,this.callSession=null,this.callUUID=null,this.callDirection=null,this.lastCallUUID=null,this._lastCallSession=null,this.incomingInvites=new Map,this.incomingCallsInitiationTime=new Map,this.lastIncomingCall=null,this.callStats=null,this.sipAuthBy=null,this.userName=null,this.options=n,this.callstatskey=null,this.rtp_enabled=null,this.statsioused=null,this.audio={availableDevices:d.availableDevices,ringtoneDevices:d.ringtoneDevices,microphoneDevices:d.inputDevices,speakerDevices:d.outputDevices,revealAudioDevices:d.revealAudioDevices},this.audioConstraints=this.options.audioConstraints,this.owaLastDetect={time:0,isOneWay:!0},this.owaDetectTime=36e5,this.outBoundConnectionStages=[],this._outboundExtraHeaders={},this._outboundCallNumber=null,this.statsSocket=null,this.statsCallback=function(e){this.statsSocket&&this.callstatskey&&this._currentSession&&this.rtp_enabled&&this.options.enableTracking&&(this.statsSocket.send(e),window._PlivoDevLogging&&console.log(e)),this._currentSession&&this._currentSession.session&&"chrome"===this.browserDetails.browser&&l.call(this,M,e,this._currentSession.session.isMuted().audio)}.bind(this),this.calcConnStage=function(e){for(var n,t=function(e){var n=new Date(e);return n.toISOString().substring(0,10)+" "+n.toString().split(" ")[4]+"."+n.getMilliseconds()},r=[],i=0;e.length>i;i++){var a=e[i].split("@");if(a[1]=Number(a[1]),0==i)n=a[1],r.push(a[0]+" = "+t(a[1])+"#");else{var s=a[1]-n;s>1e3?(s/=1e3,s=String(s)+"s#"):s=String(s)+"ms#",r.push(a[0]+" = "+t(a[1])+" +"+s)}}return r=(r=(r=JSON.stringify(r)).replace(/[[",\]]/g,"")).replace(/#/g,"\n")},this.str=function(e){return JSON.stringify(e)},this.bucketApiUrl="",this.bucketApiBody="",d.setAudioContraints(this),P.sendEvents=function(e,n){this.statsSocket&&this.callstatskey&&n&&n.sipCallID?(e=this.statsSocket.addCallInfo(n,e),this.statsSocket.send(e)):P.log.debug("Cannnot send Event ",e," mandatory parameters ( statsSocket  , sipCallID , callstatskey ) not defined ")},P.AppError=function(e,n){if(this.userName&&this.callStats){var t=(this._currentSession?this._currentSession.callUUID:null)||this.userName;"[object Object]"==Object.prototype.toString.call(e)&&(e=JSON.stringify(e)),n&&P.log.debug(`Call summary ${t}\n`,e),this.callStats.reportError(null,t,this.callStats.webRTCFunctions.applicationLog,e)}return!0},h.setup(this.options,n=>{window.RTCPeerConnection||(P.log.error("No webRTC support"),document.onreadystatechange=(()=>{"complete"==document.readyState&&this.emit("onWebrtcNotSupported")})),this.emit("onMediaPermission",n),"failure"==n.status&&this.userName&&this.callStats&&this.callStats.reportError(null,this.userName,this.callStats.webRTCFunctions.getUserMedia),"success"==n.status&&n.stream&&d.audioDevDictionary.call(this,!0).then(()=>{P.log.debug("audioDevDictionary is updated onMediaPermission: "+n.status)}),this.remoteView=document.getElementById(o.REMOTE_VIEW_ID),this.ringToneView=document.getElementById(o.RINGTONE_ELEMENT_ID),this.ringBackToneView=document.getElementById(o.RINGBACK_ELEMENT_ID),this.connectToneView=document.getElementById(o.CONNECT_TONE_ELEMENT_ID),P.log.info("PlivoWebSdk initialized in "+P.log.level()+" mode, version: 2.1.29"),P.log.debug("PlivoWebSdk initialized with ",this.str(e)),P.log.info(this.str(this.browserDetails))}),navigator.mediaDevices.ondevicechange=(e=>{d.checkAudioDevChange.call(this)}),"chrome"==i.adapter.browserDetails.browser&&i.adapter.browserDetails.version<57&&setInterval(()=>{d.checkAudioDevChange.call(this)},5e3),this.audioDevDic=null,d.audioDevDicSetter(e=>{this.audioDevDic=e}),d.audioDevDictionary(!0),window._PlivoInstance=this}a(O,s),O.prototype.login=function(e,n){if(void 0===e||void 0===n||null===e||null===n&&(e.length<=0||n.length<=0))return P.log.error("username & password cant be null."),this.emit("onLoginFailed","Username and password must be filled out"),!1;if(this.phone&&this.phone.isRegistered()&&this.phone.isConnected()&&e===this.userName)return P.log.warn(`Already registered with the endpoint provided - ${e}`),!0;if(this._currentSession)return P.log.warn(`Cannot login when there is an ongoing call ${this._currentSession.callUUID}`),this.emit("onLoginFailed","Cannot login when there is an ongoing call"),!1;this.phone&&(this.phone.stop(),delete this.phone,P.log.debug("deleting the existing phone instance")),this.options.registrationDomainSocket&&(o.WS_SERVERS=this.options.registrationDomainSocket),this.plivoSocket=new i.WebSocketInterface(o.WS_SERVERS);var r={sockets:[this.plivoSocket],register_expires:o.REGISTER_EXPIRES_SECONDS,uri:e+"@"+o.DOMAIN,password:n,googIPv6:this.enableIPV6||!1,connection_recovery_max_interval:o.WS_RECOVERY_MAX_INTERVAL,connection_recovery_min_interval:o.WS_RECOVERY_MIN_INTERVAL,session_timers:!1,user_agent:`${m} ${y}`};try{this.phone=new i.UA(r)}catch(e){return P.log.debug("Failed to create user agent"+e),!1}P.log.info("Ready to login");var a=!1;return this.phone.on("connected",e=>{if(P.log.info("websocket connection established",e),!a){a=!0;this.emit("onConnectionChange",{state:"connected"})}}),this.phone.on("disconnected",e=>{if(P.log.info("websocket connection closed",e),a&&e&&e.code>1e3){var n={state:"disconnected",eventCode:e.code,eventReason:e.reason};this.emit("onConnectionChange",n)}a=!1}),this.phone.on("registered",()=>{if(this.userName=e,!1===this.isLoggedIn){this.isLoggedIn=!0,this.emit("onLogin"),P.log.debug("logged in");let s=new URL(o.STATS_API_URL),c=new Headers;c.append("Content-Type","application/json");let l={username:e,password:n,domain:o.DOMAIN};if(fetch(s,{method:"POST",headers:c,body:JSON.stringify(l)}).then(e=>{e.ok?e.text().then(e=>{e?(e=JSON.parse(e),this.callstatskey=e.data,this.rtp_enabled=e.is_rtp_enabled):P.log.info("Call insights is not enabled"),!this.statsSocket&&this.callstatskey&&(this.statsSocket=new I(this,this.callstatskey),this.heartbeatTimer=setInterval(()=>{this.statsSocket.heartbeat(this)},o.GETSTATS_HEARTBEATINTERVAL)),this.statsSocket&&this.callstatskey&&(this.statsSocket=new I(this,this.callstatskey))}):this.callstatskey=null}).catch(function(e){P.log.error("Error in getting token from call stats",e)}),this.options.enableTracking&&!this.callStats){null!=this.options.appSecret||null!=this.options.appId?this.statsioused=!0:this.statsioused=!1,window.csioChromeLegacyGetStats=!0,this.callStats="undefined"==typeof callstats?t(15):new callstats;var r=e=>{var n=e.streams;window._PlivoDevLogging&&console.log(n)};if("chrome"!=i.adapter.browserDetails.browser&&(r=null),this.callStats&&this.options.appId){var a=this.options.appSecret||W.call(this);this.callStats.initialize(this.options.appId,a,e,(e,n)=>{P.log.debug("Stats Initializing Status: err= "+e+" msg= "+n)},r,{disableBeforeUnloadHandler:!1,applicationVersion:"2.1.29",disablePrecalltest:!0})}P.log.debug("enableTracking initialized")}let u=new URL(o.S3BUCKET_API_URL),d={username:e,password:n,domain:o.DOMAIN};this.bucketApiUrl=u,this.bucketApiBody=d}}),this.phone.on("unregistered",e=>{P.log.debug("Plivo client logged out "+e.cause,e.response),this.isLoggedIn=!1,!this.ringToneView.paused&&h.stopAudio(o.RINGTONE_ELEMENT_ID),!this.ringBackToneView.paused&&h.stopAudio(o.RINGBACK_ELEMENT_ID),this.userName=null,this.emit("onLogout")}),this.phone.on("registrationFailed",e=>{this.isLoggedIn=!1,P.log.debug("Login failed : ",e.cause),this.userName=null,this.emit("onLoginFailed",e.cause)}),this.phone.on("newTransaction",e=>{if("ist"==e.transaction.type){P.log.info("<----- INCOMING -----\x3e");const n=e.transaction.request.getHeader("X-Calluuid")||null;this.incomingCallsInitiationTime.set(n,$()),P.log.debug("call initiation time, invite received from server")}}),this.phone.on("newRTCSession",e=>{if(P.log.debug("new rtc session"),this._currentSession&&"closed"==this._currentSession.session.connection.signalingState&&(P.log.warn("Previous call doesn't end properly"),this._currentSession=null,this.callSession=null,this.callUUID=null,this.callDirection=null),this.incomingInvites.size&&this.incomingInvites.forEach(e=>{e.session.isEnded()&&this.incomingInvites.delete(e.callUUID)}),(this._currentSession||this.incomingInvites.size)&&!this.options.allowMultipleIncomingCalls||this.incomingInvites.size>=o.NUMBER_OF_SIMULTANEOUS_INCOMING_CALLS_ALLOWED){P.log.debug("Already on call, sending busy signal.");e.session.terminate({status_code:486,reason_phrase:"Busy Here"})}else if("remote"===e.originator){"firefox"===this.browserDetails.browser&&this.browserDetails.version>62&&e.request.body.indexOf(!1)&&(e.request.body=e.request.body.replace("a=ice-pwd","a=mid:0\na=ice-pwd"));const n=e.request.getHeader("X-Calluuid")||null;P.log.info(`newRTCSession for incomingCall ${n}`);const t=e.request.getHeader("Call-ID")||null,r=e.request.getHeader("From").match(/:(.*)@/i)[1],a=f.receiveExtraHeader(e.request,e.request.headers),s=this.incomingCallsInitiationTime.get(n);s&&this.incomingCallsInitiationTime.delete(n);const l=new b({callUUID:n,sipCallID:t,direction:"incoming",src:r,dest:this.userName,session:e.session,extraHeaders:a,call_initiation_time:s});this.incomingInvites.set(l.callUUID,l),this.lastIncomingCall=l,this.options.allowMultipleIncomingCalls||(this.callSession=l.session,this.callUUID=l.callUUID,this.direction=l.direction),l.addConnectionStage(`I-invite@${G()}`),l.updateSignallingInfo({invite_time:$()});try{e.request.body=c(this.options.codecs,e.request.body)}catch(e){P.log.debug("checkCodecPreference err - ",e)}P.log.debug("callSession - "+l.callUUID),l.session.on("progress",e=>{P.log.debug("Incoming call progress"),l.addConnectionStage(`progress-180@${G()}`),l.updateSignallingInfo({call_progress_time:$()}),l.setState(l._STATE.RINGING),l.setPostDialDelayEndTime($()),P.log.debug("call ringing180 time, incoming call progress");var n=l.session.remote_identity.uri.toString();!1===this.ringToneFlag||this._currentSession||(P.log.debug("ringtone enabled : ",this.ringToneFlag),h.playAudio(o.RINGTONE_ELEMENT_ID));const t=`${n.substring(4,n.indexOf("@"))}@${o.DOMAIN}`;this.emit("onIncomingCall",t,a,l.getCallInfo()),N.call(this),P.log.debug("Incoming Call Extra Headers : ",a)}),l.session.on("sdp",e=>{e.sdp=e.sdp.replace("useinbandfec=1","useinbandfec=1;maxaveragebitrate="+this.options.maxAverageBitrate),e.sdp=q(e.sdp),P.log.debug("Incoming call SDP processing done")}),l.session.on("accepted",e=>{P.log.info("Incoming call accepted"),x.call(this).then(e=>{F.call(this,e,!0)}).catch(e=>{F.call(this,null,!0)}),l.updateSignallingInfo({answer_time:$()}),V.call(this),d.startVolumeDataStreaming(this);var n=l.session.connection||null;n.oniceconnectionstatechange=(e=>{var t=n.iceConnectionState;P.log.debug("oniceconnectionstatechange:: "+t),l.addConnectionStage(`iceConnectionState-${t}@${G()}`),l.updateMediaConnectionInfo({[`ice_connection_state_${t}`]:$()}),K.call(this,t),this.callStats&&l.callUUID&&n&&("failed"!=t&&"disconnected"!=t||(L.call(this),this.callStats.reportError(n,l.callUUID,this.callStats.webRTCFunctions.iceConnectionFailure)),"connected"==t&&this.emit("onMediaConnected",l.getCallInfo()))})}),l.session.on("confirmed",e=>{P.log.debug(`Incoming call confirmed - ${l.callUUID}`),l.addConnectionStage(`confirmed@${G()}`),l.setState(l._STATE.ANSWERED),l.updateSignallingInfo({call_confirmed_time:$()}),this.options.disableRtpTimeOut&&(l.session.connection.disableRtpTimeOut=!0);var t=l.session.connection.getRemoteStreams()[0];t||P.log.error("Incoming call remoteStream does not exists"),this.remoteView.srcObject=t;this.callStats&&l.session.connection&&this.callStats.addNewFabric(l.session.connection,l.src,this.callStats.fabricUsage.audio,n,e=>{P.log.debug("Stats new fabric message: "+e)}),this.statsSocket&&this.callstatskey&&("chrome"===this.browserDetails.browser&&this.browserDetails.version>63||"firefox"===this.browserDetails.browser&&this.browserDetails.version>59)||"chrome"===this.browserDetails.browser&&this.browserDetails.version>63?z.call(this,l):this.statsSocket&&this.callstatskey&&P.log.warn("This browser version is not supported for collecting data for Call Insights API but the call will proceed despite this. Supported versions are Chrome version - 64 and above, Firefox version - 63 and above"),!this.ringToneView.paused&&h.stopAudio(o.RINGTONE_ELEMENT_ID),!this.ringBackToneView.paused&&h.stopAudio(o.RINGBACK_ELEMENT_ID),this.emit("onCallAnswered",l.getCallInfo()),P.log.debug("Plivo Event: Post-Answer detecting OWA"),setTimeout(j.bind(this),3e3,l.session.connection,this)}),l.session.on("icetimeout",e=>{P.log.debug("iceGathering timed out"),M.call(this,"network","warning","ice_timeout",e,!0,"Possible NAT/Firewall issue","None"),this.statsSocket&&l&&this.statsSocket.onIceFailure(l,"ice_timeout")}),l.session.on("failed",e=>{(P.log.error("Call failed: "+e.cause),l.addConnectionStage(`failed@${G()}`),l.updateSignallingInfo({hangup_time:$(),hangup_party:e.originator,hangup_reason:e.cause}),this.incomingInvites.size<2&&!this.ringToneView.paused&&h.stopAudio(o.RINGTONE_ELEMENT_ID),e.cause==i.C.causes.CANCELED?(l.setState(l._STATE.CANCELED),this.emit("onIncomingCallCanceled",l.getCallInfo())):("Rejected"===e.cause?l.setState(l._STATE.REJECTED):l.setState(l._STATE.FAILED),this.emit("onCallFailed",e.cause,l.getCallInfo())),this.callStats&&l.callUUID&&l.session.connection&&!e.cause.match("edia"))&&(e.message&&(e.cause,e.message.status_code&&String(e.message.status_code)),this.callStats.reportError(l.session.connection,l.callUUID,this.callStats.webRTCFunctions.signalingError));if(this.statsSocket&&l.callUUID&&this.callstatskey&&!e.cause.match("edia")){const n=e.cause;let t;t=e.message&&e.message.status_code?String(e.message.status_code):e.cause,l.updateSignallingInfo({signalling_errors:{timestamp:$(),error_code:t,error_description:n}})}X.call(this,l),d.stopVolumeDataStreaming()}),l.session.on("ended",e=>{P.log.debug(`Incoming call ended - ${l.callUUID}`),P.log.info("Incoming call ended"),l.addConnectionStage(`ended@${G()}`),l.setState(l._STATE.ENDED),l.updateSignallingInfo({hangup_time:$(),hangup_party:e.originator,hangup_reason:e.cause}),this.callStats&&this.callStats.sendFabricEvent(l.session.connection,this.callStats.fabricEvent.fabricTerminated,l.callUUID),this.emit("onCallTerminated",{originator:e.originator,reason:e.cause},l.getCallInfo()),X.call(this,l),d.stopVolumeDataStreaming()}),l.session.on("icecandidate",e=>{const n=e.candidate;n&&-1!=n.candidate.search("srflx")?e.ready():l.gotInitalIce||(l.gotInitalIce=!0,setTimeout(()=>{if(!l.session)return;const n=l.session.connection;"complete"!==n.iceGatheringState&&(e.ready(),P.log.debug("iceGathering taking more than 2sec "+n.iceGatheringState),M.call(this,"network","warning","ice_timeout",2e3,!0,"Possible NAT/Firewall issue","None"))},2e3))}),l.session.on("getusermediafailed",e=>{P.log.error("getusermediafailed: "+e),this.userName&&this.callStats&&(e.message="getusermediafailed",this.callStats.reportError(null,this.userName,this.callStats.webRTCFunctions.getUserMedia,e)),this.statsSocket&&l&&this.statsSocket.onMediaFailure(l,e),P.log.warn("getusermediafailed",e)}),l.session.on("peerconnection:createofferfailed",e=>{P.log.error("peerconnection:createofferfailed: ",e),this.userName&&this.callStats&&(e.message="peerconnection:createofferfailed",this.callStats.reportError(null,this.userName,this.callStats.webRTCFunctions.createOffer,e)),this.statsSocket&&l&&this.statsSocket.onSDPfailure(l,"createofferfailed"),P.log.warn("SDP Failure - createofferfailed",e)}),l.session.on("peerconnection:createanswerfailed",e=>{P.log.error("peerconnection:createanswerfailed: ",e),this.userName&&this.callStats&&(e.message="peerconnection:createanswerfailed",this.callStats.reportError(null,this.userName,this.callStats.webRTCFunctions.createAnswer,e)),this.statsSocket&&l&&this.statsSocket.onSDPfailure(l,"createanswerfailed"),P.log.warn("SDP Failure - createanswerfailed",e)}),l.session.on("peerconnection:setlocaldescriptionfailed",e=>{P.log.error("peerconnection:setlocaldescriptionfailed: ",e),this.userName&&this.callStats&&(e.message="peerconnection:setlocaldescriptionfailed",this.callStats.reportError(null,this.userName,this.callStats.webRTCFunctions.setLocalDescription,e)),this.statsSocket&&l&&this.statsSocket.onSDPfailure(l,"setlocaldescriptionfailed"),P.log.warn("SDP Failure - setlocaldescriptionfailed",e)}),l.session.on("peerconnection:setremotedescriptionfailed",e=>{P.log.error("peerconnection:setremotedescriptionfailed: ",e),this.userName&&this.callStats&&this.callStats.reportError(null,this.userName,this.callStats.webRTCFunctions.setRemoteDescription,e),this.statsSocket&&l&&this.statsSocket.onSDPfailure(l,"setremotedescriptionfailed"),P.log.warn("SDP Failure - setremotedescriptionfailed",e)})}else{const n=e.request.getHeader("Call-ID")||null;this._currentSession=new b({sipCallID:n,direction:"outgoing",src:this.userName,dest:this._outboundCallNumber,session:e.session,extraHeaders:this._outboundExtraHeaders}),this.callSession=this._currentSession.session,this.callUUID=this._currentSession.callUUID,this.callDirection=this._currentSession.direction,this.outBoundConnectionStages.forEach(e=>{this._currentSession.addConnectionStage(e)}),this.outBoundConnectionStages=[],P.log.debug("new RTCSession outgoing"),this.emit("onCalling")}}),this.phone.start(),!0},O.prototype.logout=function(){return P.log.debug("logout() triggered!"),this._currentSession&&(this._currentSession.addConnectionStage("logout()@"+G()),P.log.debug("Terminating an active call"),this._currentSession.session.terminate()),this.phone&&this.phone.stop(),clearInterval(this.heartbeatTimer),this.heartbeatTimer=null,this.statsSocket&&(this.statsSocket.disconnect(),this.statsSocket=null),!0},O.prototype.call=function(e,n){if(P.log.info("<----- OUTGOING -----\x3e"),this.outBoundConnectionStages=[],P.log.info("Outgoing call initialized to : "+e),!this.isLoggedIn)return P.log.warn("Must be logged in before make a call"),!1;this.outBoundConnectionStages.push(`call()@${G()}`);const t=e=>(this.emit("onCallFailed",e),!0),r=()=>(this.owaLastDetect.isOneWay=!1,H.call(this,n,e));this.options.preDetectOwa&&"chrome"==this.browserDetails.browser&&(new Date-this.owaLastDetect.time>this.owaDetectTime||this.owaLastDetect.isOneWay)?J((e,n)=>(this.owaLastDetect.time=new Date,n?(P.log.error("Error in detecting microphone status ",n),this.emit("onMediaPermission",{status:"failure",error:n.name}),t("media - "+n.name),!1):(P.log.debug("getUserMedia precheck ",e),0==Number(e.bytesSent)&&0==Number(e.audioInputLevel)?(M.call(this,"audio","warning","no_microphone_access",0,!0,"chrome lost access to microphone - restart browser","None"),this.owaLastDetect.isOneWay=!0,t("no_microphone_access"),!1):(0==Number(e.audioInputLevel)&&M.call(this,"audio","warning","no_microphone_access",0,!0,"microphone is muted","None"),void r())))):r()},O.prototype.answer=function(e,n){let t;if(e&&this.incomingInvites.has(e))t=this.incomingInvites.get(e);else if(this.lastIncomingCall&&(t=this.lastIncomingCall,e&&this.options.allowMultipleIncomingCalls))return P.log.error(`No incomingCall with callUUID - ${e}`),!1;if(this.options.allowMultipleIncomingCalls&&n&&"string"!=typeof n||"string"==typeof n&&this.options.allowMultipleIncomingCalls&&-1===["reject","ignore","letring"].indexOf(n.toLowerCase()))return P.log.error("Invalid actionOnOtherIncomingCalls value"),!1;if(!t)return P.log.error("Incoming call answer() failed : no incoming call"),!1;{P.log.debug(`answer - ${t.callUUID}`);var r={};t.addConnectionStage(`answer()@${G()}`);const e=e=>(P.log.debug("rejecting CAll, Reason : "+e),this.reject(t.callUUID),!0),i=()=>{if(this._currentSession&&this.hangup(),this.incomingInvites.forEach(e=>{e!==t&&("string"==typeof n&&"ignore"===n.toLowerCase()?this.ignore(e.callUUID):"string"==typeof n&&"reject"===n.toLowerCase()?this.reject(e.callUUID):"string"==typeof n&&"letring"===n.toLowerCase()?P.log.info("Other incoming calls will keep ringing"):n||this.reject(e.callUUID))}),this.owaLastDetect.isOneWay=!1,r.pcConfig={iceServers:[{urls:o.STUN_SERVERS}]},this.permOnClick){var e=this.options.audioConstraints||!0;r.mediaConstraints={audio:e,video:!1}}else window.localStream||P.log.warn("no localStream attached for this call");r.mediaStream=window.localStream||null,r.rtcConstraints=this.options.dscp?{optional:[{googDscp:!0}]}:null,r.sessionTimersExpires=o.SESSION_TIMERS_EXPIRES;try{t.session.answer(r),this._currentSession=t,this.incomingInvites.delete(t.callUUID),t===this.lastIncomingCall&&(this.lastIncomingCall=null,this.incomingInvites.size&&(this.lastIncomingCall=this.incomingInvites.values().next().value)),this.callSession=this._currentSession.session,this.callUUID=this._currentSession.callUUID,this.callDirection=this._currentSession.direction}catch(e){P.log.error("error in answering : ",e),t.setState(t._STATE.CANCELED),this.emit("onIncomingCallCanceled",t.getCallInfo())}return!this.ringToneView.paused&&h.stopAudio(o.RINGTONE_ELEMENT_ID),!0};this.options.preDetectOwa&&"chrome"==this.browserDetails.browser&&(new Date-this.owaLastDetect.time>this.owaDetectTime||this.owaLastDetect.isOneWay)?J((n,t)=>(this.owaLastDetect.time=new Date,t?(P.log.error("Error in detecting microphone status ",t),this.emit("onMediaPermission",{status:"failure",error:t.name}),e("media - "+t.name),!1):(P.log.debug("getUserMedia precheck ",this.str(n)),0==Number(n.bytesSent)&&0==Number(n.audioInputLevel)?(M.call(this,"audio","warning","no_microphone_access",0,!0,"chrome lost access to microphone - restart browser","None"),this.owaLastDetect.isOneWay=!0,e("no_microphone_access"),!1):(0==Number(n.audioInputLevel)&&M.call(this,"audio","warning","no_microphone_access",0,!0,"microphone is muted","None"),void i())))):i()}return!0},O.prototype.hangup=function(){if(!this._currentSession)return P.log.warn("No call session exists to hangup"),!1;P.log.debug(`hangup - ${this._currentSession.callUUID}`),"outgoing"==this._currentSession.session.direction||Q(this._currentSession.session)||P.log.warn("use of hangup() on unanswered call is deprecated. use reject() instead");try{P.log.info("hangup initialized"),d.updateAudioDeviceFlags(),P.AppError.call(this,{name:"hangup",message:"hangup initialized",method:"hangup()"}),this._currentSession.session.terminate(),!this.ringBackToneView.paused&&h.stopAudio(o.RINGBACK_ELEMENT_ID)}catch(e){P.log.error("Could not hangup reason : ",e),P.AppError.call(this,{name:e.name,message:e.message,method:"hangup()"}),P.sendEvents.call(this,{msg:"ERROR_EVENT",name:e.name,info:e.message,method:"hangup()"},this._currentSession)}return!0},O.prototype.reject=function(e){let n;if(e&&this.incomingInvites.has(e))n=this.incomingInvites.get(e);else if(this.lastIncomingCall&&(n=this.lastIncomingCall,e&&this.options.allowMultipleIncomingCalls))return P.log.error(`No incomingCall with callUUID - ${e}`),!1;if(!n)return P.log.warn("No call session exists to reject()"),!1;if(P.log.debug(`reject - ${n.callUUID}`),Q(n.session))return P.log.warn("call already answerd, please use hangup() method"),!1;if(n){P.log.info("rejecting call"),P.AppError.call(this,{name:"reject",message:"reject initialized",method:"reject()"});try{n.session.terminate({status_code:486,reason_phrase:"Busy Here"}),this.incomingInvites.delete(n.callUUID)}catch(e){P.log.error("error in rejecting call : ",e),P.AppError.call(this,{name:e.name,message:e.message,method:"reject()"}),P.sendEvents.call(this,{msg:"ERROR_EVENT",name:e.name,info:e.message,method:"reject()"},this.incomingCall)}return this.incomingInvites.size||!this.ringToneView.paused&&h.stopAudio(o.RINGTONE_ELEMENT_ID),!0}},O.prototype.ignore=function(e){let n;if(e&&this.incomingInvites.has(e))n=this.incomingInvites.get(e);else if(this.lastIncomingCall&&(n=this.lastIncomingCall,e&&this.options.allowMultipleIncomingCalls))return P.log.error(`No incomingCall with callUUID - ${e}`),!1;return n?(P.log.debug(`ignore - ${n.callUUID}`),n.session.removeAllListeners(),this.incomingInvites.delete(n.callUUID),this.incomingInvites.size||!this.ringToneView.paused&&h.stopAudio(o.RINGTONE_ELEMENT_ID),n.setState(n._STATE.IGNORED),n.updateSignallingInfo({hangup_time:$(),hangup_party:"local",hangup_reason:"Ignored",signalling_errors:{timestamp:$(),error_code:"Ignored",error_description:"Ignored"}}),X.call(this,n),this.emit("onIncomingCallIgnored",n.getCallInfo()),!0):(P.log.warn("No incoming calls to ignore"),!1)},O.prototype.sendDtmf=function(e){if(void 0===e||null==e)return P.log.warn("DTMF digit can not be null");if(void 0===o.DTMF_TONE_FLAG[e])return P.log.warn(e+" is not a valid DTMF digit");if(this._currentSession){P.log.debug(`sendDtmf - ${this._currentSession.callUUID}`);try{return P.log.debug("sending dtmf digit "+e),this._currentSession.session.sendDTMF(e),"*"===e?h.playAudio("dtmfstar"):"#"===e?h.playAudio("dtmfpound"):h.playAudio("dtmf"+e)}catch(e){P.log.error("Call has not been confirmed cannot send DTMF"),P.AppError.call(this,{name:e.name,message:e.message,method:"sendDtmf()"}),P.sendEvents.call(this,{msg:"ERROR_EVENT",name:e.name,info:e.message,method:"sendDtmf()"},this._currentSession)}}else P.log.warn("No call session exists to sendDtmf")},O.prototype.mute=function(){if(!this._currentSession)return P.log.warn("No call session exists to mute"),!1;P.log.debug("mute called");try{d.mute.call(this),this.callStats&&this.callStats.sendFabricEvent(this._currentSession.session.connection,this.callStats.fabricEvent.audioMute,this._currentSession.callUUID),this.statsSocket&&this.statsSocket.onToggleMute(this._currentSession,"mute")}catch(e){P.log.error("error in mute :",e),P.AppError.call(this,{name:e.name,message:e.message,method:"mute()"}),P.sendEvents.call(this,{msg:"ERROR_EVENT",name:e.name,info:e.message,method:"mute()"},this._currentSession)}return!0},O.prototype.unmute=function(){if(!this._currentSession)return P.log.warn("No call session exists to unmute"),!1;P.log.debug("unmute called");try{d.unmute.call(this),this.callStats&&this.callStats.sendFabricEvent(this._currentSession.session.connection,this.callStats.fabricEvent.audioUnmute,this._currentSession.callUUID),this.statsSocket&&this.statsSocket.onToggleMute(this._currentSession,"unmute")}catch(e){P.log.error("error in unmute : ",e),P.AppError.call(this,{name:e.name,message:e.message,method:"unmute()"}),P.sendEvents.call(this,{msg:"ERROR_EVENT",name:e.name,info:e.message,method:"unmute()"},this._currentSession)}return!0},O.prototype.setRingTone=function(e){return!1===e||null===e?this.ringToneFlag=!1:"string"==typeof e?(this.ringToneFlag="user",P.log.debug("setRingTone() url : "+e),this.ringToneView.src=e):this.ringToneFlag=!0,!0},O.prototype.setRingToneBack=function(e){return!1===e||null===e?this.ringToneBackFlag=!1:"string"==typeof e?(this.ringToneBackFlag="user",P.log.debug("setRingToneBack() url : "+e),this.ringBackToneView.src=e):this.ringToneBackFlag=!0,!0},O.prototype.setConnectTone=function(e){return this.connectToneFlag=!!e,!0},O.prototype.setDtmfTone=function(e,n){if(!1===n||null===n)o.DTMF_TONE_FLAG[e]=!1;else if("string"==typeof n){P.log.debug("set dtmf tone"),o.DTMF_TONE_FLAG[e]="user";var t="dtmf"+e;document.getElementById(t).src=n}else o.DTMF_TONE_FLAG[e]=!0;return!0},O.prototype.getCallUUID=function(){return this._currentSession?this._currentSession.callUUID:null},O.prototype.getLastCallUUID=function(){return this._lastCallSession?this._lastCallSession.callUUID:null},O.prototype.getIncomingCalls=function(){const e=[];return this.incomingInvites.forEach(n=>{e.push(n.getCallInfo())}),e},O.prototype.setDebug=function(e){e&&-1!=["INFO","DEBUG","WARN","ERROR","ALL","OFF"].indexOf(e)&&P.log.setLevel(e)},O.prototype.getPeerConnection=function(){return this._currentSession&&this._currentSession.session&&this._currentSession.session.connection?{status:"success",pc:this._currentSession.session.connection}:{status:"called in wrong state",pc:null}},O.prototype.version="2.1.29",O.prototype.webRTC=function(){return!!window.RTCPeerConnection},O.prototype.supportedBrowsers=function(){return"Chrome, Firefox"},O.prototype.sendQualityFeedback=function(e,n,t){n=Number(n);if(this.callStats)if(this.userName)if(e)if(t&&t.toString().length>200)P.log.error("sendQualityFeedback() comment max length is 200 character");else if(t||P.log.error("sendQualityFeedback() comment is mandatory"),n>0&&n<=5){var r={overall:n,comment:t};let i;this._currentSession&&this._currentSession.callUUID===e?i=this._currentSession:this._lastCallSession&&this._lastCallSession.callUUID===e&&(i=this._lastCallSession),this.statsSocket&&this.statsSocket.qualityFeedback(i,r),r.userID=this.userName,this.callStats.sendUserFeedback(e,r,function(e){P.log.debug("Stats sendFeedback status: "+e)}),P.log.debug("Feedback sent for callUUID: "+e)}else P.log.error("sendQualityFeedback() score: "+n+" , score should be from 1-5 range");else P.log.error("sendQualityFeedback() callUUID is mandatory");else P.log.error("sendQualityFeedback() userName is null, isLoggedIn : "+this.isLoggedIn);else P.log.warn("Stats integration not configured, ignoring feedback")},O.prototype.submitCallQualityFeedback=function(e,n,t,r,i){return new Promise((a,s)=>{if(!this.userName)return P.log.error("sendQualityFeedback() userName is null, isLoggedIn : "+this.isLoggedIn),void s("username not found");if(!e)return P.log.error("submitCallQualityFeedback() callUUID is mandatory"),void s("callUUID is mandatory");if(!n)return P.log.error("submitCallQualityFeedback() starRating is not given "),void s("Star rating is Mandatory");var c=Number(n);if(!(c>0&&c<=5))return P.log.error("submitCallQualityFeedback() score: "+c+" , score should be from 1-5 range"),void s("score should be from 1-5 range");{if(r&&r.toString().length>280)return P.log.error("submitCallQualityFeedback() max length for note is 280 characters"),void s("Maximum length for note is 280 charecters");var l=[];if(!Array.isArray(t))return void s("Attribute issues should be an array");if(5!=c&&(!t||t.length<1))return P.log.error("submitCallQualityFeedback() Atleast one issue is mandatory for feedback"),void s("Atleast one issue is mandatory for feedback");if((t||t.length>=1)&&(t.forEach(function(e){if("string"==typeof e){let n=e.trim().toUpperCase(),t=o.DEFAULT_COMMENTS[n];t&&l.push(t)}}),l.length<1)){var u=Object.keys(o.DEFAULT_COMMENTS);if(5!=c)return P.log.error("submitCallQualityFeedback() Issues must be from the predefined list of issues for feedback -"+u),void s("Issues must be from the predefined list of issues - "+u);P.log.debug("submitCallQualityFeedback() Feedback with full rating without any Issues or matches from predefined list of issues -"+u)}var d={overall:c,comment:l+" "+r||""};let n;if(this.callStats&&this.callStats.sendUserFeedback(e,d,function(e){P.log.debug("Stats sendFeedback status: "+e)}),this._currentSession&&this._currentSession.callUUID===e?n=this._currentSession:this._lastCallSession&&this._lastCallSession.callUUID===e&&(n=this._lastCallSession),n&&this.statsSocket&&this.statsSocket.qualityFeedback(n,d),1==i){var h=this.bucketApiUrl,f=this.bucketApiBody;if(!h)return void s("Feedback is sent. But console logs could not be sent");f.calluuid=e;var p="consolelogs"+e+this.userName;D(h,f,p,d).then(e=>{a("Feedback is sent with console logs")}).catch(e=>{P.log.error("Feedback was not able to send console logs"),s(e)})}else a("Feedback is sent")}})};var D=function(e,n,t,r){return new Promise(function(t,i){fetch(e,{method:"POST",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify(n)}).then(e=>{e.ok?e.text().then(e=>{if(!e)return P.log.error("Did not get s3 url to upload"),void i("Log file was not uploaded to server");e=JSON.parse(e);var n=new URL(e.data);let a=P.log.consolelogs();var s=[];r&&s.push(JSON.stringify(r)+" \n"),s.push(a);var o=new Blob(s,{type:"text/plain;charset=utf-8"}),c=new Headers;c.append("Content-Type","text/plain"),fetch(n,{method:"PUT",headers:c,body:o}).then(function(e){P.log.info("Log file uploaded to server"),t("done")}).catch(function(e){P.log.error("Log file was not uploaded to server",e),i("Log file was not uploaded to server")})}).catch(e=>{P.log.error("Did not get s3 url to upload",e),i("Log file was not uploaded to server")}):(P.log.error("WS API server did not return the presigned S3 Url for uploading call logs"),i("Bad response from server"))}).catch(function(e){P.log.error("WS API server did not return the presigned S3 Url for uploading call logs",e),i("API server did not return the presigned S3 Url for uploading call logs")})})},j=function(e){if(e&&"closed"!=e.signalingState&&"chrome"==i.adapter.browserDetails.browser){var n=e;n.getStats(function(e){e.result().forEach(function(e){var n=e;n.stat("bytesSent")&&P.log.debug("Bytes sent by WebSDK client: "+n.stat("bytesSent")+" audioInputLevel: "+n.stat("audioInputLevel")),"ssrc"===n.type&&"audio"===n.stat("mediaType")&&0===parseInt(n.stat("bytesSent"),10)&&0===n.stat("audioInputLevel")&&(P.log.debug("One way audio detected"),M.call(this,"audio","warning","no_microphone_access",0,!0,"no access to your microphone","None"))})},n.getLocalStreams()[0].getAudioTracks()[0],function(e){console.log(e)})}},M=function(e,n,t,r,i,a,s){if(this.options.enableTracking){var o={group:e,level:n,type:t,value:r,active:i,desc:a||"",stream:s};this.emit("mediaMetrics",o)}},x=function(){return navigator.mediaDevices.enumerateDevices().then(e=>{const n={noOfAudioInput:0,noOfAudioOutput:0,audioInputLables:"",audioOutputLables:"",audioInputGroupIds:"",audioOutputGroupIds:"",audioInputIdSet:this.audio.microphoneDevices.get()||"",audioOutputIdSet:this.audio.speakerDevices.get()||"",activeInputAudioDevice:"",activeOutputAudioDevice:""};return e.forEach(e=>{"default"===e.deviceId&&"audioinput"===e.kind?(A.input_default=e.label,e.defaultInputDeviceGroupId=e.groupId):"default"===e.deviceId&&"audiooutput"===e.kind?(A.output_default=e.label,e.defaultOutputDeviceGroupId=e.groupId):"audioinput"===e.kind?(A[e.deviceId]=e.label,n.noOfAudioInput+=1,n.audioInputLables+=`${e.label} ,`,n.audioInputGroupIds+=`${e.groupId} ,`):"audiooutput"===e.kind&&(A[e.deviceId]=e.label,n.noOfAudioOutput+=1,n.audioOutputLables+=`${e.label} ,`,n.audioOutputGroupIds+=`${e.groupId} ,`)}),""==n.audioInputIdSet?n.activeInputAudioDevice=A.input_default:n.activeInputAudioDevice=A[n.audioInputIdSet],""==n.audioOutputIdSet?n.activeOutputAudioDevice=A.output_default:n.activeOutputAudioDevice=A[n.audioOutputIdSet],n})},N=function(){var e=this;const n={msg:"CALL_SUMMARY",userAgent:_,clientVersionMajor:k.major||k[0]||"0",clientVersionMinor:k.minor||k[1]||"0",clientVersionPatch:k.patch||k[2]||"0",sdkName:m,sdkVersionMajor:T.major,sdkVersionMinor:T.minor,sdkVersionPatch:T.patch,clientName:i.adapter.browserDetails.browser,devicePlatform:S,deviceOs:E,setupOptions:this.options};this.options.closeProtection?window.onbeforeunload=function(t){P.sendEvents.call(e,n,e._currentSession),t.preventDefault(),t.returnValue=""}:window.onbeforeunload=function(t){new Promise(function(t,r){P.sendEvents.call(e,n,e._currentSession),e._currentSession.session.terminate(),t()}).then(()=>{})},window.onunload=function(t){new Promise(function(t,r){e._currentSession.session.terminate(),P.sendEvents.call(e,n,e._currentSession),t()}).then(()=>{})}},F=function(e,n){if(N.call(this),!this.callstatskey)return;const t={msg:"CALL_ANSWERED",info:"Outgoing call answered",clientName:i.adapter.browserDetails.browser,userAgent:_,clientVersionMajor:k.major||k[0]||"0",clientVersionMinor:k.minor||k[1]||"0",clientVersionPatch:k.patch||k[2]||"0",sdkName:m,sdkVersionMajor:T.major,sdkVersionMinor:T.minor,sdkVersionPatch:T.patch,devicePlatform:S,deviceOs:E,setupOptions:this.options};e&&(t.audioDeviceInfo=e),n&&(t.info="Incoming call answered"),P.sendEvents.call(this,t,this._currentSession)},U=function(e,n,t,r){if(!this.callstatskey)return;const a={msg:"CALL_SUMMARY",signalling:n,mediaConnection:t,clientName:i.adapter.browserDetails.browser,userAgent:_,clientVersionMajor:k.major||k[0]||"0",clientVersionMinor:k.minor||k[1]||"0",clientVersionPatch:k.patch||k[2]||"0",sdkName:m,sdkVersionMajor:T.major,sdkVersionMinor:T.minor,sdkVersionPatch:T.patch,devicePlatform:S,deviceOs:E,setupOptions:this.options};e&&(a.audioDeviceInfo=e),P.sendEvents.call(this,a,r)},L=function(){const e=this._currentSession.session.renegotiate({rtcOfferConstraints:{iceRestart:!0}});P.log.debug("Renegotiate Ice :: "+e),this.reconnectInterval&&clearInterval(this.reconnectInterval),this.reconnectInterval=setInterval(()=>{this._currentSession&&this._currentSession.session&&this._currentSession.session.connection&&("failed"===this._currentSession.session.connection.iceConnectionState||"disconnected"===this._currentSession.session.connection.iceConnectionState)&&this.reconnectTryCount<=5?(this.reconnectTryCount+=1,this._currentSession.session.renegotiate({rtcOfferConstraints:{iceRestart:!0}}),P.log.debug("Renegotiate Ice Retry :: "+this.reconnectTryCount)):(P.log.debug("Renegotiate Success"),clearInterval(this.reconnectInterval),this.reconnectInterval=null,this.reconnectTryCount=0)},2e3)},H=function(e,n){var t,r={};if(n&&(n=String(n)),void 0===n||null===n||n.length<=0)return P.log.warn("Destination address cant be null and its length must be > 0"),!1;if(this._currentSession)return P.log.warn("Can't make another call while in call"),!1;if(this.incomingInvites.size)return P.log.warn("Can't make a call while there is an incoming call"),!1;e=e||{};var i=[];for(var a in this._outboundExtraHeaders={},this._outboundCallNumber=n,e){var s=e[a];f.checkExtraHeaderKey(a)&&f.checkExtraHeaderVal(s)?(i.push(a+": "+s),this._outboundExtraHeaders[a]=s,P.log.debug("valid hdr = "+a+" -> "+s)):P.log.debug("invalid hdr = "+a+" -> "+s)}this.options.clientRegion&&i.push("X-ClientRegion: "+this.options.clientRegion),t="sip:"!=n.substring(0,4)?"sip:"+n:n,r.sessionTimersExpires=o.SESSION_TIMERS_EXPIRES,r.pcConfig={iceServers:[{urls:o.STUN_SERVERS}]};var l=this.options.audioConstraints||!0;r.mediaConstraints={audio:l,video:!1},r.rtcConstraints=this.options.dscp?{optional:[{googDscp:!0}]}:null,r.extraHeaders=i,r.mediaStream=window.localStream||null,r.eventHandlers={sending:e=>{P.log.debug("Outgoing call sending"),this._currentSession.addConnectionStage(`O-invite@${G()}`),this._currentSession.updateSignallingInfo({call_initiation_time:$()}),P.log.debug("call initiation time, sending invite");var n=this._currentSession.session.connection||null;!1!==this.connectToneFlag&&h.playAudio(o.CONNECT_TONE_ELEMENT_ID),n.ontrack=(e=>{P.log.debug("Outgoing call received addStream"),this._currentSession&&(this._currentSession.addConnectionStage(`addStream-success@${G()}`),this._currentSession.updateMediaConnectionInfo({stream_success:$()}),e.streams[0]?(setTimeout(()=>{this.remoteView.srcObject=e.streams[0]},100),this.ringToneBackFlag&&!Q(this._currentSession.session)?setTimeout(()=>{Q(this._currentSession.session)||this.remoteView.pause()},100):this.ringToneBackFlag||Q(this._currentSession.session)||P.log.debug("playAudio - MediaServer")):(P.log.error("Outgoing call addStream failure"),this._currentSession.addConnectionStage(`addStream-failure@${G()}`),this._currentSession.updateMediaConnectionInfo({stream_failure:$()})))}),n.oniceconnectionstatechange=(()=>{var e=n.iceConnectionState;P.log.debug("oniceconnectionstatechange:: "+e),this._currentSession&&(this._currentSession.addConnectionStage(`iceConnectionState-${e}@${G()}`),this._currentSession.updateMediaConnectionInfo({[`ice_connection_state_${e}`]:$()}),K.call(this,e),this.callStats&&this._currentSession.callUUID&&n&&(P.log.debug("iceState :: "+e),"failed"!=e&&"disconnected"!=e||(L.call(this),this.callStats.reportError(n,this._currentSession.callUUID,this.callStats.webRTCFunctions.iceConnectionFailure)),"connected"==e&&this.emit("onMediaConnected",this._currentSession.getCallInfo())))})},sdp:e=>{try{e.sdp=c(this.options.codecs,e.sdp),e.sdp=e.sdp.replace("useinbandfec=1","useinbandfec=1;maxaveragebitrate="+this.options.maxAverageBitrate),e.sdp=q(e.sdp)}catch(e){P.log.debug("checkCodecPreference err - ",e)}},progress:e=>{const n=e.response.getHeader("X-Calluuid");if(this._currentSession.setCallUUID(n),this._currentSession.setState(this._currentSession._STATE.RINGING),this.callUUID=n,this.emit("onCallRemoteRinging",this._currentSession.getCallInfo()),N.call(this),"firefox"===this.browserDetails.browser&&this.browserDetails.version>62&&e.response.body.indexOf(!1)&&(e.response.body=e.response.body.replace("a=ice-pwd","a=mid:0\na=ice-pwd")),this.callStats&&this._currentSession.session.connection){var t=e.response.headers.To[0].parsed.uri.user;this.callStats.addNewFabric(this._currentSession.session.connection,t,this.callStats.fabricUsage.audio,this._currentSession.callUUID,e=>{P.log.debug("Stats new fabric message: "+e)})}this._currentSession.addConnectionStage(`progress-${e.response.status_code}@${G()}`),P.log.debug(`progress-${e.response.status_code}@${G()}`),this._currentSession.updateSignallingInfo({ring_start_time:$()}),this._currentSession.setPostDialDelayEndTime($()),P.log.debug("Outgoing call progress",e.response.status_code),P.log.debug("ringback tone enabled : "+this.ringToneBackFlag),!this.connectToneView.paused&&h.stopAudio(o.CONNECT_TONE_ELEMENT_ID),this.ringToneBackFlag&&h.playAudio(o.RINGBACK_ELEMENT_ID),183!=e.response.status_code||!e.response.body||(P.log.debug(`callSession - ${this._currentSession.callUUID}`),this._currentSession.setPostDialDelayEndTime($()),this.ringToneBackFlag)||!this.ringBackToneView.paused&&h.stopAudio(o.RINGBACK_ELEMENT_ID)},accepted:e=>{const n=e.response.getHeader("X-Calluuid");this._currentSession.setCallUUID(n),P.log.info("Outgoing call accepted"),x.call(this).then(e=>{F.call(this,e,!1)}).catch(e=>{F.call(this,null,!1)}),this._currentSession.updateSignallingInfo({answer_time:$()}),this._currentSession.setPostDialDelayEndTime($());V.call(this);var t=this._currentSession.session.connection;t.getLocalStreams()[0],t.getRemoteStreams()[0];if(d.startVolumeDataStreaming(this),this.callStats&&this._currentSession.session.connection){const n=e.response.headers.To[0].parsed.uri.user;this.callStats.addNewFabric(this._currentSession.session.connection,n,this.callStats.fabricUsage.audio,this._currentSession.callUUID,function(e){P.log.debug("Stats new fabric message: "+e)})}},confirmed:e=>{P.log.debug(`Outgoing call confirmed - ${this._currentSession.callUUID}`),this._currentSession.addConnectionStage("confirmed@"+G()),this._currentSession.setState(this._currentSession._STATE.ANSWERED),this._currentSession.updateSignallingInfo({call_confirmed_time:$()}),this.remoteView.paused&&this.remoteView.play(),this.options.disableRtpTimeOut&&(this._currentSession.session.connection.disableRtpTimeOut=!0),!this.ringToneView.paused&&h.stopAudio(o.RINGTONE_ELEMENT_ID),!this.ringBackToneView.paused&&h.stopAudio(o.RINGBACK_ELEMENT_ID),!this.connectToneView.paused&&h.stopAudio(o.CONNECT_TONE_ELEMENT_ID),this.statsSocket&&this.callstatskey&&("chrome"===this.browserDetails.browser&&this.browserDetails.version>63||"firefox"===this.browserDetails.browser&&this.browserDetails.version>59)||"chrome"===this.browserDetails.browser&&this.browserDetails.version>63?z.call(this,this._currentSession):this.statsSocket&&this.callstatskey&&P.log.warn("This browser version is not supported for collecting data for Call Insights API but the call will proceed despite this. Supported versions are Chrome version - 64 and above, Firefox version - 63 and above"),this.emit("onCallAnswered",this._currentSession.getCallInfo()),setTimeout(j.bind(this),3e3,this._currentSession.session.connection,this)},icecandidate:e=>{const n=e.candidate;n&&-1!=n.candidate.search("srflx")?e.ready():this._currentSession.gotInitalIce||(this._currentSession.gotInitalIce=!0,setTimeout(()=>{if(!this._currentSession)return;const n=this._currentSession.session.connection;"complete"!==n.iceGatheringState&&(e.ready(),P.log.debug("iceGathering taking more than 2sec "+n.iceGatheringState),M.call(this,"network","warning","ice_timeout",2e3,!0,"Possible NAT/Firewall issue","None"))},2e3))},icetimeout:e=>{P.log.debug("iceGathering timed out"),M.call(this,"network","warning","ice_timeout",e,!0,"Possible NAT/Firewall issue","None"),this.statsSocket&&this._currentSession&&this.statsSocket.onIceFailure(this._currentSession,"ice_timeout")},failed:e=>{if(P.log.debug("Outgoing call failed: "+e.cause),this._currentSession){if(this._currentSession.addConnectionStage("failed@"+G()),this._currentSession.updateSignallingInfo({hangup_time:$(),hangup_party:e.originator,hangup_reason:e.cause}),"Rejected"===e.cause?this._currentSession.setState(this._currentSession._STATE.REJECTED):"Canceled"===e.cause?this._currentSession.setState(this._currentSession._STATE.CANCELED):this._currentSession.setState(this._currentSession._STATE.FAILED),!this.ringBackToneView.paused&&h.stopAudio(o.RINGBACK_ELEMENT_ID),!this.connectToneView.paused&&h.stopAudio(o.CONNECT_TONE_ELEMENT_ID),e.message&&this._currentSession.setCallUUID(e.message.getHeader("X-CallUUID")||null),this.callStats&&this._currentSession.callUUID&&!e.cause.match("edia")){var n=t=e.cause;e.message&&e.message.status_code&&(n=String(e.message.status_code)),this.callStats.reportError(null,this._currentSession.callUUID,this.callStats.webRTCFunctions.signalingError)}if(this.statsSocket&&this._currentSession.callUUID&&this.callstatskey&&!e.cause.match("edia")){var t;n=t=e.cause;e.message&&e.message.status_code&&(n=String(e.message.status_code)),this._currentSession.updateSignallingInfo({signalling_errors:{timestamp:$(),error_code:n,error_description:t}})}this.emit("onCallFailed",e.cause,this._currentSession.getCallInfo()),X.call(this,this._currentSession),d.stopVolumeDataStreaming()}},ended:e=>{P.log.debug(`Outgoing call ended - ${this._currentSession.callUUID}`),P.log.info("Outgoing call ended"),this._currentSession.addConnectionStage("ended@"+G()),this._currentSession.setState(this._currentSession._STATE.ENDED),this._currentSession.updateSignallingInfo({hangup_time:$(),hangup_party:e.originator,hangup_reason:e.cause}),this.callStats&&this.callStats.sendFabricEvent(this._currentSession.session.connection,this.callStats.fabricEvent.fabricTerminated,this._currentSession.callUUID),this.emit("onCallTerminated",{originator:e.originator,reason:e.cause},this._currentSession.getCallInfo()),P.AppError.call(this,{name:"onCallTerminated",originator:e.originator,reason:e.cause}),X.call(this,this._currentSession),d.stopVolumeDataStreaming()},getusermediafailed:e=>{P.log.error("getusermediafailed: "+e),this.userName&&this.callStats&&(e.message="getusermediafailed",this.callStats.reportError(null,this.userName,this.callStats.webRTCFunctions.getUserMedia,e)),this.statsSocket&&this._currentSession&&this.statsSocket.onMediaFailure(this._currentSession,e)},"peerconnection:createofferfailed":e=>{P.log.error("peerconnection:createofferfailed: ",e),this.userName&&this.callStats&&(e.message="peerconnection:createofferfailed",this.callStats.reportError(null,this.userName,this.callStats.webRTCFunctions.createOffer,e)),this.statsSocket&&this._currentSession&&this.statsSocket.onSDPfailure(this._currentSession,"createofferfailed")},"peerconnection:createanswerfailed":e=>{P.log.error("peerconnection:createanswerfailed: ",e),this.userName&&this.callStats&&(e.message="peerconnection:createanswerfailed",this.callStats.reportError(null,this.userName,this.callStats.webRTCFunctions.createAnswer,e)),this.statsSocket&&this._currentSession&&this.statsSocket.onSDPfailure(this._currentSession,"createanswerfailed")},"peerconnection:setlocaldescriptionfailed":e=>{P.log.error("peerconnection:setlocaldescriptionfailed: ",e),this.userName&&this.callStats&&(e.message="peerconnection:setlocaldescriptionfailed",this.callStats.reportError(null,this.userName,this.callStats.webRTCFunctions.setLocalDescription,e)),this.statsSocket&&this._currentSession&&this.statsSocket.onSDPfailure(this._currentSession,"setlocaldescriptionfailed")},"peerconnection:setremotedescriptionfailed":e=>{P.log.error("peerconnection:setremotedescriptionfailed: ",e),this.userName&&this.callStats&&this.callStats.reportError(null,this.userName,this.callStats.webRTCFunctions.setRemoteDescription,e),this.statsSocket&&this._currentSession&&this.statsSocket.onSDPfailure(this._currentSession,"setremotedescriptionfailed")}};try{this.phone.call(t,r),P.log.debug("Outgoing call options : ",JSON.stringify(r.mediaConstraints))}catch(e){return P.log.error("Failed to execute plivo.onCalling event handler",e),P.AppError.call(this,{name:e.name,message:e.message,method:"call()"}),P.sendEvents.call(this,{msg:"ERROR_EVENT",name:e.name,info:e.message,method:"call()"},this._currentSession),!1}return!0},q=function(e){var n=e,t=0,r=0,i=[],a=e.split("\n");for(let e=0;e<a.length;e++)-1!=a[e].indexOf("a=candidate")&&(r++,-1!=a[e].indexOf(".local")&&(t++,a[e]=B(a[e]))),i.push(a[e]);return t!=r?n:i.join("\n")},B=function(e){var n=e.split(" ");return n[4]="192.168.0.1",n.join(" ")},G=function(){return(new Date).getTime()},$=function(){return Date.now()},V=function(){return this.storage={},function(){var e=this.storage;return e.local_audio=[],e.remote_audio=[],e.mosLocalMeasures=[],e.mosRemoteMeasures=[],e.jitterLocalMeasures=[],e.jitterRemoteMeasures=[],e.packetLossRemoteMeasures=[],e.packetLossLocalMeasures=[],e.rtt=[],e.audioCodec=null,e.warning={audioLocalMeasures:!1,audioRemoteMeasures:!1,mosLocalMeasures:!1,mosRemoteMeasures:!1,jitterLocalMeasures:!1,jitterRemoteMeasures:!1,packetLossRemoteMeasures:!1,packetLossLocalMeasures:!1,rtt:!1,ice_connection:!1},e.startAnalysis=!1,setTimeout(function(){e.startAnalysis=!0,P.log.debug("Stats startAnalysis started")},5e3),!0}.call(this)},W=function(){return(e,n)=>{P.log.info("Stats token req...");var t={eventHandlers:{succeeded:function(e){P.log.info("Stats token success!");var t=JSON.parse(e.response.getHeader("x-token"));return t&&"0"!==t?n(null,t.token):(P.log.error("Stats token failed with 0"),n("token failed 0"))},failed:function(e){return e.response&&e.response.status_code?(P.log.error("Stats token failed!",e.response.status_code),n(e.response.status_code)):(P.log.error("Stats token failed!"),n("failed"))}},extraHeaders:[`X-appID: ${this.options.appId}`,`X-userID: ${this.userName}`]};this.phone.sendMessage("admin","-- Plivo web client --",t)}},z=function(e){if("chrome"==this.browserDetails.browser||"firefox"==this.browserDetails.browser){const n=new R(this,this.statsCallback);e.setCallStats(n),P.log.debug("stats are: ",n)}else P.log.debug("ignoring webrtc stats collection for "+main.browserDetails.browser);return!0},K=function(e){-1!=["disconnected","failed"].indexOf(e)&&(M.call(this,"network","warning","ice_connection",e,!0,"network drop","None"),this.storage&&(this.storage.warning.ice_connection=!0)),"connected"==e&&this.storage&&!0===this.storage.warning.ice_connection&&(M.call(this,"network","warning","ice_connection",e,!1,"network drop","None"),this.storage.warning.ice_connection=!1)},J=function(e){var n,t,r;function i(e,n){n.candidate&&e.addIceCandidate(n.candidate).then().catch(a)}function a(n){e&&e(null,n)}function s(){n&&n.getTracks().forEach(function(e){e.stop(),n.removeTrack(e),n=null}),"stable"==t.signalingState&&t.close(),"stable"==r.signalingState&&r.close()}t=new RTCPeerConnection(null),r=new RTCPeerConnection(null),navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(e){n=e,function(e){e.addStream(n),e.createOffer().then(function(n){e.setLocalDescription(n).then(function(){!function e(n,r){n.setRemoteDescription(r).then(function(){"offer"==r.type&&n.createAnswer().then(function(r){n.setLocalDescription(r).then(function(){}).catch(a),e(t,r)}).catch(a)}).catch(a)}(r,n)}).catch(a)}).catch(a)}(t)}).catch(a),t.onicecandidate=function(e){i(r,e)},r.onicecandidate=function(e){i(t,e)},setTimeout(function(){P.log.debug("getUM precheck icestate : "+t.iceConnectionState);var n=0;!function r(){t.getLocalStreams()[0]&&t.getStats(function(t){t.result().forEach(function(t){var i=t;if("ssrc"===i.type&&"audio"===i.stat("mediaType")){var a={bytesSent:i.stat("bytesSent"),audioInputLevel:i.stat("audioInputLevel")};Number(a.audioInputLevel)<=0&&2!=n?(n++,setTimeout(r,1e3),P.log.debug("getUM precheck re-attempt: "+n)):(e&&e(a,null),setTimeout(s,3e3))}})},t.getLocalStreams()[0].getAudioTracks()[0],a)}()},500)},Q=function(e){return e?e.isEstablished():(P.log.debug("session not available"),!1)},X=function(e){P.AppError.call(this,function(e){for(var n,t=[],r=0;e.length>r;r++){var i=e[r].split("@");if(0==r)n=i[1],t.push(i[0]+" = "+i[1]+"#");else{var a=new Date(i[1])-new Date(n);a>1e3?(a/=1e3,a=String(a)+"s#"):a=String(a)+"ms#",t.push(i[0]+" = "+i[1]+" +"+a)}}return t=(t=(t=JSON.stringify(t)).replace(/[[",\]]/g,"")).replace(/#/g,"\n")}(e.connectionStages),"log"),e.clearCallStats(),e===this._currentSession?(this.remoteView.pause(),this._lastCallSession=e,this.lastCallUUID=e.callUUID,this._currentSession=null,this.callSession=null,this.callUUID=null,this.callDirection=null):this.incomingInvites.has(e.callUUID)&&this.incomingInvites.delete(e.callUUID),this.lastIncomingCall&&this.lastIncomingCall.callUUID===e.callUUID&&(this.lastIncomingCall=null,this.options.allowMultipleIncomingCalls||(this.callSession=null,this.callUUID=null,this.callDirection=null),this.incomingInvites.size&&(this.lastIncomingCall=this.incomingInvites.values().next().value,this.options.allowMultipleIncomingCalls||(this.callSession=this.lastIncomingCall.session,this.callUUID=this.lastIncomingCall.callUUID,this.callDirection=this.lastIncomingCall.direction)));const n=e.getSignallingInfo(),t=e.getMediaConnectionInfo();if(this.callstatskey&&x.call(this).then(r=>{U.call(this,r,n,t,e)}).catch(r=>{U.call(this,null,n,t,e)}),this._currentSession||0!=this.incomingInvites.size||(window.onbeforeunload=function(e){},window.onunload=function(e){}),!this._currentSession&&(delete this.storage,window.localStream&&("chrome"==i.adapter.browserDetails.browser||this.permOnClick)))try{window.localStream.getTracks().forEach(e=>{e.stop(),window.localStream.removeTrack(e)}),window.localStream=null}catch(e){P.log.debug("error on stop track in localStream : "+e.message)}};e.exports=O},function(e,n){e.exports=function(){var e,n,t,r,i,a,s,o,c,l,u=window.AudioContext||window.webkitAudioContext;function d(){r=window.requestAnimationFrame(d),c=new Uint8Array(s.frequencyBinCount),l=new Uint8Array(o.frequencyBinCount),s.getByteFrequencyData(c),o.getByteFrequencyData(l);for(var n=0,t=0,i=0;i<c.length;i++)n+=c[i],t+=l[i];var a=n/c.length,u=t/l.length;a=(a/255).toFixed(3),u=(u/255).toFixed(3),audioStats={inputVolume:a,outputVolume:u},e.emit("volume",audioStats)}return{start:function(r,c,l){e=r,c&&l&&(n?n.resume():n=new u,t?t.resume():t=new u,i=n.createGain(),a=t.createGain(),n.createMediaStreamSource(c).connect(i),t.createMediaStreamSource(l).connect(a),s=n.createAnalyser(),o=t.createAnalyser(),s.fftSize=128,o.fftSize=128,i.connect(s),a.connect(o),d())},stop:function(){console.log("stopping the requesting frame"),n&&n.suspend(),t&&t.suspend(),r&&window.cancelAnimationFrame(r)}}}},function(e,n,t){"use strict";var r={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};r.localCName=r.generateIdentifier(),r.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},r.splitSections=function(e){return e.split("\nm=").map(function(e,n){return(n>0?"m="+e:e).trim()+"\r\n"})},r.getDescription=function(e){var n=r.splitSections(e);return n&&n[0]},r.getMediaSections=function(e){var n=r.splitSections(e);return n.shift(),n},r.matchPrefix=function(e,n){return r.splitLines(e).filter(function(e){return 0===e.indexOf(n)})},r.parseCandidate=function(e){for(var n,t={foundation:(n=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(n[1],10),protocol:n[2].toLowerCase(),priority:parseInt(n[3],10),ip:n[4],address:n[4],port:parseInt(n[5],10),type:n[7]},r=8;r<n.length;r+=2)switch(n[r]){case"raddr":t.relatedAddress=n[r+1];break;case"rport":t.relatedPort=parseInt(n[r+1],10);break;case"tcptype":t.tcpType=n[r+1];break;case"ufrag":t.ufrag=n[r+1],t.usernameFragment=n[r+1];break;default:t[n[r]]=n[r+1]}return t},r.writeCandidate=function(e){var n=[];n.push(e.foundation),n.push(e.component),n.push(e.protocol.toUpperCase()),n.push(e.priority),n.push(e.address||e.ip),n.push(e.port);var t=e.type;return n.push("typ"),n.push(t),"host"!==t&&e.relatedAddress&&e.relatedPort&&(n.push("raddr"),n.push(e.relatedAddress),n.push("rport"),n.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(n.push("tcptype"),n.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(n.push("ufrag"),n.push(e.usernameFragment||e.ufrag)),"candidate:"+n.join(" ")},r.parseIceOptions=function(e){return e.substr(14).split(" ")},r.parseRtpMap=function(e){var n=e.substr(9).split(" "),t={payloadType:parseInt(n.shift(),10)};return n=n[0].split("/"),t.name=n[0],t.clockRate=parseInt(n[1],10),t.channels=3===n.length?parseInt(n[2],10):1,t.numChannels=t.channels,t},r.writeRtpMap=function(e){var n=e.payloadType;void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType);var t=e.channels||e.numChannels||1;return"a=rtpmap:"+n+" "+e.name+"/"+e.clockRate+(1!==t?"/"+t:"")+"\r\n"},r.parseExtmap=function(e){var n=e.substr(9).split(" ");return{id:parseInt(n[0],10),direction:n[0].indexOf("/")>0?n[0].split("/")[1]:"sendrecv",uri:n[1]}},r.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},r.parseFmtp=function(e){for(var n,t={},r=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<r.length;i++)t[(n=r[i].trim().split("="))[0].trim()]=n[1];return t},r.writeFmtp=function(e){var n="",t=e.payloadType;if(void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach(function(n){e.parameters[n]?r.push(n+"="+e.parameters[n]):r.push(n)}),n+="a=fmtp:"+t+" "+r.join(";")+"\r\n"}return n},r.parseRtcpFb=function(e){var n=e.substr(e.indexOf(" ")+1).split(" ");return{type:n.shift(),parameter:n.join(" ")}},r.writeRtcpFb=function(e){var n="",t=e.payloadType;return void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){n+="a=rtcp-fb:"+t+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),n},r.parseSsrcMedia=function(e){var n=e.indexOf(" "),t={ssrc:parseInt(e.substr(7,n-7),10)},r=e.indexOf(":",n);return r>-1?(t.attribute=e.substr(n+1,r-n-1),t.value=e.substr(r+1)):t.attribute=e.substr(n+1),t},r.parseSsrcGroup=function(e){var n=e.substr(13).split(" ");return{semantics:n.shift(),ssrcs:n.map(function(e){return parseInt(e,10)})}},r.getMid=function(e){var n=r.matchPrefix(e,"a=mid:")[0];if(n)return n.substr(6)},r.parseFingerprint=function(e){var n=e.substr(14).split(" ");return{algorithm:n[0].toLowerCase(),value:n[1]}},r.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:r.matchPrefix(e+n,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(e,n){var t="a=setup:"+n+"\r\n";return e.fingerprints.forEach(function(e){t+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),t},r.parseCryptoLine=function(e){var n=e.substr(9).split(" ");return{tag:parseInt(n[0],10),cryptoSuite:n[1],keyParams:n[2],sessionParams:n.slice(3)}},r.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?r.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},r.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;var n=e.substr(7).split("|");return{keyMethod:"inline",keySalt:n[0],lifeTime:n[1],mkiValue:n[2]?n[2].split(":")[0]:void 0,mkiLength:n[2]?n[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},r.getCryptoParameters=function(e,n){return r.matchPrefix(e+n,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(e,n){var t=r.matchPrefix(e+n,"a=ice-ufrag:")[0],i=r.matchPrefix(e+n,"a=ice-pwd:")[0];return t&&i?{usernameFragment:t.substr(12),password:i.substr(10)}:null},r.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},r.parseRtpParameters=function(e){for(var n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},t=r.splitLines(e)[0].split(" "),i=3;i<t.length;i++){var a=t[i],s=r.matchPrefix(e,"a=rtpmap:"+a+" ")[0];if(s){var o=r.parseRtpMap(s),c=r.matchPrefix(e,"a=fmtp:"+a+" ");switch(o.parameters=c.length?r.parseFmtp(c[0]):{},o.rtcpFeedback=r.matchPrefix(e,"a=rtcp-fb:"+a+" ").map(r.parseRtcpFb),n.codecs.push(o),o.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(o.name.toUpperCase())}}}return r.matchPrefix(e,"a=extmap:").forEach(function(e){n.headerExtensions.push(r.parseExtmap(e))}),n},r.writeRtpDescription=function(e,n){var t="";t+="m="+e+" ",t+=n.codecs.length>0?"9":"0",t+=" UDP/TLS/RTP/SAVPF ",t+=n.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",t+="c=IN IP4 0.0.0.0\r\n",t+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach(function(e){t+=r.writeRtpMap(e),t+=r.writeFmtp(e),t+=r.writeRtcpFb(e)});var i=0;return n.codecs.forEach(function(e){e.maxptime>i&&(i=e.maxptime)}),i>0&&(t+="a=maxptime:"+i+"\r\n"),t+="a=rtcp-mux\r\n",n.headerExtensions&&n.headerExtensions.forEach(function(e){t+=r.writeExtmap(e)}),t},r.parseRtpEncodingParameters=function(e){var n,t=[],i=r.parseRtpParameters(e),a=-1!==i.fecMechanisms.indexOf("RED"),s=-1!==i.fecMechanisms.indexOf("ULPFEC"),o=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=o.length>0&&o[0].ssrc,l=r.matchPrefix(e,"a=ssrc-group:FID").map(function(e){return e.substr(17).split(" ").map(function(e){return parseInt(e,10)})});l.length>0&&l[0].length>1&&l[0][0]===c&&(n=l[0][1]),i.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var r={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&n&&(r.rtx={ssrc:n}),t.push(r),a&&((r=JSON.parse(JSON.stringify(r))).fec={ssrc:c,mechanism:s?"red+ulpfec":"red"},t.push(r))}}),0===t.length&&c&&t.push({ssrc:c});var u=r.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substr(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substr(5),10)*.95-16e3:void 0,t.forEach(function(e){e.maxBitrate=u})),t},r.parseRtcpParameters=function(e){var n={},t=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];t&&(n.cname=t.value,n.ssrc=t.ssrc);var i=r.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=i.length>0,n.compound=0===i.length;var a=r.matchPrefix(e,"a=rtcp-mux");return n.mux=a.length>0,n},r.parseMsid=function(e){var n,t=r.matchPrefix(e,"a=msid:");if(1===t.length)return{stream:(n=t[0].substr(7).split(" "))[0],track:n[1]};var i=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return i.length>0?{stream:(n=i[0].value.split(" "))[0],track:n[1]}:void 0},r.parseSctpDescription=function(e){var n,t=r.parseMLine(e),i=r.matchPrefix(e,"a=max-message-size:");i.length>0&&(n=parseInt(i[0].substr(19),10)),isNaN(n)&&(n=65536);var a=r.matchPrefix(e,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substr(12),10),protocol:t.fmt,maxMessageSize:n};if(r.matchPrefix(e,"a=sctpmap:").length>0){var s=r.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(s[0],10),protocol:s[1],maxMessageSize:n}}},r.writeSctpDescription=function(e,n){var t=[];return t="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+n.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+n.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+n.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+n.port+" "+n.protocol+" 65535\r\n"],void 0!==n.maxMessageSize&&t.push("a=max-message-size:"+n.maxMessageSize+"\r\n"),t.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,21)},r.writeSessionBoilerplate=function(e,n,t){var i,a=void 0!==n?n:2;return i=e||r.generateSessionId(),"v=0\r\no="+(t||"thisisadapterortc")+" "+i+" "+a+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},r.writeMediaSection=function(e,n,t,i){var a=r.writeRtpDescription(e.kind,n);if(a+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),a+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===t?"actpass":"active"),a+="a=mid:"+e.mid+"\r\n",e.direction?a+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?a+="a=sendrecv\r\n":e.rtpSender?a+="a=sendonly\r\n":e.rtpReceiver?a+="a=recvonly\r\n":a+="a=inactive\r\n",e.rtpSender){var s="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";a+="a="+s,a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+s,e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+s,a+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"),a},r.getDirection=function(e,n){for(var t=r.splitLines(e),i=0;i<t.length;i++)switch(t[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return t[i].substr(2)}return n?r.getDirection(n):"sendrecv"},r.getKind=function(e){return r.splitLines(e)[0].split(" ")[0].substr(2)},r.isRejected=function(e){return"0"===e.split(" ",2)[1]},r.parseMLine=function(e){var n=r.splitLines(e)[0].substr(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},r.parseOLine=function(e){var n=r.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},r.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var n=r.splitLines(e),t=0;t<n.length;t++)if(n[t].length<2||"="!==n[t].charAt(1))return!1;return!0},e.exports=r},function(e,n,t){var r=t(45),i=t(46);n.write=i,n.parse=r.parse,n.parseParams=r.parseParams,n.parseFmtpConfig=r.parseFmtpConfig,n.parsePayloads=r.parsePayloads,n.parseRemoteCandidates=r.parseRemoteCandidates,n.parseImageAttributes=r.parseImageAttributes,n.parseSimulcastStreamList=r.parseSimulcastStreamList},function(e,n){var t=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var n="candidate:%s %d %s %d %s %d typ %s";return n+=null!=e.raddr?" raddr %s rport %d":"%v%v",n+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(n+=" generation %d"),n+=null!=e["network-id"]?" network-id %d":"%v",n+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var n="ssrc:%d";return null!=e.attribute&&(n+=" %s",null!=e.value&&(n+=":%s")),n}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var n="mediaclk:";return n+=null!=e.id?"id=%s %s":"%v%s",n+=null!=e.mediaClockValue?"=%s":"",n+=null!=e.rateNumerator?" rate=%s":"",n+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(t).forEach(function(e){t[e].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})})},function(e,n){var t,r,i=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function o(e){if(t===setTimeout)return setTimeout(e,0);if((t===a||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:a}catch(e){t=a}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(e){r=s}}();var c,l=[],u=!1,d=-1;function h(){u&&c&&(u=!1,c.length?l=c.concat(l):d=-1,l.length&&f())}function f(){if(!u){var e=o(h);u=!0;for(var n=l.length;n;){for(c=l,l=[];++d<n;)c&&c[d].run();d=-1,n=l.length}c=null,u=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(n){try{return r.call(null,e)}catch(n){return r.call(this,e)}}}(e)}}function p(e,n){this.fun=e,this.array=n}function g(){}i.nextTick=function(e){var n=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)n[t-1]=arguments[t];l.push(new p(e,n)),1!==l.length||u||o(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,n){var t=500,r={T1:t,T2:4e3,T4:5e3,TIMER_B:32e3,TIMER_D:0,TIMER_F:32e3,TIMER_H:32e3,TIMER_I:0,TIMER_J:0,TIMER_K:0,TIMER_L:32e3,TIMER_M:32e3,PROVISIONAL_RESPONSE_INTERVAL:6e4};e.exports=r},function(e,n,t){const r=t(5).EventEmitter,i=t(19),a=t(1),s=t(8),o=t(10),c=t(2),l=t(22),u=t(6),d=t(50),h=t(13),f=t(52),p=t(53),g=t(54),b=t(55),v=t(0)("PlivoSIP:RTCSession"),m=t(0)("PlivoSIP:ERROR:RTCSession");m.log=console.warn.bind(console);const y={STATUS_NULL:0,STATUS_INVITE_SENT:1,STATUS_1XX_RECEIVED:2,STATUS_INVITE_RECEIVED:3,STATUS_WAITING_FOR_ANSWER:4,STATUS_ANSWERED:5,STATUS_WAITING_FOR_ACK:6,STATUS_CANCELED:7,STATUS_TERMINATED:8,STATUS_CONFIRMED:9},_=["audio","video"];e.exports=class e extends r{static get C(){return y}constructor(e){v("new"),super(),this._id=null,this._ua=e,this._status=y.STATUS_NULL,this._dialog=null,this._earlyDialogs={},this._contact=null,this._from_tag=null,this._to_tag=null,this._connection=null,this._connectionPromiseQueue=Promise.resolve(),this._request=null,this._is_canceled=!1,this._cancel_reason="",this._is_confirmed=!1,this._late_sdp=!1,this._rtcOfferConstraints=null,this._rtcAnswerConstraints=null,this._localMediaStream=null,this._localMediaStreamLocallyGenerated=!1,this._rtcReady=!0,this._timers={ackTimer:null,expiresTimer:null,invite2xxTimer:null,userNoAnswerTimer:null},this._direction=null,this._local_identity=null,this._remote_identity=null,this._start_time=null,this._end_time=null,this._tones=null,this._audioMuted=!1,this._videoMuted=!1,this._localHold=!1,this._remoteHold=!1,this._sessionTimers={enabled:this._ua.configuration.session_timers,refreshMethod:this._ua.configuration.session_timers_refresh_method,defaultExpires:a.SESSION_EXPIRES,currentExpires:null,running:!1,refresher:!1,timer:null},this._referSubscribers={},this._data={}}get C(){return y}get causes(){return a.causes}get id(){return this._id}get connection(){return this._connection}get contact(){return this._contact}get direction(){return this._direction}get local_identity(){return this._local_identity}get remote_identity(){return this._remote_identity}get start_time(){return this._start_time}get end_time(){return this._end_time}get data(){return this._data}set data(e){this._data=e}get status(){return this._status}isInProgress(){switch(this._status){case y.STATUS_NULL:case y.STATUS_INVITE_SENT:case y.STATUS_1XX_RECEIVED:case y.STATUS_INVITE_RECEIVED:case y.STATUS_WAITING_FOR_ANSWER:return!0;default:return!1}}isEstablished(){switch(this._status){case y.STATUS_ANSWERED:case y.STATUS_WAITING_FOR_ACK:case y.STATUS_CONFIRMED:return!0;default:return!1}}isEnded(){switch(this._status){case y.STATUS_CANCELED:case y.STATUS_TERMINATED:return!0;default:return!1}}isMuted(){return{audio:this._audioMuted,video:this._videoMuted}}isOnHold(){return{local:this._localHold,remote:this._remoteHold}}connect(e,n={},t){v("connect()");const r=e,i=n.eventHandlers||{},o=c.cloneArray(n.extraHeaders),l=n.mediaConstraints||{audio:!0,video:!0},d=n.mediaStream||null,h=n.pcConfig||{iceServers:[]},f=n.rtcConstraints||null,p=n.rtcOfferConstraints||null;if(this._rtcOfferConstraints=p,this._rtcAnswerConstraints=n.rtcAnswerConstraints||null,this._data=n.data||this._data,void 0===e)throw new TypeError("Not enough arguments");if(this._status!==y.STATUS_NULL)throw new s.InvalidStateError(this._status);if(!window.RTCPeerConnection)throw new s.NotSupportedError("WebRTC not supported");if(!(e=this._ua.normalizeTarget(e)))throw new TypeError(`Invalid target: ${r}`);this._sessionTimers.enabled&&c.isDecimal(n.sessionTimersExpires)&&(n.sessionTimersExpires>=a.MIN_SESSION_EXPIRES?this._sessionTimers.defaultExpires=n.sessionTimersExpires:this._sessionTimers.defaultExpires=a.SESSION_EXPIRES);for(const e in i)Object.prototype.hasOwnProperty.call(i,e)&&this.on(e,i[e]);this._from_tag=c.newTag();const g=n.anonymous||!1,b={from_tag:this._from_tag};this._contact=this._ua.contact.toString({anonymous:g,outbound:!0}),g&&(b.from_display_name="Anonymous",b.from_uri="sip:anonymous@anonymous.invalid",o.push(`P-Preferred-Identity: ${this._ua.configuration.uri.toString()}`),o.push("Privacy: id")),o.push(`Contact: ${this._contact}`),o.push("Content-Type: application/sdp"),this._sessionTimers.enabled&&o.push(`Session-Expires: ${this._sessionTimers.defaultExpires}`),this._request=new u.InitialOutgoingInviteRequest(e,this._ua,b,o),this._id=this._request.call_id+this._from_tag,this._createRTCConnection(h,f),this._direction="outgoing",this._local_identity=this._request.from,this._remote_identity=this._request.to,t&&t(this),this._newRTCSession("local",this._request),this._sendInitialRequest(l,p,d)}init_incoming(e,n){let t;v("init_incoming()");const r=e.getHeader("Content-Type");e.body&&"application/sdp"!==r?e.reply(415):(this._status=y.STATUS_INVITE_RECEIVED,this._from_tag=e.from_tag,this._id=e.call_id+this._from_tag,this._request=e,this._contact=this._ua.contact.toString(),e.hasHeader("expires")&&(t=1e3*e.getHeader("expires")),e.to_tag=c.newTag(),this._createDialog(e,"UAS",!0)?(e.body?this._late_sdp=!1:this._late_sdp=!0,this._status=y.STATUS_WAITING_FOR_ANSWER,this._timers.userNoAnswerTimer=setTimeout(()=>{e.reply(408),this._failed("local",null,a.causes.NO_ANSWER)},this._ua.configuration.no_answer_timeout),t&&(this._timers.expiresTimer=setTimeout(()=>{this._status===y.STATUS_WAITING_FOR_ANSWER&&(e.reply(487),this._failed("system",null,a.causes.EXPIRES))},t)),this._direction="incoming",this._local_identity=e.to,this._remote_identity=e.from,n&&n(this),this._newRTCSession("remote",e),this._status!==y.STATUS_TERMINATED&&(e.reply(180,null,[`Contact: ${this._contact}`]),this._progress("local",null))):e.reply(500,"Missing Contact header field"))}answer(e={}){v("answer()");const n=this._request,t=c.cloneArray(e.extraHeaders),r=e.mediaConstraints||{},i=e.mediaStream||null,o=e.pcConfig||{iceServers:[]},l=e.rtcConstraints||null,u=e.rtcAnswerConstraints||null;let d,h=!1,f=!1,p=!1,g=!1;if(this._rtcAnswerConstraints=u,this._rtcOfferConstraints=e.rtcOfferConstraints||null,this._data=e.data||this._data,"incoming"!==this._direction)throw new s.NotSupportedError('"answer" not supported for outgoing RTCSession');if(this._status!==y.STATUS_WAITING_FOR_ANSWER)throw new s.InvalidStateError(this._status);if(this._sessionTimers.enabled&&c.isDecimal(e.sessionTimersExpires)&&(e.sessionTimersExpires>=a.MIN_SESSION_EXPIRES?this._sessionTimers.defaultExpires=e.sessionTimersExpires:this._sessionTimers.defaultExpires=a.SESSION_EXPIRES),this._status=y.STATUS_ANSWERED,!this._createDialog(n,"UAS"))return void n.reply(500,"Error creating dialog");clearTimeout(this._timers.userNoAnswerTimer),t.unshift(`Contact: ${this._contact}`);const b=n.parseSDP();Array.isArray(b.media)||(b.media=[b.media]);for(const e of b.media)"audio"===e.type&&(h=!0,e.direction&&"sendrecv"!==e.direction||(p=!0)),"video"===e.type&&(f=!0,e.direction&&"sendrecv"!==e.direction||(g=!0));if(i&&!1===r.audio){d=i.getAudioTracks();for(const e of d)i.removeTrack(e)}if(i&&!1===r.video){d=i.getVideoTracks();for(const e of d)i.removeTrack(e)}i||void 0!==r.audio||(r.audio=p),i||void 0!==r.video||(r.video=g),i||h||(r.audio=!1),i||f||(r.video=!1),this._createRTCConnection(o,l),Promise.resolve().then(()=>i||(r.audio||r.video?(this._localMediaStreamLocallyGenerated=!0,navigator.mediaDevices.getUserMedia(r).catch(e=>{if(this._status===y.STATUS_TERMINATED)throw new Error("terminated");throw n.reply(480),this._failed("local",null,a.causes.USER_DENIED_MEDIA_ACCESS),m('emit "getusermediafailed" [error:%o]',e),this.emit("getusermediafailed",e),new Error("getUserMedia() failed")})):void 0)).then(e=>{if(this._status===y.STATUS_TERMINATED)throw new Error("terminated");this._localMediaStream=e,e&&this._connection.addStream(e)}).then(()=>{if(this._late_sdp)return;const e={originator:"remote",type:"offer",sdp:n.body};v('emit "sdp"'),this.emit("sdp",e);const t=new RTCSessionDescription({type:"offer",sdp:e.sdp});return this._connectionPromiseQueue=this._connectionPromiseQueue.then(()=>this._connection.setRemoteDescription(t)).catch(e=>{throw n.reply(488),this._failed("system",null,a.causes.WEBRTC_ERROR),m('emit "peerconnection:setremotedescriptionfailed" [error:%o]',e),this.emit("peerconnection:setremotedescriptionfailed",e),new Error("peerconnection.setRemoteDescription() failed")}),this._connectionPromiseQueue}).then(()=>{if(this._status===y.STATUS_TERMINATED)throw new Error("terminated");return this._connecting(n),this._late_sdp?this._createLocalDescription("offer",this._rtcOfferConstraints).catch(()=>{throw n.reply(500),new Error("_createLocalDescription() failed")}):this._createLocalDescription("answer",u).catch(()=>{throw n.reply(500),new Error("_createLocalDescription() failed")})}).then(e=>{if(this._status===y.STATUS_TERMINATED)throw new Error("terminated");this._handleSessionTimersInIncomingRequest(n,t),n.reply(200,null,t,e,()=>{this._status=y.STATUS_WAITING_FOR_ACK,this._setInvite2xxTimer(n,e),this._setACKTimer(),this._accepted("local")},()=>{this._failed("system",null,a.causes.CONNECTION_ERROR)})}).catch(e=>{this._status!==y.STATUS_TERMINATED&&m(e)})}terminate(e={}){v("terminate()");const n=e.cause||a.causes.BYE,t=c.cloneArray(e.extraHeaders),r=e.body;let i,l=e.status_code,u=e.reason_phrase;if(this._status===y.STATUS_TERMINATED)throw new s.InvalidStateError(this._status);switch(this._status){case y.STATUS_NULL:case y.STATUS_INVITE_SENT:case y.STATUS_1XX_RECEIVED:if(v("canceling session"),l&&(l<200||l>=700))throw new TypeError(`Invalid status_code: ${l}`);l&&(i=`SIP ;cause=${l} ;text="${u=u||a.REASON_PHRASE[l]||""}"`),this._status===y.STATUS_NULL||this._status===y.STATUS_INVITE_SENT?(this._is_canceled=!0,this._cancel_reason=i):this._status===y.STATUS_1XX_RECEIVED&&this._request.cancel(i),this._status=y.STATUS_CANCELED,this._failed("local",null,a.causes.CANCELED);break;case y.STATUS_WAITING_FOR_ANSWER:case y.STATUS_ANSWERED:if(v("rejecting session"),(l=l||480)<300||l>=700)throw new TypeError(`Invalid status_code: ${l}`);this._request.reply(l,u,t,r),this._failed("local",null,a.causes.REJECTED);break;case y.STATUS_WAITING_FOR_ACK:case y.STATUS_CONFIRMED:if(v("terminating session"),u=e.reason_phrase||a.REASON_PHRASE[l]||"",l&&(l<200||l>=700))throw new TypeError(`Invalid status_code: ${l}`);if(l&&t.push(`Reason: SIP ;cause=${l}; text="${u}"`),this._status===y.STATUS_WAITING_FOR_ACK&&"incoming"===this._direction&&this._request.server_transaction.state!==o.C.STATUS_TERMINATED){const e=this._dialog;this.receiveRequest=(({method:n})=>{n===a.ACK&&(this.sendRequest(a.BYE,{extraHeaders:t,body:r}),e.terminate())}),this._request.server_transaction.on("stateChanged",()=>{this._request.server_transaction.state===o.C.STATUS_TERMINATED&&(this.sendRequest(a.BYE,{extraHeaders:t,body:r}),e.terminate())}),this._ended("local",null,n),this._dialog=e,this._ua.newDialog(e)}else this.sendRequest(a.BYE,{extraHeaders:t,body:r}),this._ended("local",null,n)}}sendDTMF(e,n={}){v("sendDTMF() | tones: %s",e);let t=0,r=n.duration||null,i=n.interToneGap||null;if(void 0===e)throw new TypeError("Not enough arguments");if(this._status!==y.STATUS_CONFIRMED&&this._status!==y.STATUS_WAITING_FOR_ACK)throw new s.InvalidStateError(this._status);if("number"==typeof e&&(e=e.toString()),!e||"string"!=typeof e||!e.match(/^[0-9A-DR#*,]+$/i))throw new TypeError(`Invalid tones: ${e}`);if(r&&!c.isDecimal(r))throw new TypeError(`Invalid tone duration: ${r}`);if(r?r<f.C.MIN_DURATION?(v(`"duration" value is lower than the minimum allowed, setting it to ${f.C.MIN_DURATION} milliseconds`),r=f.C.MIN_DURATION):r>f.C.MAX_DURATION?(v(`"duration" value is greater than the maximum allowed, setting it to ${f.C.MAX_DURATION} milliseconds`),r=f.C.MAX_DURATION):r=Math.abs(r):r=f.C.DEFAULT_DURATION,n.duration=r,i&&!c.isDecimal(i))throw new TypeError(`Invalid interToneGap: ${i}`);i?i<f.C.MIN_INTER_TONE_GAP?(v(`"interToneGap" value is lower than the minimum allowed, setting it to ${f.C.MIN_INTER_TONE_GAP} milliseconds`),i=f.C.MIN_INTER_TONE_GAP):i=Math.abs(i):i=f.C.DEFAULT_INTER_TONE_GAP,this._tones?this._tones+=e:(this._tones=e,function e(){let a;if(this._status===y.STATUS_TERMINATED||!this._tones||t>=this._tones.length)return void(this._tones=null);const s=this._tones[t];t+=1;if(","===s)a=2e3;else{const e=new f(this);n.eventHandlers={onFailed:()=>{this._tones=null}},e.send(s,n),a=r+i}setTimeout(e.bind(this),a)}.call(this))}sendInfo(e,n,t={}){if(v("sendInfo()"),this._status!==y.STATUS_CONFIRMED&&this._status!==y.STATUS_WAITING_FOR_ACK)throw new s.InvalidStateError(this._status);new p(this).send(e,n,t)}mute(e={audio:!0,video:!1}){v("mute()");let n=!1,t=!1;!1===this._audioMuted&&e.audio&&(n=!0,this._audioMuted=!0,this._toogleMuteAudio(!0)),!1===this._videoMuted&&e.video&&(t=!0,this._videoMuted=!0,this._toogleMuteVideo(!0)),!0!==n&&!0!==t||this._onmute({audio:n,video:t})}unmute(e={audio:!0,video:!0}){v("unmute()");let n=!1,t=!1;!0===this._audioMuted&&e.audio&&(n=!0,this._audioMuted=!1,!1===this._localHold&&this._toogleMuteAudio(!1)),!0===this._videoMuted&&e.video&&(t=!0,this._videoMuted=!1,!1===this._localHold&&this._toogleMuteVideo(!1)),!0!==n&&!0!==t||this._onunmute({audio:n,video:t})}hold(e={},n){if(v("hold()"),this._status!==y.STATUS_WAITING_FOR_ACK&&this._status!==y.STATUS_CONFIRMED)return!1;if(!0===this._localHold)return!1;if(!this._isReadyToReOffer())return!1;this._localHold=!0,this._onhold("local");const t={succeeded:()=>{n&&n()},failed:()=>{this.terminate({cause:a.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Hold Failed"})}};return e.useUpdate?this._sendUpdate({sdpOffer:!0,eventHandlers:t,extraHeaders:e.extraHeaders}):this._sendReinvite({eventHandlers:t,extraHeaders:e.extraHeaders}),!0}unhold(e={},n){if(v("unhold()"),this._status!==y.STATUS_WAITING_FOR_ACK&&this._status!==y.STATUS_CONFIRMED)return!1;if(!1===this._localHold)return!1;if(!this._isReadyToReOffer())return!1;this._localHold=!1,this._onunhold("local");const t={succeeded:()=>{n&&n()},failed:()=>{this.terminate({cause:a.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Unhold Failed"})}};return e.useUpdate?this._sendUpdate({sdpOffer:!0,eventHandlers:t,extraHeaders:e.extraHeaders}):this._sendReinvite({eventHandlers:t,extraHeaders:e.extraHeaders}),!0}renegotiate(e={},n){v("renegotiate()");const t=e.rtcOfferConstraints||null;if(this._status!==y.STATUS_WAITING_FOR_ACK&&this._status!==y.STATUS_CONFIRMED)return!1;if(!this._isReadyToReOffer())return!1;const r={succeeded:()=>{n&&n()},failed:()=>{this.terminate({cause:a.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Media Renegotiation Failed"})}};return this._setLocalMediaStatus(),e.useUpdate?this._sendUpdate({sdpOffer:!0,eventHandlers:r,rtcOfferConstraints:t,extraHeaders:e.extraHeaders}):this._sendReinvite({eventHandlers:r,rtcOfferConstraints:t,extraHeaders:e.extraHeaders}),!0}refer(e,n){v("refer()");const t=e;if(this._status!==y.STATUS_WAITING_FOR_ACK&&this._status!==y.STATUS_CONFIRMED)return!1;if(!(e=this._ua.normalizeTarget(e)))throw new TypeError(`Invalid target: ${t}`);const r=new b(this);r.sendRefer(e,n);const i=r.id;return this._referSubscribers[i]=r,r.on("requestFailed",()=>{delete this._referSubscribers[i]}),r.on("accepted",()=>{delete this._referSubscribers[i]}),r.on("failed",()=>{delete this._referSubscribers[i]}),r}sendRequest(e,n){return v("sendRequest()"),this._dialog.sendRequest(e,n)}receiveRequest(e){if(v("receiveRequest()"),e.method===a.CANCEL)this._status!==y.STATUS_WAITING_FOR_ANSWER&&this._status!==y.STATUS_ANSWERED||(this._status=y.STATUS_CANCELED,this._request.reply(487),this._failed("remote",e,a.causes.CANCELED));else switch(e.method){case a.ACK:if(this._status!==y.STATUS_WAITING_FOR_ACK)return;if(this._status=y.STATUS_CONFIRMED,clearTimeout(this._timers.ackTimer),clearTimeout(this._timers.invite2xxTimer),this._late_sdp){if(!e.body){this.terminate({cause:a.causes.MISSING_SDP,status_code:400});break}const n={originator:"remote",type:"answer",sdp:e.body};v('emit "sdp"'),this.emit("sdp",n);const t=new RTCSessionDescription({type:"answer",sdp:n.sdp});this._connectionPromiseQueue=this._connectionPromiseQueue.then(()=>this._connection.setRemoteDescription(t)).then(()=>{this._is_confirmed||this._confirmed("remote",e)}).catch(e=>{this.terminate({cause:a.causes.BAD_MEDIA_DESCRIPTION,status_code:488}),m('emit "peerconnection:setremotedescriptionfailed" [error:%o]',e),this.emit("peerconnection:setremotedescriptionfailed",e)})}else this._is_confirmed||this._confirmed("remote",e);break;case a.BYE:this._status===y.STATUS_CONFIRMED?(e.reply(200),this._ended("remote",e,a.causes.BYE)):this._status===y.STATUS_INVITE_RECEIVED?(e.reply(200),this._request.reply(487,"BYE Received"),this._ended("remote",e,a.causes.BYE)):e.reply(403,"Wrong Status");break;case a.INVITE:this._status===y.STATUS_CONFIRMED?e.hasHeader("replaces")?this._receiveReplaces(e):this._receiveReinvite(e):e.reply(403,"Wrong Status");break;case a.INFO:if(this._status===y.STATUS_1XX_RECEIVED||this._status===y.STATUS_WAITING_FOR_ANSWER||this._status===y.STATUS_ANSWERED||this._status===y.STATUS_WAITING_FOR_ACK||this._status===y.STATUS_CONFIRMED){const n=e.getHeader("content-type");n&&n.match(/^application\/dtmf-relay/i)?new f(this).init_incoming(e):void 0!==n?new p(this).init_incoming(e):e.reply(415)}else e.reply(403,"Wrong Status");break;case a.UPDATE:this._status===y.STATUS_CONFIRMED?this._receiveUpdate(e):e.reply(403,"Wrong Status");break;case a.REFER:this._status===y.STATUS_CONFIRMED?this._receiveRefer(e):e.reply(403,"Wrong Status");break;case a.NOTIFY:this._status===y.STATUS_CONFIRMED?this._receiveNotify(e):e.reply(403,"Wrong Status");break;default:e.reply(501)}}onTransportError(){m("onTransportError()"),this._status!==y.STATUS_TERMINATED&&this.terminate({status_code:500,reason_phrase:a.causes.CONNECTION_ERROR,cause:a.causes.CONNECTION_ERROR})}onRequestTimeout(){m("onRequestTimeout()"),this._status!==y.STATUS_TERMINATED&&this.terminate({status_code:408,reason_phrase:a.causes.REQUEST_TIMEOUT,cause:a.causes.REQUEST_TIMEOUT})}onDialogError(){m("onDialogError()"),this._status!==y.STATUS_TERMINATED&&this.terminate({status_code:500,reason_phrase:a.causes.DIALOG_ERROR,cause:a.causes.DIALOG_ERROR})}newDTMF(e){v("newDTMF()"),this.emit("newDTMF",e)}newInfo(e){v("newInfo()"),this.emit("newInfo",e)}_isReadyToReOffer(){return this._rtcReady?this._dialog?!0!==this._dialog.uac_pending_reply&&!0!==this._dialog.uas_pending_reply||(v("_isReadyToReOffer() | there is another INVITE/UPDATE transaction in progress"),!1):(v("_isReadyToReOffer() | session not established yet"),!1):(v("_isReadyToReOffer() | internal WebRTC status not ready"),!1)}_close(){if(v("close()"),this._status!==y.STATUS_TERMINATED){if(this._status=y.STATUS_TERMINATED,this._connection)try{this._connection.close()}catch(e){m("close() | error closing the RTCPeerConnection: %o",e)}this._localMediaStream&&this._localMediaStreamLocallyGenerated&&(v("close() | closing local MediaStream"),c.closeMediaStream(this._localMediaStream));for(const e in this._timers)Object.prototype.hasOwnProperty.call(this._timers,e)&&clearTimeout(this._timers[e]);clearTimeout(this._sessionTimers.timer),this._dialog&&(this._dialog.terminate(),delete this._dialog);for(const e in this._earlyDialogs)Object.prototype.hasOwnProperty.call(this._earlyDialogs,e)&&(this._earlyDialogs[e].terminate(),delete this._earlyDialogs[e]);for(const e in this._referSubscribers)Object.prototype.hasOwnProperty.call(this._referSubscribers,e)&&delete this._referSubscribers[e];this._ua.destroyRTCSession(this)}}_setInvite2xxTimer(e,n){let t=l.T1;this._timers.invite2xxTimer=setTimeout(function r(){this._status===y.STATUS_WAITING_FOR_ACK&&(e.reply(200,null,[`Contact: ${this._contact}`],n),t<l.T2&&(t*=2)>l.T2&&(t=l.T2),this._timers.invite2xxTimer=setTimeout(r.bind(this),t))}.bind(this),t)}_setACKTimer(){this._timers.ackTimer=setTimeout(()=>{this._status===y.STATUS_WAITING_FOR_ACK&&(v("no ACK received, terminating the session"),clearTimeout(this._timers.invite2xxTimer),this.sendRequest(a.BYE),this._ended("remote",null,a.causes.NO_ACK))},l.TIMER_H)}_createRTCConnection(e,n){this._connection=new RTCPeerConnection(e,n),this._connection.addEventListener("iceconnectionstatechange",()=>{this._connection.iceConnectionState}),v('emit "peerconnection"'),this.emit("peerconnection",{peerconnection:this._connection})}_createLocalDescription(e,n){if(v("createLocalDescription()"),"offer"!==e&&"answer"!==e)throw new Error(`createLocalDescription() | invalid type "${e}"`);const t=this._connection;return this._rtcReady=!1,Promise.resolve().then(()=>"offer"===e?t.createOffer(n).catch(e=>(m('emit "peerconnection:createofferfailed" [error:%o]',e),this.emit("peerconnection:createofferfailed",e),Promise.reject(e))):t.createAnswer(n).catch(e=>(m('emit "peerconnection:createanswerfailed" [error:%o]',e),this.emit("peerconnection:createanswerfailed",e),Promise.reject(e)))).then(e=>t.setLocalDescription(e).catch(e=>(this._rtcReady=!0,m('emit "peerconnection:setlocaldescriptionfailed" [error:%o]',e),this.emit("peerconnection:setlocaldescriptionfailed",e),Promise.reject(e)))).then(()=>{if("complete"===t.iceGatheringState){this._rtcReady=!0;const n={originator:"local",type:e,sdp:t.localDescription.sdp};return v('emit "sdp"'),this.emit("sdp",n),Promise.resolve(n.sdp)}return new Promise(n=>{let r,i=!1;const a=()=>{t.removeEventListener("icecandidate",r),i=!0,this._rtcReady=!0;const a={originator:"local",type:e,sdp:t.localDescription.sdp};v('emit "sdp"'),this.emit("sdp",a),n(a.sdp)};t.addEventListener("icecandidate",r=(e=>{const n=e.candidate;n?this.emit("icecandidate",{candidate:n,ready:a}):i||a()}))})})}_createDialog(e,n,t){const r="UAS"===n?e.to_tag:e.from_tag,i="UAS"===n?e.from_tag:e.to_tag,s=e.call_id+r+i;let o=this._earlyDialogs[s];if(t)return!!o||((o=new d(this,e,n,d.C.STATUS_EARLY)).error?(v(o.error),this._failed("remote",e,a.causes.INTERNAL_ERROR),!1):(this._earlyDialogs[s]=o,!0));{if(this._from_tag=e.from_tag,this._to_tag=e.to_tag,o)return o.update(e,n),this._dialog=o,delete this._earlyDialogs[s],!0;const t=new d(this,e,n);return t.error?(v(t.error),this._failed("remote",e,a.causes.INTERNAL_ERROR),!1):(this._dialog=t,!0)}}_receiveReinvite(e){v("receiveReinvite()");const n=e.getHeader("Content-Type"),t={request:e,callback:void 0,reject:function(n={}){r=!0;const t=n.status_code||403,i=n.reason_phrase||"",a=c.cloneArray(n.extraHeaders);if(this._status!==y.STATUS_CONFIRMED)return!1;if(t<300||t>=700)throw new TypeError(`Invalid status_code: ${t}`);e.reply(t,i,a)}.bind(this)};let r=!1;if(this.emit("reinvite",t),!r){if(this._late_sdp=!1,!e.body)return this._late_sdp=!0,void(this._connectionPromiseQueue=this._connectionPromiseQueue.then(()=>this._createLocalDescription("offer",this._rtcOfferConstraints)).then(e=>{i.call(this,e)}).catch(()=>{e.reply(500)}));if("application/sdp"!==n)return v("invalid Content-Type"),void e.reply(415);this._processInDialogSdpOffer(e).then(e=>{this._status!==y.STATUS_TERMINATED&&i.call(this,e)}).catch(e=>{m(e)})}function i(n){const r=[`Contact: ${this._contact}`];this._handleSessionTimersInIncomingRequest(e,r),this._late_sdp&&(n=this._mangleOffer(n)),e.reply(200,null,r,n,()=>{this._status=y.STATUS_WAITING_FOR_ACK,this._setInvite2xxTimer(e,n),this._setACKTimer()}),"function"==typeof t.callback&&t.callback()}}_receiveUpdate(e){v("receiveUpdate()");const n=e.getHeader("Content-Type"),t={request:e,callback:void 0,reject:function(n={}){r=!0;const t=n.status_code||403,i=n.reason_phrase||"",a=c.cloneArray(n.extraHeaders);if(this._status!==y.STATUS_CONFIRMED)return!1;if(t<300||t>=700)throw new TypeError(`Invalid status_code: ${t}`);e.reply(t,i,a)}.bind(this)};let r=!1;if(this.emit("update",t),!r)if(e.body){if("application/sdp"!==n)return v("invalid Content-Type"),void e.reply(415);this._processInDialogSdpOffer(e).then(e=>{this._status!==y.STATUS_TERMINATED&&i.call(this,e)}).catch(e=>{m(e)})}else i.call(this,null);function i(n){const r=[`Contact: ${this._contact}`];this._handleSessionTimersInIncomingRequest(e,r),e.reply(200,null,r,n),"function"==typeof t.callback&&t.callback()}}_processInDialogSdpOffer(e){v("_processInDialogSdpOffer()");const n=e.parseSDP();let t=!1;for(const e of n.media){if(-1===_.indexOf(e.type))continue;const r=e.direction||n.direction||"sendrecv";if("sendonly"!==r&&"inactive"!==r){t=!1;break}t=!0}const r={originator:"remote",type:"offer",sdp:e.body};v('emit "sdp"'),this.emit("sdp",r);const i=new RTCSessionDescription({type:"offer",sdp:r.sdp});return this._connectionPromiseQueue=this._connectionPromiseQueue.then(()=>{if(this._status===y.STATUS_TERMINATED)throw new Error("terminated");return this._connection.setRemoteDescription(i).catch(n=>{throw e.reply(488),m('emit "peerconnection:setremotedescriptionfailed" [error:%o]',n),this.emit("peerconnection:setremotedescriptionfailed",n),new Error("peerconnection.setRemoteDescription() failed")})}).then(()=>{if(this._status===y.STATUS_TERMINATED)throw new Error("terminated");!0===this._remoteHold&&!1===t?(this._remoteHold=!1,this._onunhold("remote")):!1===this._remoteHold&&!0===t&&(this._remoteHold=!0,this._onhold("remote"))}).then(()=>{if(this._status===y.STATUS_TERMINATED)throw new Error("terminated");return this._createLocalDescription("answer",this._rtcAnswerConstraints).catch(()=>{throw e.reply(500),new Error("_createLocalDescription() failed")})}),this._connectionPromiseQueue}_receiveRefer(n){if(v("receiveRefer()"),void 0===typeof n.refer_to)return v("no Refer-To header field present in REFER"),void n.reply(400);if(n.refer_to.uri.scheme!==a.SIP)return v("Refer-To header field points to a non-SIP URI scheme"),void n.reply(416);n.reply(202);const t=new g(this,n.cseq);v('emit "refer"'),this.emit("refer",{request:n,accept:(r,i)=>{(function(r,i={}){if(r="function"==typeof r?r:null,this._status!==y.STATUS_WAITING_FOR_ACK&&this._status!==y.STATUS_CONFIRMED)return!1;const a=new e(this._ua);if(a.on("progress",({response:e})=>{t.notify(e.status_code,e.reason_phrase)}),a.on("accepted",({response:e})=>{t.notify(e.status_code,e.reason_phrase)}),a.on("failed",({message:e,cause:n})=>{e?t.notify(e.status_code,e.reason_phrase):t.notify(487,n)}),n.refer_to.uri.hasHeader("replaces")){const e=decodeURIComponent(n.refer_to.uri.getHeader("replaces"));i.extraHeaders=c.cloneArray(i.extraHeaders),i.extraHeaders.push(`Replaces: ${e}`)}a.connect(n.refer_to.uri.toAor(),i,r)}).call(this,r,i)},reject:()=>{(function(){t.notify(603)}).call(this)}})}_receiveNotify(e){switch(v("receiveNotify()"),void 0===typeof e.event&&e.reply(400),e.event.event){case"refer":{let n,t;if(e.event.params&&e.event.params.id)n=e.event.params.id,t=this._referSubscribers[n];else{if(1!==Object.keys(this._referSubscribers).length)return void e.reply(400,"Missing event id parameter");t=this._referSubscribers[Object.keys(this._referSubscribers)[0]]}if(!t)return void e.reply(481,"Subscription does not exist");t.receiveNotify(e),e.reply(200);break}default:e.reply(489)}}_receiveReplaces(n){v("receiveReplaces()"),this.emit("replaces",{request:n,accept:t=>{(function(t){if(this._status!==y.STATUS_WAITING_FOR_ACK&&this._status!==y.STATUS_CONFIRMED)return!1;const r=new e(this._ua);r.on("confirmed",()=>{this.terminate()}),r.init_incoming(n,t)}).call(this,t)},reject:()=>{(function(){v("Replaced INVITE rejected by the user"),n.reply(486)}).call(this)}})}_sendInitialRequest(e,n,t){const r=new h(this._ua,this._request,{onRequestTimeout:()=>{this.onRequestTimeout()},onTransportError:()=>{this.onTransportError()},onAuthenticated:e=>{this._request=e},onReceiveResponse:e=>{this._receiveInviteResponse(e)}});Promise.resolve().then(()=>t||(e.audio||e.video?(this._localMediaStreamLocallyGenerated=!0,navigator.mediaDevices.getUserMedia(e).catch(e=>{if(this._status===y.STATUS_TERMINATED)throw new Error("terminated");throw this._failed("local",null,a.causes.USER_DENIED_MEDIA_ACCESS),m('emit "getusermediafailed" [error:%o]',e),this.emit("getusermediafailed"),e})):void 0)).then(e=>{if(this._status===y.STATUS_TERMINATED)throw new Error("terminated");return this._localMediaStream=e,e&&this._connection.addStream(e),this._connecting(this._request),this._createLocalDescription("offer",n).catch(e=>{throw this._failed("local",null,a.causes.WEBRTC_ERROR),e})}).then(e=>{if(this._is_canceled||this._status===y.STATUS_TERMINATED)throw new Error("terminated");this._request.body=e,this._status=y.STATUS_INVITE_SENT,v('emit "sending" [request:%o]',this._request),this.emit("sending",{request:this._request}),r.send()}).catch(e=>{this._status!==y.STATUS_TERMINATED&&m(e)})}_receiveInviteResponse(e){if(v("receiveInviteResponse()"),this._dialog&&e.status_code>=200&&e.status_code<=299){if(this._dialog.id.call_id===e.call_id&&this._dialog.id.local_tag===e.from_tag&&this._dialog.id.remote_tag===e.to_tag)return void this.sendRequest(a.ACK);{const n=new d(this,e,"UAC");return void 0!==n.error?void v(n.error):(this.sendRequest(a.ACK),void this.sendRequest(a.BYE))}}if(this._is_canceled)e.status_code>=100&&e.status_code<200?this._request.cancel(this._cancel_reason):e.status_code>=200&&e.status_code<299&&this._acceptAndTerminate(e);else if(this._status===y.STATUS_INVITE_SENT||this._status===y.STATUS_1XX_RECEIVED)switch(!0){case/^100$/.test(e.status_code):this._status=y.STATUS_1XX_RECEIVED;break;case/^1[0-9]{2}$/.test(e.status_code):{if(!e.to_tag){v("1xx response received without to tag");break}if(e.hasHeader("contact")&&!this._createDialog(e,"UAC",!0))break;if(this._status=y.STATUS_1XX_RECEIVED,this._progress("remote",e),!e.body)break;const n={originator:"remote",type:"answer",sdp:e.body};v('emit "sdp"'),this.emit("sdp",n);const t=new RTCSessionDescription({type:"answer",sdp:n.sdp});this._connectionPromiseQueue=this._connectionPromiseQueue.then(()=>this._connection.setRemoteDescription(t)).catch(e=>{m('emit "peerconnection:setremotedescriptionfailed" [error:%o]',e),this.emit("peerconnection:setremotedescriptionfailed",e)});break}case/^2[0-9]{2}$/.test(e.status_code):{if(this._status=y.STATUS_CONFIRMED,!e.body){this._acceptAndTerminate(e,400,a.causes.MISSING_SDP),this._failed("remote",e,a.causes.BAD_MEDIA_DESCRIPTION);break}if(!this._createDialog(e,"UAC"))break;const n={originator:"remote",type:"answer",sdp:e.body};v('emit "sdp"'),this.emit("sdp",n);const t=new RTCSessionDescription({type:"answer",sdp:n.sdp});this._connectionPromiseQueue=this._connectionPromiseQueue.then(()=>{if("stable"===this._connection.signalingState)return this._connection.createOffer().then(e=>this._connection.setLocalDescription(e)).catch(n=>{this._acceptAndTerminate(e,500,n.toString()),this._failed("local",e,a.causes.WEBRTC_ERROR)})}).then(()=>{this._connection.setRemoteDescription(t).then(()=>{this._handleSessionTimersInIncomingResponse(e),this._accepted("remote",e),this.sendRequest(a.ACK),this._confirmed("local",null)}).catch(n=>{this._acceptAndTerminate(e,488,"Not Acceptable Here"),this._failed("remote",e,a.causes.BAD_MEDIA_DESCRIPTION),m('emit "peerconnection:setremotedescriptionfailed" [error:%o]',n),this.emit("peerconnection:setremotedescriptionfailed",n)})});break}default:{const n=c.sipErrorCause(e.status_code);this._failed("remote",e,n)}}}_sendReinvite(e={}){v("sendReinvite()");const n=c.cloneArray(e.extraHeaders),t=e.eventHandlers||{},r=e.rtcOfferConstraints||this._rtcOfferConstraints||null;function i(e){t.failed&&t.failed(e)}n.push(`Contact: ${this._contact}`),n.push("Content-Type: application/sdp"),this._sessionTimers.running&&n.push(`Session-Expires: ${this._sessionTimers.currentExpires};refresher=${this._sessionTimers.refresher?"uac":"uas"}`),this._connectionPromiseQueue=this._connectionPromiseQueue.then(()=>this._createLocalDescription("offer",r)).then(e=>{e=this._mangleOffer(e)}).catch(()=>{i()})}_sendUpdate(e={}){v("sendUpdate()");const n=c.cloneArray(e.extraHeaders),t=e.eventHandlers||{},r=e.rtcOfferConstraints||this._rtcOfferConstraints||null,i=e.sdpOffer||!1;let s=!1;function o(e){if(this._status!==y.STATUS_TERMINATED&&!s)if(this._handleSessionTimersInIncomingResponse(e),i){if(!e.body)return void l.call(this);if("application/sdp"!==e.getHeader("Content-Type"))return void l.call(this);const n={originator:"remote",type:"answer",sdp:e.body};v('emit "sdp"'),this.emit("sdp",n);const r=new RTCSessionDescription({type:"answer",sdp:n.sdp});this._connectionPromiseQueue=this._connectionPromiseQueue.then(()=>this._connection.setRemoteDescription(r)).then(()=>{t.succeeded&&t.succeeded(e)}).catch(e=>{l.call(this),m('emit "peerconnection:setremotedescriptionfailed" [error:%o]',e),this.emit("peerconnection:setremotedescriptionfailed",e)})}else t.succeeded&&t.succeeded(e)}function l(e){t.failed&&t.failed(e)}n.push(`Contact: ${this._contact}`),this._sessionTimers.running&&n.push(`Session-Expires: ${this._sessionTimers.currentExpires};refresher=${this._sessionTimers.refresher?"uac":"uas"}`),i?(n.push("Content-Type: application/sdp"),this._connectionPromiseQueue=this._connectionPromiseQueue.then(()=>this._createLocalDescription("offer",r)).then(e=>{e=this._mangleOffer(e),this.sendRequest(a.UPDATE,{extraHeaders:n,body:e,eventHandlers:{onSuccessResponse:e=>{o.call(this,e),s=!0},onErrorResponse:e=>{l.call(this,e)},onTransportError:()=>{this.onTransportError()},onRequestTimeout:()=>{this.onRequestTimeout()},onDialogError:()=>{this.onDialogError()}}})}).catch(()=>{l.call(this)})):this.sendRequest(a.UPDATE,{extraHeaders:n,eventHandlers:{onSuccessResponse:e=>{o.call(this,e)},onErrorResponse:e=>{l.call(this,e)},onTransportError:()=>{this.onTransportError()},onRequestTimeout:()=>{this.onRequestTimeout()},onDialogError:()=>{this.onDialogError()}}})}_acceptAndTerminate(e,n,t){v("acceptAndTerminate()");const r=[];n&&(t=t||a.REASON_PHRASE[n]||"",r.push(`Reason: SIP ;cause=${n}; text="${t}"`)),(this._dialog||this._createDialog(e,"UAC"))&&(this.sendRequest(a.ACK),this.sendRequest(a.BYE,{extraHeaders:r})),this._status=y.STATUS_TERMINATED}_mangleOffer(e){if(!this._localHold&&!this._remoteHold)return e;if(e=i.parse(e),this._localHold&&!this._remoteHold){v("mangleOffer() | me on hold, mangling offer");for(const n of e.media)-1!==_.indexOf(n.type)&&(n.direction?"sendrecv"===n.direction?n.direction="sendonly":"recvonly"===n.direction&&(n.direction="inactive"):n.direction="sendonly")}else if(this._localHold&&this._remoteHold){v("mangleOffer() | both on hold, mangling offer");for(const n of e.media)-1!==_.indexOf(n.type)&&(n.direction="inactive")}else if(this._remoteHold){v("mangleOffer() | remote on hold, mangling offer");for(const n of e.media)-1!==_.indexOf(n.type)&&(n.direction?"sendrecv"===n.direction?n.direction="recvonly":"recvonly"===n.direction&&(n.direction="inactive"):n.direction="recvonly")}return i.write(e)}_setLocalMediaStatus(){let e=!0,n=!0;(this._localHold||this._remoteHold)&&(e=!1,n=!1),this._audioMuted&&(e=!1),this._videoMuted&&(n=!1),this._toogleMuteAudio(!e),this._toogleMuteVideo(!n)}_handleSessionTimersInIncomingRequest(e,n){if(!this._sessionTimers.enabled)return;let t;e.session_expires&&e.session_expires>=a.MIN_SESSION_EXPIRES?(this._sessionTimers.currentExpires=e.session_expires,t=e.session_expires_refresher||"uas"):(this._sessionTimers.currentExpires=this._sessionTimers.defaultExpires,t="uas"),n.push(`Session-Expires: ${this._sessionTimers.currentExpires};refresher=${t}`),this._sessionTimers.refresher="uas"===t,this._runSessionTimer()}_handleSessionTimersInIncomingResponse(e){if(!this._sessionTimers.enabled)return;let n;e.session_expires&&e.session_expires>=a.MIN_SESSION_EXPIRES?(this._sessionTimers.currentExpires=e.session_expires,n=e.session_expires_refresher||"uac"):(this._sessionTimers.currentExpires=this._sessionTimers.defaultExpires,n="uac"),this._sessionTimers.refresher="uac"===n,this._runSessionTimer()}_runSessionTimer(){const e=this._sessionTimers.currentExpires;this._sessionTimers.running=!0,clearTimeout(this._sessionTimers.timer),this._sessionTimers.refresher?this._sessionTimers.timer=setTimeout(()=>{this._status!==y.STATUS_TERMINATED&&(v("runSessionTimer() | sending session refresh request"),this._sessionTimers.refreshMethod===a.UPDATE?this._sendUpdate():this._sendReinvite())},500*e):this._sessionTimers.timer=setTimeout(()=>{this._status!==y.STATUS_TERMINATED&&(m("runSessionTimer() | timer expired, terminating the session"),this.terminate({cause:a.causes.REQUEST_TIMEOUT,status_code:408,reason_phrase:"Session Timer Expired"}))},1100*e)}_toogleMuteAudio(e){const n=this._connection.getLocalStreams();for(const t of n){const n=t.getAudioTracks();for(const t of n)t.enabled=!e}}_toogleMuteVideo(e){const n=this._connection.getLocalStreams();for(const t of n){const n=t.getVideoTracks();for(const t of n)t.enabled=!e}}_newRTCSession(e,n){v("newRTCSession()"),this._ua.newRTCSession(this,{originator:e,session:this,request:n})}_connecting(e){v("session connecting"),v('emit "connecting"'),this.emit("connecting",{request:e})}_progress(e,n){v("session progress"),v('emit "progress"'),this.emit("progress",{originator:e,response:n||null})}_accepted(e,n){v("session accepted"),this._start_time=new Date,v('emit "accepted"'),this.emit("accepted",{originator:e,response:n||null})}_confirmed(e,n){v("session confirmed"),this._is_confirmed=!0,v('emit "confirmed"'),this.emit("confirmed",{originator:e,ack:n||null})}_ended(e,n,t){v("session ended"),this._end_time=new Date,this._close(),v('emit "ended"'),this.emit("ended",{originator:e,message:n||null,cause:t})}_failed(e,n,t){v("session failed"),this._close(),v('emit "failed"'),this.emit("failed",{originator:e,message:n||null,cause:t})}_onhold(e){v("session onhold"),this._setLocalMediaStatus(),v('emit "hold"'),this.emit("hold",{originator:e})}_onunhold(e){v("session onunhold"),this._setLocalMediaStatus(),v('emit "unhold"'),this.emit("unhold",{originator:e})}_onmute({audio:e,video:n}){v("session onmute"),this._setLocalMediaStatus(),v('emit "muted"'),this.emit("muted",{audio:e,video:n})}_onunmute({audio:e,video:n}){v("session onunmute"),this._setLocalMediaStatus(),v('emit "unmuted"'),this.emit("unmuted",{audio:e,video:n})}}},function(e,n,t){const r=t(2),i=t(3),a=t(0)("PlivoSIP:ERROR:Socket");a.log=console.warn.bind(console),n.isSocket=(e=>{if(Array.isArray(e))return!1;if(void 0===e)return a("undefined JsSIP.Socket instance"),!1;try{if(!r.isString(e.url))throw a("missing or invalid JsSIP.Socket url property"),new Error;if(!r.isString(e.via_transport))throw a("missing or invalid JsSIP.Socket via_transport property"),new Error;if(-1===i.parse(e.sip_uri,"SIP_URI"))throw a("missing or invalid JsSIP.Socket sip_uri property"),new Error}catch(e){return!1}try{["connect","disconnect","send"].forEach(n=>{if(!r.isFunction(e[n]))throw a(`missing or invalid JsSIP.Socket method: ${n}`),new Error})}catch(e){return!1}return!0})},function(e,n,t){t(15),e.exports=t(28)},function(e,n){e.exports=function(e){function n(e){"undefined"!=typeof console&&(console.error||console.log)("[Script Loader]",e)}try{"undefined"!=typeof execScript&&"undefined"!=typeof attachEvent&&"undefined"==typeof addEventListener?execScript(e):"undefined"!=typeof eval?eval.call(null,e):n("EvalError: No eval function available")}catch(e){n(e)}}},function(e,n){e.exports='/***\nCopyright (c) 2013-2018, callstats.io\nAll rights reserved.\n\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"\nAND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\nIMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\nARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE\nLIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR\nCONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF\nSUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS\nINTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN\nCONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\nARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\nPOSSIBILITY OF SUCH DAMAGE.\n***/\n\n/*! callstats  version = 3.53.1 2018-08-07 11-35-59 */\n\n!function() {\n    function a(b, c, d) {\n        function e(g, h) {\n            if (!c[g]) {\n                if (!b[g]) {\n                    var i = "function" == typeof require && require;\n                    if (!h && i) return i(g, !0);\n                    if (f) return f(g, !0);\n                    var j = new Error("Cannot find module \'" + g + "\'");\n                    throw j.code = "MODULE_NOT_FOUND", j;\n                }\n                var k = c[g] = {\n                    exports: {}\n                };\n                b[g][0].call(k.exports, function(a) {\n                    return e(b[g][1][a] || a);\n                }, k, k.exports, a, b, c, d);\n            }\n            return c[g].exports;\n        }\n        for (var f = "function" == typeof require && require, g = 0; g < d.length; g++) e(d[g]);\n        return e;\n    }\n    return a;\n}()({\n    1: [ function(a, b, c) {\n        (function(a, d, e) {\n            !function(a) {\n                if ("object" == typeof c && void 0 !== b) b.exports = a(); else if ("function" == typeof define && define.amd) define([], a); else {\n                    var e;\n                    "undefined" != typeof window ? e = window : void 0 !== d ? e = d : "undefined" != typeof self && (e = self), \n                    e.Promise = a();\n                }\n            }(function() {\n                var b, c, f;\n                return function a(b, c, d) {\n                    function e(g, h) {\n                        if (!c[g]) {\n                            if (!b[g]) {\n                                var i = "function" == typeof _dereq_ && _dereq_;\n                                if (!h && i) return i(g, !0);\n                                if (f) return f(g, !0);\n                                var j = new Error("Cannot find module \'" + g + "\'");\n                                throw j.code = "MODULE_NOT_FOUND", j;\n                            }\n                            var k = c[g] = {\n                                exports: {}\n                            };\n                            b[g][0].call(k.exports, function(a) {\n                                var c = b[g][1][a];\n                                return e(c || a);\n                            }, k, k.exports, a, b, c, d);\n                        }\n                        return c[g].exports;\n                    }\n                    for (var f = "function" == typeof _dereq_ && _dereq_, g = 0; g < d.length; g++) e(d[g]);\n                    return e;\n                }({\n                    1: [ function(a, b, c) {\n                        "use strict";\n                        b.exports = function(a) {\n                            function b(a) {\n                                var b = new c(a), d = b.promise();\n                                return b.setHowMany(1), b.setUnwrap(), b.init(), d;\n                            }\n                            var c = a._SomePromiseArray;\n                            a.any = function(a) {\n                                return b(a);\n                            }, a.prototype.any = function() {\n                                return b(this);\n                            };\n                        };\n                    }, {} ],\n                    2: [ function(b, c, d) {\n                        "use strict";\n                        function e() {\n                            this._customScheduler = !1, this._isTickUsed = !1, this._lateQueue = new k(16), \n                            this._normalQueue = new k(16), this._haveDrainedQueues = !1, this._trampolineEnabled = !0;\n                            var a = this;\n                            this.drainQueues = function() {\n                                a._drainQueues();\n                            }, this._schedule = j;\n                        }\n                        function f(a, b, c) {\n                            this._lateQueue.push(a, b, c), this._queueTick();\n                        }\n                        function g(a, b, c) {\n                            this._normalQueue.push(a, b, c), this._queueTick();\n                        }\n                        function h(a) {\n                            this._normalQueue._pushOne(a), this._queueTick();\n                        }\n                        var i;\n                        try {\n                            throw new Error();\n                        } catch (a) {\n                            i = a;\n                        }\n                        var j = b("./schedule"), k = b("./queue"), l = b("./util");\n                        e.prototype.setScheduler = function(a) {\n                            var b = this._schedule;\n                            return this._schedule = a, this._customScheduler = !0, b;\n                        }, e.prototype.hasCustomScheduler = function() {\n                            return this._customScheduler;\n                        }, e.prototype.enableTrampoline = function() {\n                            this._trampolineEnabled = !0;\n                        }, e.prototype.disableTrampolineIfNecessary = function() {\n                            l.hasDevTools && (this._trampolineEnabled = !1);\n                        }, e.prototype.haveItemsQueued = function() {\n                            return this._isTickUsed || this._haveDrainedQueues;\n                        }, e.prototype.fatalError = function(b, c) {\n                            c ? (a.stderr.write("Fatal " + (b instanceof Error ? b.stack : b) + "\\n"), a.exit(2)) : this.throwLater(b);\n                        }, e.prototype.throwLater = function(a, b) {\n                            if (1 === arguments.length && (b = a, a = function() {\n                                throw b;\n                            }), "undefined" != typeof setTimeout) setTimeout(function() {\n                                a(b);\n                            }, 0); else try {\n                                this._schedule(function() {\n                                    a(b);\n                                });\n                            } catch (a) {\n                                throw new Error("No async scheduler available\\n\\n    See http://goo.gl/MqrFmX\\n");\n                            }\n                        }, l.hasDevTools ? (e.prototype.invokeLater = function(a, b, c) {\n                            this._trampolineEnabled ? f.call(this, a, b, c) : this._schedule(function() {\n                                setTimeout(function() {\n                                    a.call(b, c);\n                                }, 100);\n                            });\n                        }, e.prototype.invoke = function(a, b, c) {\n                            this._trampolineEnabled ? g.call(this, a, b, c) : this._schedule(function() {\n                                a.call(b, c);\n                            });\n                        }, e.prototype.settlePromises = function(a) {\n                            this._trampolineEnabled ? h.call(this, a) : this._schedule(function() {\n                                a._settlePromises();\n                            });\n                        }) : (e.prototype.invokeLater = f, e.prototype.invoke = g, e.prototype.settlePromises = h), \n                        e.prototype._drainQueue = function(a) {\n                            for (;a.length() > 0; ) {\n                                var b = a.shift();\n                                if ("function" == typeof b) {\n                                    var c = a.shift(), d = a.shift();\n                                    b.call(c, d);\n                                } else b._settlePromises();\n                            }\n                        }, e.prototype._drainQueues = function() {\n                            this._drainQueue(this._normalQueue), this._reset(), this._haveDrainedQueues = !0, \n                            this._drainQueue(this._lateQueue);\n                        }, e.prototype._queueTick = function() {\n                            this._isTickUsed || (this._isTickUsed = !0, this._schedule(this.drainQueues));\n                        }, e.prototype._reset = function() {\n                            this._isTickUsed = !1;\n                        }, c.exports = e, c.exports.firstLineError = i;\n                    }, {\n                        "./queue": 26,\n                        "./schedule": 29,\n                        "./util": 36\n                    } ],\n                    3: [ function(a, b, c) {\n                        "use strict";\n                        b.exports = function(a, b, c, d) {\n                            var e = !1, f = function(a, b) {\n                                this._reject(b);\n                            }, g = function(a, b) {\n                                b.promiseRejectionQueued = !0, b.bindingPromise._then(f, f, null, this, a);\n                            }, h = function(a, b) {\n                                0 == (50397184 & this._bitField) && this._resolveCallback(b.target);\n                            }, i = function(a, b) {\n                                b.promiseRejectionQueued || this._reject(a);\n                            };\n                            a.prototype.bind = function(f) {\n                                e || (e = !0, a.prototype._propagateFrom = d.propagateFromFunction(), a.prototype._boundValue = d.boundValueFunction());\n                                var j = c(f), k = new a(b);\n                                k._propagateFrom(this, 1);\n                                var l = this._target();\n                                if (k._setBoundTo(j), j instanceof a) {\n                                    var m = {\n                                        promiseRejectionQueued: !1,\n                                        promise: k,\n                                        target: l,\n                                        bindingPromise: j\n                                    };\n                                    l._then(b, g, void 0, k, m), j._then(h, i, void 0, k, m), k._setOnCancel(j);\n                                } else k._resolveCallback(l);\n                                return k;\n                            }, a.prototype._setBoundTo = function(a) {\n                                void 0 !== a ? (this._bitField = 2097152 | this._bitField, this._boundTo = a) : this._bitField = -2097153 & this._bitField;\n                            }, a.prototype._isBound = function() {\n                                return 2097152 == (2097152 & this._bitField);\n                            }, a.bind = function(b, c) {\n                                return a.resolve(c).bind(b);\n                            };\n                        };\n                    }, {} ],\n                    4: [ function(a, b, c) {\n                        "use strict";\n                        function d() {\n                            try {\n                                Promise === f && (Promise = e);\n                            } catch (a) {}\n                            return f;\n                        }\n                        var e;\n                        "undefined" != typeof Promise && (e = Promise);\n                        var f = a("./promise")();\n                        f.noConflict = d, b.exports = f;\n                    }, {\n                        "./promise": 22\n                    } ],\n                    5: [ function(a, b, c) {\n                        "use strict";\n                        var d = Object.create;\n                        if (d) {\n                            var e = d(null), f = d(null);\n                            e[" size"] = f[" size"] = 0;\n                        }\n                        b.exports = function(b) {\n                            function c(a, c) {\n                                var d;\n                                if (null != a && (d = a[c]), "function" != typeof d) {\n                                    var e = "Object " + h.classString(a) + " has no method \'" + h.toString(c) + "\'";\n                                    throw new b.TypeError(e);\n                                }\n                                return d;\n                            }\n                            function d(a) {\n                                return c(a, this.pop()).apply(a, this);\n                            }\n                            function e(a) {\n                                return a[this];\n                            }\n                            function f(a) {\n                                var b = +this;\n                                return b < 0 && (b = Math.max(0, b + a.length)), a[b];\n                            }\n                            var g, h = a("./util"), i = h.canEvaluate;\n                            h.isIdentifier;\n                            b.prototype.call = function(a) {\n                                var b = [].slice.call(arguments, 1);\n                                return b.push(a), this._then(d, void 0, void 0, b, void 0);\n                            }, b.prototype.get = function(a) {\n                                var b, c = "number" == typeof a;\n                                if (c) b = f; else if (i) {\n                                    var d = g(a);\n                                    b = null !== d ? d : e;\n                                } else b = e;\n                                return this._then(b, void 0, void 0, a, void 0);\n                            };\n                        };\n                    }, {\n                        "./util": 36\n                    } ],\n                    6: [ function(a, b, c) {\n                        "use strict";\n                        b.exports = function(b, c, d, e) {\n                            var f = a("./util"), g = f.tryCatch, h = f.errorObj, i = b._async;\n                            b.prototype.break = b.prototype.cancel = function() {\n                                if (!e.cancellation()) return this._warn("cancellation is disabled");\n                                for (var a = this, b = a; a._isCancellable(); ) {\n                                    if (!a._cancelBy(b)) {\n                                        b._isFollowing() ? b._followee().cancel() : b._cancelBranched();\n                                        break;\n                                    }\n                                    var c = a._cancellationParent;\n                                    if (null == c || !c._isCancellable()) {\n                                        a._isFollowing() ? a._followee().cancel() : a._cancelBranched();\n                                        break;\n                                    }\n                                    a._isFollowing() && a._followee().cancel(), a._setWillBeCancelled(), b = a, a = c;\n                                }\n                            }, b.prototype._branchHasCancelled = function() {\n                                this._branchesRemainingToCancel--;\n                            }, b.prototype._enoughBranchesHaveCancelled = function() {\n                                return void 0 === this._branchesRemainingToCancel || this._branchesRemainingToCancel <= 0;\n                            }, b.prototype._cancelBy = function(a) {\n                                return a === this ? (this._branchesRemainingToCancel = 0, this._invokeOnCancel(), \n                                !0) : (this._branchHasCancelled(), !!this._enoughBranchesHaveCancelled() && (this._invokeOnCancel(), \n                                !0));\n                            }, b.prototype._cancelBranched = function() {\n                                this._enoughBranchesHaveCancelled() && this._cancel();\n                            }, b.prototype._cancel = function() {\n                                this._isCancellable() && (this._setCancelled(), i.invoke(this._cancelPromises, this, void 0));\n                            }, b.prototype._cancelPromises = function() {\n                                this._length() > 0 && this._settlePromises();\n                            }, b.prototype._unsetOnCancel = function() {\n                                this._onCancelField = void 0;\n                            }, b.prototype._isCancellable = function() {\n                                return this.isPending() && !this._isCancelled();\n                            }, b.prototype.isCancellable = function() {\n                                return this.isPending() && !this.isCancelled();\n                            }, b.prototype._doInvokeOnCancel = function(a, b) {\n                                if (f.isArray(a)) for (var c = 0; c < a.length; ++c) this._doInvokeOnCancel(a[c], b); else if (void 0 !== a) if ("function" == typeof a) {\n                                    if (!b) {\n                                        var d = g(a).call(this._boundValue());\n                                        d === h && (this._attachExtraTrace(d.e), i.throwLater(d.e));\n                                    }\n                                } else a._resultCancelled(this);\n                            }, b.prototype._invokeOnCancel = function() {\n                                var a = this._onCancel();\n                                this._unsetOnCancel(), i.invoke(this._doInvokeOnCancel, this, a);\n                            }, b.prototype._invokeInternalOnCancel = function() {\n                                this._isCancellable() && (this._doInvokeOnCancel(this._onCancel(), !0), this._unsetOnCancel());\n                            }, b.prototype._resultCancelled = function() {\n                                this.cancel();\n                            };\n                        };\n                    }, {\n                        "./util": 36\n                    } ],\n                    7: [ function(a, b, c) {\n                        "use strict";\n                        b.exports = function(b) {\n                            function c(a, c, h) {\n                                return function(i) {\n                                    var j = h._boundValue();\n                                    a: for (var k = 0; k < a.length; ++k) {\n                                        var l = a[k];\n                                        if (l === Error || null != l && l.prototype instanceof Error) {\n                                            if (i instanceof l) return f(c).call(j, i);\n                                        } else if ("function" == typeof l) {\n                                            var m = f(l).call(j, i);\n                                            if (m === g) return m;\n                                            if (m) return f(c).call(j, i);\n                                        } else if (d.isObject(i)) {\n                                            for (var n = e(l), o = 0; o < n.length; ++o) {\n                                                var p = n[o];\n                                                if (l[p] != i[p]) continue a;\n                                            }\n                                            return f(c).call(j, i);\n                                        }\n                                    }\n                                    return b;\n                                };\n                            }\n                            var d = a("./util"), e = a("./es5").keys, f = d.tryCatch, g = d.errorObj;\n                            return c;\n                        };\n                    }, {\n                        "./es5": 13,\n                        "./util": 36\n                    } ],\n                    8: [ function(a, b, c) {\n                        "use strict";\n                        b.exports = function(a) {\n                            function b() {\n                                this._trace = new b.CapturedTrace(d());\n                            }\n                            function c() {\n                                if (e) return new b();\n                            }\n                            function d() {\n                                var a = f.length - 1;\n                                if (a >= 0) return f[a];\n                            }\n                            var e = !1, f = [];\n                            return a.prototype._promiseCreated = function() {}, a.prototype._pushContext = function() {}, \n                            a.prototype._popContext = function() {\n                                return null;\n                            }, a._peekContext = a.prototype._peekContext = function() {}, b.prototype._pushContext = function() {\n                                void 0 !== this._trace && (this._trace._promiseCreated = null, f.push(this._trace));\n                            }, b.prototype._popContext = function() {\n                                if (void 0 !== this._trace) {\n                                    var a = f.pop(), b = a._promiseCreated;\n                                    return a._promiseCreated = null, b;\n                                }\n                                return null;\n                            }, b.CapturedTrace = null, b.create = c, b.deactivateLongStackTraces = function() {}, \n                            b.activateLongStackTraces = function() {\n                                var c = a.prototype._pushContext, f = a.prototype._popContext, g = a._peekContext, h = a.prototype._peekContext, i = a.prototype._promiseCreated;\n                                b.deactivateLongStackTraces = function() {\n                                    a.prototype._pushContext = c, a.prototype._popContext = f, a._peekContext = g, a.prototype._peekContext = h, \n                                    a.prototype._promiseCreated = i, e = !1;\n                                }, e = !0, a.prototype._pushContext = b.prototype._pushContext, a.prototype._popContext = b.prototype._popContext, \n                                a._peekContext = a.prototype._peekContext = d, a.prototype._promiseCreated = function() {\n                                    var a = this._peekContext();\n                                    a && null == a._promiseCreated && (a._promiseCreated = this);\n                                };\n                            }, b;\n                        };\n                    }, {} ],\n                    9: [ function(b, c, d) {\n                        "use strict";\n                        c.exports = function(c, d) {\n                            function e(a, b) {\n                                return {\n                                    promise: b\n                                };\n                            }\n                            function f() {\n                                return !1;\n                            }\n                            function g(a, b, c) {\n                                var d = this;\n                                try {\n                                    a(b, c, function(a) {\n                                        if ("function" != typeof a) throw new TypeError("onCancel must be a function, got: " + N.toString(a));\n                                        d._attachCancellationCallback(a);\n                                    });\n                                } catch (a) {\n                                    return a;\n                                }\n                            }\n                            function h(a) {\n                                if (!this._isCancellable()) return this;\n                                var b = this._onCancel();\n                                void 0 !== b ? N.isArray(b) ? b.push(a) : this._setOnCancel([ b, a ]) : this._setOnCancel(a);\n                            }\n                            function i() {\n                                return this._onCancelField;\n                            }\n                            function j(a) {\n                                this._onCancelField = a;\n                            }\n                            function k() {\n                                this._cancellationParent = void 0, this._onCancelField = void 0;\n                            }\n                            function l(a, b) {\n                                if (0 != (1 & b)) {\n                                    this._cancellationParent = a;\n                                    var c = a._branchesRemainingToCancel;\n                                    void 0 === c && (c = 0), a._branchesRemainingToCancel = c + 1;\n                                }\n                                0 != (2 & b) && a._isBound() && this._setBoundTo(a._boundTo);\n                            }\n                            function m(a, b) {\n                                0 != (2 & b) && a._isBound() && this._setBoundTo(a._boundTo);\n                            }\n                            function n() {\n                                var a = this._boundTo;\n                                return void 0 !== a && a instanceof c ? a.isFulfilled() ? a.value() : void 0 : a;\n                            }\n                            function o() {\n                                this._trace = new G(this._peekContext());\n                            }\n                            function p(a, b) {\n                                if (O(a)) {\n                                    var c = this._trace;\n                                    if (void 0 !== c && b && (c = c._parent), void 0 !== c) c.attachExtraTrace(a); else if (!a.__stackCleaned__) {\n                                        var d = y(a);\n                                        N.notEnumerableProp(a, "stack", d.message + "\\n" + d.stack.join("\\n")), N.notEnumerableProp(a, "__stackCleaned__", !0);\n                                    }\n                                }\n                            }\n                            function q(a, b, c, d, e) {\n                                if (void 0 === a && null !== b && Y) {\n                                    if (void 0 !== e && e._returnedNonUndefined()) return;\n                                    if (0 == (65535 & d._bitField)) return;\n                                    c && (c += " ");\n                                    var f = "", g = "";\n                                    if (b._trace) {\n                                        for (var h = b._trace.stack.split("\\n"), i = w(h), j = i.length - 1; j >= 0; --j) {\n                                            var k = i[j];\n                                            if (!Q.test(k)) {\n                                                var l = k.match(R);\n                                                l && (f = "at " + l[1] + ":" + l[2] + ":" + l[3] + " ");\n                                                break;\n                                            }\n                                        }\n                                        if (i.length > 0) for (var m = i[0], j = 0; j < h.length; ++j) if (h[j] === m) {\n                                            j > 0 && (g = "\\n" + h[j - 1]);\n                                            break;\n                                        }\n                                    }\n                                    var n = "a promise was created in a " + c + "handler " + f + "but was not returned from it, see http://goo.gl/rRqMUw" + g;\n                                    d._warn(n, !0, b);\n                                }\n                            }\n                            function r(a, b) {\n                                var c = a + " is deprecated and will be removed in a future version.";\n                                return b && (c += " Use " + b + " instead."), s(c);\n                            }\n                            function s(a, b, d) {\n                                if (ga.warnings) {\n                                    var e, f = new M(a);\n                                    if (b) d._attachExtraTrace(f); else if (ga.longStackTraces && (e = c._peekContext())) e.attachExtraTrace(f); else {\n                                        var g = y(f);\n                                        f.stack = g.message + "\\n" + g.stack.join("\\n");\n                                    }\n                                    ba("warning", f) || z(f, "", !0);\n                                }\n                            }\n                            function t(a, b) {\n                                for (var c = 0; c < b.length - 1; ++c) b[c].push("From previous event:"), b[c] = b[c].join("\\n");\n                                return c < b.length && (b[c] = b[c].join("\\n")), a + "\\n" + b.join("\\n");\n                            }\n                            function u(a) {\n                                for (var b = 0; b < a.length; ++b) (0 === a[b].length || b + 1 < a.length && a[b][0] === a[b + 1][0]) && (a.splice(b, 1), \n                                b--);\n                            }\n                            function v(a) {\n                                for (var b = a[0], c = 1; c < a.length; ++c) {\n                                    for (var d = a[c], e = b.length - 1, f = b[e], g = -1, h = d.length - 1; h >= 0; --h) if (d[h] === f) {\n                                        g = h;\n                                        break;\n                                    }\n                                    for (var h = g; h >= 0; --h) {\n                                        var i = d[h];\n                                        if (b[e] !== i) break;\n                                        b.pop(), e--;\n                                    }\n                                    b = d;\n                                }\n                            }\n                            function w(a) {\n                                for (var b = [], c = 0; c < a.length; ++c) {\n                                    var d = a[c], e = "    (No stack trace)" === d || S.test(d), f = e && da(d);\n                                    e && !f && (U && " " !== d.charAt(0) && (d = "    " + d), b.push(d));\n                                }\n                                return b;\n                            }\n                            function x(a) {\n                                for (var b = a.stack.replace(/\\s+$/g, "").split("\\n"), c = 0; c < b.length; ++c) {\n                                    var d = b[c];\n                                    if ("    (No stack trace)" === d || S.test(d)) break;\n                                }\n                                return c > 0 && "SyntaxError" != a.name && (b = b.slice(c)), b;\n                            }\n                            function y(a) {\n                                var b = a.stack, c = a.toString();\n                                return b = "string" == typeof b && b.length > 0 ? x(a) : [ "    (No stack trace)" ], \n                                {\n                                    message: c,\n                                    stack: "SyntaxError" == a.name ? b : w(b)\n                                };\n                            }\n                            function z(a, b, c) {\n                                if ("undefined" != typeof console) {\n                                    var d;\n                                    if (N.isObject(a)) {\n                                        var e = a.stack;\n                                        d = b + T(e, a);\n                                    } else d = b + String(a);\n                                    "function" == typeof J ? J(d, c) : "function" != typeof console.log && "object" != typeof console.log || console.log(d);\n                                }\n                            }\n                            function A(a, b, c, d) {\n                                var e = !1;\n                                try {\n                                    "function" == typeof b && (e = !0, "rejectionHandled" === a ? b(d) : b(c, d));\n                                } catch (a) {\n                                    L.throwLater(a);\n                                }\n                                "unhandledRejection" === a ? ba(a, c, d) || e || z(c, "Unhandled rejection ") : ba(a, d);\n                            }\n                            function B(a) {\n                                var b;\n                                if ("function" == typeof a) b = "[function " + (a.name || "anonymous") + "]"; else {\n                                    b = a && "function" == typeof a.toString ? a.toString() : N.toString(a);\n                                    if (/\\[object [a-zA-Z0-9$_]+\\]/.test(b)) try {\n                                        b = JSON.stringify(a);\n                                    } catch (a) {}\n                                    0 === b.length && (b = "(empty array)");\n                                }\n                                return "(<" + C(b) + ">, no stack trace)";\n                            }\n                            function C(a) {\n                                return a.length < 41 ? a : a.substr(0, 38) + "...";\n                            }\n                            function D() {\n                                return "function" == typeof fa;\n                            }\n                            function E(a) {\n                                var b = a.match(ea);\n                                if (b) return {\n                                    fileName: b[1],\n                                    line: parseInt(b[2], 10)\n                                };\n                            }\n                            function F(a, b) {\n                                if (D()) {\n                                    for (var c, d, e = a.stack.split("\\n"), f = b.stack.split("\\n"), g = -1, h = -1, i = 0; i < e.length; ++i) {\n                                        var j = E(e[i]);\n                                        if (j) {\n                                            c = j.fileName, g = j.line;\n                                            break;\n                                        }\n                                    }\n                                    for (var i = 0; i < f.length; ++i) {\n                                        var j = E(f[i]);\n                                        if (j) {\n                                            d = j.fileName, h = j.line;\n                                            break;\n                                        }\n                                    }\n                                    g < 0 || h < 0 || !c || !d || c !== d || g >= h || (da = function(a) {\n                                        if (P.test(a)) return !0;\n                                        var b = E(a);\n                                        return !!(b && b.fileName === c && g <= b.line && b.line <= h);\n                                    });\n                                }\n                            }\n                            function G(a) {\n                                this._parent = a, this._promisesCreated = 0;\n                                var b = this._length = 1 + (void 0 === a ? 0 : a._length);\n                                fa(this, G), b > 32 && this.uncycle();\n                            }\n                            var H, I, J, K = c._getDomain, L = c._async, M = b("./errors").Warning, N = b("./util"), O = N.canAttachTrace, P = /[\\\\\\/]bluebird[\\\\\\/]js[\\\\\\/](release|debug|instrumented)/, Q = /\\((?:timers\\.js):\\d+:\\d+\\)/, R = /[\\/<\\(](.+?):(\\d+):(\\d+)\\)?\\s*$/, S = null, T = null, U = !1, V = !(0 == N.env("BLUEBIRD_DEBUG")), W = !(0 == N.env("BLUEBIRD_WARNINGS") || !V && !N.env("BLUEBIRD_WARNINGS")), X = !(0 == N.env("BLUEBIRD_LONG_STACK_TRACES") || !V && !N.env("BLUEBIRD_LONG_STACK_TRACES")), Y = 0 != N.env("BLUEBIRD_W_FORGOTTEN_RETURN") && (W || !!N.env("BLUEBIRD_W_FORGOTTEN_RETURN"));\n                            c.prototype.suppressUnhandledRejections = function() {\n                                var a = this._target();\n                                a._bitField = -1048577 & a._bitField | 524288;\n                            }, c.prototype._ensurePossibleRejectionHandled = function() {\n                                if (0 == (524288 & this._bitField)) {\n                                    this._setRejectionIsUnhandled();\n                                    var a = this;\n                                    setTimeout(function() {\n                                        a._notifyUnhandledRejection();\n                                    }, 1);\n                                }\n                            }, c.prototype._notifyUnhandledRejectionIsHandled = function() {\n                                A("rejectionHandled", H, void 0, this);\n                            }, c.prototype._setReturnedNonUndefined = function() {\n                                this._bitField = 268435456 | this._bitField;\n                            }, c.prototype._returnedNonUndefined = function() {\n                                return 0 != (268435456 & this._bitField);\n                            }, c.prototype._notifyUnhandledRejection = function() {\n                                if (this._isRejectionUnhandled()) {\n                                    var a = this._settledValue();\n                                    this._setUnhandledRejectionIsNotified(), A("unhandledRejection", I, a, this);\n                                }\n                            }, c.prototype._setUnhandledRejectionIsNotified = function() {\n                                this._bitField = 262144 | this._bitField;\n                            }, c.prototype._unsetUnhandledRejectionIsNotified = function() {\n                                this._bitField = -262145 & this._bitField;\n                            }, c.prototype._isUnhandledRejectionNotified = function() {\n                                return (262144 & this._bitField) > 0;\n                            }, c.prototype._setRejectionIsUnhandled = function() {\n                                this._bitField = 1048576 | this._bitField;\n                            }, c.prototype._unsetRejectionIsUnhandled = function() {\n                                this._bitField = -1048577 & this._bitField, this._isUnhandledRejectionNotified() && (this._unsetUnhandledRejectionIsNotified(), \n                                this._notifyUnhandledRejectionIsHandled());\n                            }, c.prototype._isRejectionUnhandled = function() {\n                                return (1048576 & this._bitField) > 0;\n                            }, c.prototype._warn = function(a, b, c) {\n                                return s(a, b, c || this);\n                            }, c.onPossiblyUnhandledRejection = function(a) {\n                                var b = K();\n                                I = "function" == typeof a ? null === b ? a : N.domainBind(b, a) : void 0;\n                            }, c.onUnhandledRejectionHandled = function(a) {\n                                var b = K();\n                                H = "function" == typeof a ? null === b ? a : N.domainBind(b, a) : void 0;\n                            };\n                            var Z = function() {};\n                            c.longStackTraces = function() {\n                                if (L.haveItemsQueued() && !ga.longStackTraces) throw new Error("cannot enable long stack traces after promises have been created\\n\\n    See http://goo.gl/MqrFmX\\n");\n                                if (!ga.longStackTraces && D()) {\n                                    var a = c.prototype._captureStackTrace, b = c.prototype._attachExtraTrace;\n                                    ga.longStackTraces = !0, Z = function() {\n                                        if (L.haveItemsQueued() && !ga.longStackTraces) throw new Error("cannot enable long stack traces after promises have been created\\n\\n    See http://goo.gl/MqrFmX\\n");\n                                        c.prototype._captureStackTrace = a, c.prototype._attachExtraTrace = b, d.deactivateLongStackTraces(), \n                                        L.enableTrampoline(), ga.longStackTraces = !1;\n                                    }, c.prototype._captureStackTrace = o, c.prototype._attachExtraTrace = p, d.activateLongStackTraces(), \n                                    L.disableTrampolineIfNecessary();\n                                }\n                            }, c.hasLongStackTraces = function() {\n                                return ga.longStackTraces && D();\n                            };\n                            var $ = function() {\n                                try {\n                                    if ("function" == typeof CustomEvent) {\n                                        var a = new CustomEvent("CustomEvent");\n                                        return N.global.dispatchEvent(a), function(a, b) {\n                                            var c = new CustomEvent(a.toLowerCase(), {\n                                                detail: b,\n                                                cancelable: !0\n                                            });\n                                            return !N.global.dispatchEvent(c);\n                                        };\n                                    }\n                                    if ("function" == typeof Event) {\n                                        var a = new Event("CustomEvent");\n                                        return N.global.dispatchEvent(a), function(a, b) {\n                                            var c = new Event(a.toLowerCase(), {\n                                                cancelable: !0\n                                            });\n                                            return c.detail = b, !N.global.dispatchEvent(c);\n                                        };\n                                    }\n                                    var a = document.createEvent("CustomEvent");\n                                    return a.initCustomEvent("testingtheevent", !1, !0, {}), N.global.dispatchEvent(a), \n                                    function(a, b) {\n                                        var c = document.createEvent("CustomEvent");\n                                        return c.initCustomEvent(a.toLowerCase(), !1, !0, b), !N.global.dispatchEvent(c);\n                                    };\n                                } catch (a) {}\n                                return function() {\n                                    return !1;\n                                };\n                            }(), _ = function() {\n                                return N.isNode ? function() {\n                                    return a.emit.apply(a, arguments);\n                                } : N.global ? function(a) {\n                                    var b = "on" + a.toLowerCase(), c = N.global[b];\n                                    return !!c && (c.apply(N.global, [].slice.call(arguments, 1)), !0);\n                                } : function() {\n                                    return !1;\n                                };\n                            }(), aa = {\n                                promiseCreated: e,\n                                promiseFulfilled: e,\n                                promiseRejected: e,\n                                promiseResolved: e,\n                                promiseCancelled: e,\n                                promiseChained: function(a, b, c) {\n                                    return {\n                                        promise: b,\n                                        child: c\n                                    };\n                                },\n                                warning: function(a, b) {\n                                    return {\n                                        warning: b\n                                    };\n                                },\n                                unhandledRejection: function(a, b, c) {\n                                    return {\n                                        reason: b,\n                                        promise: c\n                                    };\n                                },\n                                rejectionHandled: e\n                            }, ba = function(a) {\n                                var b = !1;\n                                try {\n                                    b = _.apply(null, arguments);\n                                } catch (a) {\n                                    L.throwLater(a), b = !0;\n                                }\n                                var c = !1;\n                                try {\n                                    c = $(a, aa[a].apply(null, arguments));\n                                } catch (a) {\n                                    L.throwLater(a), c = !0;\n                                }\n                                return c || b;\n                            };\n                            c.config = function(a) {\n                                if (a = Object(a), "longStackTraces" in a && (a.longStackTraces ? c.longStackTraces() : !a.longStackTraces && c.hasLongStackTraces() && Z()), \n                                "warnings" in a) {\n                                    var b = a.warnings;\n                                    ga.warnings = !!b, Y = ga.warnings, N.isObject(b) && "wForgottenReturn" in b && (Y = !!b.wForgottenReturn);\n                                }\n                                if ("cancellation" in a && a.cancellation && !ga.cancellation) {\n                                    if (L.haveItemsQueued()) throw new Error("cannot enable cancellation after promises are in use");\n                                    c.prototype._clearCancellationData = k, c.prototype._propagateFrom = l, c.prototype._onCancel = i, \n                                    c.prototype._setOnCancel = j, c.prototype._attachCancellationCallback = h, c.prototype._execute = g, \n                                    ca = l, ga.cancellation = !0;\n                                }\n                                return "monitoring" in a && (a.monitoring && !ga.monitoring ? (ga.monitoring = !0, \n                                c.prototype._fireEvent = ba) : !a.monitoring && ga.monitoring && (ga.monitoring = !1, \n                                c.prototype._fireEvent = f)), c;\n                            }, c.prototype._fireEvent = f, c.prototype._execute = function(a, b, c) {\n                                try {\n                                    a(b, c);\n                                } catch (a) {\n                                    return a;\n                                }\n                            }, c.prototype._onCancel = function() {}, c.prototype._setOnCancel = function(a) {}, \n                            c.prototype._attachCancellationCallback = function(a) {}, c.prototype._captureStackTrace = function() {}, \n                            c.prototype._attachExtraTrace = function() {}, c.prototype._clearCancellationData = function() {}, \n                            c.prototype._propagateFrom = function(a, b) {};\n                            var ca = m, da = function() {\n                                return !1;\n                            }, ea = /[\\/<\\(]([^:\\/]+):(\\d+):(?:\\d+)\\)?\\s*$/;\n                            N.inherits(G, Error), d.CapturedTrace = G, G.prototype.uncycle = function() {\n                                var a = this._length;\n                                if (!(a < 2)) {\n                                    for (var b = [], c = {}, d = 0, e = this; void 0 !== e; ++d) b.push(e), e = e._parent;\n                                    a = this._length = d;\n                                    for (var d = a - 1; d >= 0; --d) {\n                                        var f = b[d].stack;\n                                        void 0 === c[f] && (c[f] = d);\n                                    }\n                                    for (var d = 0; d < a; ++d) {\n                                        var g = b[d].stack, h = c[g];\n                                        if (void 0 !== h && h !== d) {\n                                            h > 0 && (b[h - 1]._parent = void 0, b[h - 1]._length = 1), b[d]._parent = void 0, \n                                            b[d]._length = 1;\n                                            var i = d > 0 ? b[d - 1] : this;\n                                            h < a - 1 ? (i._parent = b[h + 1], i._parent.uncycle(), i._length = i._parent._length + 1) : (i._parent = void 0, \n                                            i._length = 1);\n                                            for (var j = i._length + 1, k = d - 2; k >= 0; --k) b[k]._length = j, j++;\n                                            return;\n                                        }\n                                    }\n                                }\n                            }, G.prototype.attachExtraTrace = function(a) {\n                                if (!a.__stackCleaned__) {\n                                    this.uncycle();\n                                    for (var b = y(a), c = b.message, d = [ b.stack ], e = this; void 0 !== e; ) d.push(w(e.stack.split("\\n"))), \n                                    e = e._parent;\n                                    v(d), u(d), N.notEnumerableProp(a, "stack", t(c, d)), N.notEnumerableProp(a, "__stackCleaned__", !0);\n                                }\n                            };\n                            var fa = function() {\n                                var a = /^\\s*at\\s*/, b = function(a, b) {\n                                    return "string" == typeof a ? a : void 0 !== b.name && void 0 !== b.message ? b.toString() : B(b);\n                                };\n                                if ("number" == typeof Error.stackTraceLimit && "function" == typeof Error.captureStackTrace) {\n                                    Error.stackTraceLimit += 6, S = a, T = b;\n                                    var c = Error.captureStackTrace;\n                                    return da = function(a) {\n                                        return P.test(a);\n                                    }, function(a, b) {\n                                        Error.stackTraceLimit += 6, c(a, b), Error.stackTraceLimit -= 6;\n                                    };\n                                }\n                                var d = new Error();\n                                if ("string" == typeof d.stack && d.stack.split("\\n")[0].indexOf("stackDetection@") >= 0) return S = /@/, \n                                T = b, U = !0, function(a) {\n                                    a.stack = new Error().stack;\n                                };\n                                var e;\n                                try {\n                                    throw new Error();\n                                } catch (a) {\n                                    e = "stack" in a;\n                                }\n                                return "stack" in d || !e || "number" != typeof Error.stackTraceLimit ? (T = function(a, b) {\n                                    return "string" == typeof a ? a : "object" != typeof b && "function" != typeof b || void 0 === b.name || void 0 === b.message ? B(b) : b.toString();\n                                }, null) : (S = a, T = b, function(a) {\n                                    Error.stackTraceLimit += 6;\n                                    try {\n                                        throw new Error();\n                                    } catch (b) {\n                                        a.stack = b.stack;\n                                    }\n                                    Error.stackTraceLimit -= 6;\n                                });\n                            }();\n                            "undefined" != typeof console && void 0 !== console.warn && (J = function(a) {\n                                console.warn(a);\n                            }, N.isNode && a.stderr.isTTY ? J = function(a, b) {\n                                var c = b ? "[33m" : "[31m";\n                                console.warn(c + a + "[0m\\n");\n                            } : N.isNode || "string" != typeof new Error().stack || (J = function(a, b) {\n                                console.warn("%c" + a, b ? "color: darkorange" : "color: red");\n                            }));\n                            var ga = {\n                                warnings: W,\n                                longStackTraces: !1,\n                                cancellation: !1,\n                                monitoring: !1\n                            };\n                            return X && c.longStackTraces(), {\n                                longStackTraces: function() {\n                                    return ga.longStackTraces;\n                                },\n                                warnings: function() {\n                                    return ga.warnings;\n                                },\n                                cancellation: function() {\n                                    return ga.cancellation;\n                                },\n                                monitoring: function() {\n                                    return ga.monitoring;\n                                },\n                                propagateFromFunction: function() {\n                                    return ca;\n                                },\n                                boundValueFunction: function() {\n                                    return n;\n                                },\n                                checkForgottenReturns: q,\n                                setBounds: F,\n                                warn: s,\n                                deprecated: r,\n                                CapturedTrace: G,\n                                fireDomEvent: $,\n                                fireGlobalEvent: _\n                            };\n                        };\n                    }, {\n                        "./errors": 12,\n                        "./util": 36\n                    } ],\n                    10: [ function(a, b, c) {\n                        "use strict";\n                        b.exports = function(a) {\n                            function b() {\n                                return this.value;\n                            }\n                            function c() {\n                                throw this.reason;\n                            }\n                            a.prototype.return = a.prototype.thenReturn = function(c) {\n                                return c instanceof a && c.suppressUnhandledRejections(), this._then(b, void 0, void 0, {\n                                    value: c\n                                }, void 0);\n                            }, a.prototype.throw = a.prototype.thenThrow = function(a) {\n                                return this._then(c, void 0, void 0, {\n                                    reason: a\n                                }, void 0);\n                            }, a.prototype.catchThrow = function(a) {\n                                if (arguments.length <= 1) return this._then(void 0, c, void 0, {\n                                    reason: a\n                                }, void 0);\n                                var b = arguments[1], d = function() {\n                                    throw b;\n                                };\n                                return this.caught(a, d);\n                            }, a.prototype.catchReturn = function(c) {\n                                if (arguments.length <= 1) return c instanceof a && c.suppressUnhandledRejections(), \n                                this._then(void 0, b, void 0, {\n                                    value: c\n                                }, void 0);\n                                var d = arguments[1];\n                                d instanceof a && d.suppressUnhandledRejections();\n                                var e = function() {\n                                    return d;\n                                };\n                                return this.caught(c, e);\n                            };\n                        };\n                    }, {} ],\n                    11: [ function(a, b, c) {\n                        "use strict";\n                        b.exports = function(a, b) {\n                            function c() {\n                                return f(this);\n                            }\n                            function d(a, c) {\n                                return e(a, c, b, b);\n                            }\n                            var e = a.reduce, f = a.all;\n                            a.prototype.each = function(a) {\n                                return e(this, a, b, 0)._then(c, void 0, void 0, this, void 0);\n                            }, a.prototype.mapSeries = function(a) {\n                                return e(this, a, b, b);\n                            }, a.each = function(a, d) {\n                                return e(a, d, b, 0)._then(c, void 0, void 0, a, void 0);\n                            }, a.mapSeries = d;\n                        };\n                    }, {} ],\n                    12: [ function(a, b, c) {\n                        "use strict";\n                        function d(a, b) {\n                            function c(d) {\n                                if (!(this instanceof c)) return new c(d);\n                                l(this, "message", "string" == typeof d ? d : b), l(this, "name", a), Error.captureStackTrace ? Error.captureStackTrace(this, this.constructor) : Error.call(this);\n                            }\n                            return k(c, Error), c;\n                        }\n                        function e(a) {\n                            if (!(this instanceof e)) return new e(a);\n                            l(this, "name", "OperationalError"), l(this, "message", a), this.cause = a, this.isOperational = !0, \n                            a instanceof Error ? (l(this, "message", a.message), l(this, "stack", a.stack)) : Error.captureStackTrace && Error.captureStackTrace(this, this.constructor);\n                        }\n                        var f, g, h = a("./es5"), i = h.freeze, j = a("./util"), k = j.inherits, l = j.notEnumerableProp, m = d("Warning", "warning"), n = d("CancellationError", "cancellation error"), o = d("TimeoutError", "timeout error"), p = d("AggregateError", "aggregate error");\n                        try {\n                            f = TypeError, g = RangeError;\n                        } catch (a) {\n                            f = d("TypeError", "type error"), g = d("RangeError", "range error");\n                        }\n                        for (var q = "join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "), r = 0; r < q.length; ++r) "function" == typeof Array.prototype[q[r]] && (p.prototype[q[r]] = Array.prototype[q[r]]);\n                        h.defineProperty(p.prototype, "length", {\n                            value: 0,\n                            configurable: !1,\n                            writable: !0,\n                            enumerable: !0\n                        }), p.prototype.isOperational = !0;\n                        var s = 0;\n                        p.prototype.toString = function() {\n                            var a = Array(4 * s + 1).join(" "), b = "\\n" + a + "AggregateError of:\\n";\n                            s++, a = Array(4 * s + 1).join(" ");\n                            for (var c = 0; c < this.length; ++c) {\n                                for (var d = this[c] === this ? "[Circular AggregateError]" : this[c] + "", e = d.split("\\n"), f = 0; f < e.length; ++f) e[f] = a + e[f];\n                                d = e.join("\\n"), b += d + "\\n";\n                            }\n                            return s--, b;\n                        }, k(e, Error);\n                        var t = Error.__BluebirdErrorTypes__;\n                        t || (t = i({\n                            CancellationError: n,\n                            TimeoutError: o,\n                            OperationalError: e,\n                            RejectionError: e,\n                            AggregateError: p\n                        }), h.defineProperty(Error, "__BluebirdErrorTypes__", {\n                            value: t,\n                            writable: !1,\n                            enumerable: !1,\n                            configurable: !1\n                        })), b.exports = {\n                            Error: Error,\n                            TypeError: f,\n                            RangeError: g,\n                            CancellationError: t.CancellationError,\n                            OperationalError: t.OperationalError,\n                            TimeoutError: t.TimeoutError,\n                            AggregateError: t.AggregateError,\n                            Warning: m\n                        };\n                    }, {\n                        "./es5": 13,\n                        "./util": 36\n                    } ],\n                    13: [ function(a, b, c) {\n                        var d = function() {\n                            "use strict";\n                            return void 0 === this;\n                        }();\n                        if (d) b.exports = {\n                            freeze: Object.freeze,\n                            defineProperty: Object.defineProperty,\n                            getDescriptor: Object.getOwnPropertyDescriptor,\n                            keys: Object.keys,\n                            names: Object.getOwnPropertyNames,\n                            getPrototypeOf: Object.getPrototypeOf,\n                            isArray: Array.isArray,\n                            isES5: d,\n                            propertyIsWritable: function(a, b) {\n                                var c = Object.getOwnPropertyDescriptor(a, b);\n                                return !(c && !c.writable && !c.set);\n                            }\n                        }; else {\n                            var e = {}.hasOwnProperty, f = {}.toString, g = {}.constructor.prototype, h = function(a) {\n                                var b = [];\n                                for (var c in a) e.call(a, c) && b.push(c);\n                                return b;\n                            }, i = function(a, b) {\n                                return {\n                                    value: a[b]\n                                };\n                            }, j = function(a, b, c) {\n                                return a[b] = c.value, a;\n                            }, k = function(a) {\n                                return a;\n                            }, l = function(a) {\n                                try {\n                                    return Object(a).constructor.prototype;\n                                } catch (a) {\n                                    return g;\n                                }\n                            }, m = function(a) {\n                                try {\n                                    return "[object Array]" === f.call(a);\n                                } catch (a) {\n                                    return !1;\n                                }\n                            };\n                            b.exports = {\n                                isArray: m,\n                                keys: h,\n                                names: h,\n                                defineProperty: j,\n                                getDescriptor: i,\n                                freeze: k,\n                                getPrototypeOf: l,\n                                isES5: d,\n                                propertyIsWritable: function() {\n                                    return !0;\n                                }\n                            };\n                        }\n                    }, {} ],\n                    14: [ function(a, b, c) {\n                        "use strict";\n                        b.exports = function(a, b) {\n                            var c = a.map;\n                            a.prototype.filter = function(a, d) {\n                                return c(this, a, d, b);\n                            }, a.filter = function(a, d, e) {\n                                return c(a, d, e, b);\n                            };\n                        };\n                    }, {} ],\n                    15: [ function(a, b, c) {\n                        "use strict";\n                        b.exports = function(b, c, d) {\n                            function e(a, b, c) {\n                                this.promise = a, this.type = b, this.handler = c, this.called = !1, this.cancelPromise = null;\n                            }\n                            function f(a) {\n                                this.finallyHandler = a;\n                            }\n                            function g(a, b) {\n                                return null != a.cancelPromise && (arguments.length > 1 ? a.cancelPromise._reject(b) : a.cancelPromise._cancel(), \n                                a.cancelPromise = null, !0);\n                            }\n                            function h() {\n                                return j.call(this, this.promise._target()._settledValue());\n                            }\n                            function i(a) {\n                                if (!g(this, a)) return m.e = a, m;\n                            }\n                            function j(a) {\n                                var e = this.promise, j = this.handler;\n                                if (!this.called) {\n                                    this.called = !0;\n                                    var k = this.isFinallyHandler() ? j.call(e._boundValue()) : j.call(e._boundValue(), a);\n                                    if (k === d) return k;\n                                    if (void 0 !== k) {\n                                        e._setReturnedNonUndefined();\n                                        var n = c(k, e);\n                                        if (n instanceof b) {\n                                            if (null != this.cancelPromise) {\n                                                if (n._isCancelled()) {\n                                                    var o = new l("late cancellation observer");\n                                                    return e._attachExtraTrace(o), m.e = o, m;\n                                                }\n                                                n.isPending() && n._attachCancellationCallback(new f(this));\n                                            }\n                                            return n._then(h, i, void 0, this, void 0);\n                                        }\n                                    }\n                                }\n                                return e.isRejected() ? (g(this), m.e = a, m) : (g(this), a);\n                            }\n                            var k = a("./util"), l = b.CancellationError, m = k.errorObj, n = a("./catch_filter")(d);\n                            return e.prototype.isFinallyHandler = function() {\n                                return 0 === this.type;\n                            }, f.prototype._resultCancelled = function() {\n                                g(this.finallyHandler);\n                            }, b.prototype._passThrough = function(a, b, c, d) {\n                                return "function" != typeof a ? this.then() : this._then(c, d, void 0, new e(this, b, a), void 0);\n                            }, b.prototype.lastly = b.prototype.finally = function(a) {\n                                return this._passThrough(a, 0, j, j);\n                            }, b.prototype.tap = function(a) {\n                                return this._passThrough(a, 1, j);\n                            }, b.prototype.tapCatch = function(a) {\n                                var c = arguments.length;\n                                if (1 === c) return this._passThrough(a, 1, void 0, j);\n                                var d, e = new Array(c - 1), f = 0;\n                                for (d = 0; d < c - 1; ++d) {\n                                    var g = arguments[d];\n                                    if (!k.isObject(g)) return b.reject(new TypeError("tapCatch statement predicate: expecting an object but got " + k.classString(g)));\n                                    e[f++] = g;\n                                }\n                                e.length = f;\n                                var h = arguments[d];\n                                return this._passThrough(n(e, h, this), 1, void 0, j);\n                            }, e;\n                        };\n                    }, {\n                        "./catch_filter": 7,\n                        "./util": 36\n                    } ],\n                    16: [ function(a, b, c) {\n                        "use strict";\n                        b.exports = function(b, c, d, e, f, g) {\n                            function h(a, c, d) {\n                                for (var f = 0; f < c.length; ++f) {\n                                    d._pushContext();\n                                    var g = n(c[f])(a);\n                                    if (d._popContext(), g === m) {\n                                        d._pushContext();\n                                        var h = b.reject(m.e);\n                                        return d._popContext(), h;\n                                    }\n                                    var i = e(g, d);\n                                    if (i instanceof b) return i;\n                                }\n                                return null;\n                            }\n                            function i(a, c, e, f) {\n                                if (g.cancellation()) {\n                                    var h = new b(d), i = this._finallyPromise = new b(d);\n                                    this._promise = h.lastly(function() {\n                                        return i;\n                                    }), h._captureStackTrace(), h._setOnCancel(this);\n                                } else {\n                                    (this._promise = new b(d))._captureStackTrace();\n                                }\n                                this._stack = f, this._generatorFunction = a, this._receiver = c, this._generator = void 0, \n                                this._yieldHandlers = "function" == typeof e ? [ e ].concat(o) : o, this._yieldedPromise = null, \n                                this._cancellationPhase = !1;\n                            }\n                            var j = a("./errors"), k = j.TypeError, l = a("./util"), m = l.errorObj, n = l.tryCatch, o = [];\n                            l.inherits(i, f), i.prototype._isResolved = function() {\n                                return null === this._promise;\n                            }, i.prototype._cleanup = function() {\n                                this._promise = this._generator = null, g.cancellation() && null !== this._finallyPromise && (this._finallyPromise._fulfill(), \n                                this._finallyPromise = null);\n                            }, i.prototype._promiseCancelled = function() {\n                                if (!this._isResolved()) {\n                                    var a, c = void 0 !== this._generator.return;\n                                    if (c) this._promise._pushContext(), a = n(this._generator.return).call(this._generator, void 0), \n                                    this._promise._popContext(); else {\n                                        var d = new b.CancellationError("generator .return() sentinel");\n                                        b.coroutine.returnSentinel = d, this._promise._attachExtraTrace(d), this._promise._pushContext(), \n                                        a = n(this._generator.throw).call(this._generator, d), this._promise._popContext();\n                                    }\n                                    this._cancellationPhase = !0, this._yieldedPromise = null, this._continue(a);\n                                }\n                            }, i.prototype._promiseFulfilled = function(a) {\n                                this._yieldedPromise = null, this._promise._pushContext();\n                                var b = n(this._generator.next).call(this._generator, a);\n                                this._promise._popContext(), this._continue(b);\n                            }, i.prototype._promiseRejected = function(a) {\n                                this._yieldedPromise = null, this._promise._attachExtraTrace(a), this._promise._pushContext();\n                                var b = n(this._generator.throw).call(this._generator, a);\n                                this._promise._popContext(), this._continue(b);\n                            }, i.prototype._resultCancelled = function() {\n                                if (this._yieldedPromise instanceof b) {\n                                    var a = this._yieldedPromise;\n                                    this._yieldedPromise = null, a.cancel();\n                                }\n                            }, i.prototype.promise = function() {\n                                return this._promise;\n                            }, i.prototype._run = function() {\n                                this._generator = this._generatorFunction.call(this._receiver), this._receiver = this._generatorFunction = void 0, \n                                this._promiseFulfilled(void 0);\n                            }, i.prototype._continue = function(a) {\n                                var c = this._promise;\n                                if (a === m) return this._cleanup(), this._cancellationPhase ? c.cancel() : c._rejectCallback(a.e, !1);\n                                var d = a.value;\n                                if (!0 === a.done) return this._cleanup(), this._cancellationPhase ? c.cancel() : c._resolveCallback(d);\n                                var f = e(d, this._promise);\n                                if (!(f instanceof b) && null === (f = h(f, this._yieldHandlers, this._promise))) return void this._promiseRejected(new k("A value %s was yielded that could not be treated as a promise\\n\\n    See http://goo.gl/MqrFmX\\n\\n".replace("%s", String(d)) + "From coroutine:\\n" + this._stack.split("\\n").slice(1, -7).join("\\n")));\n                                f = f._target();\n                                var g = f._bitField;\n                                0 == (50397184 & g) ? (this._yieldedPromise = f, f._proxy(this, null)) : 0 != (33554432 & g) ? b._async.invoke(this._promiseFulfilled, this, f._value()) : 0 != (16777216 & g) ? b._async.invoke(this._promiseRejected, this, f._reason()) : this._promiseCancelled();\n                            }, b.coroutine = function(a, b) {\n                                if ("function" != typeof a) throw new k("generatorFunction must be a function\\n\\n    See http://goo.gl/MqrFmX\\n");\n                                var c = Object(b).yieldHandler, d = i, e = new Error().stack;\n                                return function() {\n                                    var b = a.apply(this, arguments), f = new d(void 0, void 0, c, e), g = f.promise();\n                                    return f._generator = b, f._promiseFulfilled(void 0), g;\n                                };\n                            }, b.coroutine.addYieldHandler = function(a) {\n                                if ("function" != typeof a) throw new k("expecting a function but got " + l.classString(a));\n                                o.push(a);\n                            }, b.spawn = function(a) {\n                                if (g.deprecated("Promise.spawn()", "Promise.coroutine()"), "function" != typeof a) return c("generatorFunction must be a function\\n\\n    See http://goo.gl/MqrFmX\\n");\n                                var d = new i(a, this), e = d.promise();\n                                return d._run(b.spawn), e;\n                            };\n                        };\n                    }, {\n                        "./errors": 12,\n                        "./util": 36\n                    } ],\n                    17: [ function(a, b, c) {\n                        "use strict";\n                        b.exports = function(b, c, d, e, f, g) {\n                            var h = a("./util");\n                            h.canEvaluate, h.tryCatch, h.errorObj;\n                            b.join = function() {\n                                var a, b = arguments.length - 1;\n                                if (b > 0 && "function" == typeof arguments[b]) {\n                                    a = arguments[b];\n                                    var d;\n                                }\n                                var e = [].slice.call(arguments);\n                                a && e.pop();\n                                var d = new c(e).promise();\n                                return void 0 !== a ? d.spread(a) : d;\n                            };\n                        };\n                    }, {\n                        "./util": 36\n                    } ],\n                    18: [ function(a, b, c) {\n                        "use strict";\n                        b.exports = function(b, c, d, e, f, g) {\n                            function h(a, b, c, d) {\n                                this.constructor$(a), this._promise._captureStackTrace();\n                                var e = j();\n                                this._callback = null === e ? b : k.domainBind(e, b), this._preservedValues = d === f ? new Array(this.length()) : null, \n                                this._limit = c, this._inFlight = 0, this._queue = [], n.invoke(this._asyncInit, this, void 0);\n                            }\n                            function i(a, c, e, f) {\n                                if ("function" != typeof c) return d("expecting a function but got " + k.classString(c));\n                                var g = 0;\n                                if (void 0 !== e) {\n                                    if ("object" != typeof e || null === e) return b.reject(new TypeError("options argument must be an object but it is " + k.classString(e)));\n                                    if ("number" != typeof e.concurrency) return b.reject(new TypeError("\'concurrency\' must be a number but it is " + k.classString(e.concurrency)));\n                                    g = e.concurrency;\n                                }\n                                return g = "number" == typeof g && isFinite(g) && g >= 1 ? g : 0, new h(a, c, g, f).promise();\n                            }\n                            var j = b._getDomain, k = a("./util"), l = k.tryCatch, m = k.errorObj, n = b._async;\n                            k.inherits(h, c), h.prototype._asyncInit = function() {\n                                this._init$(void 0, -2);\n                            }, h.prototype._init = function() {}, h.prototype._promiseFulfilled = function(a, c) {\n                                var d = this._values, f = this.length(), h = this._preservedValues, i = this._limit;\n                                if (c < 0) {\n                                    if (c = -1 * c - 1, d[c] = a, i >= 1 && (this._inFlight--, this._drainQueue(), this._isResolved())) return !0;\n                                } else {\n                                    if (i >= 1 && this._inFlight >= i) return d[c] = a, this._queue.push(c), !1;\n                                    null !== h && (h[c] = a);\n                                    var j = this._promise, k = this._callback, n = j._boundValue();\n                                    j._pushContext();\n                                    var o = l(k).call(n, a, c, f), p = j._popContext();\n                                    if (g.checkForgottenReturns(o, p, null !== h ? "Promise.filter" : "Promise.map", j), \n                                    o === m) return this._reject(o.e), !0;\n                                    var q = e(o, this._promise);\n                                    if (q instanceof b) {\n                                        q = q._target();\n                                        var r = q._bitField;\n                                        if (0 == (50397184 & r)) return i >= 1 && this._inFlight++, d[c] = q, q._proxy(this, -1 * (c + 1)), \n                                        !1;\n                                        if (0 == (33554432 & r)) return 0 != (16777216 & r) ? (this._reject(q._reason()), \n                                        !0) : (this._cancel(), !0);\n                                        o = q._value();\n                                    }\n                                    d[c] = o;\n                                }\n                                return ++this._totalResolved >= f && (null !== h ? this._filter(d, h) : this._resolve(d), \n                                !0);\n                            }, h.prototype._drainQueue = function() {\n                                for (var a = this._queue, b = this._limit, c = this._values; a.length > 0 && this._inFlight < b; ) {\n                                    if (this._isResolved()) return;\n                                    var d = a.pop();\n                                    this._promiseFulfilled(c[d], d);\n                                }\n                            }, h.prototype._filter = function(a, b) {\n                                for (var c = b.length, d = new Array(c), e = 0, f = 0; f < c; ++f) a[f] && (d[e++] = b[f]);\n                                d.length = e, this._resolve(d);\n                            }, h.prototype.preservedValues = function() {\n                                return this._preservedValues;\n                            }, b.prototype.map = function(a, b) {\n                                return i(this, a, b, null);\n                            }, b.map = function(a, b, c, d) {\n                                return i(a, b, c, d);\n                            };\n                        };\n                    }, {\n                        "./util": 36\n                    } ],\n                    19: [ function(a, b, c) {\n                        "use strict";\n                        b.exports = function(b, c, d, e, f) {\n                            var g = a("./util"), h = g.tryCatch;\n                            b.method = function(a) {\n                                if ("function" != typeof a) throw new b.TypeError("expecting a function but got " + g.classString(a));\n                                return function() {\n                                    var d = new b(c);\n                                    d._captureStackTrace(), d._pushContext();\n                                    var e = h(a).apply(this, arguments), g = d._popContext();\n                                    return f.checkForgottenReturns(e, g, "Promise.method", d), d._resolveFromSyncValue(e), \n                                    d;\n                                };\n                            }, b.attempt = b.try = function(a) {\n                                if ("function" != typeof a) return e("expecting a function but got " + g.classString(a));\n                                var d = new b(c);\n                                d._captureStackTrace(), d._pushContext();\n                                var i;\n                                if (arguments.length > 1) {\n                                    f.deprecated("calling Promise.try with more than 1 argument");\n                                    var j = arguments[1], k = arguments[2];\n                                    i = g.isArray(j) ? h(a).apply(k, j) : h(a).call(k, j);\n                                } else i = h(a)();\n                                var l = d._popContext();\n                                return f.checkForgottenReturns(i, l, "Promise.try", d), d._resolveFromSyncValue(i), \n                                d;\n                            }, b.prototype._resolveFromSyncValue = function(a) {\n                                a === g.errorObj ? this._rejectCallback(a.e, !1) : this._resolveCallback(a, !0);\n                            };\n                        };\n                    }, {\n                        "./util": 36\n                    } ],\n                    20: [ function(a, b, c) {\n                        "use strict";\n                        function d(a) {\n                            return a instanceof Error && k.getPrototypeOf(a) === Error.prototype;\n                        }\n                        function e(a) {\n                            var b;\n                            if (d(a)) {\n                                b = new j(a), b.name = a.name, b.message = a.message, b.stack = a.stack;\n                                for (var c = k.keys(a), e = 0; e < c.length; ++e) {\n                                    var f = c[e];\n                                    l.test(f) || (b[f] = a[f]);\n                                }\n                                return b;\n                            }\n                            return g.markAsOriginatingFromRejection(a), a;\n                        }\n                        function f(a, b) {\n                            return function(c, d) {\n                                if (null !== a) {\n                                    if (c) {\n                                        var f = e(h(c));\n                                        a._attachExtraTrace(f), a._reject(f);\n                                    } else if (b) {\n                                        var g = [].slice.call(arguments, 1);\n                                        a._fulfill(g);\n                                    } else a._fulfill(d);\n                                    a = null;\n                                }\n                            };\n                        }\n                        var g = a("./util"), h = g.maybeWrapAsError, i = a("./errors"), j = i.OperationalError, k = a("./es5"), l = /^(?:name|message|stack|cause)$/;\n                        b.exports = f;\n                    }, {\n                        "./errors": 12,\n                        "./es5": 13,\n                        "./util": 36\n                    } ],\n                    21: [ function(a, b, c) {\n                        "use strict";\n                        b.exports = function(b) {\n                            function c(a, b) {\n                                var c = this;\n                                if (!f.isArray(a)) return d.call(c, a, b);\n                                var e = h(b).apply(c._boundValue(), [ null ].concat(a));\n                                e === i && g.throwLater(e.e);\n                            }\n                            function d(a, b) {\n                                var c = this, d = c._boundValue(), e = void 0 === a ? h(b).call(d, null) : h(b).call(d, null, a);\n                                e === i && g.throwLater(e.e);\n                            }\n                            function e(a, b) {\n                                var c = this;\n                                if (!a) {\n                                    var d = new Error(a + "");\n                                    d.cause = a, a = d;\n                                }\n                                var e = h(b).call(c._boundValue(), a);\n                                e === i && g.throwLater(e.e);\n                            }\n                            var f = a("./util"), g = b._async, h = f.tryCatch, i = f.errorObj;\n                            b.prototype.asCallback = b.prototype.nodeify = function(a, b) {\n                                if ("function" == typeof a) {\n                                    var f = d;\n                                    void 0 !== b && Object(b).spread && (f = c), this._then(f, e, void 0, this, a);\n                                }\n                                return this;\n                            };\n                        };\n                    }, {\n                        "./util": 36\n                    } ],\n                    22: [ function(b, c, d) {\n                        "use strict";\n                        c.exports = function() {\n                            function d() {}\n                            function e(a, b) {\n                                if (null == a || a.constructor !== f) throw new t("the promise constructor cannot be invoked directly\\n\\n    See http://goo.gl/MqrFmX\\n");\n                                if ("function" != typeof b) throw new t("expecting a function but got " + o.classString(b));\n                            }\n                            function f(a) {\n                                a !== v && e(this, a), this._bitField = 0, this._fulfillmentHandler0 = void 0, this._rejectionHandler0 = void 0, \n                                this._promise0 = void 0, this._receiver0 = void 0, this._resolveFromExecutor(a), \n                                this._promiseCreated(), this._fireEvent("promiseCreated", this);\n                            }\n                            function g(a) {\n                                this.promise._resolveCallback(a);\n                            }\n                            function h(a) {\n                                this.promise._rejectCallback(a, !1);\n                            }\n                            function i(a) {\n                                var b = new f(v);\n                                b._fulfillmentHandler0 = a, b._rejectionHandler0 = a, b._promise0 = a, b._receiver0 = a;\n                            }\n                            var j, k = function() {\n                                return new t("circular promise resolution chain\\n\\n    See http://goo.gl/MqrFmX\\n");\n                            }, l = function() {\n                                return new f.PromiseInspection(this._target());\n                            }, m = function(a) {\n                                return f.reject(new t(a));\n                            }, n = {}, o = b("./util");\n                            j = o.isNode ? function() {\n                                var b = a.domain;\n                                return void 0 === b && (b = null), b;\n                            } : function() {\n                                return null;\n                            }, o.notEnumerableProp(f, "_getDomain", j);\n                            var p = b("./es5"), q = b("./async"), r = new q();\n                            p.defineProperty(f, "_async", {\n                                value: r\n                            });\n                            var s = b("./errors"), t = f.TypeError = s.TypeError;\n                            f.RangeError = s.RangeError;\n                            var u = f.CancellationError = s.CancellationError;\n                            f.TimeoutError = s.TimeoutError, f.OperationalError = s.OperationalError, f.RejectionError = s.OperationalError, \n                            f.AggregateError = s.AggregateError;\n                            var v = function() {}, w = {}, x = {}, y = b("./thenables")(f, v), z = b("./promise_array")(f, v, y, m, d), A = b("./context")(f), B = A.create, C = b("./debuggability")(f, A), D = (C.CapturedTrace, \n                            b("./finally")(f, y, x)), E = b("./catch_filter")(x), F = b("./nodeback"), G = o.errorObj, H = o.tryCatch;\n                            return f.prototype.toString = function() {\n                                return "[object Promise]";\n                            }, f.prototype.caught = f.prototype.catch = function(a) {\n                                var b = arguments.length;\n                                if (b > 1) {\n                                    var c, d = new Array(b - 1), e = 0;\n                                    for (c = 0; c < b - 1; ++c) {\n                                        var f = arguments[c];\n                                        if (!o.isObject(f)) return m("Catch statement predicate: expecting an object but got " + o.classString(f));\n                                        d[e++] = f;\n                                    }\n                                    return d.length = e, a = arguments[c], this.then(void 0, E(d, a, this));\n                                }\n                                return this.then(void 0, a);\n                            }, f.prototype.reflect = function() {\n                                return this._then(l, l, void 0, this, void 0);\n                            }, f.prototype.then = function(a, b) {\n                                if (C.warnings() && arguments.length > 0 && "function" != typeof a && "function" != typeof b) {\n                                    var c = ".then() only accepts functions but was passed: " + o.classString(a);\n                                    arguments.length > 1 && (c += ", " + o.classString(b)), this._warn(c);\n                                }\n                                return this._then(a, b, void 0, void 0, void 0);\n                            }, f.prototype.done = function(a, b) {\n                                this._then(a, b, void 0, void 0, void 0)._setIsFinal();\n                            }, f.prototype.spread = function(a) {\n                                return "function" != typeof a ? m("expecting a function but got " + o.classString(a)) : this.all()._then(a, void 0, void 0, w, void 0);\n                            }, f.prototype.toJSON = function() {\n                                var a = {\n                                    isFulfilled: !1,\n                                    isRejected: !1,\n                                    fulfillmentValue: void 0,\n                                    rejectionReason: void 0\n                                };\n                                return this.isFulfilled() ? (a.fulfillmentValue = this.value(), a.isFulfilled = !0) : this.isRejected() && (a.rejectionReason = this.reason(), \n                                a.isRejected = !0), a;\n                            }, f.prototype.all = function() {\n                                return arguments.length > 0 && this._warn(".all() was passed arguments but it does not take any"), \n                                new z(this).promise();\n                            }, f.prototype.error = function(a) {\n                                return this.caught(o.originatesFromRejection, a);\n                            }, f.getNewLibraryCopy = c.exports, f.is = function(a) {\n                                return a instanceof f;\n                            }, f.fromNode = f.fromCallback = function(a) {\n                                var b = new f(v);\n                                b._captureStackTrace();\n                                var c = arguments.length > 1 && !!Object(arguments[1]).multiArgs, d = H(a)(F(b, c));\n                                return d === G && b._rejectCallback(d.e, !0), b._isFateSealed() || b._setAsyncGuaranteed(), \n                                b;\n                            }, f.all = function(a) {\n                                return new z(a).promise();\n                            }, f.cast = function(a) {\n                                var b = y(a);\n                                return b instanceof f || (b = new f(v), b._captureStackTrace(), b._setFulfilled(), \n                                b._rejectionHandler0 = a), b;\n                            }, f.resolve = f.fulfilled = f.cast, f.reject = f.rejected = function(a) {\n                                var b = new f(v);\n                                return b._captureStackTrace(), b._rejectCallback(a, !0), b;\n                            }, f.setScheduler = function(a) {\n                                if ("function" != typeof a) throw new t("expecting a function but got " + o.classString(a));\n                                return r.setScheduler(a);\n                            }, f.prototype._then = function(a, b, c, d, e) {\n                                var g = void 0 !== e, h = g ? e : new f(v), i = this._target(), k = i._bitField;\n                                g || (h._propagateFrom(this, 3), h._captureStackTrace(), void 0 === d && 0 != (2097152 & this._bitField) && (d = 0 != (50397184 & k) ? this._boundValue() : i === this ? void 0 : this._boundTo), \n                                this._fireEvent("promiseChained", this, h));\n                                var l = j();\n                                if (0 != (50397184 & k)) {\n                                    var m, n, p = i._settlePromiseCtx;\n                                    0 != (33554432 & k) ? (n = i._rejectionHandler0, m = a) : 0 != (16777216 & k) ? (n = i._fulfillmentHandler0, \n                                    m = b, i._unsetRejectionIsUnhandled()) : (p = i._settlePromiseLateCancellationObserver, \n                                    n = new u("late cancellation observer"), i._attachExtraTrace(n), m = b), r.invoke(p, i, {\n                                        handler: null === l ? m : "function" == typeof m && o.domainBind(l, m),\n                                        promise: h,\n                                        receiver: d,\n                                        value: n\n                                    });\n                                } else i._addCallbacks(a, b, h, d, l);\n                                return h;\n                            }, f.prototype._length = function() {\n                                return 65535 & this._bitField;\n                            }, f.prototype._isFateSealed = function() {\n                                return 0 != (117506048 & this._bitField);\n                            }, f.prototype._isFollowing = function() {\n                                return 67108864 == (67108864 & this._bitField);\n                            }, f.prototype._setLength = function(a) {\n                                this._bitField = -65536 & this._bitField | 65535 & a;\n                            }, f.prototype._setFulfilled = function() {\n                                this._bitField = 33554432 | this._bitField, this._fireEvent("promiseFulfilled", this);\n                            }, f.prototype._setRejected = function() {\n                                this._bitField = 16777216 | this._bitField, this._fireEvent("promiseRejected", this);\n                            }, f.prototype._setFollowing = function() {\n                                this._bitField = 67108864 | this._bitField, this._fireEvent("promiseResolved", this);\n                            }, f.prototype._setIsFinal = function() {\n                                this._bitField = 4194304 | this._bitField;\n                            }, f.prototype._isFinal = function() {\n                                return (4194304 & this._bitField) > 0;\n                            }, f.prototype._unsetCancelled = function() {\n                                this._bitField = -65537 & this._bitField;\n                            }, f.prototype._setCancelled = function() {\n                                this._bitField = 65536 | this._bitField, this._fireEvent("promiseCancelled", this);\n                            }, f.prototype._setWillBeCancelled = function() {\n                                this._bitField = 8388608 | this._bitField;\n                            }, f.prototype._setAsyncGuaranteed = function() {\n                                r.hasCustomScheduler() || (this._bitField = 134217728 | this._bitField);\n                            }, f.prototype._receiverAt = function(a) {\n                                var b = 0 === a ? this._receiver0 : this[4 * a - 4 + 3];\n                                if (b !== n) return void 0 === b && this._isBound() ? this._boundValue() : b;\n                            }, f.prototype._promiseAt = function(a) {\n                                return this[4 * a - 4 + 2];\n                            }, f.prototype._fulfillmentHandlerAt = function(a) {\n                                return this[4 * a - 4 + 0];\n                            }, f.prototype._rejectionHandlerAt = function(a) {\n                                return this[4 * a - 4 + 1];\n                            }, f.prototype._boundValue = function() {}, f.prototype._migrateCallback0 = function(a) {\n                                var b = (a._bitField, a._fulfillmentHandler0), c = a._rejectionHandler0, d = a._promise0, e = a._receiverAt(0);\n                                void 0 === e && (e = n), this._addCallbacks(b, c, d, e, null);\n                            }, f.prototype._migrateCallbackAt = function(a, b) {\n                                var c = a._fulfillmentHandlerAt(b), d = a._rejectionHandlerAt(b), e = a._promiseAt(b), f = a._receiverAt(b);\n                                void 0 === f && (f = n), this._addCallbacks(c, d, e, f, null);\n                            }, f.prototype._addCallbacks = function(a, b, c, d, e) {\n                                var f = this._length();\n                                if (f >= 65531 && (f = 0, this._setLength(0)), 0 === f) this._promise0 = c, this._receiver0 = d, \n                                "function" == typeof a && (this._fulfillmentHandler0 = null === e ? a : o.domainBind(e, a)), \n                                "function" == typeof b && (this._rejectionHandler0 = null === e ? b : o.domainBind(e, b)); else {\n                                    var g = 4 * f - 4;\n                                    this[g + 2] = c, this[g + 3] = d, "function" == typeof a && (this[g + 0] = null === e ? a : o.domainBind(e, a)), \n                                    "function" == typeof b && (this[g + 1] = null === e ? b : o.domainBind(e, b));\n                                }\n                                return this._setLength(f + 1), f;\n                            }, f.prototype._proxy = function(a, b) {\n                                this._addCallbacks(void 0, void 0, b, a, null);\n                            }, f.prototype._resolveCallback = function(a, b) {\n                                if (0 == (117506048 & this._bitField)) {\n                                    if (a === this) return this._rejectCallback(k(), !1);\n                                    var c = y(a, this);\n                                    if (!(c instanceof f)) return this._fulfill(a);\n                                    b && this._propagateFrom(c, 2);\n                                    var d = c._target();\n                                    if (d === this) return void this._reject(k());\n                                    var e = d._bitField;\n                                    if (0 == (50397184 & e)) {\n                                        var g = this._length();\n                                        g > 0 && d._migrateCallback0(this);\n                                        for (var h = 1; h < g; ++h) d._migrateCallbackAt(this, h);\n                                        this._setFollowing(), this._setLength(0), this._setFollowee(d);\n                                    } else if (0 != (33554432 & e)) this._fulfill(d._value()); else if (0 != (16777216 & e)) this._reject(d._reason()); else {\n                                        var i = new u("late cancellation observer");\n                                        d._attachExtraTrace(i), this._reject(i);\n                                    }\n                                }\n                            }, f.prototype._rejectCallback = function(a, b, c) {\n                                var d = o.ensureErrorObject(a), e = d === a;\n                                if (!e && !c && C.warnings()) {\n                                    var f = "a promise was rejected with a non-error: " + o.classString(a);\n                                    this._warn(f, !0);\n                                }\n                                this._attachExtraTrace(d, !!b && e), this._reject(a);\n                            }, f.prototype._resolveFromExecutor = function(a) {\n                                if (a !== v) {\n                                    var b = this;\n                                    this._captureStackTrace(), this._pushContext();\n                                    var c = !0, d = this._execute(a, function(a) {\n                                        b._resolveCallback(a);\n                                    }, function(a) {\n                                        b._rejectCallback(a, c);\n                                    });\n                                    c = !1, this._popContext(), void 0 !== d && b._rejectCallback(d, !0);\n                                }\n                            }, f.prototype._settlePromiseFromHandler = function(a, b, c, d) {\n                                var e = d._bitField;\n                                if (0 == (65536 & e)) {\n                                    d._pushContext();\n                                    var f;\n                                    b === w ? c && "number" == typeof c.length ? f = H(a).apply(this._boundValue(), c) : (f = G, \n                                    f.e = new t("cannot .spread() a non-array: " + o.classString(c))) : f = H(a).call(b, c);\n                                    var g = d._popContext();\n                                    e = d._bitField, 0 == (65536 & e) && (f === x ? d._reject(c) : f === G ? d._rejectCallback(f.e, !1) : (C.checkForgottenReturns(f, g, "", d, this), \n                                    d._resolveCallback(f)));\n                                }\n                            }, f.prototype._target = function() {\n                                for (var a = this; a._isFollowing(); ) a = a._followee();\n                                return a;\n                            }, f.prototype._followee = function() {\n                                return this._rejectionHandler0;\n                            }, f.prototype._setFollowee = function(a) {\n                                this._rejectionHandler0 = a;\n                            }, f.prototype._settlePromise = function(a, b, c, e) {\n                                var g = a instanceof f, h = this._bitField, i = 0 != (134217728 & h);\n                                0 != (65536 & h) ? (g && a._invokeInternalOnCancel(), c instanceof D && c.isFinallyHandler() ? (c.cancelPromise = a, \n                                H(b).call(c, e) === G && a._reject(G.e)) : b === l ? a._fulfill(l.call(c)) : c instanceof d ? c._promiseCancelled(a) : g || a instanceof z ? a._cancel() : c.cancel()) : "function" == typeof b ? g ? (i && a._setAsyncGuaranteed(), \n                                this._settlePromiseFromHandler(b, c, e, a)) : b.call(c, e, a) : c instanceof d ? c._isResolved() || (0 != (33554432 & h) ? c._promiseFulfilled(e, a) : c._promiseRejected(e, a)) : g && (i && a._setAsyncGuaranteed(), \n                                0 != (33554432 & h) ? a._fulfill(e) : a._reject(e));\n                            }, f.prototype._settlePromiseLateCancellationObserver = function(a) {\n                                var b = a.handler, c = a.promise, d = a.receiver, e = a.value;\n                                "function" == typeof b ? c instanceof f ? this._settlePromiseFromHandler(b, d, e, c) : b.call(d, e, c) : c instanceof f && c._reject(e);\n                            }, f.prototype._settlePromiseCtx = function(a) {\n                                this._settlePromise(a.promise, a.handler, a.receiver, a.value);\n                            }, f.prototype._settlePromise0 = function(a, b, c) {\n                                var d = this._promise0, e = this._receiverAt(0);\n                                this._promise0 = void 0, this._receiver0 = void 0, this._settlePromise(d, a, e, b);\n                            }, f.prototype._clearCallbackDataAtIndex = function(a) {\n                                var b = 4 * a - 4;\n                                this[b + 2] = this[b + 3] = this[b + 0] = this[b + 1] = void 0;\n                            }, f.prototype._fulfill = function(a) {\n                                var b = this._bitField;\n                                if (!((117506048 & b) >>> 16)) {\n                                    if (a === this) {\n                                        var c = k();\n                                        return this._attachExtraTrace(c), this._reject(c);\n                                    }\n                                    this._setFulfilled(), this._rejectionHandler0 = a, (65535 & b) > 0 && (0 != (134217728 & b) ? this._settlePromises() : r.settlePromises(this));\n                                }\n                            }, f.prototype._reject = function(a) {\n                                var b = this._bitField;\n                                if (!((117506048 & b) >>> 16)) {\n                                    if (this._setRejected(), this._fulfillmentHandler0 = a, this._isFinal()) return r.fatalError(a, o.isNode);\n                                    (65535 & b) > 0 ? r.settlePromises(this) : this._ensurePossibleRejectionHandled();\n                                }\n                            }, f.prototype._fulfillPromises = function(a, b) {\n                                for (var c = 1; c < a; c++) {\n                                    var d = this._fulfillmentHandlerAt(c), e = this._promiseAt(c), f = this._receiverAt(c);\n                                    this._clearCallbackDataAtIndex(c), this._settlePromise(e, d, f, b);\n                                }\n                            }, f.prototype._rejectPromises = function(a, b) {\n                                for (var c = 1; c < a; c++) {\n                                    var d = this._rejectionHandlerAt(c), e = this._promiseAt(c), f = this._receiverAt(c);\n                                    this._clearCallbackDataAtIndex(c), this._settlePromise(e, d, f, b);\n                                }\n                            }, f.prototype._settlePromises = function() {\n                                var a = this._bitField, b = 65535 & a;\n                                if (b > 0) {\n                                    if (0 != (16842752 & a)) {\n                                        var c = this._fulfillmentHandler0;\n                                        this._settlePromise0(this._rejectionHandler0, c, a), this._rejectPromises(b, c);\n                                    } else {\n                                        var d = this._rejectionHandler0;\n                                        this._settlePromise0(this._fulfillmentHandler0, d, a), this._fulfillPromises(b, d);\n                                    }\n                                    this._setLength(0);\n                                }\n                                this._clearCancellationData();\n                            }, f.prototype._settledValue = function() {\n                                var a = this._bitField;\n                                return 0 != (33554432 & a) ? this._rejectionHandler0 : 0 != (16777216 & a) ? this._fulfillmentHandler0 : void 0;\n                            }, f.defer = f.pending = function() {\n                                return C.deprecated("Promise.defer", "new Promise"), {\n                                    promise: new f(v),\n                                    resolve: g,\n                                    reject: h\n                                };\n                            }, o.notEnumerableProp(f, "_makeSelfResolutionError", k), b("./method")(f, v, y, m, C), \n                            b("./bind")(f, v, y, C), b("./cancel")(f, z, m, C), b("./direct_resolve")(f), b("./synchronous_inspection")(f), \n                            b("./join")(f, z, y, v, r, j), f.Promise = f, f.version = "3.5.1", b("./map.js")(f, z, m, y, v, C), \n                            b("./call_get.js")(f), b("./using.js")(f, m, y, B, v, C), b("./timers.js")(f, v, C), \n                            b("./generators.js")(f, m, v, y, d, C), b("./nodeify.js")(f), b("./promisify.js")(f, v), \n                            b("./props.js")(f, z, y, m), b("./race.js")(f, v, y, m), b("./reduce.js")(f, z, m, y, v, C), \n                            b("./settle.js")(f, z, C), b("./some.js")(f, z, m), b("./filter.js")(f, v), b("./each.js")(f, v), \n                            b("./any.js")(f), o.toFastProperties(f), o.toFastProperties(f.prototype), i({\n                                a: 1\n                            }), i({\n                                b: 2\n                            }), i({\n                                c: 3\n                            }), i(1), i(function() {}), i(void 0), i(!1), i(new f(v)), C.setBounds(q.firstLineError, o.lastLineError), \n                            f;\n                        };\n                    }, {\n                        "./any.js": 1,\n                        "./async": 2,\n                        "./bind": 3,\n                        "./call_get.js": 5,\n                        "./cancel": 6,\n                        "./catch_filter": 7,\n                        "./context": 8,\n                        "./debuggability": 9,\n                        "./direct_resolve": 10,\n                        "./each.js": 11,\n                        "./errors": 12,\n                        "./es5": 13,\n                        "./filter.js": 14,\n                        "./finally": 15,\n                        "./generators.js": 16,\n                        "./join": 17,\n                        "./map.js": 18,\n                        "./method": 19,\n                        "./nodeback": 20,\n                        "./nodeify.js": 21,\n                        "./promise_array": 23,\n                        "./promisify.js": 24,\n                        "./props.js": 25,\n                        "./race.js": 27,\n                        "./reduce.js": 28,\n                        "./settle.js": 30,\n                        "./some.js": 31,\n                        "./synchronous_inspection": 32,\n                        "./thenables": 33,\n                        "./timers.js": 34,\n                        "./using.js": 35,\n                        "./util": 36\n                    } ],\n                    23: [ function(a, b, c) {\n                        "use strict";\n                        b.exports = function(b, c, d, e, f) {\n                            function g(a) {\n                                switch (a) {\n                                  case -2:\n                                    return [];\n\n                                  case -3:\n                                    return {};\n\n                                  case -6:\n                                    return new Map();\n                                }\n                            }\n                            function h(a) {\n                                var d = this._promise = new b(c);\n                                a instanceof b && d._propagateFrom(a, 3), d._setOnCancel(this), this._values = a, \n                                this._length = 0, this._totalResolved = 0, this._init(void 0, -2);\n                            }\n                            var i = a("./util");\n                            i.isArray;\n                            return i.inherits(h, f), h.prototype.length = function() {\n                                return this._length;\n                            }, h.prototype.promise = function() {\n                                return this._promise;\n                            }, h.prototype._init = function a(c, f) {\n                                var h = d(this._values, this._promise);\n                                if (h instanceof b) {\n                                    h = h._target();\n                                    var j = h._bitField;\n                                    if (this._values = h, 0 == (50397184 & j)) return this._promise._setAsyncGuaranteed(), \n                                    h._then(a, this._reject, void 0, this, f);\n                                    if (0 == (33554432 & j)) return 0 != (16777216 & j) ? this._reject(h._reason()) : this._cancel();\n                                    h = h._value();\n                                }\n                                if (null === (h = i.asArray(h))) {\n                                    var k = e("expecting an array or an iterable object but got " + i.classString(h)).reason();\n                                    return void this._promise._rejectCallback(k, !1);\n                                }\n                                if (0 === h.length) return void (-5 === f ? this._resolveEmptyArray() : this._resolve(g(f)));\n                                this._iterate(h);\n                            }, h.prototype._iterate = function(a) {\n                                var c = this.getActualLength(a.length);\n                                this._length = c, this._values = this.shouldCopyValues() ? new Array(c) : this._values;\n                                for (var e = this._promise, f = !1, g = null, h = 0; h < c; ++h) {\n                                    var i = d(a[h], e);\n                                    i instanceof b ? (i = i._target(), g = i._bitField) : g = null, f ? null !== g && i.suppressUnhandledRejections() : null !== g ? 0 == (50397184 & g) ? (i._proxy(this, h), \n                                    this._values[h] = i) : f = 0 != (33554432 & g) ? this._promiseFulfilled(i._value(), h) : 0 != (16777216 & g) ? this._promiseRejected(i._reason(), h) : this._promiseCancelled(h) : f = this._promiseFulfilled(i, h);\n                                }\n                                f || e._setAsyncGuaranteed();\n                            }, h.prototype._isResolved = function() {\n                                return null === this._values;\n                            }, h.prototype._resolve = function(a) {\n                                this._values = null, this._promise._fulfill(a);\n                            }, h.prototype._cancel = function() {\n                                !this._isResolved() && this._promise._isCancellable() && (this._values = null, this._promise._cancel());\n                            }, h.prototype._reject = function(a) {\n                                this._values = null, this._promise._rejectCallback(a, !1);\n                            }, h.prototype._promiseFulfilled = function(a, b) {\n                                return this._values[b] = a, ++this._totalResolved >= this._length && (this._resolve(this._values), \n                                !0);\n                            }, h.prototype._promiseCancelled = function() {\n                                return this._cancel(), !0;\n                            }, h.prototype._promiseRejected = function(a) {\n                                return this._totalResolved++, this._reject(a), !0;\n                            }, h.prototype._resultCancelled = function() {\n                                if (!this._isResolved()) {\n                                    var a = this._values;\n                                    if (this._cancel(), a instanceof b) a.cancel(); else for (var c = 0; c < a.length; ++c) a[c] instanceof b && a[c].cancel();\n                                }\n                            }, h.prototype.shouldCopyValues = function() {\n                                return !0;\n                            }, h.prototype.getActualLength = function(a) {\n                                return a;\n                            }, h;\n                        };\n                    }, {\n                        "./util": 36\n                    } ],\n                    24: [ function(a, b, c) {\n                        "use strict";\n                        b.exports = function(b, c) {\n                            function d(a) {\n                                return !v.test(a);\n                            }\n                            function e(a) {\n                                try {\n                                    return !0 === a.__isPromisified__;\n                                } catch (a) {\n                                    return !1;\n                                }\n                            }\n                            function f(a, b, c) {\n                                var d = n.getDataPropertyOrDefault(a, b + c, t);\n                                return !!d && e(d);\n                            }\n                            function g(a, b, c) {\n                                for (var d = 0; d < a.length; d += 2) {\n                                    var e = a[d];\n                                    if (c.test(e)) for (var f = e.replace(c, ""), g = 0; g < a.length; g += 2) if (a[g] === f) throw new s("Cannot promisify an API that has normal methods with \'%s\'-suffix\\n\\n    See http://goo.gl/MqrFmX\\n".replace("%s", b));\n                                }\n                            }\n                            function h(a, b, c, d) {\n                                for (var h = n.inheritedDataKeys(a), i = [], j = 0; j < h.length; ++j) {\n                                    var k = h[j], l = a[k], m = d === w || w(k, l, a);\n                                    "function" != typeof l || e(l) || f(a, k, b) || !d(k, l, a, m) || i.push(k, l);\n                                }\n                                return g(i, b, c), i;\n                            }\n                            function i(a, d, e, f, g, h) {\n                                function i() {\n                                    var e = d;\n                                    d === m && (e = this);\n                                    var f = new b(c);\n                                    f._captureStackTrace();\n                                    var g = "string" == typeof k && this !== j ? this[k] : a, i = o(f, h);\n                                    try {\n                                        g.apply(e, p(arguments, i));\n                                    } catch (a) {\n                                        f._rejectCallback(q(a), !0, !0);\n                                    }\n                                    return f._isFateSealed() || f._setAsyncGuaranteed(), f;\n                                }\n                                var j = function() {\n                                    return this;\n                                }(), k = a;\n                                return "string" == typeof k && (a = f), n.notEnumerableProp(i, "__isPromisified__", !0), \n                                i;\n                            }\n                            function j(a, b, c, d, e) {\n                                for (var f = new RegExp(x(b) + "$"), g = h(a, b, f, c), i = 0, j = g.length; i < j; i += 2) {\n                                    var k = g[i], l = g[i + 1], o = k + b;\n                                    if (d === y) a[o] = y(k, m, k, l, b, e); else {\n                                        var p = d(l, function() {\n                                            return y(k, m, k, l, b, e);\n                                        });\n                                        n.notEnumerableProp(p, "__isPromisified__", !0), a[o] = p;\n                                    }\n                                }\n                                return n.toFastProperties(a), a;\n                            }\n                            function k(a, b, c) {\n                                return y(a, b, void 0, a, null, c);\n                            }\n                            var l, m = {}, n = a("./util"), o = a("./nodeback"), p = n.withAppended, q = n.maybeWrapAsError, r = n.canEvaluate, s = a("./errors").TypeError, t = {\n                                __isPromisified__: !0\n                            }, u = [ "arity", "length", "name", "arguments", "caller", "callee", "prototype", "__isPromisified__" ], v = new RegExp("^(?:" + u.join("|") + ")$"), w = function(a) {\n                                return n.isIdentifier(a) && "_" !== a.charAt(0) && "constructor" !== a;\n                            }, x = function(a) {\n                                return a.replace(/([$])/, "\\\\$");\n                            }, y = r ? l : i;\n                            b.promisify = function(a, b) {\n                                if ("function" != typeof a) throw new s("expecting a function but got " + n.classString(a));\n                                if (e(a)) return a;\n                                b = Object(b);\n                                var c = void 0 === b.context ? m : b.context, f = !!b.multiArgs, g = k(a, c, f);\n                                return n.copyDescriptors(a, g, d), g;\n                            }, b.promisifyAll = function(a, b) {\n                                if ("function" != typeof a && "object" != typeof a) throw new s("the target of promisifyAll must be an object or a function\\n\\n    See http://goo.gl/MqrFmX\\n");\n                                b = Object(b);\n                                var c = !!b.multiArgs, d = b.suffix;\n                                "string" != typeof d && (d = "Async");\n                                var e = b.filter;\n                                "function" != typeof e && (e = w);\n                                var f = b.promisifier;\n                                if ("function" != typeof f && (f = y), !n.isIdentifier(d)) throw new RangeError("suffix must be a valid identifier\\n\\n    See http://goo.gl/MqrFmX\\n");\n                                for (var g = n.inheritedDataKeys(a), h = 0; h < g.length; ++h) {\n                                    var i = a[g[h]];\n                                    "constructor" !== g[h] && n.isClass(i) && (j(i.prototype, d, e, f, c), j(i, d, e, f, c));\n                                }\n                                return j(a, d, e, f, c);\n                            };\n                        };\n                    }, {\n                        "./errors": 12,\n                        "./nodeback": 20,\n                        "./util": 36\n                    } ],\n                    25: [ function(a, b, c) {\n                        "use strict";\n                        b.exports = function(b, c, d, e) {\n                            function f(a) {\n                                var b, c = !1;\n                                if (void 0 !== h && a instanceof h) b = l(a), c = !0; else {\n                                    var d = k.keys(a), e = d.length;\n                                    b = new Array(2 * e);\n                                    for (var f = 0; f < e; ++f) {\n                                        var g = d[f];\n                                        b[f] = a[g], b[f + e] = g;\n                                    }\n                                }\n                                this.constructor$(b), this._isMap = c, this._init$(void 0, c ? -6 : -3);\n                            }\n                            function g(a) {\n                                var c, g = d(a);\n                                return j(g) ? (c = g instanceof b ? g._then(b.props, void 0, void 0, void 0, void 0) : new f(g).promise(), \n                                g instanceof b && c._propagateFrom(g, 2), c) : e("cannot await properties of a non-object\\n\\n    See http://goo.gl/MqrFmX\\n");\n                            }\n                            var h, i = a("./util"), j = i.isObject, k = a("./es5");\n                            "function" == typeof Map && (h = Map);\n                            var l = function() {\n                                function a(a, d) {\n                                    this[b] = a, this[b + c] = d, b++;\n                                }\n                                var b = 0, c = 0;\n                                return function(d) {\n                                    c = d.size, b = 0;\n                                    var e = new Array(2 * d.size);\n                                    return d.forEach(a, e), e;\n                                };\n                            }(), m = function(a) {\n                                for (var b = new h(), c = a.length / 2 | 0, d = 0; d < c; ++d) {\n                                    var e = a[c + d], f = a[d];\n                                    b.set(e, f);\n                                }\n                                return b;\n                            };\n                            i.inherits(f, c), f.prototype._init = function() {}, f.prototype._promiseFulfilled = function(a, b) {\n                                if (this._values[b] = a, ++this._totalResolved >= this._length) {\n                                    var c;\n                                    if (this._isMap) c = m(this._values); else {\n                                        c = {};\n                                        for (var d = this.length(), e = 0, f = this.length(); e < f; ++e) c[this._values[e + d]] = this._values[e];\n                                    }\n                                    return this._resolve(c), !0;\n                                }\n                                return !1;\n                            }, f.prototype.shouldCopyValues = function() {\n                                return !1;\n                            }, f.prototype.getActualLength = function(a) {\n                                return a >> 1;\n                            }, b.prototype.props = function() {\n                                return g(this);\n                            }, b.props = function(a) {\n                                return g(a);\n                            };\n                        };\n                    }, {\n                        "./es5": 13,\n                        "./util": 36\n                    } ],\n                    26: [ function(a, b, c) {\n                        "use strict";\n                        function d(a, b, c, d, e) {\n                            for (var f = 0; f < e; ++f) c[f + d] = a[f + b], a[f + b] = void 0;\n                        }\n                        function e(a) {\n                            this._capacity = a, this._length = 0, this._front = 0;\n                        }\n                        e.prototype._willBeOverCapacity = function(a) {\n                            return this._capacity < a;\n                        }, e.prototype._pushOne = function(a) {\n                            var b = this.length();\n                            this._checkCapacity(b + 1), this[this._front + b & this._capacity - 1] = a, this._length = b + 1;\n                        }, e.prototype.push = function(a, b, c) {\n                            var d = this.length() + 3;\n                            if (this._willBeOverCapacity(d)) return this._pushOne(a), this._pushOne(b), void this._pushOne(c);\n                            var e = this._front + d - 3;\n                            this._checkCapacity(d);\n                            var f = this._capacity - 1;\n                            this[e + 0 & f] = a, this[e + 1 & f] = b, this[e + 2 & f] = c, this._length = d;\n                        }, e.prototype.shift = function() {\n                            var a = this._front, b = this[a];\n                            return this[a] = void 0, this._front = a + 1 & this._capacity - 1, this._length--, \n                            b;\n                        }, e.prototype.length = function() {\n                            return this._length;\n                        }, e.prototype._checkCapacity = function(a) {\n                            this._capacity < a && this._resizeTo(this._capacity << 1);\n                        }, e.prototype._resizeTo = function(a) {\n                            var b = this._capacity;\n                            this._capacity = a, d(this, 0, this, b, this._front + this._length & b - 1);\n                        }, b.exports = e;\n                    }, {} ],\n                    27: [ function(a, b, c) {\n                        "use strict";\n                        b.exports = function(b, c, d, e) {\n                            function f(a, f) {\n                                var i = d(a);\n                                if (i instanceof b) return h(i);\n                                if (null === (a = g.asArray(a))) return e("expecting an array or an iterable object but got " + g.classString(a));\n                                var j = new b(c);\n                                void 0 !== f && j._propagateFrom(f, 3);\n                                for (var k = j._fulfill, l = j._reject, m = 0, n = a.length; m < n; ++m) {\n                                    var o = a[m];\n                                    (void 0 !== o || m in a) && b.cast(o)._then(k, l, void 0, j, null);\n                                }\n                                return j;\n                            }\n                            var g = a("./util"), h = function(a) {\n                                return a.then(function(b) {\n                                    return f(b, a);\n                                });\n                            };\n                            b.race = function(a) {\n                                return f(a, void 0);\n                            }, b.prototype.race = function() {\n                                return f(this, void 0);\n                            };\n                        };\n                    }, {\n                        "./util": 36\n                    } ],\n                    28: [ function(a, b, c) {\n                        "use strict";\n                        b.exports = function(b, c, d, e, f, g) {\n                            function h(a, c, d, e) {\n                                this.constructor$(a);\n                                var g = m();\n                                this._fn = null === g ? c : n.domainBind(g, c), void 0 !== d && (d = b.resolve(d), \n                                d._attachCancellationCallback(this)), this._initialValue = d, this._currentCancellable = null, \n                                this._eachValues = e === f ? Array(this._length) : 0 === e ? null : void 0, this._promise._captureStackTrace(), \n                                this._init$(void 0, -5);\n                            }\n                            function i(a, b) {\n                                this.isFulfilled() ? b._resolve(a) : b._reject(a);\n                            }\n                            function j(a, b, c, e) {\n                                return "function" != typeof b ? d("expecting a function but got " + n.classString(b)) : new h(a, b, c, e).promise();\n                            }\n                            function k(a) {\n                                this.accum = a, this.array._gotAccum(a);\n                                var c = e(this.value, this.array._promise);\n                                return c instanceof b ? (this.array._currentCancellable = c, c._then(l, void 0, void 0, this, void 0)) : l.call(this, c);\n                            }\n                            function l(a) {\n                                var c = this.array, d = c._promise, e = o(c._fn);\n                                d._pushContext();\n                                var f;\n                                (f = void 0 !== c._eachValues ? e.call(d._boundValue(), a, this.index, this.length) : e.call(d._boundValue(), this.accum, a, this.index, this.length)) instanceof b && (c._currentCancellable = f);\n                                var h = d._popContext();\n                                return g.checkForgottenReturns(f, h, void 0 !== c._eachValues ? "Promise.each" : "Promise.reduce", d), \n                                f;\n                            }\n                            var m = b._getDomain, n = a("./util"), o = n.tryCatch;\n                            n.inherits(h, c), h.prototype._gotAccum = function(a) {\n                                void 0 !== this._eachValues && null !== this._eachValues && a !== f && this._eachValues.push(a);\n                            }, h.prototype._eachComplete = function(a) {\n                                return null !== this._eachValues && this._eachValues.push(a), this._eachValues;\n                            }, h.prototype._init = function() {}, h.prototype._resolveEmptyArray = function() {\n                                this._resolve(void 0 !== this._eachValues ? this._eachValues : this._initialValue);\n                            }, h.prototype.shouldCopyValues = function() {\n                                return !1;\n                            }, h.prototype._resolve = function(a) {\n                                this._promise._resolveCallback(a), this._values = null;\n                            }, h.prototype._resultCancelled = function(a) {\n                                if (a === this._initialValue) return this._cancel();\n                                this._isResolved() || (this._resultCancelled$(), this._currentCancellable instanceof b && this._currentCancellable.cancel(), \n                                this._initialValue instanceof b && this._initialValue.cancel());\n                            }, h.prototype._iterate = function(a) {\n                                this._values = a;\n                                var c, d, e = a.length;\n                                if (void 0 !== this._initialValue ? (c = this._initialValue, d = 0) : (c = b.resolve(a[0]), \n                                d = 1), this._currentCancellable = c, !c.isRejected()) for (;d < e; ++d) {\n                                    var f = {\n                                        accum: null,\n                                        value: a[d],\n                                        index: d,\n                                        length: e,\n                                        array: this\n                                    };\n                                    c = c._then(k, void 0, void 0, f, void 0);\n                                }\n                                void 0 !== this._eachValues && (c = c._then(this._eachComplete, void 0, void 0, this, void 0)), \n                                c._then(i, i, void 0, c, this);\n                            }, b.prototype.reduce = function(a, b) {\n                                return j(this, a, b, null);\n                            }, b.reduce = function(a, b, c, d) {\n                                return j(a, b, c, d);\n                            };\n                        };\n                    }, {\n                        "./util": 36\n                    } ],\n                    29: [ function(b, c, f) {\n                        "use strict";\n                        var g, h = b("./util"), i = function() {\n                            throw new Error("No async scheduler available\\n\\n    See http://goo.gl/MqrFmX\\n");\n                        }, j = h.getNativePromise();\n                        if (h.isNode && "undefined" == typeof MutationObserver) {\n                            var k = d.setImmediate, l = a.nextTick;\n                            g = h.isRecentNode ? function(a) {\n                                k.call(d, a);\n                            } : function(b) {\n                                l.call(a, b);\n                            };\n                        } else if ("function" == typeof j && "function" == typeof j.resolve) {\n                            var m = j.resolve();\n                            g = function(a) {\n                                m.then(a);\n                            };\n                        } else g = "undefined" == typeof MutationObserver || "undefined" != typeof window && window.navigator && (window.navigator.standalone || window.cordova) ? void 0 !== e ? function(a) {\n                            e(a);\n                        } : "undefined" != typeof setTimeout ? function(a) {\n                            setTimeout(a, 0);\n                        } : i : function() {\n                            var a = document.createElement("div"), b = {\n                                attributes: !0\n                            }, c = !1, d = document.createElement("div");\n                            new MutationObserver(function() {\n                                a.classList.toggle("foo"), c = !1;\n                            }).observe(d, b);\n                            var e = function() {\n                                c || (c = !0, d.classList.toggle("foo"));\n                            };\n                            return function(c) {\n                                var d = new MutationObserver(function() {\n                                    d.disconnect(), c();\n                                });\n                                d.observe(a, b), e();\n                            };\n                        }();\n                        c.exports = g;\n                    }, {\n                        "./util": 36\n                    } ],\n                    30: [ function(a, b, c) {\n                        "use strict";\n                        b.exports = function(b, c, d) {\n                            function e(a) {\n                                this.constructor$(a);\n                            }\n                            var f = b.PromiseInspection;\n                            a("./util").inherits(e, c), e.prototype._promiseResolved = function(a, b) {\n                                return this._values[a] = b, ++this._totalResolved >= this._length && (this._resolve(this._values), \n                                !0);\n                            }, e.prototype._promiseFulfilled = function(a, b) {\n                                var c = new f();\n                                return c._bitField = 33554432, c._settledValueField = a, this._promiseResolved(b, c);\n                            }, e.prototype._promiseRejected = function(a, b) {\n                                var c = new f();\n                                return c._bitField = 16777216, c._settledValueField = a, this._promiseResolved(b, c);\n                            }, b.settle = function(a) {\n                                return d.deprecated(".settle()", ".reflect()"), new e(a).promise();\n                            }, b.prototype.settle = function() {\n                                return b.settle(this);\n                            };\n                        };\n                    }, {\n                        "./util": 36\n                    } ],\n                    31: [ function(a, b, c) {\n                        "use strict";\n                        b.exports = function(b, c, d) {\n                            function e(a) {\n                                this.constructor$(a), this._howMany = 0, this._unwrap = !1, this._initialized = !1;\n                            }\n                            function f(a, b) {\n                                if ((0 | b) !== b || b < 0) return d("expecting a positive integer\\n\\n    See http://goo.gl/MqrFmX\\n");\n                                var c = new e(a), f = c.promise();\n                                return c.setHowMany(b), c.init(), f;\n                            }\n                            var g = a("./util"), h = a("./errors").RangeError, i = a("./errors").AggregateError, j = g.isArray, k = {};\n                            g.inherits(e, c), e.prototype._init = function() {\n                                if (this._initialized) {\n                                    if (0 === this._howMany) return void this._resolve([]);\n                                    this._init$(void 0, -5);\n                                    var a = j(this._values);\n                                    !this._isResolved() && a && this._howMany > this._canPossiblyFulfill() && this._reject(this._getRangeError(this.length()));\n                                }\n                            }, e.prototype.init = function() {\n                                this._initialized = !0, this._init();\n                            }, e.prototype.setUnwrap = function() {\n                                this._unwrap = !0;\n                            }, e.prototype.howMany = function() {\n                                return this._howMany;\n                            }, e.prototype.setHowMany = function(a) {\n                                this._howMany = a;\n                            }, e.prototype._promiseFulfilled = function(a) {\n                                return this._addFulfilled(a), this._fulfilled() === this.howMany() && (this._values.length = this.howMany(), \n                                1 === this.howMany() && this._unwrap ? this._resolve(this._values[0]) : this._resolve(this._values), \n                                !0);\n                            }, e.prototype._promiseRejected = function(a) {\n                                return this._addRejected(a), this._checkOutcome();\n                            }, e.prototype._promiseCancelled = function() {\n                                return this._values instanceof b || null == this._values ? this._cancel() : (this._addRejected(k), \n                                this._checkOutcome());\n                            }, e.prototype._checkOutcome = function() {\n                                if (this.howMany() > this._canPossiblyFulfill()) {\n                                    for (var a = new i(), b = this.length(); b < this._values.length; ++b) this._values[b] !== k && a.push(this._values[b]);\n                                    return a.length > 0 ? this._reject(a) : this._cancel(), !0;\n                                }\n                                return !1;\n                            }, e.prototype._fulfilled = function() {\n                                return this._totalResolved;\n                            }, e.prototype._rejected = function() {\n                                return this._values.length - this.length();\n                            }, e.prototype._addRejected = function(a) {\n                                this._values.push(a);\n                            }, e.prototype._addFulfilled = function(a) {\n                                this._values[this._totalResolved++] = a;\n                            }, e.prototype._canPossiblyFulfill = function() {\n                                return this.length() - this._rejected();\n                            }, e.prototype._getRangeError = function(a) {\n                                var b = "Input array must contain at least " + this._howMany + " items but contains only " + a + " items";\n                                return new h(b);\n                            }, e.prototype._resolveEmptyArray = function() {\n                                this._reject(this._getRangeError(0));\n                            }, b.some = function(a, b) {\n                                return f(a, b);\n                            }, b.prototype.some = function(a) {\n                                return f(this, a);\n                            }, b._SomePromiseArray = e;\n                        };\n                    }, {\n                        "./errors": 12,\n                        "./util": 36\n                    } ],\n                    32: [ function(a, b, c) {\n                        "use strict";\n                        b.exports = function(a) {\n                            function b(a) {\n                                void 0 !== a ? (a = a._target(), this._bitField = a._bitField, this._settledValueField = a._isFateSealed() ? a._settledValue() : void 0) : (this._bitField = 0, \n                                this._settledValueField = void 0);\n                            }\n                            b.prototype._settledValue = function() {\n                                return this._settledValueField;\n                            };\n                            var c = b.prototype.value = function() {\n                                if (!this.isFulfilled()) throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\\n\\n    See http://goo.gl/MqrFmX\\n");\n                                return this._settledValue();\n                            }, d = b.prototype.error = b.prototype.reason = function() {\n                                if (!this.isRejected()) throw new TypeError("cannot get rejection reason of a non-rejected promise\\n\\n    See http://goo.gl/MqrFmX\\n");\n                                return this._settledValue();\n                            }, e = b.prototype.isFulfilled = function() {\n                                return 0 != (33554432 & this._bitField);\n                            }, f = b.prototype.isRejected = function() {\n                                return 0 != (16777216 & this._bitField);\n                            }, g = b.prototype.isPending = function() {\n                                return 0 == (50397184 & this._bitField);\n                            }, h = b.prototype.isResolved = function() {\n                                return 0 != (50331648 & this._bitField);\n                            };\n                            b.prototype.isCancelled = function() {\n                                return 0 != (8454144 & this._bitField);\n                            }, a.prototype.__isCancelled = function() {\n                                return 65536 == (65536 & this._bitField);\n                            }, a.prototype._isCancelled = function() {\n                                return this._target().__isCancelled();\n                            }, a.prototype.isCancelled = function() {\n                                return 0 != (8454144 & this._target()._bitField);\n                            }, a.prototype.isPending = function() {\n                                return g.call(this._target());\n                            }, a.prototype.isRejected = function() {\n                                return f.call(this._target());\n                            }, a.prototype.isFulfilled = function() {\n                                return e.call(this._target());\n                            }, a.prototype.isResolved = function() {\n                                return h.call(this._target());\n                            }, a.prototype.value = function() {\n                                return c.call(this._target());\n                            }, a.prototype.reason = function() {\n                                var a = this._target();\n                                return a._unsetRejectionIsUnhandled(), d.call(a);\n                            }, a.prototype._value = function() {\n                                return this._settledValue();\n                            }, a.prototype._reason = function() {\n                                return this._unsetRejectionIsUnhandled(), this._settledValue();\n                            }, a.PromiseInspection = b;\n                        };\n                    }, {} ],\n                    33: [ function(a, b, c) {\n                        "use strict";\n                        b.exports = function(b, c) {\n                            function d(a, d) {\n                                if (k(a)) {\n                                    if (a instanceof b) return a;\n                                    var e = f(a);\n                                    if (e === j) {\n                                        d && d._pushContext();\n                                        var i = b.reject(e.e);\n                                        return d && d._popContext(), i;\n                                    }\n                                    if ("function" == typeof e) {\n                                        if (g(a)) {\n                                            var i = new b(c);\n                                            return a._then(i._fulfill, i._reject, void 0, i, null), i;\n                                        }\n                                        return h(a, e, d);\n                                    }\n                                }\n                                return a;\n                            }\n                            function e(a) {\n                                return a.then;\n                            }\n                            function f(a) {\n                                try {\n                                    return e(a);\n                                } catch (a) {\n                                    return j.e = a, j;\n                                }\n                            }\n                            function g(a) {\n                                try {\n                                    return l.call(a, "_promise0");\n                                } catch (a) {\n                                    return !1;\n                                }\n                            }\n                            function h(a, d, e) {\n                                function f(a) {\n                                    h && (h._resolveCallback(a), h = null);\n                                }\n                                function g(a) {\n                                    h && (h._rejectCallback(a, l, !0), h = null);\n                                }\n                                var h = new b(c), k = h;\n                                e && e._pushContext(), h._captureStackTrace(), e && e._popContext();\n                                var l = !0, m = i.tryCatch(d).call(a, f, g);\n                                return l = !1, h && m === j && (h._rejectCallback(m.e, !0, !0), h = null), k;\n                            }\n                            var i = a("./util"), j = i.errorObj, k = i.isObject, l = {}.hasOwnProperty;\n                            return d;\n                        };\n                    }, {\n                        "./util": 36\n                    } ],\n                    34: [ function(a, b, c) {\n                        "use strict";\n                        b.exports = function(b, c, d) {\n                            function e(a) {\n                                this.handle = a;\n                            }\n                            function f(a) {\n                                return clearTimeout(this.handle), a;\n                            }\n                            function g(a) {\n                                throw clearTimeout(this.handle), a;\n                            }\n                            var h = a("./util"), i = b.TimeoutError;\n                            e.prototype._resultCancelled = function() {\n                                clearTimeout(this.handle);\n                            };\n                            var j = function(a) {\n                                return k(+this).thenReturn(a);\n                            }, k = b.delay = function(a, f) {\n                                var g, h;\n                                return void 0 !== f ? (g = b.resolve(f)._then(j, null, null, a, void 0), d.cancellation() && f instanceof b && g._setOnCancel(f)) : (g = new b(c), \n                                h = setTimeout(function() {\n                                    g._fulfill();\n                                }, +a), d.cancellation() && g._setOnCancel(new e(h)), g._captureStackTrace()), g._setAsyncGuaranteed(), \n                                g;\n                            };\n                            b.prototype.delay = function(a) {\n                                return k(a, this);\n                            };\n                            var l = function(a, b, c) {\n                                var d;\n                                d = "string" != typeof b ? b instanceof Error ? b : new i("operation timed out") : new i(b), \n                                h.markAsOriginatingFromRejection(d), a._attachExtraTrace(d), a._reject(d), null != c && c.cancel();\n                            };\n                            b.prototype.timeout = function(a, b) {\n                                a = +a;\n                                var c, h, i = new e(setTimeout(function() {\n                                    c.isPending() && l(c, b, h);\n                                }, a));\n                                return d.cancellation() ? (h = this.then(), c = h._then(f, g, void 0, i, void 0), \n                                c._setOnCancel(i)) : c = this._then(f, g, void 0, i, void 0), c;\n                            };\n                        };\n                    }, {\n                        "./util": 36\n                    } ],\n                    35: [ function(a, b, c) {\n                        "use strict";\n                        b.exports = function(b, c, d, e, f, g) {\n                            function h(a) {\n                                setTimeout(function() {\n                                    throw a;\n                                }, 0);\n                            }\n                            function i(a) {\n                                var b = d(a);\n                                return b !== a && "function" == typeof a._isDisposable && "function" == typeof a._getDisposer && a._isDisposable() && b._setDisposable(a._getDisposer()), \n                                b;\n                            }\n                            function j(a, c) {\n                                function e() {\n                                    if (g >= j) return k._fulfill();\n                                    var f = i(a[g++]);\n                                    if (f instanceof b && f._isDisposable()) {\n                                        try {\n                                            f = d(f._getDisposer().tryDispose(c), a.promise);\n                                        } catch (a) {\n                                            return h(a);\n                                        }\n                                        if (f instanceof b) return f._then(e, h, null, null, null);\n                                    }\n                                    e();\n                                }\n                                var g = 0, j = a.length, k = new b(f);\n                                return e(), k;\n                            }\n                            function k(a, b, c) {\n                                this._data = a, this._promise = b, this._context = c;\n                            }\n                            function l(a, b, c) {\n                                this.constructor$(a, b, c);\n                            }\n                            function m(a) {\n                                return k.isDisposer(a) ? (this.resources[this.index]._setDisposable(a), a.promise()) : a;\n                            }\n                            function n(a) {\n                                this.length = a, this.promise = null, this[a - 1] = null;\n                            }\n                            var o = a("./util"), p = a("./errors").TypeError, q = a("./util").inherits, r = o.errorObj, s = o.tryCatch, t = {};\n                            k.prototype.data = function() {\n                                return this._data;\n                            }, k.prototype.promise = function() {\n                                return this._promise;\n                            }, k.prototype.resource = function() {\n                                return this.promise().isFulfilled() ? this.promise().value() : t;\n                            }, k.prototype.tryDispose = function(a) {\n                                var b = this.resource(), c = this._context;\n                                void 0 !== c && c._pushContext();\n                                var d = b !== t ? this.doDispose(b, a) : null;\n                                return void 0 !== c && c._popContext(), this._promise._unsetDisposable(), this._data = null, \n                                d;\n                            }, k.isDisposer = function(a) {\n                                return null != a && "function" == typeof a.resource && "function" == typeof a.tryDispose;\n                            }, q(l, k), l.prototype.doDispose = function(a, b) {\n                                return this.data().call(a, a, b);\n                            }, n.prototype._resultCancelled = function() {\n                                for (var a = this.length, c = 0; c < a; ++c) {\n                                    var d = this[c];\n                                    d instanceof b && d.cancel();\n                                }\n                            }, b.using = function() {\n                                var a = arguments.length;\n                                if (a < 2) return c("you must pass at least 2 arguments to Promise.using");\n                                var e = arguments[a - 1];\n                                if ("function" != typeof e) return c("expecting a function but got " + o.classString(e));\n                                var f, h = !0;\n                                2 === a && Array.isArray(arguments[0]) ? (f = arguments[0], a = f.length, h = !1) : (f = arguments, \n                                a--);\n                                for (var i = new n(a), l = 0; l < a; ++l) {\n                                    var p = f[l];\n                                    if (k.isDisposer(p)) {\n                                        var q = p;\n                                        p = p.promise(), p._setDisposable(q);\n                                    } else {\n                                        var t = d(p);\n                                        t instanceof b && (p = t._then(m, null, null, {\n                                            resources: i,\n                                            index: l\n                                        }, void 0));\n                                    }\n                                    i[l] = p;\n                                }\n                                for (var u = new Array(i.length), l = 0; l < u.length; ++l) u[l] = b.resolve(i[l]).reflect();\n                                var v = b.all(u).then(function(a) {\n                                    for (var b = 0; b < a.length; ++b) {\n                                        var c = a[b];\n                                        if (c.isRejected()) return r.e = c.error(), r;\n                                        if (!c.isFulfilled()) return void v.cancel();\n                                        a[b] = c.value();\n                                    }\n                                    w._pushContext(), e = s(e);\n                                    var d = h ? e.apply(void 0, a) : e(a), f = w._popContext();\n                                    return g.checkForgottenReturns(d, f, "Promise.using", w), d;\n                                }), w = v.lastly(function() {\n                                    var a = new b.PromiseInspection(v);\n                                    return j(i, a);\n                                });\n                                return i.promise = w, w._setOnCancel(i), w;\n                            }, b.prototype._setDisposable = function(a) {\n                                this._bitField = 131072 | this._bitField, this._disposer = a;\n                            }, b.prototype._isDisposable = function() {\n                                return (131072 & this._bitField) > 0;\n                            }, b.prototype._getDisposer = function() {\n                                return this._disposer;\n                            }, b.prototype._unsetDisposable = function() {\n                                this._bitField = -131073 & this._bitField, this._disposer = void 0;\n                            }, b.prototype.disposer = function(a) {\n                                if ("function" == typeof a) return new l(a, this, e());\n                                throw new p();\n                            };\n                        };\n                    }, {\n                        "./errors": 12,\n                        "./util": 36\n                    } ],\n                    36: [ function(b, c, e) {\n                        "use strict";\n                        function f() {\n                            try {\n                                var a = F;\n                                return F = null, a.apply(this, arguments);\n                            } catch (a) {\n                                return E.e = a, E;\n                            }\n                        }\n                        function g(a) {\n                            return F = a, f;\n                        }\n                        function h(a) {\n                            return null == a || !0 === a || !1 === a || "string" == typeof a || "number" == typeof a;\n                        }\n                        function i(a) {\n                            return "function" == typeof a || "object" == typeof a && null !== a;\n                        }\n                        function j(a) {\n                            return h(a) ? new Error(s(a)) : a;\n                        }\n                        function k(a, b) {\n                            var c, d = a.length, e = new Array(d + 1);\n                            for (c = 0; c < d; ++c) e[c] = a[c];\n                            return e[c] = b, e;\n                        }\n                        function l(a, b, c) {\n                            if (!C.isES5) return {}.hasOwnProperty.call(a, b) ? a[b] : void 0;\n                            var d = Object.getOwnPropertyDescriptor(a, b);\n                            return null != d ? null == d.get && null == d.set ? d.value : c : void 0;\n                        }\n                        function m(a, b, c) {\n                            if (h(a)) return a;\n                            var d = {\n                                value: c,\n                                configurable: !0,\n                                enumerable: !1,\n                                writable: !0\n                            };\n                            return C.defineProperty(a, b, d), a;\n                        }\n                        function n(a) {\n                            throw a;\n                        }\n                        function o(a) {\n                            try {\n                                if ("function" == typeof a) {\n                                    var b = C.names(a.prototype), c = C.isES5 && b.length > 1, d = b.length > 0 && !(1 === b.length && "constructor" === b[0]), e = J.test(a + "") && C.names(a).length > 0;\n                                    if (c || d || e) return !0;\n                                }\n                                return !1;\n                            } catch (a) {\n                                return !1;\n                            }\n                        }\n                        function p(a) {\n                            function b() {}\n                            b.prototype = a;\n                            for (var c = 8; c--; ) new b();\n                            return a;\n                        }\n                        function q(a) {\n                            return K.test(a);\n                        }\n                        function r(a, b, c) {\n                            for (var d = new Array(a), e = 0; e < a; ++e) d[e] = b + e + c;\n                            return d;\n                        }\n                        function s(a) {\n                            try {\n                                return a + "";\n                            } catch (a) {\n                                return "[no string representation]";\n                            }\n                        }\n                        function t(a) {\n                            return a instanceof Error || null !== a && "object" == typeof a && "string" == typeof a.message && "string" == typeof a.name;\n                        }\n                        function u(a) {\n                            try {\n                                m(a, "isOperational", !0);\n                            } catch (a) {}\n                        }\n                        function v(a) {\n                            return null != a && (a instanceof Error.__BluebirdErrorTypes__.OperationalError || !0 === a.isOperational);\n                        }\n                        function w(a) {\n                            return t(a) && C.propertyIsWritable(a, "stack");\n                        }\n                        function x(a) {\n                            return {}.toString.call(a);\n                        }\n                        function y(a, b, c) {\n                            for (var d = C.names(a), e = 0; e < d.length; ++e) {\n                                var f = d[e];\n                                if (c(f)) try {\n                                    C.defineProperty(b, f, C.getDescriptor(a, f));\n                                } catch (a) {}\n                            }\n                        }\n                        function z(b) {\n                            return P ? a.env[b] : void 0;\n                        }\n                        function A() {\n                            if ("function" == typeof Promise) try {\n                                var a = new Promise(function() {});\n                                if ("[object Promise]" === {}.toString.call(a)) return Promise;\n                            } catch (a) {}\n                        }\n                        function B(a, b) {\n                            return a.bind(b);\n                        }\n                        var C = b("./es5"), D = "undefined" == typeof navigator, E = {\n                            e: {}\n                        }, F, G = "undefined" != typeof self ? self : "undefined" != typeof window ? window : void 0 !== d ? d : void 0 !== this ? this : null, H = function(a, b) {\n                            function c() {\n                                this.constructor = a, this.constructor$ = b;\n                                for (var c in b.prototype) d.call(b.prototype, c) && "$" !== c.charAt(c.length - 1) && (this[c + "$"] = b.prototype[c]);\n                            }\n                            var d = {}.hasOwnProperty;\n                            return c.prototype = b.prototype, a.prototype = new c(), a.prototype;\n                        }, I = function() {\n                            var a = [ Array.prototype, Object.prototype, Function.prototype ], b = function(b) {\n                                for (var c = 0; c < a.length; ++c) if (a[c] === b) return !0;\n                                return !1;\n                            };\n                            if (C.isES5) {\n                                var c = Object.getOwnPropertyNames;\n                                return function(a) {\n                                    for (var d = [], e = Object.create(null); null != a && !b(a); ) {\n                                        var f;\n                                        try {\n                                            f = c(a);\n                                        } catch (a) {\n                                            return d;\n                                        }\n                                        for (var g = 0; g < f.length; ++g) {\n                                            var h = f[g];\n                                            if (!e[h]) {\n                                                e[h] = !0;\n                                                var i = Object.getOwnPropertyDescriptor(a, h);\n                                                null != i && null == i.get && null == i.set && d.push(h);\n                                            }\n                                        }\n                                        a = C.getPrototypeOf(a);\n                                    }\n                                    return d;\n                                };\n                            }\n                            var d = {}.hasOwnProperty;\n                            return function(c) {\n                                if (b(c)) return [];\n                                var e = [];\n                                a: for (var f in c) if (d.call(c, f)) e.push(f); else {\n                                    for (var g = 0; g < a.length; ++g) if (d.call(a[g], f)) continue a;\n                                    e.push(f);\n                                }\n                                return e;\n                            };\n                        }(), J = /this\\s*\\.\\s*\\S+\\s*=/, K = /^[a-z$_][a-z$_0-9]*$/i, L = function() {\n                            return "stack" in new Error() ? function(a) {\n                                return w(a) ? a : new Error(s(a));\n                            } : function(a) {\n                                if (w(a)) return a;\n                                try {\n                                    throw new Error(s(a));\n                                } catch (a) {\n                                    return a;\n                                }\n                            };\n                        }(), M = function(a) {\n                            return C.isArray(a) ? a : null;\n                        };\n                        if ("undefined" != typeof Symbol && Symbol.iterator) {\n                            var N = "function" == typeof Array.from ? function(a) {\n                                return Array.from(a);\n                            } : function(a) {\n                                for (var b, c = [], d = a[Symbol.iterator](); !(b = d.next()).done; ) c.push(b.value);\n                                return c;\n                            };\n                            M = function(a) {\n                                return C.isArray(a) ? a : null != a && "function" == typeof a[Symbol.iterator] ? N(a) : null;\n                            };\n                        }\n                        var O = void 0 !== a && "[object process]" === x(a).toLowerCase(), P = void 0 !== a && void 0 !== a.env, Q = {\n                            isClass: o,\n                            isIdentifier: q,\n                            inheritedDataKeys: I,\n                            getDataPropertyOrDefault: l,\n                            thrower: n,\n                            isArray: C.isArray,\n                            asArray: M,\n                            notEnumerableProp: m,\n                            isPrimitive: h,\n                            isObject: i,\n                            isError: t,\n                            canEvaluate: D,\n                            errorObj: E,\n                            tryCatch: g,\n                            inherits: H,\n                            withAppended: k,\n                            maybeWrapAsError: j,\n                            toFastProperties: p,\n                            filledRange: r,\n                            toString: s,\n                            canAttachTrace: w,\n                            ensureErrorObject: L,\n                            originatesFromRejection: v,\n                            markAsOriginatingFromRejection: u,\n                            classString: x,\n                            copyDescriptors: y,\n                            hasDevTools: "undefined" != typeof chrome && chrome && "function" == typeof chrome.loadTimes,\n                            isNode: O,\n                            hasEnvVariables: P,\n                            env: z,\n                            global: G,\n                            getNativePromise: A,\n                            domainBind: B\n                        };\n                        Q.isRecentNode = Q.isNode && function() {\n                            var b = a.versions.node.split(".").map(Number);\n                            return 0 === b[0] && b[1] > 10 || b[0] > 0;\n                        }(), Q.isNode && Q.toFastProperties(a);\n                        try {\n                            throw new Error();\n                        } catch (a) {\n                            Q.lastLineError = a;\n                        }\n                        c.exports = Q;\n                    }, {\n                        "./es5": 13\n                    } ]\n                }, {}, [ 4 ])(4);\n            }), "undefined" != typeof window && null !== window ? window.P = window.Promise : "undefined" != typeof self && null !== self && (self.P = self.Promise);\n        }).call(this, a("_process"), "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {}, a("timers").setImmediate);\n    }, {\n        _process: 15,\n        timers: 16\n    } ],\n    2: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.PreCallTest = void 0;\n        var e = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), f = a("./turnConnection"), g = a("./tests/rttTest"), h = a("./tests/throughputTest"), i = a("./utility/resultsHandler"), j = a("./utility/onlineCheck"), k = a("./utility/stats/detectbrowser"), l = a("bluebird"), m = {\n            RTT: "rtt",\n            THROUGHPUT: "throughput"\n        }, n = function() {\n            function a() {\n                d(this, a), this.browserInfo = (0, k.detect)(), this.onlineCheck = new j.OnlineCheck(), \n                this.callsInProgress = 0, this.turnTests = [ m.RTT, m.THROUGHPUT ], this.active = !1, \n                this.rtt = null, this.resultsHandler = null;\n            }\n            return e(a, [ {\n                key: "start",\n                value: function(a, b, c) {\n                    if (this.browserInfo.browserName !== k.Constants.browserName.msie) if (this.iceServers = a, \n                    this.callback = c, this.active) this.callback && this.callback(null, "Not started: already in progress"); else if (0 < this.callsInProgress) this.callback && this.callback(null, "Not started: call in progress"); else if (a) {\n                        this.turnTestCounter = 0, this.resultsHandler = new i.ResultsHandler(), this.resultsHandler.setProvider(b);\n                        var d = {\n                            type: "browser",\n                            os: this.browserInfo.os,\n                            osVersion: this.browserInfo.osVersion,\n                            buildName: this.browserInfo.browserName,\n                            buildVersion: this.browserInfo.browserVersion\n                        };\n                        this.resultsHandler.add("endpointInfo", d), this.onlineCheck.start(), this.active = !0, \n                        this._start();\n                    } else this.callback && this.callback(null, "Not started: no ICE servers given"); else this.callback && this.callback(null, "Not started: disabled for IE");\n                }\n            }, {\n                key: "_start",\n                value: function() {\n                    var a = this;\n                    this.active && (this.turnConnection = new f.TurnConnection(this.browserInfo), this.turnConnection.connect(this.iceServers).then(function() {\n                        a.active ? a.startTurnTests().then(function() {\n                            a.stop();\n                        }, function(b) {\n                            a.stop();\n                        }) : a.stop();\n                    }, function(b) {\n                        var c = b.continueFlag;\n                        if (a.resultsHandler.failure(b), !c) {\n                            a.turnConnection.disconnect(), a.active = !1;\n                            var d = "";\n                            try {\n                                d = b.stack;\n                            } catch (c) {\n                                d = b.toString();\n                            }\n                            return d && "" !== d || (d = b.toString()), void a.callback(null, d);\n                        }\n                        a.resultsHandler.getFailureNumber() >= 10 ? a.stop() : (a.turnConnection.disconnect(), \n                        setTimeout(function() {\n                            a._start();\n                        }, 0));\n                    }));\n                }\n            }, {\n                key: "stop",\n                value: function() {\n                    var a = this;\n                    if (this.browserInfo.browserName !== k.Constants.browserName.msie && this.active) {\n                        this.active = !1, this.activeTurnTest && this.activeTurnTest.forceStop();\n                        var b = this.onlineCheck.stop();\n                        this.resultsHandler && this.resultsHandler.add("onlineStatus", b), this.turnConnection.getIceResults().then(function(b) {\n                            a.resultsHandler && a.resultsHandler.add("ice", b), a.turnConnection.disconnect(), \n                            a.sendResults();\n                        }, function(b) {\n                            a.resultsHandler && a.resultsHandler.failure(b), a.turnConnection.disconnect(), \n                            a.sendResults();\n                        });\n                    }\n                }\n            }, {\n                key: "sendResults",\n                value: function() {\n                    if (this.resultsHandler) {\n                        var a = this.resultsHandler.getResults();\n                        this.resultsHandler = null, this.callback && this.callback(a, null);\n                    } else this.callback && this.callback(null, "No results present");\n                }\n            }, {\n                key: "callStarts",\n                value: function() {\n                    this.callsInProgress += 1, this.stop();\n                }\n            }, {\n                key: "callFinished",\n                value: function() {\n                    this.callsInProgress -= 1;\n                }\n            }, {\n                key: "getId",\n                value: function() {\n                    return this.resultsHandler ? this.resultsHandler.getId() : null;\n                }\n            }, {\n                key: "crashDisconnect",\n                value: function() {\n                    try {\n                        this.turnConnection.disconnect();\n                    } catch (a) {}\n                }\n            }, {\n                key: "startTurnTests",\n                value: function() {\n                    var a = this;\n                    if (this.turnTestCounter >= this.turnTests.length) return new l(function(a, b) {\n                        a();\n                    });\n                    var b = this.turnTests[this.turnTestCounter], c = null;\n                    switch (b) {\n                      case m.RTT:\n                        c = new g.RttTest(this.turnConnection);\n                        break;\n\n                      case m.THROUGHPUT:\n                        c = new h.ThroughputTest(this.turnConnection, this.rtt);\n                        break;\n\n                      default:\n                        return new l(function(a, c) {\n                            c(new Error("Unknown test: " + b));\n                        });\n                    }\n                    return this.activeTurnTest = c, this.active ? c.start().then(function() {\n                        return a.handleTestResults(b, c.getResults()), a.turnTestCounter += 1, a.activeTurnTest = null, \n                        a.startTurnTests();\n                    }, function(d) {\n                        return a.handleTestResults(b, c.getResults(), d), a.turnTestCounter += 1, a.activeTurnTest = null, \n                        a.startTurnTests();\n                    }) : new l(function(a, b) {\n                        b(new Error("Test trying to start while testing is not active"));\n                    });\n                }\n            }, {\n                key: "handleTestResults",\n                value: function(a, b) {\n                    null == (2 < arguments.length && void 0 !== arguments[2] ? arguments[2] : null) && a == m.RTT && (this.rtt = b.median), \n                    this.resultsHandler && this.resultsHandler.add(a, b);\n                }\n            } ]), a;\n        }();\n        c.PreCallTest = n;\n    }, {\n        "./tests/rttTest": 3,\n        "./tests/throughputTest": 4,\n        "./turnConnection": 6,\n        "./utility/onlineCheck": 8,\n        "./utility/resultsHandler": 10,\n        "./utility/stats/detectbrowser": 11,\n        bluebird: 1\n    } ],\n    3: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        function e(a, b) {\n            if (!a) throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");\n            return !b || "object" != typeof b && "function" != typeof b ? a : b;\n        }\n        function f(a, b) {\n            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);\n            a.prototype = Object.create(b && b.prototype, {\n                constructor: {\n                    value: a,\n                    enumerable: !1,\n                    writable: !0,\n                    configurable: !0\n                }\n            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.RttTest = void 0;\n        var g = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), h = function a(b, c, d) {\n            null === b && (b = Function.prototype);\n            var e = Object.getOwnPropertyDescriptor(b, c);\n            if (void 0 === e) {\n                var f = Object.getPrototypeOf(b);\n                return null === f ? void 0 : a(f, c, d);\n            }\n            if ("value" in e) return e.value;\n            var g = e.get;\n            return void 0 !== g ? g.call(d) : void 0;\n        }, i = a("../utility/timestamps"), j = function(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }(i), k = a("./turnTest"), l = function(a) {\n            function b(a) {\n                d(this, b);\n                var c = e(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, a));\n                return c.sendTimer = null, c.countSent = 0, c.rtts = [], c;\n            }\n            return f(b, k.TurnTest), g(b, [ {\n                key: "initiate",\n                value: function() {\n                    this.results.startTimestamp = j.getCurrent(), this.sendPing();\n                }\n            }, {\n                key: "handleMessage",\n                value: function(a) {\n                    if (this.isActive()) {\n                        var b = parseInt(a, 10), c = this.calculateRtt(b);\n                        this.rtts.push(c), this.countSent < 10 ? this.sendPing() : this.calculateMetrics();\n                    }\n                }\n            }, {\n                key: "handleError",\n                value: function(a) {\n                    this.fillResults(), this.failed(a);\n                }\n            }, {\n                key: "sendPing",\n                value: function() {\n                    if (this.isActive()) {\n                        var a = j.getCurrent();\n                        this.send(a.toString()), this.countSent += 1, this.sendTimer && (clearTimeout(this.sendTimer), \n                        this.sendTimer = null), this.countSent < 10 ? this.sendTimer = setTimeout(this.sendPing.bind(this), 100) : this.sendTimer = setTimeout(this.calculateMetrics.bind(this), 500);\n                    }\n                }\n            }, {\n                key: "calculateRtt",\n                value: function(a) {\n                    return j.getCurrent() - a;\n                }\n            }, {\n                key: "calculateMetrics",\n                value: function() {\n                    this.sendTimer && (clearTimeout(this.sendTimer), this.sendTimer = null), this.fillResults(), \n                    this.finished();\n                }\n            }, {\n                key: "fillResults",\n                value: function() {\n                    this.results.sentMessages = this.countSent, this.results.unAckedMessages = this.countSent - this.rtts.length, \n                    this.results.maxMessages = 10, this.results.forceStopped = this.forceStopped, this.results.median = this.median(), \n                    this.results.average = this.average(), this.results.variance = this.variance(), \n                    this.results.endTimestamp = j.getCurrent();\n                }\n            }, {\n                key: "median",\n                value: function() {\n                    if (0 == this.rtts.length) return null;\n                    this.rtts.sort();\n                    var a = Math.floor(this.rtts.length / 2);\n                    return this.rtts[a];\n                }\n            }, {\n                key: "average",\n                value: function() {\n                    if (0 == this.rtts.length) return null;\n                    for (var a = 0, b = 0; b < this.rtts.length; b++) a += this.rtts[b];\n                    return a / this.rtts.length;\n                }\n            }, {\n                key: "variance",\n                value: function() {\n                    if (0 == this.rtts.length) return null;\n                    for (var a = 0, b = this.average(), c = 0; c < this.rtts.length; c++) {\n                        var d = this.rtts[c];\n                        a += Math.pow(d - b, 2);\n                    }\n                    return a /= this.rtts.length;\n                }\n            }, {\n                key: "stop",\n                value: function() {\n                    this.isActive() && (h(b.prototype.__proto__ || Object.getPrototypeOf(b.prototype), "stop", this).call(this), \n                    this.fillResults());\n                }\n            } ]), b;\n        }();\n        c.RttTest = l;\n    }, {\n        "../utility/timestamps": 14,\n        "./turnTest": 5\n    } ],\n    4: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        function e(a, b) {\n            if (!a) throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");\n            return !b || "object" != typeof b && "function" != typeof b ? a : b;\n        }\n        function f(a, b) {\n            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);\n            a.prototype = Object.create(b && b.prototype, {\n                constructor: {\n                    value: a,\n                    enumerable: !1,\n                    writable: !0,\n                    configurable: !0\n                }\n            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.ThroughputTest = void 0;\n        var g = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), h = function a(b, c, d) {\n            null === b && (b = Function.prototype);\n            var e = Object.getOwnPropertyDescriptor(b, c);\n            if (void 0 === e) {\n                var f = Object.getPrototypeOf(b);\n                return null === f ? void 0 : a(f, c, d);\n            }\n            if ("value" in e) return e.value;\n            var g = e.get;\n            return void 0 !== g ? g.call(d) : void 0;\n        }, i = a("../utility/timestamps"), j = function(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }(i), k = a("../utility/messageMaker"), l = a("./turnTest"), m = function(a) {\n            function b(a, c) {\n                d(this, b);\n                var f = e(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, a));\n                if (f.sentBytes = 0, f.receivedBytes = 0, f.secondHalfBytes = 0, f.secondHalfStart = null, \n                f.bufferEmpty = 0, f.chunkSize = 1200, f.messageMaker = new k.MessageMaker(f.chunkSize), \n                f.duration = 5e3, null != c) {\n                    var g = 50 * c;\n                    f.duration = Math.max(Math.min(g, 1e4), 1e3);\n                }\n                return f.sendTimer = null, f.lastMessage = null, f.intervals = [], f.intervalStart = 0, \n                f.intervalLength = 100, f.intervalBytes = 0, f;\n            }\n            return f(b, l.TurnTest), g(b, [ {\n                key: "initiate",\n                value: function() {\n                    if (window && window.csioReactNative) {\n                        this.handleError(new Error("Not running throughput test for react-native"));\n                    } else this.startSend();\n                }\n            }, {\n                key: "handleMessage",\n                value: function(a) {\n                    var b = this;\n                    if (this.isActive()) {\n                        this.lastMessage = a, this.receivedBytes += a.length;\n                        var c = j.getCurrent();\n                        if (this.sendTimer || (this.results.startTimestamp = c, this.sendTimer = setTimeout(function() {\n                            b.stop(), b.finished();\n                        }, this.duration)), 0 == this.intervalStart && (this.intervalStart = c), this.intervalBytes += a.length, \n                        c - this.intervalStart >= this.intervalLength) {\n                            var d = c - this.intervalStart, e = this.averageThroughput(this.intervalBytes, d), f = null;\n                            try {\n                                f = c - JSON.parse(this.lastMessage).timestamp;\n                            } catch (a) {}\n                            this.intervals.push({\n                                startTimestamp: this.intervalStart,\n                                endTimestamp: c,\n                                bytesReceived: this.intervalBytes,\n                                average: e,\n                                rtt: f\n                            }), this.intervalStart = c, this.intervalBytes = 0;\n                        }\n                        this.results.startTimestamp && c - this.results.startTimestamp > this.duration / 2 && (this.secondHalfStart || (this.secondHalfStart = c), \n                        this.secondHalfBytes += a.length);\n                    }\n                }\n            }, {\n                key: "handleError",\n                value: function(a) {\n                    this.stop(), this.failed(a);\n                }\n            }, {\n                key: "averageThroughput",\n                value: function(a, b) {\n                    return a / (b / 1e3) * 8 / 1024;\n                }\n            }, {\n                key: "bufferListener",\n                value: function() {\n                    this.sendChannel.removeEventListener("bufferedamountlow", this.bufferListener.bind(this)), \n                    this.fillBuffer();\n                }\n            }, {\n                key: "fillBuffer",\n                value: function() {\n                    for (0 == this.sendChannel.bufferedAmount && (this.bufferEmpty += 1); this.isActive(); ) {\n                        if (this.sendChannel.bufferedAmount > this.bufferFullThreshold) return void (this.usePolling ? setTimeout(this.fillBuffer.bind(this), 250) : this.sendChannel.addEventListener("bufferedamountlow", this.bufferListener.bind(this)));\n                        var a = this.messageMaker.make(this.sentBytes);\n                        this.sentBytes += a.length, this.send(a);\n                    }\n                    this.sendChannel.removeEventListener("bufferedamountlow", this.bufferListener.bind(this));\n                }\n            }, {\n                key: "startSend",\n                value: function() {\n                    this.isActive() && (this.bufferFullThreshold = 1e3 * this.chunkSize, this.sendChannel = this.connection.sendChannel, \n                    this.usePolling = !0, "number" == typeof this.sendChannel.bufferedAmountLowThreshold && (this.usePolling = !1, \n                    this.sendChannel.bufferedAmountLowThreshold = this.bufferFullThreshold / 10), setTimeout(this.fillBuffer.bind(this), 0));\n                }\n            }, {\n                key: "fillResults",\n                value: function() {\n                    this.results.endTimestamp = j.getCurrent(), this.results.maxDuration = this.duration, \n                    this.results.forceStopped = this.forceStopped, this.results.bufferEmpty = this.bufferEmpty, \n                    this.results.intervals = this.intervals, this.results.bytesPrepared = this.sentBytes, \n                    this.results.bytesReceived = this.receivedBytes;\n                    var a = 0, b = 0;\n                    this.secondHalfStart && (a = this.results.endTimestamp - this.secondHalfStart, b = this.averageThroughput(this.secondHalfBytes, a));\n                    var c = this.results.endTimestamp - this.results.startTimestamp, d = this.averageThroughput(this.receivedBytes, c);\n                    b < d && (b = d), this.results.average = b;\n                    var e = null;\n                    try {\n                        e = JSON.parse(this.lastMessage);\n                    } catch (a) {\n                        return;\n                    }\n                    if (e) {\n                        var f = e.sentBytes + this.lastMessage.length;\n                        this.results.bytesSent = f, this.results.fractionLostBytes = 1 - this.receivedBytes / f;\n                    } else this.results.bytesSent = -1, this.results.fractionLostBytes = -1;\n                }\n            }, {\n                key: "stop",\n                value: function() {\n                    this.isActive() && (clearTimeout(this.sendTimer), this.sendTimer = null, h(b.prototype.__proto__ || Object.getPrototypeOf(b.prototype), "stop", this).call(this), \n                    this.fillResults());\n                }\n            } ]), b;\n        }();\n        c.ThroughputTest = m;\n    }, {\n        "../utility/messageMaker": 7,\n        "../utility/timestamps": 14,\n        "./turnTest": 5\n    } ],\n    5: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        });\n        var e = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), f = a("bluebird"), g = function() {\n            function a(b) {\n                d(this, a), this.connection = b, this.active = !1, this.results = {};\n            }\n            return e(a, [ {\n                key: "getResults",\n                value: function() {\n                    return this.results;\n                }\n            }, {\n                key: "start",\n                value: function() {\n                    var a = this, b = new f(function(b, c) {\n                        a.resolveCb = b, a.rejectCb = c;\n                    });\n                    return this.connection.setMessageCallback(this.handleMessage.bind(this)), this.connection.setErrorCallback(this.handleError.bind(this)), \n                    this.active = !0, this.forceStopped = !1, this.initiate(), b;\n                }\n            }, {\n                key: "stop",\n                value: function() {\n                    this.active = !1;\n                }\n            }, {\n                key: "forceStop",\n                value: function() {\n                    this.forceStopped = !0, this.stop(), this.finished();\n                }\n            }, {\n                key: "isActive",\n                value: function() {\n                    return this.active;\n                }\n            }, {\n                key: "initiate",\n                value: function() {}\n            }, {\n                key: "handleMessage",\n                value: function(a) {}\n            }, {\n                key: "handleError",\n                value: function(a) {}\n            }, {\n                key: "send",\n                value: function(a) {\n                    this.connection.send(a);\n                }\n            }, {\n                key: "finished",\n                value: function() {\n                    this.active = !1, this.resolveCb && (this.resolveCb(), this.resolveCb = null);\n                }\n            }, {\n                key: "failed",\n                value: function(a) {\n                    this.active = !1, this.rejectCb && (this.rejectCb(a), this.rejectCb = null);\n                }\n            } ]), a;\n        }();\n        c.TurnTest = g;\n    }, {\n        bluebird: 1\n    } ],\n    6: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.TurnConnection = void 0;\n        var e = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), f = a("./utility/parsedIceCandidate"), g = a("./utility/stats/getstatshandler"), h = a("./utility/stats/detectbrowser"), i = a("bluebird"), j = function() {\n            function a(b) {\n                d(this, a), this.reset(), this.statshandler = new g.GetStatsHandler(b);\n            }\n            return e(a, [ {\n                key: "reset",\n                value: function() {\n                    this.disconnect(), this.iceServers = null, this.pctpc1 = null, this.pctpc2 = null, \n                    this.sendChannel = null, this.messageCallback = null, this.errorCallback = null, \n                    this.parsedIceResults = {}, this.resolveCb = null, this.rejectCb = null;\n                }\n            }, {\n                key: "setMessageCallback",\n                value: function(a) {\n                    this.messageCallback = a;\n                }\n            }, {\n                key: "setErrorCallback",\n                value: function(a) {\n                    this.errorCallback = a;\n                }\n            }, {\n                key: "send",\n                value: function(a) {\n                    if (this.sendChannel) try {\n                        this.sendChannel.send(a);\n                    } catch (a) {\n                        this.raiseSendError(a);\n                    } else this.raiseSendError(new Error("No send channel"));\n                }\n            }, {\n                key: "raiseSendError",\n                value: function(a) {\n                    this.errorCallback && this.errorCallback(a);\n                }\n            }, {\n                key: "assignEvent",\n                value: function(a, b, c) {\n                    a.addEventListener ? a.addEventListener(b, c.bind(this), !1) : a.attachEvent && (b = "on" + b, \n                    a.attachEvent(b, c.bind(this)));\n                }\n            }, {\n                key: "connect",\n                value: function(a) {\n                    var b = this;\n                    this.reset();\n                    var c = new i(function(a, c) {\n                        b.resolveCb = a, b.rejectCb = c;\n                    });\n                    this.iceServers = a;\n                    var d = null;\n                    try {\n                        if (RTCPeerConnection ? d = RTCPeerConnection : webkitRTCPeerConnection ? d = webkitRTCPeerConnection : mozRTCPeerConnection ? d = mozRTCPeerConnection : window && window.RTCPeerConnection && (d = window.RTCPeerConnection), \n                        !d) {\n                            var e = new Error("RTCPeerConnection not found");\n                            return e.continueFlag = !1, this.rejectCb(e), c;\n                        }\n                    } catch (e) {\n                        return e.continueFlag = !1, this.rejectCb(e), c;\n                    }\n                    var f = {\n                        iceTransportPolicy: "all",\n                        iceServers: this.iceServers\n                    };\n                    try {\n                        this.pctpc1 = new d(f), this.pctpc2 = new d(f);\n                    } catch (e) {\n                        return this.rejectDisconnect(!1, e), c;\n                    }\n                    this.connectionTimer = setTimeout(function() {\n                        delete b.connectionTimer, b.rejectDisconnect(!1, new Error("Connection timeout"));\n                    }, 3e4);\n                    try {\n                        this.sendChannel = this.pctpc1.createDataChannel("precalltest", {\n                            ordered: !1,\n                            maxRetransmits: 0\n                        }), this.sendChannel.binaryType = "arraybuffer", this.assignEvent(this.sendChannel, "error", function(a) {\n                            b.raiseSendError(a), b.rejectDisconnect(!0, a);\n                        }), this.assignEvent(this.pctpc2, "datachannel", function(a) {\n                            var c = a.channel;\n                            b.assignEvent(c, "open", function(a) {\n                                b.resolveCb && (b.resolveCb(), b.resolveCb = null);\n                            }), b.assignEvent(c, "close", function(a) {\n                                b && b.disconnect && b.disconnect();\n                            }), b.assignEvent(c, "message", function(a) {\n                                b.messageCallback && b.messageCallback(a.data);\n                            }), b.assignEvent(c, "error", function(a) {\n                                b.errorCallback && b.errorCallback(a), b.rejectDisconnect(!0, a);\n                            });\n                        });\n                    } catch (e) {\n                        return this.rejectDisconnect(!1, e), c;\n                    }\n                    try {\n                        this.assignEvent(this.pctpc1, "icecandidate", function(a) {\n                            b.onIceCandidate(b.pctpc1, a);\n                        }), this.assignEvent(this.pctpc1, "iceconnectionstatechange", function(a) {\n                            b.onIceStateChange(b.pctpc1, a);\n                        }), this.assignEvent(this.pctpc2, "icecandidate", function(a) {\n                            b.onIceCandidate(b.pctpc2, a);\n                        }), this.assignEvent(this.pctpc2, "iceconnectionstatechange", function(a) {\n                            b.onIceStateChange(b.pctpc2, a);\n                        }), this.pctpc1.createOffer().then(function(a, c) {\n                            b.onCreateOfferSuccess(a);\n                        }, function(a) {\n                            b.onCreateOfferError(b.pctpc1, a);\n                        });\n                    } catch (e) {\n                        return this.rejectDisconnect(!1, e), c;\n                    }\n                    return c;\n                }\n            }, {\n                key: "rejectDisconnect",\n                value: function(a, b) {\n                    this.disconnect(), this.rejectCb && (b.continueFlag = a, this.rejectCb(b)), this.resolveCb = null, \n                    this.rejectCb = null;\n                }\n            }, {\n                key: "disconnect",\n                value: function() {\n                    if (clearTimeout(this.connectionTimer), clearTimeout(this.iceTimer), this.pctpc1) try {\n                        this.pctpc1.close();\n                    } catch (a) {}\n                    if (this.pctpc1 = null, this.pctpc2) try {\n                        this.pctpc2.close();\n                    } catch (a) {}\n                    this.pctpc2 = null;\n                }\n            }, {\n                key: "getName",\n                value: function(a) {\n                    return a === this.pctpc1 ? "pctpc1" : "pctpc2";\n                }\n            }, {\n                key: "getOtherPc",\n                value: function(a) {\n                    return a === this.pctpc1 ? this.pctpc2 : this.pctpc1;\n                }\n            }, {\n                key: "onCreateOfferError",\n                value: function(a, b) {\n                    this.rejectDisconnect(!1, b);\n                }\n            }, {\n                key: "onCreateAnswerError",\n                value: function(a, b) {\n                    this.rejectDisconnect(!1, b);\n                }\n            }, {\n                key: "onCreateOfferSuccess",\n                value: function(a) {\n                    var b = this;\n                    try {\n                        this.pctpc1.setLocalDescription(a).then(function() {\n                            b.onSetLocalSuccess(b.pctpc1);\n                        }, function(a) {\n                            b.onSetSessionDescriptionError(b.pctpc1, a);\n                        }), this.pctpc2.setRemoteDescription(a).then(function() {\n                            b.onSetRemoteSuccess(b.pctpc2);\n                        }, function(a) {\n                            b.onSetRemoteSessionDescriptionError(b.pctpc2, a);\n                        }), this.pctpc2.createAnswer().then(function(a) {\n                            b.onCreateAnswerSuccess(a);\n                        }, function(a) {\n                            b.onCreateAnswerError(b.pctpc2, a);\n                        });\n                    } catch (a) {\n                        this.rejectDisconnect(!1, a);\n                    }\n                }\n            }, {\n                key: "onSetLocalSuccess",\n                value: function(a) {}\n            }, {\n                key: "onSetRemoteSuccess",\n                value: function(a) {}\n            }, {\n                key: "onSetSessionDescriptionError",\n                value: function(a, b) {\n                    this.rejectDisconnect(!1, b);\n                }\n            }, {\n                key: "onSetRemoteSessionDescriptionError",\n                value: function(a, b) {\n                    this.rejectDisconnect(!1, b);\n                }\n            }, {\n                key: "onCreateAnswerSuccess",\n                value: function(a) {\n                    var b = this;\n                    try {\n                        this.pctpc2.setLocalDescription(a).then(function() {\n                            b.onSetLocalSuccess(b.pctpc2);\n                        }, function(a) {\n                            b.onSetSessionDescriptionError(b.pctpc2, a);\n                        }), this.pctpc1.setRemoteDescription(a).then(function() {\n                            b.onSetRemoteSuccess(b.pctpc1);\n                        }, function(a) {\n                            b.onSetRemoteSessionDescriptionError(b.pctpc1, a);\n                        });\n                    } catch (a) {\n                        this.rejectDisconnect(!1, a);\n                    }\n                }\n            }, {\n                key: "onIceCandidate",\n                value: function(a, b) {\n                    var c = this;\n                    try {\n                        if (!b.candidate) return;\n                        var d = new f.ParsedIceCandidate(b.candidate);\n                        if (a == this.pctpc1 && this.statshandler.codeBase == h.Constants.codeBaseType.chrome && (d.isRelay() && (d.isTypeTransportUdp() && (this.parsedIceResults.relayUdpGathered = !0), \n                        d.isTypeTransportTcp() && (this.parsedIceResults.relayTcpGathered = !0), d.isTypeTransportTls() && (this.parsedIceResults.relayTlsGathered = !0)), \n                        d.isServerReflexive() && (this.parsedIceResults.srflxGathered = !0)), !d.isRelay()) return;\n                        this.getOtherPc(a).addIceCandidate(b.candidate).then(function() {\n                            c.onAddIceCandidateSuccess(a);\n                        }, function(b) {\n                            c.onAddIceCandidateError(a, b, d.isRelay());\n                        });\n                    } catch (b) {\n                        this.rejectDisconnect(!1, b);\n                    }\n                }\n            }, {\n                key: "onAddIceCandidateSuccess",\n                value: function(a) {}\n            }, {\n                key: "onAddIceCandidateError",\n                value: function(a, b, c) {\n                    c && this.rejectDisconnect(!1, b);\n                }\n            }, {\n                key: "onIceStateChange",\n                value: function(a, b) {\n                    var c = this;\n                    try {\n                        var d = "(?)";\n                        a && (d = a.iceConnectionState), "failed" === d && this.rejectDisconnect(!0, new Error("ICE failure")), \n                        "checking" !== d || this.iceTimer || (this.iceTimer = setTimeout(function() {\n                            delete c.iceTimer, c.rejectDisconnect(!0, new Error("ICE timeout"));\n                        }, 1e4)), "completed" !== d && "connected" !== d || (clearTimeout(this.iceTimer), \n                        delete this.iceTimer);\n                    } catch (a) {\n                        this.rejectDisconnect(!1, a);\n                    }\n                }\n            }, {\n                key: "getIceResults",\n                value: function() {\n                    var a = this;\n                    return new i(function(b, c) {\n                        for (var d = JSON.parse(JSON.stringify(a.iceServers)), e = 0; e < d.length; e++) {\n                            var f = d[e];\n                            d.hasOwnProperty(f) || delete f.credential;\n                        }\n                        var g = {\n                            turnIpAddress: "",\n                            turnIpVersion: "",\n                            turnTransport: "",\n                            iceServers: d,\n                            ipv6Supported: !1,\n                            ipv4Supported: !1,\n                            relayTlsGathered: !1,\n                            relayTcpGathered: !1,\n                            relayUdpGathered: !1,\n                            srflxGathered: !1,\n                            relayTlsSuccess: !1,\n                            relayTcpSuccess: !1,\n                            relayUdpSuccess: !1,\n                            srflxSuccess: !1\n                        };\n                        for (var h in a.parsedIceResults) a.parsedIceResults.hasOwnProperty(h) && (g[h] = a.parsedIceResults[h]);\n                        a.pctpc1 ? a.statshandler.getIceCandidates(a.pctpc1).then(function(a) {\n                            for (var c = 0; c < a.iceCandidatePairs.length; c++) {\n                                var d = a.iceCandidatePairs[c];\n                                if (d.googActiveConnection || d.selected) for (var e = 0; e < a.localCandidates.length; e++) {\n                                    var f = a.localCandidates[e], h = null;\n                                    if (h = f.ip ? f.ip : f.ipAddress, f.id == d.localCandidateId) {\n                                        var i = -1 !== (g.turnIpAddress = h).indexOf(":");\n                                        g.turnIpVersion = i ? "ipv6" : "ipv4", g.turnTransport = f.mozLocalTransport;\n                                    }\n                                    "relay" !== f.candidateType && "relayed" !== f.candidateType || ("udp" === f.mozLocalTransport && (g.relayUdpSuccess = !0), \n                                    "tcp" === f.mozLocalTransport && (g.relayTcpSuccess = !0), "tls" === f.mozLocalTransport && (g.relayTlsSuccess = !0)), \n                                    -1 !== h.indexOf(":") ? g.ipv6Supported = !0 : g.ipv4Supported = !0;\n                                }\n                            }\n                            for (var j = 0; j < a.localCandidates.length; j++) {\n                                var k = a.localCandidates[j];\n                                "relay" !== k.candidateType && "relayed" !== k.candidateType || ("udp" === k.mozLocalTransport && (g.relayUdpGathered = !0), \n                                "tcp" === k.mozLocalTransport && (g.relayTcpGathered = !0), "tls" === k.mozLocalTransport && (g.relayTlsGathered = !0)), \n                                "srflx" !== k.candidateType && "serverreflexive" !== k.candidateType || (g.srflxGathered = !0);\n                            }\n                            for (var l = 0; l < a.iceCandidatePairs.length; l++) {\n                                var m = a.iceCandidatePairs[l];\n                                if ("succeeded" === m.state) for (var n = 0; n < a.localCandidates.length; n++) {\n                                    var o = a.localCandidates[n];\n                                    o.id == m.localCandidateId && ("relay" !== o.candidateType && "relayed" !== o.candidateType || ("udp" === o.mozLocalTransport && (g.relayUdpSuccess = !0), \n                                    "tcp" === o.mozLocalTransport && (g.relayTcpSuccess = !0), "tls" === o.mozLocalTransport && (g.relayTlsSuccess = !0)), \n                                    "srflx" !== o.candidateType && "serverreflexive" !== o.candidateType || (g.srflxSuccess = !0));\n                                }\n                            }\n                            b(g);\n                        }, function(a) {\n                            c(a);\n                        }) : c(new Error("PC not available for stats"));\n                    }, function(a) {\n                        reject(a);\n                    });\n                }\n            } ]), a;\n        }();\n        c.TurnConnection = j;\n    }, {\n        "./utility/parsedIceCandidate": 9,\n        "./utility/stats/detectbrowser": 11,\n        "./utility/stats/getstatshandler": 12,\n        bluebird: 1\n    } ],\n    7: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        function e(a) {\n            for (var b = "", c = 0; c < a; c++) b += String.fromCharCode(35 + 58 * Math.random());\n            return b;\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.randomAsciiString = c.MessageMaker = void 0;\n        var f = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), g = a("../utility/timestamps"), h = function(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }(g), i = function() {\n            function a() {\n                var b = 0 < arguments.length && void 0 !== arguments[0] ? arguments[0] : 1200;\n                d(this, a), this.message = {\n                    timestamp: "",\n                    sentBytes: 1e4,\n                    padding: ""\n                };\n                var c = e(b - h.getCurrent().toString().length - JSON.stringify(this.message).length);\n                this.message.padding = c;\n            }\n            return f(a, [ {\n                key: "make",\n                value: function(a) {\n                    return this.message.timestamp = h.getCurrent(), this.message.sentBytes = a, JSON.stringify(this.message);\n                }\n            } ]), a;\n        }();\n        c.MessageMaker = i, c.randomAsciiString = e;\n    }, {\n        "../utility/timestamps": 14\n    } ],\n    8: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.OnlineCheck = void 0;\n        var e = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), f = a("./timestamps"), g = function(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }(f), h = function() {\n            function a() {\n                d(this, a), this.active = !1;\n            }\n            return e(a, [ {\n                key: "start",\n                value: function() {\n                    var a = this;\n                    this.active = !0, this.onlineCheck = [], window && window.addEventListener && "function" == typeof window.addEventListener && (window.addEventListener("offline", function() {\n                        a.addEntry();\n                    }), window.addEventListener("online", function() {\n                        a.addEntry();\n                    }), this.addEntry());\n                }\n            }, {\n                key: "addEntry",\n                value: function() {\n                    if (this.active) {\n                        var a = g.getCurrent();\n                        if (navigator && navigator.onLine) {\n                            var b = navigator.onLine;\n                            this.onlineCheck.push({\n                                timestamp: a,\n                                online: b\n                            });\n                        }\n                    }\n                }\n            }, {\n                key: "stop",\n                value: function() {\n                    var a = this;\n                    return this.active = !1, window && window.removeEventListener && "function" == typeof window.removeEventListener && (window.removeEventListener("offline", function() {\n                        a.addEntry();\n                    }), window.removeEventListener("online", function() {\n                        a.addEntry();\n                    })), this.onlineCheck;\n                }\n            } ]), a;\n        }();\n        c.OnlineCheck = h;\n    }, {\n        "./timestamps": 14\n    } ],\n    9: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        });\n        var e = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), f = function() {\n            function a(b) {\n                d(this, a), this.iceCandidateStr = b.candidate, this.parse();\n            }\n            return e(a, [ {\n                key: "parse",\n                value: function() {\n                    var a = this.iceCandidateStr.split(" ");\n                    a.length < 8 || (this.protocol = "1" === a[1] ? "rtp" : "rtcp", this.transport = a[2], \n                    this.typeTransport = this.extractTypeTransport(a[3]), this.ipv6 = -1 !== a[4].indexOf(":"), \n                    this.ipAddress = a[4], this.port = a[5], this.type = a[7]);\n                }\n            }, {\n                key: "extractTypeTransport",\n                value: function(a) {\n                    var b = "None", c = a >> 24;\n                    if ("rtp" === this.protocol && 0 <= c && c <= 2) switch (c) {\n                      case 0:\n                        b = "TLS";\n                        break;\n\n                      case 1:\n                        b = "TCP";\n                        break;\n\n                      case 2:\n                        b = "UDP";\n                    }\n                    return b;\n                }\n            }, {\n                key: "getString",\n                value: function() {\n                    return this.iceCandidateStr;\n                }\n            }, {\n                key: "getType",\n                value: function() {\n                    return this.type;\n                }\n            }, {\n                key: "isHost",\n                value: function() {\n                    return "host" === this.type.toLowerCase();\n                }\n            }, {\n                key: "isServerReflexive",\n                value: function() {\n                    return "srflx" === this.type.toLowerCase();\n                }\n            }, {\n                key: "isPeerReflexive",\n                value: function() {\n                    return "prflx" === this.type.toLowerCase();\n                }\n            }, {\n                key: "isRelay",\n                value: function() {\n                    return "relay" === this.type.toLowerCase() || "relayed" === this.type.toLowerCase();\n                }\n            }, {\n                key: "getTypeTransport",\n                value: function() {\n                    return this.typeTransport;\n                }\n            }, {\n                key: "isTypeTransportUdp",\n                value: function() {\n                    return "UDP" === this.typeTransport;\n                }\n            }, {\n                key: "isTypeTransportTcp",\n                value: function() {\n                    return "TCP" === this.typeTransport;\n                }\n            }, {\n                key: "isTypeTransportTls",\n                value: function() {\n                    return "TLS" === this.typeTransport;\n                }\n            }, {\n                key: "getTransport",\n                value: function() {\n                    return this.transport;\n                }\n            }, {\n                key: "isUdp",\n                value: function() {\n                    return "udp" === this.transport.toLowerCase();\n                }\n            }, {\n                key: "isTcp",\n                value: function() {\n                    return "tcp" === this.transport.toLowerCase();\n                }\n            }, {\n                key: "getProtocol",\n                value: function() {\n                    return this.protocol;\n                }\n            }, {\n                key: "isRtp",\n                value: function() {\n                    return "rtp" === this.protocol;\n                }\n            }, {\n                key: "isRtcp",\n                value: function() {\n                    return "rtcp" === this.protocol;\n                }\n            }, {\n                key: "isIpv6",\n                value: function() {\n                    return this.ipv6;\n                }\n            }, {\n                key: "getIpAddress",\n                value: function() {\n                    return this.ipAddress;\n                }\n            }, {\n                key: "getPort",\n                value: function() {\n                    return this.port;\n                }\n            } ]), a;\n        }();\n        c.ParsedIceCandidate = f;\n    }, {} ],\n    10: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.ResultsHandler = void 0;\n        var e = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(a) {\n            return typeof a;\n        } : function(a) {\n            return a && "function" == typeof Symbol && a.constructor === Symbol && a !== Symbol.prototype ? "symbol" : typeof a;\n        }, f = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), g = a("./timestamps"), h = function(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }(g), i = a("./messageMaker"), j = function() {\n            function a() {\n                d(this, a), this.start = h.getCurrent(), this.id = Math.trunc(this.start) + "-" + (0, \n                i.randomAsciiString)(20), this.version = "1.3.1", this.failures = [], this.results = {}, \n                this.forceStopped = !0, this.provider = "callstats";\n            }\n            return f(a, [ {\n                key: "setProvider",\n                value: function(a) {\n                    a && (this.provider = a);\n                }\n            }, {\n                key: "getResults",\n                value: function() {\n                    return {\n                        id: this.id,\n                        version: this.version,\n                        forceStopped: this.forceStopped,\n                        startTimestamp: this.start,\n                        endTimestamp: h.getCurrent(),\n                        failures: this.failures,\n                        tests: this.results,\n                        provider: this.provider\n                    };\n                }\n            }, {\n                key: "getFailureNumber",\n                value: function() {\n                    return this.failures.length;\n                }\n            }, {\n                key: "getId",\n                value: function() {\n                    return this.id;\n                }\n            }, {\n                key: "add",\n                value: function(a, b) {\n                    (this.results[a] = b).hasOwnProperty("forceStopped") && (this.forceStopped = b.forceStopped);\n                }\n            }, {\n                key: "failure",\n                value: function(a) {\n                    "object" === (void 0 === a ? "undefined" : e(a)) && (a = a.toString());\n                    var b = {\n                        timestamp: h.getCurrent(),\n                        reason: a\n                    };\n                    this.failures.push(b);\n                }\n            } ]), a;\n        }();\n        c.ResultsHandler = j;\n    }, {\n        "./messageMaker": 7,\n        "./timestamps": 14\n    } ],\n    11: [ function(a, b, c) {\n        "use strict";\n        function d() {\n            var a = e.browserName.chrome, b = null, c = null, d = null, f = null, g = e.codeBaseType.chrome;\n            if (window && (!window.navigator || !window.navigator.userAgent || window.csioReactNative)) return window && window.csioGetOsName && (b = window.csioGetOsName()), \n            window && window.csioGetOsVer && (c = window.csioGetOsVer()), window && window.csioReactNative && (d = "react-native"), \n            {\n                browserName: a,\n                codeBase: g,\n                os: b,\n                osVersion: c,\n                userAgent: d\n            };\n            var h = (d = navigator.userAgent).toLowerCase(), i = void 0, j = void 0;\n            (f = navigator.appVersion) && (i = f.toLowerCase(), j = "" + parseFloat(i));\n            var k = void 0, l = "Version";\n            -1 !== (k = h.indexOf("opera")) ? (a = e.browserName.opera, j = h.substring(k + 6), \n            -1 !== (k = h.indexOf(l)) && (j = h.substring(k + 8)), g = e.codeBaseType.chrome) : -1 !== (k = h.indexOf("opr")) ? (a = e.browserName.opera, \n            j = h.substring(k + 4), -1 !== (k = h.indexOf(l)) && (j = h.substring(k + 8)), g = e.codeBaseType.chrome) : -1 !== (k = h.indexOf("msie")) ? (a = e.browserName.msie, \n            j = h.substring(k + 5), g = e.codeBaseType.chrome) : -1 !== (k = h.indexOf("edge")) ? (a = e.browserName.edge, \n            j = h.substring(k + 5), g = e.codeBaseType.edge) : -1 !== (k = h.indexOf("chrome")) ? (a = e.browserName.chrome, \n            j = h.substring(k + 7), g = e.codeBaseType.chrome) : -1 !== (k = h.indexOf("safari")) ? (a = e.browserName.safari, \n            j = h.substring(k + 7), -1 !== (k = h.indexOf(l)) && (j = h.substring(k + 8)), g = e.codeBaseType.chrome) : -1 !== (k = h.indexOf("firefox")) ? (a = e.browserName.firefox, \n            j = h.substring(k + 8), g = e.codeBaseType.firefox) : -1 !== (k = h.indexOf("trident")) && (a = e.browserName.msie, \n            k = h.indexOf("rv"), j = h.substring(k + 3, k + 7), g = e.codeBaseType.chrome);\n            var m = [ {\n                s: "Windows 3.11",\n                r: /win16/\n            }, {\n                s: "Windows 95",\n                r: /(windows 95|win95|windows_95)/\n            }, {\n                s: "Windows ME",\n                r: /(win 9x 4.90|windows me)/\n            }, {\n                s: "Windows 98",\n                r: /(windows 98|win98)/\n            }, {\n                s: "Windows CE",\n                r: /windows ce/\n            }, {\n                s: "Windows 2000",\n                r: /(windows nt 5.0|windows 2000)/\n            }, {\n                s: "Windows XP",\n                r: /(windows nt 5.1|windows xp)/\n            }, {\n                s: "Windows Server 2003",\n                r: /windows nt 5.2/\n            }, {\n                s: "Windows Vista",\n                r: /windows nt 6.0/\n            }, {\n                s: "Windows 7",\n                r: /(windows 7|windows nt 6.1)/\n            }, {\n                s: "Windows 8.1",\n                r: /(windows 8.1|windows nt 6.3)/\n            }, {\n                s: "Windows 8",\n                r: /(windows 8|windows nt 6.2)/\n            }, {\n                s: "Windows 10",\n                r: /(windows 10|windows nt 10.0)/\n            }, {\n                s: "Windows NT 4.0",\n                r: /(windows nt 4.0|winnt4.0|winnt|windows nt)/\n            }, {\n                s: "Windows ME",\n                r: /windows me/\n            }, {\n                s: "Android",\n                r: /android/\n            }, {\n                s: "Open BSD",\n                r: /openbsd/\n            }, {\n                s: "Sun OS",\n                r: /sunos/\n            }, {\n                s: "Linux",\n                r: /(linux|x11)/\n            }, {\n                s: "iOS",\n                r: /(iphone|ipad|ipod)/\n            }, {\n                s: "Mac OS X",\n                r: /mac os x/\n            }, {\n                s: "Mac OS",\n                r: /(macppc|macintel|mac_powerpc|macintosh)/\n            }, {\n                s: "QNX",\n                r: /qnx/\n            }, {\n                s: "UNIX",\n                r: /unix/\n            }, {\n                s: "BeOS",\n                r: /beos/\n            }, {\n                s: "OS/2",\n                r: /os\\/2/\n            }, {\n                s: "Search Bot",\n                r: /(nuhk|googlebot|yammybot|openbot|slurp|msnbot|ask jeeves\\/teoma|ia_archiver)/\n            } ], n = void 0, o = void 0;\n            for (n in m) if (m.hasOwnProperty(n) && (o = m[n]).r.test(h)) {\n                b = o.s;\n                break;\n            }\n            switch (b && /Windows/.test(b) && (c = /Windows (.*)/.exec(b)[1], b = e.osName.windows), \n            b) {\n              case e.osName.mac:\n                c = /mac os x (10[\\.\\_\\d]+)/.exec(h)[1];\n                break;\n\n              case e.osName.android:\n                c = /android ([\\.\\_\\d]+)/.exec(h)[1];\n                break;\n\n              case e.osName.ios:\n                if (!i) break;\n                if (!(c = /os (\\d+)_(\\d+)_?(\\d+)?/.exec(i))) break;\n                c = c[1] + "." + c[2] + "." + (0 | c[3]);\n            }\n            return {\n                browserName: a,\n                browserVersion: j.toString(),\n                os: b,\n                osVersion: c,\n                codeBase: g,\n                userAgent: d\n            };\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.detect = d;\n        var e = c.Constants = {\n            codeBaseType: {\n                chrome: "Chrome",\n                firefox: "Firefox",\n                edge: "Edge",\n                plugin: "Plugin"\n            },\n            browserName: {\n                chrome: "Chrome",\n                firefox: "Firefox",\n                edge: "Edge",\n                msie: "Microsoft Internet Explorer",\n                safari: "Safari"\n            },\n            osName: {\n                windows: "Windows",\n                mac: "Mac OS X",\n                android: "Android",\n                ios: "iOS"\n            }\n        };\n    }, {} ],\n    12: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.GetStatsHandler = void 0;\n        var e = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), f = a("./detectbrowser"), g = a("./statsadapter"), h = a("bluebird"), i = function() {\n            function a(b) {\n                d(this, a), this.codeBase = b.codeBase, this.browserName = b.browserName, this.adapter = new g.StatsAdapter(this.codeBase, this.browserName), \n                this.isPromiseBased = !0;\n            }\n            return e(a, [ {\n                key: "getIceCandidates",\n                value: function(a) {\n                    var b = this;\n                    return new h(function(c, d) {\n                        b.csioGetStats(b.iceCandidatesHandler.bind(b), a, function(a) {\n                            c(a);\n                        });\n                    });\n                }\n            }, {\n                key: "iceCandidatesHandler",\n                value: function(a, b) {\n                    b(this.adapter.getIceCandidates(a));\n                }\n            }, {\n                key: "csioGetStats",\n                value: function(a, b, c) {\n                    var d = f.Constants.codeBaseType.firefox, e = f.Constants.codeBaseType.chrome, g = f.Constants.codeBaseType.edge, h = f.Constants.browserName.safari;\n                    b && (this.codeBase === d ? this.getStatsFirefox(a, b, c) : this.browserName === h ? this.getStatsSafari(a, b, c) : this.codeBase === e ? this.getStatsChrome(a, b, c) : this.codeBase === g && this.getStatsEdge(a, b, c));\n                }\n            }, {\n                key: "getStatsFirefox",\n                value: function(a, b, c) {\n                    var d = this;\n                    if (d.isPromiseBased) try {\n                        b.getStats().then(function(b) {\n                            a(b, c);\n                        }).catch(function(e) {\n                            d.isPromiseBased = !1, b.getStats(null, function(b) {\n                                a(b, c);\n                            }, function() {});\n                        });\n                    } catch (e) {\n                        d.isPromiseBased = !1, b.getStats(null, function(b) {\n                            a(b, c);\n                        }, function() {});\n                    } else b.getStats(null, function(b) {\n                        a(b, c);\n                    }, function() {});\n                }\n            }, {\n                key: "getStatsChrome",\n                value: function(a, b, c) {\n                    var d = this;\n                    if (window && window.csioReactNative) b.getStats(null, function(b) {\n                        a(b, c);\n                    }, function(a) {}); else if (d.isPromiseBased) try {\n                        b.getStats().then(function(b) {\n                            a(b, c);\n                        }).catch(function(e) {\n                            d.isPromiseBased = !1, b.getStats(function(b) {\n                                a(b, c);\n                            });\n                        });\n                    } catch (d) {\n                        isPromiseBased = !1, b.getStats(function(b) {\n                            a(b, c);\n                        });\n                    } else b.getStats(function(b) {\n                        a(b, c);\n                    });\n                }\n            }, {\n                key: "getStatsEdge",\n                value: function(a, b, c) {\n                    b.getStats().then(function(b) {\n                        a(b, c);\n                    }).catch(function(a) {});\n                }\n            }, {\n                key: "getStatsSafari",\n                value: function(a, b, c) {\n                    b.getStats().then(function(b) {\n                        a(b, c);\n                    }).catch(function(a) {});\n                }\n            } ]), a;\n        }();\n        c.GetStatsHandler = i;\n    }, {\n        "./detectbrowser": 11,\n        "./statsadapter": 13,\n        bluebird: 1\n    } ],\n    13: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.StatsAdapter = void 0;\n        var e = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), f = a("./detectbrowser"), g = function() {\n            function a(b, c) {\n                d(this, a), this.codeBase = b, this.browser = c;\n            }\n            return e(a, [ {\n                key: "getIceCandidates",\n                value: function(a) {\n                    if (!a) return {\n                        localCandidates: [],\n                        remoteCandidates: [],\n                        iceCandidatePairs: []\n                    };\n                    var b = this.extractRawStats(a);\n                    return this.processRawStatsForIceInfo(b);\n                }\n            }, {\n                key: "extractRawStats",\n                value: function(a) {\n                    var b = [], c = void 0, d = f.Constants.codeBaseType.firefox, e = f.Constants.codeBaseType.chrome, g = f.Constants.browserName.safari;\n                    if (this.codeBase === d && this.browser !== g) a.forEach(function(a) {\n                        b.push(a);\n                    }); else if (this.codeBase === e && this.browser !== g) a && a.result ? b = a.result() : a && a.forEach && (b = [], \n                    a.forEach(function(a) {\n                        b.push(a);\n                    })); else for (c in a) a.hasOwnProperty(c) && b.push(a[c]);\n                    return b;\n                }\n            }, {\n                key: "processRawStatsForIceInfo",\n                value: function(a) {\n                    var b = [], c = [], d = [], e = void 0;\n                    if (!a) return {\n                        localCandidates: b,\n                        remoteCandidates: c,\n                        iceCandidatePairs: d\n                    };\n                    for (var f = 0; f < a.length; ++f) {\n                        var g = this.getParsedStats(a[f]), h = this.statsClassifier(g);\n                        if (h.candidatePair) d.push(h.candidatePair); else if (h.transportStats) {\n                            if ("transport" === h.transportStats.type) {\n                                e = h.transportStats.selectedCandidatePairId;\n                                continue;\n                            }\n                            d.push(h.transportStats);\n                        } else if (h.localCandidate) {\n                            var i = h.localCandidate;\n                            if ("relay" == i.candidateType || "relayed" == i.candidateType) {\n                                if (!i.mozLocalTransport) {\n                                    var j = i.priority >> 24;\n                                    i.mozLocalTransport = this.formatRelayType(j);\n                                }\n                                i.mozLocalTransport = i.mozLocalTransport.toLowerCase();\n                            }\n                            b.push(i);\n                        } else h.remoteCandidate && c.push(h.remoteCandidate);\n                    }\n                    if (e) for (var k = 0; k < d.length; ++k) d[k].id === e && (d[k].googActiveConnection = "true");\n                    return {\n                        localCandidates: b,\n                        remoteCandidates: c,\n                        iceCandidatePairs: d\n                    };\n                }\n            }, {\n                key: "getParsedStats",\n                value: function(a) {\n                    var b = {};\n                    if (a.timestamp instanceof Date && (b.timestamp = a.timestamp.getTime().toString()), \n                    a.type && (b.type = a.type), a.names) for (var c = a.names(), d = 0; d < c.length; ++d) b[c[d]] = a.stat(c[d]); else Object.assign(b, a);\n                    if (b.values) {\n                        for (var e = 0; e < b.values.length; e++) {\n                            var f = b.values[e];\n                            Object.assign(b, f);\n                        }\n                        delete b.values;\n                    }\n                    return b;\n                }\n            }, {\n                key: "statsClassifier",\n                value: function(a) {\n                    var b = {}, c = function() {\n                        for (var b = arguments.length, c = Array(b), d = 0; d < b; d++) c[d] = arguments[d];\n                        for (var e = 0; e < c.length; e++) {\n                            var f = c[e];\n                            if (a.type === f) return !0;\n                        }\n                        return !1;\n                    }, d = c("inbound-rtp", "inboundrtp"), e = "true" === a.isRemote || !0 === a.isRemote;\n                    return d || c("outbound-rtp", "outboundrtp") ? (b.tracks = {}, b.tracks.data = a, \n                    b.tracks.ssrc = a.ssrc, b.tracks.streamType = d ? "inbound" : "outbound", b.tracks.reportType = "local", \n                    void 0 !== a.isRemote && (b.tracks.reportType = e ? "remote" : "local")) : c("candidatepair") && a.selected ? b.transportStats = a : c("localcandidate", "local-candidate") ? b.localCandidate = a : c("remotecandidate", "remote-candidate") ? b.remoteCandidate = a : c("transport", "googCandidatePair") ? b.transportStats = a : c("VideoBwe") ? b.bwe = a : c("track") ? b.trackStats = a : c("candidate-pair") ? b.candidatePair = a : c("codec") ? b.codec = a : c("ssrc") && (b.tracks = {}, \n                    b.tracks.data = a, b.tracks.ssrc = a.ssrc, b.tracks.reportType = "local", b.tracks.streamType = a.bytesSent ? "outbound" : "inbound"), \n                    b;\n                }\n            }, {\n                key: "formatRelayType",\n                value: function(a) {\n                    var b = "none";\n                    switch (a) {\n                      case 0:\n                        b = "tls";\n                        break;\n\n                      case 1:\n                        b = "tcp";\n                        break;\n\n                      case 2:\n                        b = "udp";\n                    }\n                    return b;\n                }\n            } ]), a;\n        }();\n        c.StatsAdapter = g;\n    }, {\n        "./detectbrowser": 11\n    } ],\n    14: [ function(a, b, c) {\n        "use strict";\n        function d() {\n            return window && window.performance && window.performance.now && window.performance.timing && window.performance.timing.navigationStart ? window.performance.now() + window.performance.timing.navigationStart : Date.now();\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.getCurrent = d;\n    }, {} ],\n    15: [ function(a, b, c) {\n        function d() {\n            throw new Error("setTimeout has not been defined");\n        }\n        function e() {\n            throw new Error("clearTimeout has not been defined");\n        }\n        function f(a) {\n            if (l === setTimeout) return setTimeout(a, 0);\n            if ((l === d || !l) && setTimeout) return l = setTimeout, setTimeout(a, 0);\n            try {\n                return l(a, 0);\n            } catch (b) {\n                try {\n                    return l.call(null, a, 0);\n                } catch (b) {\n                    return l.call(this, a, 0);\n                }\n            }\n        }\n        function g(a) {\n            if (m === clearTimeout) return clearTimeout(a);\n            if ((m === e || !m) && clearTimeout) return m = clearTimeout, clearTimeout(a);\n            try {\n                return m(a);\n            } catch (b) {\n                try {\n                    return m.call(null, a);\n                } catch (b) {\n                    return m.call(this, a);\n                }\n            }\n        }\n        function h() {\n            q && o && (q = !1, o.length ? p = o.concat(p) : r = -1, p.length && i());\n        }\n        function i() {\n            if (!q) {\n                var a = f(h);\n                q = !0;\n                for (var b = p.length; b; ) {\n                    for (o = p, p = []; ++r < b; ) o && o[r].run();\n                    r = -1, b = p.length;\n                }\n                o = null, q = !1, g(a);\n            }\n        }\n        function j(a, b) {\n            this.fun = a, this.array = b;\n        }\n        function k() {}\n        var l, m, n = b.exports = {};\n        !function() {\n            try {\n                l = "function" == typeof setTimeout ? setTimeout : d;\n            } catch (a) {\n                l = d;\n            }\n            try {\n                m = "function" == typeof clearTimeout ? clearTimeout : e;\n            } catch (a) {\n                m = e;\n            }\n        }();\n        var o, p = [], q = !1, r = -1;\n        n.nextTick = function(a) {\n            var b = new Array(arguments.length - 1);\n            if (arguments.length > 1) for (var c = 1; c < arguments.length; c++) b[c - 1] = arguments[c];\n            p.push(new j(a, b)), 1 !== p.length || q || f(i);\n        }, j.prototype.run = function() {\n            this.fun.apply(null, this.array);\n        }, n.title = "browser", n.browser = !0, n.env = {}, n.argv = [], n.version = "", \n        n.versions = {}, n.on = k, n.addListener = k, n.once = k, n.off = k, n.removeListener = k, \n        n.removeAllListeners = k, n.emit = k, n.prependListener = k, n.prependOnceListener = k, \n        n.listeners = function(a) {\n            return [];\n        }, n.binding = function(a) {\n            throw new Error("process.binding is not supported");\n        }, n.cwd = function() {\n            return "/";\n        }, n.chdir = function(a) {\n            throw new Error("process.chdir is not supported");\n        }, n.umask = function() {\n            return 0;\n        };\n    }, {} ],\n    16: [ function(a, b, c) {\n        (function(b, d) {\n            function e(a, b) {\n                this._id = a, this._clearFn = b;\n            }\n            var f = a("process/browser.js").nextTick, g = Function.prototype.apply, h = Array.prototype.slice, i = {}, j = 0;\n            c.setTimeout = function() {\n                return new e(g.call(setTimeout, window, arguments), clearTimeout);\n            }, c.setInterval = function() {\n                return new e(g.call(setInterval, window, arguments), clearInterval);\n            }, c.clearTimeout = c.clearInterval = function(a) {\n                a.close();\n            }, e.prototype.unref = e.prototype.ref = function() {}, e.prototype.close = function() {\n                this._clearFn.call(window, this._id);\n            }, c.enroll = function(a, b) {\n                clearTimeout(a._idleTimeoutId), a._idleTimeout = b;\n            }, c.unenroll = function(a) {\n                clearTimeout(a._idleTimeoutId), a._idleTimeout = -1;\n            }, c._unrefActive = c.active = function(a) {\n                clearTimeout(a._idleTimeoutId);\n                var b = a._idleTimeout;\n                b >= 0 && (a._idleTimeoutId = setTimeout(function() {\n                    a._onTimeout && a._onTimeout();\n                }, b));\n            }, c.setImmediate = "function" == typeof b ? b : function(a) {\n                var b = j++, d = !(arguments.length < 2) && h.call(arguments, 1);\n                return i[b] = !0, f(function() {\n                    i[b] && (d ? a.apply(null, d) : a.call(null), c.clearImmediate(b));\n                }), b;\n            }, c.clearImmediate = "function" == typeof d ? d : function(a) {\n                delete i[a];\n            };\n        }).call(this, a("timers").setImmediate, a("timers").clearImmediate);\n    }, {\n        "process/browser.js": 15,\n        timers: 16\n    } ],\n    17: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        });\n        var e = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), f = function() {\n            function a() {\n                var b = this;\n                d(this, a), this.batteryManager = null, "function" == typeof navigator.getBattery && navigator.getBattery().then(function(a) {\n                    b.batteryManager = a;\n                });\n            }\n            return e(a, [ {\n                key: "getLevel",\n                value: function() {\n                    return this.batteryManager ? this.batteryManager.level : -1;\n                }\n            }, {\n                key: "getCharging",\n                value: function() {\n                    return this.batteryManager ? this.batteryManager.charging : null;\n                }\n            } ]), a;\n        }();\n        c.Battery = f;\n    }, {} ],\n    18: [ function(a, b, c) {\n        "use strict";\n        function d() {\n            var a = f.browserName.chrome, b = null, c = null, d = null, e = null, g = f.codeBaseType.chrome;\n            if (!window.navigator.userAgent || window.csioReactNative) return window && window.csioGetOsName && (b = window.csioGetOsName()), \n            window && window.csioGetOsVer && (c = window.csioGetOsVer()), window && window.csioReactNative && (d = "react-native"), \n            {\n                browserName: a,\n                codeBase: g,\n                os: b,\n                osVersion: c,\n                userAgent: d,\n                browserVersion: null\n            };\n            d = navigator.userAgent;\n            var h = d.toLowerCase();\n            e = navigator.appVersion;\n            var i = void 0, j = void 0;\n            e && (i = e.toLowerCase(), j = "" + parseFloat(i));\n            var k = void 0;\n            -1 !== (k = h.indexOf("opera")) ? (a = f.browserName.opera, j = h.substring(k + 6), \n            -1 !== (k = h.indexOf("Version")) && (j = h.substring(k + 8)), g = f.codeBaseType.chrome) : -1 !== (k = h.indexOf("opr")) ? (a = f.browserName.opera, \n            j = h.substring(k + 4), -1 !== (k = h.indexOf("Version")) && (j = h.substring(k + 8)), \n            g = f.codeBaseType.chrome) : -1 !== (k = h.indexOf("msie")) ? (a = f.browserName.msie, \n            j = h.substring(k + 5), g = f.codeBaseType.chrome) : -1 !== (k = h.indexOf("edge")) ? (a = f.browserName.edge, \n            j = h.substring(k + 5), g = f.codeBaseType.edge) : -1 !== (k = h.indexOf("chrome")) ? (a = f.browserName.chrome, \n            j = h.substring(k + 7), g = f.codeBaseType.chrome) : -1 !== (k = h.indexOf("safari")) ? (a = f.browserName.safari, \n            j = h.substring(k + 7), -1 !== (k = h.indexOf("Version")) && (j = h.substring(k + 8)), \n            g = f.codeBaseType.chrome) : -1 !== (k = h.indexOf("firefox")) ? (a = f.browserName.firefox, \n            j = h.substring(k + 8), g = f.codeBaseType.firefox) : -1 !== (k = h.indexOf("trident")) && (a = f.browserName.msie, \n            k = h.indexOf("rv"), j = h.substring(k + 3, k + 7), g = f.codeBaseType.chrome);\n            var l = [ {\n                s: "Windows 3.11",\n                r: /win16/\n            }, {\n                s: "Windows 95",\n                r: /(windows 95|win95|windows_95)/\n            }, {\n                s: "Windows ME",\n                r: /(win 9x 4.90|windows me)/\n            }, {\n                s: "Windows 98",\n                r: /(windows 98|win98)/\n            }, {\n                s: "Windows CE",\n                r: /windows ce/\n            }, {\n                s: "Windows 2000",\n                r: /(windows nt 5.0|windows 2000)/\n            }, {\n                s: "Windows XP",\n                r: /(windows nt 5.1|windows xp)/\n            }, {\n                s: "Windows Server 2003",\n                r: /windows nt 5.2/\n            }, {\n                s: "Windows Vista",\n                r: /windows nt 6.0/\n            }, {\n                s: "Windows 7",\n                r: /(windows 7|windows nt 6.1)/\n            }, {\n                s: "Windows 8.1",\n                r: /(windows 8.1|windows nt 6.3)/\n            }, {\n                s: "Windows 8",\n                r: /(windows 8|windows nt 6.2)/\n            }, {\n                s: "Windows 10",\n                r: /(windows 10|windows nt 10.0)/\n            }, {\n                s: "Windows NT 4.0",\n                r: /(windows nt 4.0|winnt4.0|winnt|windows nt)/\n            }, {\n                s: "Windows ME",\n                r: /windows me/\n            }, {\n                s: "Android",\n                r: /android/\n            }, {\n                s: "Open BSD",\n                r: /openbsd/\n            }, {\n                s: "Sun OS",\n                r: /sunos/\n            }, {\n                s: "Linux",\n                r: /(linux|x11)/\n            }, {\n                s: "iOS",\n                r: /(iphone|ipad|ipod)/\n            }, {\n                s: "Mac OS X",\n                r: /mac os x/\n            }, {\n                s: "Mac OS",\n                r: /(macppc|macintel|mac_powerpc|macintosh)/\n            }, {\n                s: "QNX",\n                r: /qnx/\n            }, {\n                s: "UNIX",\n                r: /unix/\n            }, {\n                s: "BeOS",\n                r: /beos/\n            }, {\n                s: "OS/2",\n                r: /os\\/2/\n            }, {\n                s: "Search Bot",\n                r: /(nuhk|googlebot|yammybot|openbot|slurp|msnbot|ask jeeves\\/teoma|ia_archiver)/\n            } ], m = void 0, n = void 0;\n            for (m in l) if (l.hasOwnProperty(m) && (n = l[m], n.r.test(h))) {\n                b = n.s;\n                break;\n            }\n            switch (b && /Windows/.test(b) && (c = /Windows (.*)/.exec(b)[1], b = f.osName.windows), \n            b) {\n              case f.osName.mac:\n                c = /mac os x (10[\\.\\_\\d]+)/.exec(h)[1];\n                break;\n\n              case f.osName.android:\n                c = /android ([\\.\\_\\d]+)/.exec(h)[1];\n                break;\n\n              case f.osName.ios:\n                if (!i) break;\n                if (!(c = /os (\\d+)_(\\d+)_?(\\d+)?/.exec(i))) break;\n                c = c[1] + "." + c[2] + "." + (0 | c[3]);\n            }\n            return {\n                browserName: a,\n                browserVersion: j.toString(),\n                os: b,\n                osVersion: c,\n                codeBase: g,\n                userAgent: d\n            };\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.detect = d;\n        var e = a("../config/constants"), f = function(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }(e);\n    }, {\n        "../config/constants": 33\n    } ],\n    19: [ function(a, b, c) {\n        "use strict";\n        function d(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }\n        function e(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.Devices = void 0;\n        var f = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), g = a("../config/constants"), h = d(g), i = a("../utility/registry"), j = a("../utility/csiologger"), k = d(j), l = a("../utility/utils"), m = d(l), n = function() {\n            function a(b, c) {\n                e(this, a), this.conferenceId = b, this.pc = c, this.devices = null, this.emb = i.Registry.getEventMessageBuilder();\n            }\n            return f(a, [ {\n                key: "collectConnected",\n                value: function() {\n                    var a = this;\n                    if (navigator.mediaDevices && navigator.mediaDevices.enumerateDevices) {\n                        var b = this;\n                        navigator.mediaDevices.enumerateDevices().then(function(c) {\n                            var d = m.normalizeMediaDeviceList(c);\n                            b.sendConnected(d), setTimeout(a.collectConnected.bind(b), 1e4);\n                        }).catch(function(c) {\n                            setTimeout(a.collectConnected.bind(b), 1e4);\n                        });\n                    }\n                }\n            }, {\n                key: "sendConnected",\n                value: function(a) {\n                    this.devices ? this.compare(a) || (this.devices = a, this.send()) : (this.devices = a, \n                    this.send());\n                }\n            }, {\n                key: "compare",\n                value: function(a) {\n                    return self.devices.sort().toString() === a.sort().toString();\n                }\n            }, {\n                key: "send",\n                value: function() {\n                    var a = {\n                        mediaDeviceList: this.devices\n                    };\n                    k.log("sending connectedDevice", h.internalFabricEvent.connectedDeviceList, a), \n                    this.emb.make(h.internalFabricEvent.connectedDeviceList, this.conferenceId, this.pc, a);\n                }\n            } ]), a;\n        }();\n        c.Devices = n;\n    }, {\n        "../config/constants": 33,\n        "../utility/csiologger": 88,\n        "../utility/registry": 95,\n        "../utility/utils": 101\n    } ],\n    20: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (b) try {\n                window && window.localStorage && window.localStorage.setItem(a, b);\n            } catch (a) {\n                return;\n            }\n        }\n        function e(a) {\n            try {\n                if (window && window.localStorage) return window.localStorage.getItem(a);\n            } catch (a) {\n                return null;\n            }\n            return null;\n        }\n        function f(a) {\n            try {\n                window && window.localStorage && window.localStorage.removeItem(a);\n            } catch (a) {\n                return;\n            }\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.store = d, c.get = e, c.remove = f;\n    }, {} ],\n    21: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (b) try {\n                window && window.sessionStorage && window.sessionStorage.setItem(a, b);\n            } catch (a) {\n                return;\n            }\n        }\n        function e(a) {\n            try {\n                if (window && window.sessionStorage) return window.sessionStorage.getItem(a);\n            } catch (a) {\n                return null;\n            }\n            return null;\n        }\n        function f(a) {\n            try {\n                window && window.sessionStorage && window.sessionStorage.removeItem(a);\n            } catch (a) {\n                return;\n            }\n        }\n        function g(a, b) {\n            if (a) {\n                var c = JSON.parse(e("csio_ucid_data"));\n                c || (c = {}), c[a] || (c[a] = {}), c[a].ucID = b, d("csio_ucid_data", JSON.stringify(c));\n            }\n        }\n        function h(a) {\n            if (!a) return null;\n            var b = JSON.parse(e("csio_ucid_data"));\n            return b && b[a] ? b[a].ucID : null;\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.store = d, c.get = e, c.remove = f, c.storeUcId = g, c.getUcId = h;\n    }, {} ],\n    22: [ function(a, b, c) {\n        (function(c) {\n            "use strict";\n            function d(a) {\n                if (a && a.__esModule) return a;\n                var b = {};\n                if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n                return b.default = a, b;\n            }\n            function e(a, b) {\n                if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n            }\n            function f(a, b) {\n                var c = {};\n                return c.status = a, b && (c.message = b), c;\n            }\n            function g(a, b) {\n                return a + ": " + b + " " + (arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : "");\n            }\n            function h() {\n                var a = null, b = r.Registry.getEndpoint().getBrowserName();\n                return "Firefox" === b ? a = mozRTCPeerConnection : "Chrome" === b || "Opera" === b ? a = webkitRTCPeerConnection : "Safari" === b ? t.log("Browser type Safari") : "Edge" === b && (a = window.RTCPeerConnection), \n                a;\n            }\n            function i(a) {\n                if (null === a) return !1;\n                var b = r.Registry.getEndpoint().getCodeBase();\n                if (b === m.codeBaseType.firefox) return "undefined" != typeof mozRTCPeerConnection && a instanceof mozRTCPeerConnection || "undefined" != typeof RTCPeerConnection && a instanceof RTCPeerConnection;\n                if (b === m.codeBaseType.edge || "function" == typeof a) return !0;\n                var c = h();\n                return null !== c && a instanceof c || void 0 !== a.createOffer;\n            }\n            var j = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(a) {\n                return typeof a;\n            } : function(a) {\n                return a && "function" == typeof Symbol && a.constructor === Symbol && a !== Symbol.prototype ? "symbol" : typeof a;\n            }, k = function() {\n                function a(a, b) {\n                    for (var c = 0; c < b.length; c++) {\n                        var d = b[c];\n                        d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                        Object.defineProperty(a, d.key, d);\n                    }\n                }\n                return function(b, c, d) {\n                    return c && a(b.prototype, c), d && a(b, d), b;\n                };\n            }(), l = a("./config/constants"), m = d(l), n = a("./config/settings"), o = d(n), p = a("./config/callstatserrors"), q = a("./fsm/mainfsm"), r = a("./utility/registry"), s = a("./utility/csiologger"), t = d(s), u = a("./utility/onerroreventlistner"), v = d(u), w = a("./utility/utils"), x = d(w);\n            v.setErrorEventListener(), x.assignPollyfill(), x.isIntegerPollyfill();\n            var y = null, z = function() {\n                function a() {\n                    e(this, a), y = new q.MainFSM();\n                }\n                return k(a, [ {\n                    key: "initialize",\n                    value: function(a, b, c, d, e, h) {\n                        if (!a || !c || !b) {\n                            var i = g("initialize", p.csErrorStrings.argumentError);\n                            return t.error(i), f(m.callstatsAPIReturnStatus.failure, i);\n                        }\n                        if (d && "function" != typeof d) {\n                            var j = g("initialize", p.csErrorStrings.argumentError);\n                            t.warn(j), d = null;\n                        }\n                        if (e && "function" != typeof e) {\n                            var k = g("initialize", p.csErrorStrings.argumentError);\n                            t.warn(k), e = null;\n                        }\n                        if ("function" != typeof b && !(window.crypto && (window.crypto.subtle || window.crypto.webkitSubtle) || window.msCrypto && window.msCrypto.subtle || window.csioReactNative)) {\n                            var l = g("initialize", p.csErrorStrings.cryptoError);\n                            return t.error(l), d && d(p.csError.tokenGenerationError, p.csErrorStrings.cryptoError), \n                            f(m.callstatsAPIReturnStatus.failure, l);\n                        }\n                        try {\n                            y.fire(q.MainEvents.onInitialize, a, c, b, d, e, h), y.run();\n                        } catch (a) {\n                            r.Registry.getGenericEventHandler().sendEvent(m.logEvents.error, {\n                                msg: "initialize: Error",\n                                error: a.message + ":" + a.stack\n                            }), t.error("initialize: Error", a);\n                        }\n                        return f(m.callstatsAPIReturnStatus.success);\n                    }\n                }, {\n                    key: "addNewFabric",\n                    value: function(a, b, c, d, e, h) {\n                        var j = null, k = m.endpointType.peer, l = m.transmissionDirection.sendrecv;\n                        if (void 0 === b) {\n                            var n = g("addNewFabric", p.csErrorStrings.argumentError);\n                            return t.error(n), f(m.callstatsAPIReturnStatus.failure, n);\n                        }\n                        if (void 0 === d) {\n                            var o = g("addNewFabric", p.csErrorStrings.argumentError);\n                            return t.error(o), f(m.callstatsAPIReturnStatus.failure, o);\n                        }\n                        if (d || (d = m.tmpConferenceId), !a || !c) {\n                            var s = g("addNewFabric", p.csErrorStrings.argumentError);\n                            return t.error(s), f(m.callstatsAPIReturnStatus.failure, s);\n                        }\n                        if (h && "function" == typeof h && (j = h), e && "function" == typeof e && (j = e), \n                        e && "function" != typeof e) {\n                            if (e.remoteEndpointType) {\n                                if (!m.endpointType.hasOwnProperty(e.remoteEndpointType)) {\n                                    var u = g("addNewFabric", p.csErrorStrings.invalidEndPointType, e.remoteEndpointType);\n                                    return t.error(u), f(m.callstatsAPIReturnStatus.failure, u);\n                                }\n                                k = e.remoteEndpointType;\n                            }\n                            if (e.fabricTransmissionDirection) {\n                                if (!m.transmissionDirection.hasOwnProperty(e.fabricTransmissionDirection)) {\n                                    var v = g("addNewFabric", p.csErrorStrings.invalidTransmissionDirection, e.fabricTransmissionDirection);\n                                    return t.error(v), f(m.callstatsAPIReturnStatus.failure, v);\n                                }\n                                l = e.fabricTransmissionDirection;\n                            }\n                        }\n                        if (!m.fabricUsage.hasOwnProperty(c) || c instanceof Function) {\n                            var w = g("addNewFabric", p.csErrorStrings.fabricUsageInvalid, c);\n                            return t.error(w), f(m.callstatsAPIReturnStatus.failure, w);\n                        }\n                        if (!i(a)) {\n                            var x = g("addNewFabric", p.csErrorStrings.pcInvalid);\n                            return t.error(x), f(m.callstatsAPIReturnStatus.failure, x);\n                        }\n                        var z = r.Registry.getConferenceManager().get(d);\n                        if (z) {\n                            if (z.getPeerConnectionManager().getPcHandler(a)) return f(m.callstatsAPIReturnStatus.success);\n                        }\n                        if (!r.Registry.getCredentials().getAppId() || !r.Registry.getCredentials().getUserId()) {\n                            var A = g("addNewFabric", p.csErrorStrings.notInitialized);\n                            return t.error(A), f(m.callstatsAPIReturnStatus.failure, A);\n                        }\n                        try {\n                            y.fire(q.MainEvents.onAddNewFabric, a, b, c, d, k, l, j), y.run();\n                        } catch (a) {\n                            r.Registry.getGenericEventHandler().sendEvent(m.logEvents.error, {\n                                msg: "addNewFabric: Error",\n                                error: a.message + ":" + a.stack\n                            }), t.error("addNewFabric: Error", a);\n                        }\n                        return f(m.callstatsAPIReturnStatus.success);\n                    }\n                }, {\n                    key: "sendFabricEvent",\n                    value: function(a, b, c, d) {\n                        if (t.log("sendFabricEvent ", b), c || (c = m.tmpConferenceId), !a || !b) {\n                            var e = g("sendFabricEvent", p.csErrorStrings.argumentError);\n                            return t.error(e), f(m.callstatsAPIReturnStatus.failure, e);\n                        }\n                        if (b === m.fabricEvent.fabricSetupFailed) {\n                            var h = g("sendFabricEvent", p.csErrorStrings.fabricEventUnsupported, b);\n                            return t.error(h), f(m.callstatsAPIReturnStatus.failure, h);\n                        }\n                        if (!m.fabricEvent.hasOwnProperty(b) && !m.internalFabricEvent.hasOwnProperty(b)) {\n                            var i = g("sendFabricEvent", p.csErrorStrings.fabricEventInvalid, b);\n                            return t.error(i), f(m.callstatsAPIReturnStatus.failure, i);\n                        }\n                        if (!(b !== m.fabricEvent.activeDeviceList || d && d.deviceList)) {\n                            var j = g("sendFabricEvent ", p.csErrorStrings.argumentError);\n                            return t.error(j), f(m.callstatsAPIReturnStatus.failure, j);\n                        }\n                        var k = r.Registry.getConferenceManager().get(c);\n                        if (!r.Registry.getCredentials().getAppId() || !r.Registry.getCredentials().getUserId() || !k) {\n                            var l = g("sendFabricEvent ", p.csErrorStrings.notInitialized);\n                            return t.error(l), f(m.callstatsAPIReturnStatus.failure, l);\n                        }\n                        if (!k.getPeerConnectionManager().getPcHandler(a)) {\n                            var n = g("sendFabricEvent ", p.csErrorStrings.pcInvalid);\n                            return t.error(n), f(m.callstatsAPIReturnStatus.failure, n);\n                        }\n                        try {\n                            y.fire(q.MainEvents.onSendFabricEvent, a, b, c, d), y.run();\n                        } catch (a) {\n                            r.Registry.getGenericEventHandler().sendEvent(m.logEvents.error, {\n                                msg: "sendFabricEvent: Error",\n                                error: a.message + ":" + a.stack\n                            }), t.error("sendFabricEvent: Error", a);\n                        }\n                        return f(m.callstatsAPIReturnStatus.success);\n                    }\n                }, {\n                    key: "sendUserFeedback",\n                    value: function(a, b, c) {\n                        if (!b || !a) {\n                            var d = g("sendUserFeedback", p.csErrorStrings.argumentError);\n                            return t.error(d), f(m.callstatsAPIReturnStatus.failure, d);\n                        }\n                        if ("object" !== (void 0 === b ? "undefined" : j(b))) {\n                            var e = g("sendUserFeedback", p.csErrorStrings.argumentError);\n                            return t.error(e), f(m.callstatsAPIReturnStatus.failure, e);\n                        }\n                        if (0 === Object.keys(b).length) {\n                            var h = g("sendUserFeedback", p.csErrorStrings.argumentError);\n                            return t.error(h), f(m.callstatsAPIReturnStatus.failure, h);\n                        }\n                        try {\n                            y.fire(q.MainEvents.onSendUserFeedback, a, b, c), y.run();\n                        } catch (a) {\n                            r.Registry.getGenericEventHandler().sendEvent(m.logEvents.error, {\n                                msg: "sendUserFeedback: Error",\n                                error: a.message + ":" + a.stack\n                            }), t.error("sendUserFeedback: Error", a);\n                        }\n                        return f(m.callstatsAPIReturnStatus.success);\n                    }\n                }, {\n                    key: "associateMstWithUserID",\n                    value: function(a, b, c, d, e, h) {\n                        if (c || (c = m.tmpConferenceId), !a || !d || !e) {\n                            var j = g("associateMstWithUserID", p.csErrorStrings.argumentError);\n                            return t.error(j), f(m.callstatsAPIReturnStatus.failure, j);\n                        }\n                        if (!i(a)) {\n                            var k = g("associateMstWithUserID", p.csErrorStrings.pcInvalid);\n                            return t.error(k), f(m.callstatsAPIReturnStatus.failure, k);\n                        }\n                        var l = r.Registry.getConferenceManager().get(c);\n                        if (!l) {\n                            var n = g("associateMstWithUserID", p.csErrorStrings.confereneDoesNotExist);\n                            return t.error(n), f(m.callstatsAPIReturnStatus.failure, n);\n                        }\n                        if (!l.getPeerConnectionManager().getPcHandler(a)) {\n                            var o = g("associateMstWithUserID", p.csErrorStrings.pcInvalid);\n                            return t.error(o), f(m.callstatsAPIReturnStatus.failure, o);\n                        }\n                        h && "string" != typeof h && (t.error("associateMstWithUserID: Invalid videoTag"), \n                        h = null);\n                        try {\n                            y.fire(q.MainEvents.onAssociateMstWithUserID, a, b, c, d, e, h), y.run();\n                        } catch (a) {\n                            r.Registry.getGenericEventHandler().sendEvent(m.logEvents.error, {\n                                msg: "associateMstWithUserID: Error",\n                                error: a.message + ":" + a.stack\n                            }), t.error("associateMstWithUserID: Error", a);\n                        }\n                        return f(m.callstatsAPIReturnStatus.success);\n                    }\n                }, {\n                    key: "reportError",\n                    value: function(a, b, c, d, e, h) {\n                        if (b || (b = m.tmpConferenceId), void 0 === a || !c) {\n                            var i = g("reportError", p.csErrorStrings.argumentError);\n                            return t.error(i), f(m.callstatsAPIReturnStatus.failure, i);\n                        }\n                        if (!m.webRTCFunctions.hasOwnProperty(c)) {\n                            var j = g("reportError", p.csErrorStrings.webRTCFunctionsInvalid, c);\n                            return t.error(j), f(m.callstatsAPIReturnStatus.failure, j);\n                        }\n                        if (void 0 === d && t.warn("reportError: Missing DOM error parameter"), !r.Registry.getCredentials().getAppId() || !r.Registry.getCredentials().getUserId()) {\n                            var k = g("reportError", p.csErrorStrings.notInitialized);\n                            return t.error(k), f(m.callstatsAPIReturnStatus.failure, k);\n                        }\n                        try {\n                            y.fire(q.MainEvents.onReportError, a, b, c, d, e, h), y.run();\n                        } catch (a) {\n                            r.Registry.getGenericEventHandler().sendEvent(m.logEvents.error, {\n                                msg: "reportError: Error",\n                                error: a.message + ":" + a.stack\n                            }), t.error("reportError: Error", a);\n                        }\n                        return f(m.callstatsAPIReturnStatus.success);\n                    }\n                }, {\n                    key: "setProxyConfig",\n                    value: function(a) {\n                        if (window && !window.csioproxy) {\n                            var b = g("setProxyConfig", p.csErrorStrings.setProxyConfigInvokeError);\n                            return t.error(b), f(m.callstatsAPIReturnStatus.failure, b);\n                        }\n                        if (!a) {\n                            var c = g("setProxyConfig", p.csErrorStrings.argumentError);\n                            return t.error(c), f(m.callstatsAPIReturnStatus.failure, c);\n                        }\n                        try {\n                            y.fire(q.MainEvents.onSetProxyConfig, a), y.run();\n                        } catch (a) {\n                            r.Registry.getGenericEventHandler().sendEvent(m.logEvents.error, {\n                                msg: "setProxyConfig: Error",\n                                error: a.message + ":" + a.stack\n                            }), t.error("setProxyConfig: Error", a);\n                        }\n                        return f(m.callstatsAPIReturnStatus.success);\n                    }\n                }, {\n                    key: "attachWifiStatsHandler",\n                    value: function(a) {\n                        if (!a) {\n                            var b = g("attachWifiStatsHandler", p.csErrorStrings.argumentError);\n                            return t.error(b), f(m.callstatsAPIReturnStatus.failure, b);\n                        }\n                        if ("function" != typeof a) {\n                            var c = g("attachWifiStatsHandler", p.csErrorStrings.argumentError);\n                            return t.error(c), f(m.callstatsAPIReturnStatus.failure, c);\n                        }\n                        try {\n                            y.fire(q.MainEvents.onAttachWifiStatsHandler, a), y.run();\n                        } catch (a) {\n                            r.Registry.getGenericEventHandler().sendEvent(m.logEvents.error, {\n                                msg: "attachWifiStatsHandler: Error",\n                                error: a.message + ":" + a.stack\n                            }), t.error("attachWifiStatsHandler: Error", a);\n                        }\n                        return f(m.callstatsAPIReturnStatus.success);\n                    }\n                }, {\n                    key: "setIdentifiers",\n                    value: function(a, b) {\n                        if (!a) {\n                            var c = g("setIdentifiers", p.csErrorStrings.argumentError);\n                            return t.error(c), f(m.callstatsAPIReturnStatus.failure, c);\n                        }\n                        try {\n                            y.fire(q.MainEvents.onSetIdentifiers, a, b), y.run();\n                        } catch (a) {\n                            r.Registry.getGenericEventHandler().sendEvent(m.logEvents.error, {\n                                msg: "setIdentifiers: Error",\n                                error: a.message + ":" + a.stack\n                            }), t.error("setIdentifiers: Error", a);\n                        }\n                        return f(m.callstatsAPIReturnStatus.success);\n                    }\n                }, {\n                    key: "makePrecallTest",\n                    value: function(a, b) {\n                        if (!r.Registry.getAuthenticator().getToken() || !r.Registry.getCredentials().getAppId()) {\n                            var c = g("makePrecallTest", p.csErrorStrings.notInitialized);\n                            return t.error(c), f(m.callstatsAPIReturnStatus.failure, c);\n                        }\n                        if (!r.Registry.getAuthenticator().getIceServers()) {\n                            var d = g("makePrecallTest", p.csErrorStrings.notInitialized);\n                            return t.error(d), f(m.callstatsAPIReturnStatus.failure, d);\n                        }\n                        if (!r.Registry.getCredentials().getCollectSDP()) {\n                            var e = g("makePrecallTest", p.csErrorStrings.apiaccesserror);\n                            return t.error(e), f(m.callstatsAPIReturnStatus.failure, e);\n                        }\n                        try {\n                            y.fire(q.MainEvents.onMakePrecallTest, a, b), y.run();\n                        } catch (a) {\n                            r.Registry.getGenericEventHandler().sendEvent(m.logEvents.error, {\n                                msg: "on: Error",\n                                error: a.message + ":" + a.stack\n                            }), t.error("makePrecallTest: Error", a);\n                        }\n                        return f(m.callstatsAPIReturnStatus.success);\n                    }\n                }, {\n                    key: "on",\n                    value: function(a, b) {\n                        if (!b || "function" != typeof b) {\n                            var c = g("on", p.csErrorStrings.argumentError);\n                            return t.error(c), f(m.callstatsAPIReturnStatus.failure, c);\n                        }\n                        if (!a || !m.callbackFunctions.hasOwnProperty(a)) {\n                            var d = g("on", p.csErrorStrings.argumentError);\n                            return t.error(d), f(m.callstatsAPIReturnStatus.failure, d);\n                        }\n                        try {\n                            y.fire(q.MainEvents.onOn, a, b), y.run();\n                        } catch (a) {\n                            r.Registry.getGenericEventHandler().sendEvent(m.logEvents.error, {\n                                msg: "on: Error",\n                                error: a.message + ":" + a.stack\n                            }), t.error("on: Error", a);\n                        }\n                        return f(m.callstatsAPIReturnStatus.success);\n                    }\n                }, {\n                    key: "fabricUsage",\n                    get: function() {\n                        return this.constructor.fabricUsage;\n                    }\n                }, {\n                    key: "fabricEvent",\n                    get: function() {\n                        return this.constructor.fabricEvent;\n                    }\n                }, {\n                    key: "webRTCFunctions",\n                    get: function() {\n                        return this.constructor.webRTCFunctions;\n                    }\n                }, {\n                    key: "csError",\n                    get: function() {\n                        return this.constructor.csError;\n                    }\n                }, {\n                    key: "qualityRating",\n                    get: function() {\n                        return this.constructor.qualityRating;\n                    }\n                }, {\n                    key: "callStatsAPIReturnStatus",\n                    get: function() {\n                        return this.constructor.callStatsAPIReturnStatus;\n                    }\n                }, {\n                    key: "version",\n                    get: function() {\n                        return this.constructor.version;\n                    }\n                }, {\n                    key: "userIDType",\n                    get: function() {\n                        return this.constructor.userIDType;\n                    }\n                }, {\n                    key: "transmissionDirection",\n                    get: function() {\n                        return this.constructor.transmissionDirection;\n                    }\n                }, {\n                    key: "endpointType",\n                    get: function() {\n                        return this.constructor.endpointType;\n                    }\n                } ]), a;\n            }();\n            z.fabricUsage = m.fabricUsage, z.fabricEvent = m.fabricEvent, z.webRTCFunctions = m.webRTCFunctions, \n            z.csError = p.csError, z.qualityRating = m.qualityRating, z.callStatsAPIReturnStatus = m.callstatsAPIReturnStatus, \n            z.version = o.version, z.userIDType = m.userIdType, z.endpointType = m.endpointType, \n            z.transmissionDirection = m.transmissionDirection, function() {\n                function a() {\n                    return new z();\n                }\n                "function" == typeof define && define.amd ? define("callstats", [], a) : c.callstats = a, \n                b.exports = a;\n            }("undefined" != typeof window && window);\n        }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {});\n    }, {\n        "./config/callstatserrors": 32,\n        "./config/constants": 33,\n        "./config/settings": 34,\n        "./fsm/mainfsm": 35,\n        "./utility/csiologger": 88,\n        "./utility/onerroreventlistner": 94,\n        "./utility/registry": 95,\n        "./utility/utils": 101\n    } ],\n    23: [ function(a, b, c) {\n        "use strict";\n        function d(a) {\n            if (Array.isArray(a)) {\n                for (var b = 0, c = Array(a.length); b < a.length; b++) c[b] = a[b];\n                return c;\n            }\n            return Array.from(a);\n        }\n        function e(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.BinaryTree = void 0;\n        var f = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), g = a("./binarytreenode.js"), h = a("../utility/csiologger"), i = function(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }(h), j = function() {\n            function a(b) {\n                e(this, a), this.root = null, this.top = null, this.bottom = null, this.comparator = b, \n                this.node_counter = 0, this.duplicate_counter = 0;\n            }\n            return f(a, [ {\n                key: "getTopNode",\n                value: function() {\n                    return this.top;\n                }\n            }, {\n                key: "getTopValue",\n                value: function() {\n                    return null === this.top ? null : this.top.peek();\n                }\n            }, {\n                key: "getBottomValue",\n                value: function() {\n                    return null === this.bottom ? null : this.bottom.peek();\n                }\n            }, {\n                key: "getBottomNode",\n                value: function() {\n                    return this.bottom;\n                }\n            }, {\n                key: "getDuplicatedCounter",\n                value: function() {\n                    return this.duplicate_counter;\n                }\n            }, {\n                key: "getNodeCounter",\n                value: function() {\n                    return this.node_counter;\n                }\n            }, {\n                key: "getSize",\n                value: function() {\n                    return this.duplicate_counter + this.node_counter;\n                }\n            }, {\n                key: "insertNodeAtTop",\n                value: function(a) {\n                    a && this.inserting(a.getValues(), this.top);\n                }\n            }, {\n                key: "insertNodeAtBottom",\n                value: function(a) {\n                    a && this.inserting(a.getValues(), this.bottom);\n                }\n            }, {\n                key: "insert",\n                value: function(a) {\n                    this.inserting([ a ], this.root);\n                }\n            }, {\n                key: "createNode",\n                value: function(a) {\n                    var b = new (Function.prototype.bind.apply(g.BinaryTreeNode, [ null ].concat(d(a))))();\n                    return null === this.top ? this.top = b : this.comparator(this.top.peek(), b.peek()) < 0 && (this.top = b), \n                    null === this.bottom ? this.bottom = b : this.comparator(b.peek(), this.bottom.peek()) < 0 && (this.bottom = b), \n                    b;\n                }\n            }, {\n                key: "inserting",\n                value: function(a, b) {\n                    if (null === this.root) return this.root = this.createNode(a), this.node_counter = 1, \n                    void (this.duplicate_counter += a.length - 1);\n                    for (var c = null, d = b, e = 0; null !== d; ) {\n                        if (0 === (e = this.comparator(a[0], d.peek()))) return d.concat(a), this.duplicate_counter += a.length, \n                        void d.find(a[0]);\n                        c = d, d = e < 0 ? d.getLeft() : d.getRight();\n                    }\n                    ++this.node_counter, this.duplicate_counter += a.length - 1, d = this.createNode(a), \n                    e < 0 ? c.setLeft(d) : c.setRight(d);\n                }\n            }, {\n                key: "getRightist",\n                value: function(a) {\n                    for (var b = null; null !== a.right; ) b = a, a = a.right;\n                    return [ a, b ];\n                }\n            }, {\n                key: "getLeftist",\n                value: function(a) {\n                    for (var b = null; null !== a.getLeft(); ) b = a, a = a.getLeft();\n                    return [ a, b ];\n                }\n            }, {\n                key: "popBottomNode",\n                value: function() {\n                    if (null === this.bottom) return null;\n                    var a = this.search(this.bottom.peek()), b = a[0], c = a[1];\n                    return null === b ? null : (this.replaceNode(b, c, b.getRight()), this.disposeNode(b), \n                    --this.node_counter, this.duplicate_counter -= b.getLength() - 1, b.setRight(null), \n                    b);\n                }\n            }, {\n                key: "popTopNode",\n                value: function() {\n                    if (null === this.top) return null;\n                    var a = this.search(this.top.peek()), b = a[0], c = a[1];\n                    return null === b ? null : (this.replaceNode(b, c, b.getLeft()), this.disposeNode(b), \n                    --this.node_counter, this.duplicate_counter -= b.getLength() - 1, b.setLeft(null), \n                    b);\n                }\n            }, {\n                key: "search",\n                value: function(a) {\n                    for (var b = this.root, c = null, d = void 0; null !== b; ) {\n                        if (0 === (d = this.comparator(a, b.peek()))) return b.find(a) ? [ b, c ] : [ null, null ];\n                        c = b, b = d < 0 ? b.getLeft() : b.getRight();\n                    }\n                    return [ null, null ];\n                }\n            }, {\n                key: "replaceNode",\n                value: function(a, b, c) {\n                    null !== b ? b.left === a ? b.left = c : b.right = c : this.root = c;\n                }\n            }, {\n                key: "disposeNode",\n                value: function(a) {\n                    if (null !== a) {\n                        if (null === this.root) return void (this.bottom = this.top = null);\n                        if (0 === this.comparator(this.top.peek(), a.peek())) {\n                            var b = this.getRightist(this.root);\n                            this.top = b[0];\n                        }\n                        if (0 === this.comparator(this.bottom.peek(), a.peek())) {\n                            var c = this.getLeftist(this.root);\n                            this.bottom = c[0];\n                        }\n                    }\n                }\n            }, {\n                key: "delete",\n                value: function(a) {\n                    var b = this.search(a), c = b[0], d = b[1];\n                    if (null === c) return !1;\n                    if (1 < c.getLength()) return c.remove(a), --this.duplicate_counter, !0;\n                    if (--this.node_counter, null === c.getLeft() && null === c.getRight()) this.replaceNode(c, d, null); else if (null === c.getLeft()) this.replaceNode(c, d, c.getRight()); else if (null === c.getRight()) this.replaceNode(c, d, c.getLeft()); else {\n                        for (var e = c.getLeft(), f = c; null !== e.getRight(); f = e, e = e.getRight()) ;\n                        var g = e.getLeft();\n                        f === c ? f.setLeft(g) : f.setRight(g), c.setValues(e.getValues());\n                    }\n                    return this.disposeNode(c), !0;\n                }\n            }, {\n                key: "logging",\n                value: function() {\n                    if (null === this.root) return void i.log("This tree is empty Duplicate Counter: " + this.duplicate_counter);\n                    i.log("Size of the tree: " + this.getSize() + " Node: " + this.getNodeCounter() + " Duplicates: " + this.getDuplicatedCounter() + " Top: " + this.getTopNode().toString() + " Bottom: " + this.getBottomNode().toString()), \n                    function a(b, c, d) {\n                        if (null !== b) {\n                            for (var e = "-", f = 0; f < c; ++f) e += "--";\n                            i.log(e + "> (" + d + ") [" + b.toString() + "]"), null !== b.getLeft() && a(b.getLeft(), c + 1, "Left"), \n                            null !== b.getRight() && a(b.getRight(), c + 1, "Right");\n                        }\n                    }(this.root, 0, "Root");\n                }\n            } ]), a;\n        }();\n        c.BinaryTree = j;\n    }, {\n        "../utility/csiologger": 88,\n        "./binarytreenode.js": 24\n    } ],\n    24: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        });\n        var e = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), f = function() {\n            function a() {\n                d(this, a);\n                for (var b = arguments.length, c = Array(b), e = 0; e < b; e++) c[e] = arguments[e];\n                this.values = c, this.left = null, this.right = null;\n            }\n            return e(a, [ {\n                key: "getRight",\n                value: function() {\n                    return this.right;\n                }\n            }, {\n                key: "setRight",\n                value: function(a) {\n                    this.right = a;\n                }\n            }, {\n                key: "getLeft",\n                value: function() {\n                    return this.left;\n                }\n            }, {\n                key: "setLeft",\n                value: function(a) {\n                    this.left = a;\n                }\n            }, {\n                key: "push",\n                value: function(a) {\n                    this.values.push(a);\n                }\n            }, {\n                key: "concat",\n                value: function(a) {\n                    this.values = this.values.concat(a);\n                }\n            }, {\n                key: "pop",\n                value: function() {\n                    return this.values.length < 1 ? null : this.values.shift();\n                }\n            }, {\n                key: "remove",\n                value: function(a) {\n                    this.values.splice(this.values.indexOf(a), 1);\n                }\n            }, {\n                key: "setValues",\n                value: function(a) {\n                    this.values = a;\n                }\n            }, {\n                key: "getValues",\n                value: function() {\n                    return this.values;\n                }\n            }, {\n                key: "hasValue",\n                value: function() {\n                    return 0 < this.values.length;\n                }\n            }, {\n                key: "getLength",\n                value: function() {\n                    return this.values.length;\n                }\n            }, {\n                key: "peek",\n                value: function() {\n                    return this.values.length < 1 ? null : this.values[0];\n                }\n            }, {\n                key: "find",\n                value: function(a) {\n                    return this.values.find(function(b) {\n                        return b === a;\n                    });\n                }\n            }, {\n                key: "toString",\n                value: function() {\n                    return this.values.toString();\n                }\n            } ]), a;\n        }();\n        c.BinaryTreeNode = f;\n    }, {} ],\n    25: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.Cache = void 0;\n        var e = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), f = a("../utility/csiologger"), g = function(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }(f), h = function() {\n            function a() {\n                d(this, a), this.queue = [], this.priority = [];\n            }\n            return e(a, [ {\n                key: "add",\n                value: function(a) {\n                    var b = arguments.length > 1 && void 0 !== arguments[1] && arguments[1];\n                    if (this.length() > 1e6) return void g.error("Maximum cached items reached, dropping.");\n                    b ? this.priority.push(a) : this.queue.push(a);\n                }\n            }, {\n                key: "pop",\n                value: function() {\n                    return this.priority.length > 0 ? this.priority.shift() : this.queue.shift();\n                }\n            }, {\n                key: "peak",\n                value: function() {\n                    return this.priority.length > 0 ? this.priority[0] : this.queue.length > 0 ? this.queue[0] : null;\n                }\n            }, {\n                key: "length",\n                value: function() {\n                    return this.queue.length + this.priority.length;\n                }\n            }, {\n                key: "updateConferenceId",\n                value: function(a) {\n                    for (var b = 0; b < this.queue.length; ++b) {\n                        this.queue[b].updateConferenceId(a);\n                    }\n                    for (var c = 0; c < this.priority.length; ++c) {\n                        this.priority[c].updateConferenceId(a);\n                    }\n                }\n            } ]), a;\n        }();\n        c.Cache = h;\n    }, {\n        "../utility/csiologger": 88\n    } ],\n    26: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.Component = void 0;\n        var e = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), f = a("./port"), g = a("../utility/csiologger"), h = function(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }(g), i = function() {\n            function a() {\n                var b = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : "Unknown";\n                d(this, a), this.name = b, this.ports = new Map();\n            }\n            return e(a, [ {\n                key: "bindPort",\n                value: function(a, b) {\n                    var c = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : this;\n                    if (this.ports.has(a)) return void h.warn("Port (" + a + ") for " + this.name + " already exists.");\n                    this.ports.set(a, new f.Port(b, c));\n                }\n            }, {\n                key: "declarePort",\n                value: function(a) {\n                    if (this.ports.has(a)) return void h.warn("Port (" + a + ") for " + this.name + " already exists.");\n                    this.ports.set(a, null);\n                }\n            }, {\n                key: "getPort",\n                value: function(a) {\n                    return this.ports.get(a);\n                }\n            }, {\n                key: "isConnected",\n                value: function(a) {\n                    return !!this.ports.has(a) && null !== this.ports.get(a);\n                }\n            }, {\n                key: "connect",\n                value: function(a, b) {\n                    if (!this.ports.has(a)) return void h.warn("Port (" + a + ") for " + this.name + " does not exists.");\n                    this.ports.set(a, b);\n                }\n            }, {\n                key: "transmit",\n                value: function(a) {\n                    var b = this.ports.get(a);\n                    if (void 0 === b) return void h.warn("Port (" + a + ") for " + this.name + " does not exists.");\n                    if (null === b) return void h.warn("Port (" + a + ") for " + this.name + " is not connected.");\n                    for (var c = arguments.length, d = Array(c > 1 ? c - 1 : 0), e = 1; e < c; e++) d[e - 1] = arguments[e];\n                    b.transmit(d);\n                }\n            }, {\n                key: "request",\n                value: function(a) {\n                    var b = this.ports.get(a);\n                    if (void 0 === b) return h.warn("Port (" + a + ") for " + this.name + " does not exists."), \n                    null;\n                    if (null === b) return h.warn("Port (" + a + ") for " + this.name + " is not connected."), \n                    null;\n                    for (var c = arguments.length, d = Array(c > 1 ? c - 1 : 0), e = 1; e < c; e++) d[e - 1] = arguments[e];\n                    return b.request(d);\n                }\n            } ]), a;\n        }();\n        c.Component = i;\n    }, {\n        "../utility/csiologger": 88,\n        "./port": 27\n    } ],\n    27: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        });\n        var e = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), f = function() {\n            function a(b) {\n                var c = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : null;\n                d(this, a), this.target = b, this.object = c;\n            }\n            return e(a, [ {\n                key: "transmit",\n                value: function(a) {\n                    this.target.apply(this.object, a);\n                }\n            }, {\n                key: "request",\n                value: function(a) {\n                    return this.target.apply(this.object, a);\n                }\n            } ]), a;\n        }();\n        c.Port = f;\n    }, {} ],\n    28: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.SlidingWindow = void 0;\n        var e = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), f = a("./switem"), g = a("../utility/timestamps"), h = function(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }(g), i = function() {\n            function a(b, c) {\n                d(this, a), this.items = [], this.plugins = [], this.postProcesses = [], this.preProcesses = [], \n                this.timeoutInMs = c, this.maxItemsNum = b, this.minItemsNum = 0;\n            }\n            return e(a, [ {\n                key: "setMaxItemsNum",\n                value: function(a) {\n                    this.maxItemsNum = a;\n                }\n            }, {\n                key: "setTimeoutInMs",\n                value: function(a) {\n                    this.timeoutInMs = a;\n                }\n            }, {\n                key: "setMinItemsNum",\n                value: function(a) {\n                    this.minItemsNum = a;\n                }\n            }, {\n                key: "refresh",\n                value: function() {\n                    var a = h.getCurrent();\n                    if (!(this.items.length <= this.minItemsNum)) {\n                        for (;0 < this.maxItemsNum && this.maxItemsNum <= this.items.length; ) this.remove();\n                        this.timeoutInMs && this.timeoutInMs < a - this.items[0].getCreated() && (this.remove(), \n                        this.refresh());\n                    }\n                }\n            }, {\n                key: "getLength",\n                value: function() {\n                    return this.items.length;\n                }\n            }, {\n                key: "add",\n                value: function(a) {\n                    this.refresh(), this.items.push(new f.SWItem(a));\n                    for (var b = 0; b < this.preProcesses.length; b++) {\n                        (0, this.preProcesses[b])(a);\n                    }\n                    for (var c = 0; c < this.plugins.length; c++) {\n                        this.plugins[c].add(a);\n                    }\n                    for (var d = 0; d < this.postProcesses.length; d++) {\n                        (0, this.postProcesses[d])(a);\n                    }\n                }\n            }, {\n                key: "remove",\n                value: function() {\n                    for (var a = this.items.shift(), b = 0; b < this.plugins.length; b++) {\n                        this.plugins[b].remove(a.value);\n                    }\n                }\n            }, {\n                key: "peek",\n                value: function() {\n                    var a = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 0;\n                    return this.items.length <= a ? null : this.items[this.items.length - a - 1].getValue();\n                }\n            }, {\n                key: "attach",\n                value: function(a) {\n                    this.plugins.push(a);\n                }\n            }, {\n                key: "addPreProcess",\n                value: function(a) {\n                    this.preProcesses.push(a);\n                }\n            }, {\n                key: "addPostProcess",\n                value: function(a) {\n                    this.postProcesses.push(a);\n                }\n            }, {\n                key: "detach",\n                value: function(a) {\n                    this.plugins = this.plugins.filter(function(b) {\n                        return b !== a;\n                    });\n                }\n            } ]), a;\n        }();\n        c.SlidingWindow = i;\n    }, {\n        "../utility/timestamps": 99,\n        "./switem": 29\n    } ],\n    29: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.SWItem = void 0;\n        var e = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), f = a("../utility/timestamps"), g = function(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }(f), h = function() {\n            function a(b) {\n                d(this, a), this.value = b, this.created = g.getCurrent();\n            }\n            return e(a, [ {\n                key: "getValue",\n                value: function() {\n                    return this.value;\n                }\n            }, {\n                key: "getCreated",\n                value: function() {\n                    return this.created;\n                }\n            }, {\n                key: "toString",\n                value: function() {\n                    return "";\n                }\n            } ]), a;\n        }();\n        c.SWItem = h;\n    }, {\n        "../utility/timestamps": 99\n    } ],\n    30: [ function(a, b, c) {\n        "use strict";\n        function d(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }\n        function e(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.Conference = void 0;\n        var f = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), g = a("../peerconnection/peerconnectionmanager"), h = a("../config/settings"), i = d(h), j = a("../utility/registry"), k = a("../browserapi/sessionstorage"), l = d(k), m = function() {\n            function a(b, c) {\n                e(this, a), this.conferenceId = b, this.startTime, this.peerConnectionManager = new g.PeerConnectionManager(), \n                this.credentials = c, this.ucId = null, this.url = null, this.userJoinedSent = !1;\n            }\n            return f(a, [ {\n                key: "getCredentials",\n                value: function() {\n                    return this.credentials;\n                }\n            }, {\n                key: "getUcId",\n                value: function() {\n                    return this.ucId;\n                }\n            }, {\n                key: "setUcId",\n                value: function(a) {\n                    this.ucId = a, this.url = i.conferenceBaseUrl + j.Registry.getCredentials().getAppId() + "/conferences/" + encodeURIComponent(this.conferenceId) + "/" + a + "/general", \n                    l.storeUcId(this.conferenceId, a);\n                }\n            }, {\n                key: "getPeerConnectionManager",\n                value: function() {\n                    return this.peerConnectionManager;\n                }\n            }, {\n                key: "getUrl",\n                value: function() {\n                    return this.url;\n                }\n            }, {\n                key: "updateConferenceId",\n                value: function(a) {\n                    this.conferenceId = a, this.peerConnectionManager.updateConferenceId(a);\n                }\n            }, {\n                key: "close",\n                value: function(a) {}\n            } ]), a;\n        }();\n        c.Conference = m;\n    }, {\n        "../browserapi/sessionstorage": 21,\n        "../config/settings": 34,\n        "../peerconnection/peerconnectionmanager": 42,\n        "../utility/registry": 95\n    } ],\n    31: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.ConferenceManager = void 0;\n        var e = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), f = a("./conference"), g = a("../config/constants"), h = function(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }(g), i = function() {\n            function a() {\n                d(this, a), this.conferenceMap = new Map();\n            }\n            return e(a, [ {\n                key: "add",\n                value: function(a, b) {\n                    if (!this.get(a)) {\n                        var c = new f.Conference(a, b);\n                        this.conferenceMap.set(a, c);\n                    }\n                }\n            }, {\n                key: "get",\n                value: function(a) {\n                    return this.conferenceMap.get(a);\n                }\n            }, {\n                key: "getConferenceForPc",\n                value: function(a) {\n                    var b = null;\n                    return a ? (this.conferenceMap.forEach(function(c, d) {\n                        var e = c.getPeerConnectionManager().getPcHandler(a);\n                        e && e.getConferenceId() === d && (b = c);\n                    }), b) : b;\n                }\n            }, {\n                key: "getConferenceForPcHash",\n                value: function(a) {\n                    var b = null;\n                    return a ? (this.conferenceMap.forEach(function(c, d) {\n                        var e = c.getPeerConnectionManager().getPcHandlerByHash(a);\n                        e && e.getConferenceId() === d && (b = c);\n                    }), b) : b;\n                }\n            }, {\n                key: "updateConferenceId",\n                value: function(a) {\n                    var b = h.tmpConferenceId, c = this.get(b);\n                    c && (c.updateConferenceId(a), this.conferenceMap.set(a, c), this.conferenceMap.delete(b));\n                }\n            }, {\n                key: "getConferenceIds",\n                value: function() {\n                    var a = [];\n                    return this.conferenceMap.forEach(function(b, c) {\n                        a.push(c);\n                    }), a;\n                }\n            } ]), a;\n        }();\n        c.ConferenceManager = i;\n    }, {\n        "../config/constants": 33,\n        "./conference": 30\n    } ],\n    32: [ function(a, b, c) {\n        "use strict";\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        });\n        c.csError = {\n            httpError: "httpError",\n            authError: "authError",\n            wsChannelFailure: "wsChannelFailure",\n            success: "success",\n            csProtoError: "csProtoError",\n            appConnectivityError: "appConnectivityError",\n            tokenGenerationError: "tokenGenerationError",\n            ok: "OK",\n            authOngoing: "authOngoing",\n            invalidWebRTCFunctionName: "Invalid WebRTC function name",\n            invalidEndPointType: "Invalid EndPoint Type",\n            invalidTransmissionDirection: "Invalid fabric transmission direction"\n        }, c.csErrorStrings = {\n            argumentError: "Argument missing/invalid",\n            cryptoError: "Browser does not support Web Cryptography API. App secret based authentication requires Web Cryptography API",\n            fabricEventUnsupported: "Unsupported fabricEvent",\n            fabricEventInvalid: "Invalid fabricEvents value",\n            fabricUsageInvalid: "Invalid fabricUsage value",\n            notInitialized: "SDK is not initialized or no Fabrics added",\n            pcInvalid: "Invalid PeerConnection object passed",\n            confereneDoesNotExist: "conferenceId does not exist",\n            webRTCFunctionsInvalid: "Invalid webRTC functionName value",\n            setProxyConfigInvokeError: "cannot be called if window.csioproxy is false",\n            invalidWebRTCFunctionName: "Invalid WebRTC function name",\n            invalidEndPointType: "Invalid EndPoint Type",\n            invalidTransmissionDirection: "Invalid fabric transmission direction",\n            apiaccesserror: "API access Error"\n        }, c.csErrorReason = {\n            csProtoError: "Protocol fields cannot be empty.",\n            csNoAuthState: "Authentication state unavailable in server."\n        }, c.internalErrors = {\n            authOngoing: "authOngoing"\n        }, c.authErrorActions = {\n            RETRY: 0,\n            GET_NEW_TOKEN: 1,\n            REPORT_ERROR: 2\n        };\n    }, {} ],\n    33: [ function(a, b, c) {\n        "use strict";\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        });\n        c.logEvents = {\n            stateMachine: "stateMachine",\n            log: "log",\n            timing: "timing",\n            error: "error",\n            getStatsError: "getStatsError",\n            restResponseError: "restResponseError"\n        }, c.fabricEvent = {\n            fabricSetupFailed: "fabricSetupFailed",\n            fabricHold: "fabricHold",\n            fabricResume: "fabricResume",\n            audioMute: "audioMute",\n            audioUnmute: "audioUnmute",\n            videoPause: "videoPause",\n            videoResume: "videoResume",\n            fabricUsageEvent: "fabricUsageEvent",\n            fabricTerminated: "fabricTerminated",\n            screenShareStart: "screenShareStart",\n            screenShareStop: "screenShareStop",\n            dominantSpeaker: "dominantSpeaker",\n            activeDeviceList: "activeDeviceList",\n            applicationErrorLog: "applicationErrorLog"\n        }, c.internalFabricEvent = {\n            fabricSetup: "fabricSetup",\n            fabricSetupFailed: "fabricSetupFailed",\n            userJoined: "userJoined",\n            userLeft: "userLeft",\n            userAlive: "userAlive",\n            ssrcMap: "ssrcMap",\n            mediaPlaybackStart: "mediaPlaybackStart",\n            mediaPlaybackSuspended: "mediaPlaybackSuspended",\n            mediaPlaybackStalled: "mediaPlaybackStalled",\n            oneWayMedia: "oneWayMedia",\n            fabricStateChange: "fabricStateChange",\n            iceDisruptionStart: "iceDisruptionStart",\n            iceDisruptionEnd: "iceDisruptionEnd",\n            fabricTransportSwitch: "fabricTransportSwitch",\n            iceConnectionDisruptionStart: "iceConnectionDisruptionStart",\n            iceConnectionDisruptionEnd: "iceConnectionDisruptionEnd",\n            iceAborted: "iceAborted",\n            iceTerminated: "iceTerminated",\n            iceFailed: "iceFailed",\n            iceRestarted: "iceRestarted",\n            fabricDropped: "fabricDropped",\n            connectedDeviceList: "connectedDeviceList",\n            sdpSubmission: "sdpSubmissionEvent",\n            sendingThroughputObservations: "sendingThroughputObservations",\n            limitationObservations: "limitationObservations",\n            userDetails: "userDetails"\n        }, c.callstatsChannels = {\n            sdpSubmission: "sdpSubmissionEvent",\n            processedStats: "processedStats",\n            callstatsEvent: "callStatsEvent",\n            userFeedback: "userFeedbackEvent",\n            preCallTest: "preCallTest",\n            senderConfiguration: "senderConfiguration"\n        }, c.precalltestEvents = {\n            results: "preCallTestResults",\n            associate: "preCallTestAssociate"\n        }, c.callstatsAPIReturnStatus = {\n            success: "success",\n            failure: "failure"\n        }, c.fabricUsage = {\n            audio: "audio",\n            video: "video",\n            data: "data",\n            screen: "screen",\n            multiplex: "multiplex",\n            unbundled: "unbundled"\n        }, c.userIdType = {\n            local: "local",\n            remote: "remote"\n        }, c.qualityRating = {\n            excellent: 5,\n            good: 4,\n            fair: 3,\n            poor: 2,\n            bad: 1\n        }, c.reportType = {\n            local: "local",\n            remote: "remote",\n            inbound: "inbound",\n            outbound: "outbound"\n        }, c.avQualityRatings = {\n            excellent: "excellent",\n            fair: "fair",\n            bad: "bad",\n            unknown: "unknown"\n        }, c.fabricState = {\n            established: "established",\n            initializing: "initializing",\n            failed: "failed",\n            disrupted: "disrupted",\n            hold: "hold",\n            checkingDisrupted: "checkingDisrupted",\n            terminated: "terminated"\n        }, c.webRTCFunctions = {\n            createOffer: "createOffer",\n            createAnswer: "createAnswer",\n            setLocalDescription: "setLocalDescription",\n            setRemoteDescription: "setRemoteDescription",\n            addIceCandidate: "addIceCandidate",\n            getUserMedia: "getUserMedia",\n            iceConnectionFailure: "iceConnectionFailure",\n            signalingError: "signalingError",\n            applicationError: "applicationError",\n            applicationLog: "applicationLog"\n        }, c.callFailureReasons = {\n            mediaConfigError: "MediaConfigError",\n            negotiationFailure: "NegotiationFailure",\n            sdpError: "SDPGenerationError",\n            iceFailure: "IceConnectionFailure",\n            transportFailure: "TransportFailure",\n            signalingError: "SignalingError",\n            applicationError: "ApplicationError",\n            applicationLog: "ApplicationLog",\n            invalidWebRTCFunctionName: "Invalid WebRTC function name"\n        }, c.throughputThreshold = {\n            video: {\n                green: 1024,\n                red: 256\n            },\n            audio: {\n                green: 30,\n                red: 8\n            }\n        }, c.currOverPrevFrameRateThreshold = {\n            video: {\n                green: .8,\n                red: .3\n            }\n        }, c.rttThreshold = {\n            video: {\n                green: 400,\n                red: 1e3\n            }\n        }, c.fractionalLossThreshold = {\n            video: {\n                green: .1,\n                red: .5\n            },\n            audio: {\n                green: .15,\n                red: .3\n            }\n        }, c.eModelThreshold = {\n            audio: {\n                green: 240,\n                red: 400\n            }\n        }, c.codeBaseType = {\n            chrome: "Chrome",\n            firefox: "Firefox",\n            edge: "Edge",\n            plugin: "Plugin"\n        }, c.browserName = {\n            chrome: "Chrome",\n            firefox: "Firefox",\n            edge: "Edge",\n            msie: "Microsoft Internet Explorer",\n            safari: "Safari",\n            opera: "Opera"\n        }, c.osName = {\n            windows: "Windows",\n            mac: "Mac OS X",\n            android: "Android",\n            ios: "iOS"\n        }, c.mediaType = {\n            audio: "audio",\n            video: "video"\n        }, c.streamType = {\n            inbound: "inbound",\n            outbound: "outbound"\n        }, c.fabricStateChangeType = {\n            signalingState: "signalingState",\n            iceConnectionState: "iceConnectionState",\n            iceGatheringState: "iceGatheringState"\n        }, c.transportType = {\n            rest: "rest",\n            ws: "ws"\n        }, c.wsConnectionState = {\n            initiated: "initiated",\n            connected: "connected",\n            closed: "closed"\n        }, c.csCallBackMessages = {\n            authSuccessful: "SDK authentication successful.",\n            authFailed: "SDK authentication failed.",\n            authProtocolInvalid: "Fatal authentication error. Invalid auth protocol message.",\n            authOngoing: "Authentication on going.",\n            wsConnected: "WebSocket establishment successful.",\n            wsClosed: "WebSocket server closed.",\n            wsFailed: "WebSocket establishment failed."\n        }, c.oneWayMediaTypes = {\n            audio: "audio",\n            video: "video",\n            screen: "screen"\n        }, c.limitationType = {\n            cpu: "cpu",\n            network: "network"\n        }, c.qualityDisruptionTypes = {\n            qpchange: "qpchange"\n        }, c.callbackFunctions = {\n            stats: "stats",\n            defaultConfig: "defaultConfig",\n            recommendedConfig: "recommendedConfig",\n            preCallTestResults: "preCallTestResults",\n            preCallTest: "preCallTest"\n        }, c.endpointType = {\n            peer: "peer",\n            server: "server"\n        }, c.transmissionDirection = {\n            sendonly: "sendonly",\n            receiveonly: "receiveonly",\n            sendrecv: "sendrecv",\n            inactive: "inactive"\n        }, c.tmpConferenceId = "csio-conf-id-tmp";\n    }, {} ],\n    34: [ function(a, b, c) {\n        "use strict";\n        function d(a) {\n            c.configServiceUrl = m = a;\n        }\n        function e(a) {\n            c.authServiceUrl = n = a;\n        }\n        function f(a) {\n            c.conferenceBaseUrl = o = a;\n        }\n        function g(a) {\n            c.wsUrl = p = a;\n        }\n        function h(a) {\n            c.restEventUrl = q = a;\n        }\n        function i(a) {\n            c.restStatsUrl = r = a;\n        }\n        function j(a) {\n            c.baseUrl = s = a;\n        }\n        function k(a) {\n            c.qmodelThresholdsAPIUrl = t = a;\n        }\n        function l(a) {\n            c.transportType = u = a;\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.setConfigServiceUrl = d, c.setAuthServiceUrl = e, c.setConferenceBaseUrl = f, \n        c.setWsUrl = g, c.setRestEventUrl = h, c.setRestStatsUrl = i, c.setBaseUrl = j, \n        c.setQmodelThresholdsAPIUrl = k, c.setTransportType = l;\n        var m = (c.version = "3.53.1", c.configServiceUrl = "https://appsettings.callstats.io/v1/apps/"), n = c.authServiceUrl = "https://auth.callstats.io/", o = (c.authRetryTimeout = 5e3, \n        c.conferenceBaseUrl = "https://dashboard.callstats.io/apps/"), p = c.wsUrl = "wss://collector.callstats.io:443/csiows/collectCallStats", q = c.restEventUrl = "https://events.callstats.io/v1/apps/", r = c.restStatsUrl = "https://stats.callstats.io/v1/apps/", s = c.baseUrl = "https://collector.callstats.io:443/", t = c.qmodelThresholdsAPIUrl = "https://dashboard.callstats.io/api-internal/v1/qmodelthresholds", u = (c.csioDebug = "false", \n        c.transportType = "@@transportType");\n    }, {} ],\n    35: [ function(a, b, c) {\n        "use strict";\n        function d(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }\n        function e(a) {\n            if (Array.isArray(a)) {\n                for (var b = 0, c = Array(a.length); b < a.length; b++) c[b] = a[b];\n                return c;\n            }\n            return Array.from(a);\n        }\n        function f(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        function g(a, b) {\n            if (!a) throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");\n            return !b || "object" != typeof b && "function" != typeof b ? a : b;\n        }\n        function h(a, b) {\n            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);\n            a.prototype = Object.create(b && b.prototype, {\n                constructor: {\n                    value: a,\n                    enumerable: !1,\n                    writable: !0,\n                    configurable: !0\n                }\n            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);\n        }\n        function i() {\n            Array.prototype.find || Object.defineProperty(Array.prototype, "find", {\n                value: function(a) {\n                    if (null === this) throw new TypeError("Array.prototype.find called on null or undefined");\n                    if ("function" != typeof a) throw new TypeError("predicate must be a function");\n                    for (var b = Object(this), c = b.length >>> 0, d = arguments[1], e = void 0, f = 0; f < c; f++) if (e = b[f], \n                    a.call(d, e, f, b)) return e;\n                }\n            });\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.MainFSM = c.MainEvents = void 0;\n        var j = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(a) {\n            return typeof a;\n        } : function(a) {\n            return a && "function" == typeof Symbol && a.constructor === Symbol && a !== Symbol.prototype ? "symbol" : typeof a;\n        }, k = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), l = a("./statemachine"), m = a("../utility/registry"), n = a("../utility/csiologger"), o = d(n), p = a("../utility/utils"), q = d(p), r = a("../utility/timestamps"), s = d(r), t = a("../config/constants"), u = d(t), v = a("../config/settings"), w = d(v), x = a("./utility"), y = d(x), z = a("../statspipeline/statsadapter"), A = a("../statspipeline/statsparser"), B = a("../statspipeline/statsmonitor"), C = a("../statspipeline/statstransmitter"), D = a("../statspipeline/statsassembler"), E = {\n            Created: "Created",\n            Initializing: "Initializing",\n            Idle: "Idle",\n            Run: "Run"\n        }, F = c.MainEvents = {\n            onStart: "onStart",\n            onInitialize: "onInitialize",\n            onAddNewFabric: "onAddNewFabric",\n            onSendFabricEvent: "onSendFabricEvent",\n            onReportError: "onReportError",\n            onAssociateMstWithUserID: "onAssociateMstWithUserID",\n            onSetProxyConfig: "onSetProxyConfig",\n            onAttachWifiStatsHandler: "onAttachWifiStatsHandler",\n            onSendUserFeedback: "onSendUserFeedback",\n            onOn: "onOn",\n            onSetIdentifiers: "onSetIdentifiers",\n            onMakePrecallTest: "onMakePrecallTest"\n        }, G = {\n            onServicesFinished: "onServicesFinished"\n        }, H = function(a) {\n            function b() {\n                f(this, b);\n                var a = g(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, E.Created));\n                return o.log("FSM:", a.getState()), a.fire(F.onStart), a.run(), i(), a;\n            }\n            return h(b, a), k(b, [ {\n                key: "proceed",\n                value: function(a, b) {\n                    switch (this.getState()) {\n                      case E.Created:\n                        switch (a) {\n                          case F.onStart:\n                            this.onStart.apply(this, e(b));\n                            break;\n\n                          case F.onInitialize:\n                            this.setState(E.Initializing), o.log("FSM:", this.getState()), this.onInitialize.apply(this, e(b));\n                            break;\n\n                          case F.onOn:\n                            this.onOn.apply(this, e(b));\n                            break;\n\n                          case F.onSetProxyConfig:\n                            this.onSetProxyConfig.apply(this, e(b));\n                        }\n                        break;\n\n                      case E.Initializing:\n                        switch (a) {\n                          case G.onServicesFinished:\n                            this.onServicesFinished() && (this.setState(E.Idle), o.log("FSM:", this.getState()));\n                            break;\n\n                          case F.onAddNewFabric:\n                            this.onAddNewFabric.apply(this, e(b));\n                            break;\n\n                          case F.onSendFabricEvent:\n                            this.onSendFabricEvent.apply(this, e(b));\n                            break;\n\n                          case F.onReportError:\n                            this.onReportError.apply(this, e(b));\n                            break;\n\n                          case F.onAssociateMstWithUserID:\n                            this.onAssociateMstWithUserID.apply(this, e(b));\n                            break;\n\n                          case F.onSendUserFeedback:\n                            this.onSendUserFeedback.apply(this, e(b));\n                            break;\n\n                          case F.onAttachWifiStatsHandler:\n                            this.onAttachWifiStatsHandler.apply(this, e(b));\n                            break;\n\n                          case F.onOn:\n                            this.onOn.apply(this, e(b));\n                            break;\n\n                          case F.onMakePrecallTest:\n                            this.onMakePrecallTest.apply(this, e(b));\n                            break;\n\n                          case F.onSetIdentifiers:\n                            this.onSetIdentifiers.apply(this, e(b));\n                            break;\n\n                          case F.onSetProxyConfig:\n                            this.onSetProxyConfig.apply(this, e(b));\n                        }\n                        break;\n\n                      case E.Idle:\n                      case E.Run:\n                        switch (a) {\n                          case F.onAddNewFabric:\n                            this.onAddNewFabric.apply(this, e(b));\n                            break;\n\n                          case F.onSendFabricEvent:\n                            this.onSendFabricEvent.apply(this, e(b));\n                            break;\n\n                          case F.onReportError:\n                            this.onReportError.apply(this, e(b));\n                            break;\n\n                          case F.onAssociateMstWithUserID:\n                            this.onAssociateMstWithUserID.apply(this, e(b));\n                            break;\n\n                          case F.onSendUserFeedback:\n                            this.onSendUserFeedback.apply(this, e(b));\n                            break;\n\n                          case F.onAttachWifiStatsHandler:\n                            this.onAttachWifiStatsHandler.apply(this, e(b));\n                            break;\n\n                          case F.onOn:\n                            this.onOn.apply(this, e(b));\n                            break;\n\n                          case F.onSetProxyConfig:\n                            this.onSetProxyConfig.apply(this, e(b));\n                            break;\n\n                          case F.onMakePrecallTest:\n                            this.onMakePrecallTest.apply(this, e(b));\n                            break;\n\n                          case F.onSetIdentifiers:\n                            this.onSetIdentifiers.apply(this, e(b));\n                        }\n                    }\n                }\n            }, {\n                key: "onStart",\n                value: function() {\n                    m.Registry.getEndpoint().setup(), this.authenticator = m.Registry.getAuthenticator(), \n                    this.configservicewrapper = m.Registry.getConfigServiceWrapper(), this.precalltest = m.Registry.getPreCallTest(), \n                    this.precalltestIds = [];\n                    var a = m.Registry.getStatsAdapter(), b = m.Registry.getStatsParser(), c = m.Registry.getStatsMonitor(), d = m.Registry.getStatsTransmitter(), e = m.Registry.getStatsAssembler();\n                    a.connect(z.StatsAdapterIO.RawStatsOut, b.getPort(A.StatsParserIO.RawStatsIn)), \n                    b.connect(A.StatsParserIO.PcStatsTupleOut, c.getPort(B.StatsMonitorIO.PcStatsTupleIn)), \n                    c.connect(B.StatsMonitorIO.StatsTupleOut, e.getPort(D.StatsAssemblerIO.StatsTupleIn)), \n                    e.connect(D.StatsAssemblerIO.CallstatsOut, d.getPort(C.StatsTransmitterIO.CallstatsIn)), \n                    a.connect(z.StatsAdapterIO.UnprocessedOut, d.getPort(C.StatsTransmitterIO.UnprocessedIn));\n                }\n            }, {\n                key: "setupConnection",\n                value: function() {\n                    var a = this;\n                    this.connectionManager = m.Registry.getConnectionManager(), this.connectionManager.setupCollectorConnection(m.Registry.getCredentials().getTransportType()), \n                    this.connectionManager.setup().then(function() {\n                        o.log("Connected to connectionManager"), a.fire(G.onServicesFinished), a.run();\n                    }).catch(function(a) {\n                        return o.log("Could not connect to connectionManager", a);\n                    });\n                }\n            }, {\n                key: "setup",\n                value: function() {\n                    var a = this;\n                    this.clocksync = m.Registry.getClockSync(), this.clocksync.initiate().then(function() {\n                        o.log("Clocksync completed"), a.fire(G.onServicesFinished), a.run();\n                    }).catch(function(a) {\n                        return o.log("Could not finish ClockSync", a);\n                    });\n                }\n            }, {\n                key: "onInitialize",\n                value: function(a, b, c, d, e, f) {\n                    var g = this, h = m.Registry.getCredentials();\n                    if (h.setAppId(a), h.setUserId(b), m.Registry.getCallbacks().set(u.callbackFunctions.stats, e), \n                    this.doPrecalltest = !0, f) {\n                        if (!0 === f.disableBeforeUnloadHandler && this.setBeforeUnloadHandler(), f.applicationVersion) {\n                            m.Registry.getEndpoint().setAppVersion(f.applicationVersion);\n                        }\n                        f.transportType && w.setTransportType(f.transportType), f.disablePrecalltest && (this.doPrecalltest = !1);\n                    }\n                    this.setup(), this.authenticator.initiate(c, d).then(function(a) {\n                        o.log("Authentication complete"), g.setupConnection();\n                        var b = m.Registry.getCredentials().getStatsSubmissionInterval();\n                        m.Registry.getStatsMonitor().setIntervals(b, b), g.fire(G.onServicesFinished), g.run();\n                        var c = g.authenticator.getIceServers();\n                        c && g.doPrecalltest && g.precalltest.start(c, "callstats", g.precalltestCallback.bind(g)), \n                        g.configservicewrapper.initiateInternalConfig().then(function() {\n                            o.log("ConfigService internal config:", g.configservicewrapper.getInternalConfig()), \n                            g.fire(G.onServicesFinished), g.run();\n                        }, function(a) {\n                            return o.log(a);\n                        }), g.configservicewrapper.initiateAppConfig().then(function() {\n                            var a = m.Registry.getCallbacks().get(u.callbackFunctions.defaultConfig), b = g.configservicewrapper.getAppDefaultConfig();\n                            a && b && a(b);\n                            var c = m.Registry.getCallbacks().get(u.callbackFunctions.recommendedConfig), d = g.configservicewrapper.getAppRecommendedConfig();\n                            c && d && c(d), g.fire(G.onServicesFinished), g.run();\n                        }, function(a) {\n                            return o.log(a);\n                        });\n                    }, function(a) {\n                        o.log(a);\n                    });\n                }\n            }, {\n                key: "precalltestCallback",\n                value: function(a, b) {\n                    var c = m.Registry.getCallbacks().get(u.callbackFunctions.preCallTestResults), d = m.Registry.getCallbacks().get(u.callbackFunctions.preCallTest);\n                    if (d && d(a), c) {\n                        if (b) {\n                            var e = {\n                                msg: "precalltest error: " + b\n                            };\n                            return o.warn("backendlog", e), m.Registry.getGenericEventHandler().sendEvent(u.logEvents.log, e), \n                            void c(u.callstatsAPIReturnStatus.failure, null);\n                        }\n                        var f = y.getPublicPrecalltestResults(a);\n                        c(u.callstatsAPIReturnStatus.success, f);\n                    }\n                    a && (this.precalltestIds.push(a.id), a.tests && a.tests.ice && ("" === a.tests.ice.turnIpAddress && delete a.tests.ice.turnIpAddress, \n                    "" === a.tests.ice.turnIpVersion && delete a.tests.ice.turnIpVersion, "" === a.tests.ice.turnTransport && delete a.tests.ice.turnTransport), \n                    o.log("sending preCallTest results", a), m.Registry.getEventMessageBuilder().make(u.precalltestEvents.results, null, null, {\n                        results: a\n                    }));\n                }\n            }, {\n                key: "setBeforeUnloadHandler",\n                value: function() {\n                    window && window.addEventListener && (o.log("setBeforeUnloadHandler"), window.addEventListener("beforeunload", function(a) {\n                        return m.Registry.getConferenceManager().conferenceMap.forEach(function(a, b) {\n                            a && a.getPeerConnectionManager().pcHandlers.forEach(function(a, b) {\n                                m.Registry.getEventMessageBuilder().make(u.internalFabricEvent.userLeft, a.getConferenceId(), a.getPeerConnection());\n                            });\n                        }), "Are you sure you want to close the call?";\n                    }));\n                }\n            }, {\n                key: "onServicesFinished",\n                value: function() {\n                    return !!(this.connectionManager && this.connectionManager.isReady() && this.clocksync.isCompleted() && this.authenticator.isCompleted()) && (m.Registry.getTransmissionManager().trySend(), \n                    !0);\n                }\n            }, {\n                key: "onAddNewFabric",\n                value: function(a, b, c, d, e, f, g) {\n                    o.warn("FSM onAddNewFabric"), m.Registry.getConferenceManager().add(d, m.Registry.getCredentials());\n                    var h = m.Registry.getConferenceManager().get(d);\n                    h.getPeerConnectionManager().addPcHandler(a, b, c, d, e, f, g);\n                    var i = {\n                        endpointInfo: m.Registry.getEndpoint().serialize()\n                    };\n                    m.Registry.getCredentials().getUserIdObject() && (i.localUserIDObject = m.Registry.getCredentials().getUserIdObject()), \n                    h.userJoinedSent || (m.Registry.getEventMessageBuilder().make(u.internalFabricEvent.userJoined, d, a, i), \n                    h.userJoinedSent = !0, m.Registry.getCredentials().getTransportType() === u.transportType.rest && i.localUserIDObject && i.localUserIDObject.userName && m.Registry.getEventMessageBuilder().make(u.internalFabricEvent.userDetails, d, a, {\n                        userName: String(i.localUserIDObject.userName)\n                    }));\n                    var j = this.precalltestIds;\n                    this.precalltestIds = [];\n                    var k = this.precalltest.getId();\n                    k && j.push(k), j.length > 0 && m.Registry.getEventMessageBuilder().make(u.precalltestEvents.associate, d, a, {\n                        ids: j\n                    });\n                }\n            }, {\n                key: "onSendFabricEvent",\n                value: function(a, b, c, d) {\n                    o.warn("FSM onSendFabricEvent");\n                    var e = {};\n                    if (d && (e = d, e.ssrc && (e.ssrc = String(e.ssrc))), b === u.fabricEvent.activeDeviceList) {\n                        e = {\n                            mediaDeviceList: q.normalizeMediaDeviceList(d.deviceList)\n                        };\n                    }\n                    m.Registry.getEventMessageBuilder().make(b, c, a, e);\n                    var f = m.Registry.getConferenceManager().get(c);\n                    if (f) {\n                        var g = f.getPeerConnectionManager().getPcHandler(a);\n                        b !== u.fabricEvent.fabricTerminated && b !== u.internalFabricEvent.fabricSetupFailed || (g.stopUserAliveHandler(), \n                        g.setPcState(u.fabricState.terminated), g.stopStatsPolling(), f.getPeerConnectionManager().removePcHandler(a)), \n                        b === u.fabricEvent.fabricHold && (g.setPcState(u.fabricState.hold), g.stopStatsPolling()), \n                        b === u.fabricEvent.fabricResume && (g.setPcState(u.fabricState.established), g.startStatsPolling());\n                    }\n                }\n            }, {\n                key: "onReportError",\n                value: function(a, b, c, d, e, f) {\n                    o.warn("FSM onReportError");\n                    var g = {\n                        failureDelay: 0,\n                        reason: this.callFailureClassifier(c),\n                        function: c,\n                        magicKey: m.Registry.getEndpoint().getMagicKey(),\n                        endpoint: m.Registry.getEndpoint().serialize(),\n                        level: "debug"\n                    };\n                    if (d) {\n                        var h = this.formatDomError(d);\n                        g.message = h.message, g.messageType = h.messageType, g.name = d.name, g.stack = d.stack;\n                    }\n                    if (a) {\n                        var i = m.Registry.getConferenceManager().get(b), j = void 0;\n                        if (i && (j = i.getPeerConnectionManager().getPcHandler(a)), !j) return void o.error("onReportError: No handler found for given PeerConnection!");\n                        if (g.failureDelay = s.getCurrent() - j.getStartTime(), g.fabricState = j.getPcState(), \n                        g.iceConnectionState = j.getIceConnectionState(), (e || f || a && "closed" !== a.signalingState) && m.Registry.getCredentials().getCollectSDP() && c === u.fabricEvent.fabricSetupFailed) {\n                            var k = {};\n                            k.localSDP = this.pickSDP(a, e, "localDescription"), k.remoteSDP = this.pickSDP(a, f, "remoteDescription"), \n                            m.Registry.getEventMessageBuilder().make(u.callstatsChannels.sdpSubmission, b, a, k);\n                        }\n                    }\n                    c === u.webRTCFunctions.applicationLog || c === u.webRTCFunctions.applicationError ? m.Registry.getEventMessageBuilder().make(u.fabricEvent.applicationErrorLog, b, a, g) : (m.Registry.getEventMessageBuilder().make(u.fabricEvent.fabricSetupFailed, b, a, g), \n                    c === u.webRTCFunctions.getUserMedia && this.handleGUMErrors(b));\n                }\n            }, {\n                key: "onAssociateMstWithUserID",\n                value: function(a, b, c, d, e, f) {\n                    var g = m.Registry.getConferenceManager().get(c);\n                    if (g) {\n                        var h = g.getPeerConnectionManager().getPcHandler(a);\n                        "string" != typeof d && (d += ""), h.updateSSRCInfo(d, b, e, f);\n                    }\n                }\n            }, {\n                key: "onAttachWifiStatsHandler",\n                value: function(a) {\n                    m.Registry.getWifiStatsExecutor().setGetWifiStatsMethod(a);\n                }\n            }, {\n                key: "onSetProxyConfig",\n                value: function(a) {\n                    o.warn("FSM onSetProxyConfig"), a.collectorURL && w.setBaseUrl(a.collectorURL), \n                    a.authServiceURL && w.setAuthServiceUrl(a.authServiceURL), a.csioInternalAPIURL && w.setQmodelThresholdsAPIUrl(a.csioInternalAPIURL), \n                    a.wsURL && w.setWsUrl(a.wsURL), a.restEventURL && w.setRestEventUrl(a.restEventURL), \n                    a.restStatsURL && w.setRestStatsUrl(a.restStatsURL), a.appSettingsURL && w.setConfigServiceUrl(a.appSettingsURL);\n                }\n            }, {\n                key: "onSendUserFeedback",\n                value: function(a, b, c) {\n                    var d = {\n                        feedback: {\n                            overallRating: b.overall\n                        }\n                    };\n                    b.video && (d.feedback.videoQualityRating = b.video), b.audio && (d.feedback.audioQualityRating = b.audio), \n                    b.comment && (d.feedback.comments = b.comment), m.Registry.getEventMessageBuilder().make(u.callstatsChannels.userFeedback, a, null, d);\n                }\n            }, {\n                key: "onOn",\n                value: function(a, b) {\n                    m.Registry.getCallbacks().set(a, b);\n                }\n            }, {\n                key: "onSetIdentifiers",\n                value: function(a, b) {\n                    if (a.conferenceID && (m.Registry.getConferenceManager().updateConferenceId(a.conferenceID), \n                    m.Registry.getTransmissionManager().updateConferenceId(a.conferenceID), m.Registry.getTransmissionManager().trySend()), \n                    a.remoteUserID && b) {\n                        var c = m.Registry.getConferenceManager().getConferenceForPc(b);\n                        if (!c) return void o.log("onSetIdentifiers conference not found");\n                        var d = c.getPeerConnectionManager().getPcHandler(b);\n                        if (!d) return void o.log("pcHandler not found");\n                        d.updateRemoteId(a.remoteUserID), m.Registry.getTransmissionManager().trySend();\n                    }\n                }\n            }, {\n                key: "onMakePrecallTest",\n                value: function(a, b) {\n                    var c = this, d = a, e = b || "callstats";\n                    a || (d = this.authenticator.getIceServers(), e = "callstats"), c.precalltest.start(d, e, c.precalltestCallback.bind(c));\n                }\n            }, {\n                key: "handleGUMErrors",\n                value: function(a) {\n                    var b = m.Registry.getConferenceManager().get(a);\n                    if (b || (m.Registry.getConferenceManager().add(a, m.Registry.getCredentials()), \n                    b = m.Registry.getConferenceManager().get(a)), !b.getUcId()) {\n                        var c = {\n                            endpointInfo: m.Registry.getEndpoint().serialize()\n                        };\n                        m.Registry.getEventMessageBuilder().make(u.internalFabricEvent.userJoined, a, null, c), \n                        b.userJoinedSent = !0;\n                    }\n                }\n            }, {\n                key: "callFailureClassifier",\n                value: function(a) {\n                    var b = void 0;\n                    return u.webRTCFunctions.hasOwnProperty(a) ? a === u.webRTCFunctions.createOffer || a === u.webRTCFunctions.createAnswer || a === u.webRTCFunctions.setRemoteDescription ? b = u.callFailureReasons.negotiationFailure : a === u.webRTCFunctions.setLocalDescription ? b = u.callFailureReasons.sdpError : a === u.webRTCFunctions.addIceCandidate ? b = u.callFailureReasons.sdpError : a === u.webRTCFunctions.getUserMedia ? b = u.callFailureReasons.mediaConfigError : a === u.webRTCFunctions.iceConnectionFailure ? b = u.callFailureReasons.iceFailure : a === u.webRTCFunctions.signalingError ? b = u.callFailureReasons.signalingError : (a === u.webRTCFunctions.applicationLog || u.webRTCFunctions.applicationError) && (b = u.callFailureReasons.applicationLog) : b = u.callFailureReasons.invalidWebRTCFunctionName, \n                    b;\n                }\n            }, {\n                key: "formatDomError",\n                value: function(a) {\n                    var b = {}, c = {};\n                    a && (window.DOMException && a instanceof window.DOMException ? (c.message = a.message, \n                    c.name = a.name, b.messageType = "domError") : "object" === (void 0 === a ? "undefined" : j(a)) ? (a.message && (c.message = a.message), \n                    a.name && (c.name = a.name), a.constraintName && (c.name = a.constraintName), a.stack && (c.stack = a.stack), \n                    b.messageType = "json") : (c = a, b.messageType = "text"));\n                    var d = this.truncateLog(c);\n                    return "object" === (void 0 === d ? "undefined" : j(d)) ? b.message = JSON.stringify(d) : b.message = d, \n                    b;\n                }\n            }, {\n                key: "pickSDP",\n                value: function(a, b, c) {\n                    return b || (a && a[c] ? a[c].sdp : "");\n                }\n            }, {\n                key: "truncateString",\n                value: function(a) {\n                    return a.length > 2e4 && (o.log("Log exceeds 20kb, It will be truncated"), a = a.substring(0, 2e4)), \n                    a;\n                }\n            }, {\n                key: "truncateLog",\n                value: function(a) {\n                    return a ? ("string" == typeof a ? a = this.truncateString(a) : "object" === (void 0 === a ? "undefined" : j(a)) && a.message && (a.message = this.truncateString(a.message)), \n                    a) : a;\n                }\n            } ]), b;\n        }(l.StateMachine);\n        c.MainFSM = H;\n    }, {\n        "../config/constants": 33,\n        "../config/settings": 34,\n        "../statspipeline/statsadapter": 69,\n        "../statspipeline/statsassembler": 70,\n        "../statspipeline/statsmonitor": 72,\n        "../statspipeline/statsparser": 73,\n        "../statspipeline/statstransmitter": 74,\n        "../utility/csiologger": 88,\n        "../utility/registry": 95,\n        "../utility/timestamps": 99,\n        "../utility/utils": 101,\n        "./statemachine": 37,\n        "./utility": 38\n    } ],\n    36: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        });\n        var e = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), f = function() {\n            function a(b, c) {\n                d(this, a), this.type = b, this.args = void 0 !== c ? c : null;\n            }\n            return e(a, [ {\n                key: "getType",\n                value: function() {\n                    return this.type;\n                }\n            }, {\n                key: "getArgs",\n                value: function() {\n                    return this.args;\n                }\n            } ]), a;\n        }();\n        c.ProgramEvent = f;\n    }, {} ],\n    37: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.StateMachine = void 0;\n        var e = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), f = a("./programevent"), g = a("../utility/csiologger"), h = function(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }(g), i = function() {\n            function a(b) {\n                d(this, a), this.events = [], this.state = b;\n            }\n            return e(a, [ {\n                key: "fire",\n                value: function(a) {\n                    for (var b = arguments.length, c = Array(b > 1 ? b - 1 : 0), d = 1; d < b; d++) c[d - 1] = arguments[d];\n                    var e = new f.ProgramEvent(a, c);\n                    this.events.push(e);\n                }\n            }, {\n                key: "proceed",\n                value: function(a, b) {\n                    h.warn("You need to overwrite the proceed function inan extended StateMachine");\n                }\n            }, {\n                key: "setState",\n                value: function(a) {\n                    this.state = a;\n                }\n            }, {\n                key: "getState",\n                value: function() {\n                    return this.state;\n                }\n            }, {\n                key: "run",\n                value: function() {\n                    if (!(this.events.length < 1)) {\n                        var a = this.events.shift();\n                        this.proceed(a.getType(), a.getArgs());\n                    }\n                }\n            } ]), a;\n        }();\n        c.StateMachine = i;\n    }, {\n        "../utility/csiologger": 88,\n        "./programevent": 36\n    } ],\n    38: [ function(a, b, c) {\n        "use strict";\n        function d(a) {\n            var b = {\n                mediaConnectivity: !1,\n                throughput: null,\n                fractionalLoss: null,\n                rtt: null\n            };\n            return a && a.tests ? (b.provider = a.provider, a.tests.rtt && (b.rtt = a.tests.rtt.median, \n            b.mediaConnectivity = !0), a.tests.throughput && (b.throughput = a.tests.throughput.average, \n            b.fractionalLoss = Math.max(a.tests.throughput.fractionLostBytes, 0), b.mediaConnectivity = !0), \n            a.tests.ice && (a.tests.ice.relayTcpSuccess || a.tests.ice.relayTlsSuccess || a.tests.ice.relayUdpSuccess) && (b.mediaConnectivity = !0), \n            b) : b;\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.getPublicPrecalltestResults = d;\n    }, {} ],\n    39: [ function(a, b, c) {\n        "use strict";\n        function d(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }\n        function e(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.GetStatsHandler = void 0;\n        var f = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), g = a("../config/constants"), h = d(g), i = a("../statspipeline/statsadapter"), j = a("../utility/registry"), k = a("../utility/rttregistry"), l = a("../utility/csiologger"), m = d(l), n = function() {\n            function a(b, c, d, f, g) {\n                e(this, a), this.pc = b, this.interval = d, this.codeBase = f, this.browserName = g, \n                this.getStatsTimer = null, this.isPromiseBased = !0, this.pcHash = c, this.genericevent = j.Registry.getGenericEventHandler();\n            }\n            return f(a, [ {\n                key: "startStatsPolling",\n                value: function() {\n                    var a = this;\n                    a.getStatsTimer || (m.log("startStatsPolling for ", a.pcHash), this.getStatsTimer = setInterval(function() {\n                        a.csioGetStats(a.statsHandler, a.pcHash);\n                    }, a.interval));\n                }\n            }, {\n                key: "stopStatsPolling",\n                value: function() {\n                    this.getStatsTimer && (clearInterval(this.getStatsTimer), this.getStatsTimer = null);\n                }\n            }, {\n                key: "csioGetStats",\n                value: function(a, b) {\n                    var c = h.codeBaseType.firefox, d = h.codeBaseType.chrome, e = h.codeBaseType.edge, f = h.browserName.safari;\n                    if (this.pc) {\n                        if ("closed" === this.pc.iceConnectionState) return void this.stopStatsPolling();\n                        try {\n                            this.isTemaSys() ? this.getStatsTemasys(a, b) : this.codeBase === c ? this.getStatsFirefox(a, b) : this.browserName === f ? this.getStatsSafari(a, b) : this.codeBase === d ? this.getStatsChrome(a, b) : this.codeBase === e && this.getStatsEdge(a, b);\n                        } catch (a) {\n                            m.log("csioGetStats: Error ", a);\n                        }\n                    }\n                }\n            }, {\n                key: "getStatsTemasys",\n                value: function(a, b) {\n                    this.pc.getStats(null, function(c) {\n                        a(c, b);\n                    }, function(a) {\n                        m.log("getStatsTemasys error", a);\n                    });\n                }\n            }, {\n                key: "getStatsFirefox",\n                value: function(a, b) {\n                    var c = this, d = this.pc;\n                    if (!c.isPromiseBased) return void d.getStats(null, function(c) {\n                        a(c, b);\n                    });\n                    try {\n                        d.getStats().then(function(c) {\n                            a(c, b);\n                        }).catch(function(e) {\n                            c.isPromiseBased = !1, d.getStats(null, function(c) {\n                                a(c, b);\n                            });\n                        });\n                    } catch (e) {\n                        c.isPromiseBased = !1, c.genericevent.sendEvent(h.logEvents.getStatsError, {\n                            msg: "Firefox getStats reports error ",\n                            error: e.message + ":" + e.stack\n                        }), d.getStats(null, function(c) {\n                            a(c, b);\n                        });\n                    }\n                }\n            }, {\n                key: "getStatsChrome",\n                value: function(a, b) {\n                    var c = this, d = c.pc;\n                    if (window && window.csioReactNative) return void d.getStats(null, function(c) {\n                        a(c, b);\n                    }, function(a) {\n                        c.genericevent.sendEvent(h.logEvents.getStatsError, {\n                            msg: "react-native getStats reports error",\n                            error: a.message + ":" + a.stack\n                        });\n                    });\n                    if (!c.isPromiseBased) return void d.getStats(function(c) {\n                        a(c, b);\n                    });\n                    try {\n                        d.getStats().then(function(c) {\n                            (0, k.getRTTRegistry)().update(d), a(c, b);\n                        }).catch(function(e) {\n                            m.log("Chrome getStats Error ", e), c.isPromiseBased = !1, c.genericevent.sendEvent(h.logEvents.getStatsError, {\n                                msg: "Chrome getStats reports error",\n                                error: e.message + ":" + e.stack\n                            }), d.getStats(function(c) {\n                                a(c, b);\n                            });\n                        });\n                    } catch (e) {\n                        c.isPromiseBased = !1, c.genericevent.sendEvent(h.logEvents.getStatsError, {\n                            msg: "Chrome getStats reports error",\n                            error: e.message + ":" + e.stack\n                        }), d.getStats(function(c) {\n                            a(c, b);\n                        });\n                    }\n                }\n            }, {\n                key: "getStatsEdge",\n                value: function(a, b) {\n                    var c = this;\n                    c.pc.getStats().then(function(c) {\n                        a(c, b);\n                    }).catch(function(d) {\n                        a({}, b), d ? c.genericevent.sendEvent(h.logEvents.getStatsError, {\n                            msg: "Edge getStats reports error",\n                            error: d.message + ":" + d.stack\n                        }) : c.genericevent.sendEvent(h.logEvents.getStatsError, {\n                            msg: "Edge getStats reports error"\n                        });\n                    });\n                }\n            }, {\n                key: "getStatsSafari",\n                value: function(a, b) {\n                    var c = this;\n                    c.pc.getStats().then(function(c) {\n                        a(c, b);\n                    }).catch(function(a) {\n                        c.genericevent.sendEvent(h.logEvents.getStatsError, {\n                            msg: "Safari getStats reports error",\n                            error: a.message + ":" + a.stack\n                        });\n                    });\n                }\n            }, {\n                key: "statsHandler",\n                value: function(a, b) {\n                    var c = j.Registry.getStatsAdapter();\n                    if (a && c) try {\n                        c.transmit(i.StatsAdapterIO.RawStatsIn, a, b);\n                    } catch (a) {\n                        m.log("statsHandler 123: Error ", a), j.Registry.getGenericEventHandler().sendEvent(h.logEvents.error, {\n                            msg: "statsHandler: Error",\n                            error: a.message + ":" + a.stack\n                        });\n                    }\n                }\n            }, {\n                key: "iceCandidatesHandler",\n                value: function(a, b) {\n                    var c = j.Registry.getStatsAdapter(), d = void 0;\n                    d = c.getIceCandidates(a), b(d);\n                }\n            }, {\n                key: "getIceCandidates",\n                value: function() {\n                    var a = this;\n                    return new Promise(function(b, c) {\n                        a.csioGetStats(a.iceCandidatesHandler, function(a) {\n                            b(a);\n                        });\n                    });\n                }\n            }, {\n                key: "isTemaSys",\n                value: function() {\n                    return !!(window && window.AdapterJS && window.AdapterJS.WebRTCPlugin && window.AdapterJS.WebRTCPlugin.plugin);\n                }\n            } ]), a;\n        }();\n        c.GetStatsHandler = n;\n    }, {\n        "../config/constants": 33,\n        "../statspipeline/statsadapter": 69,\n        "../utility/csiologger": 88,\n        "../utility/registry": 95,\n        "../utility/rttregistry": 96\n    } ],\n    40: [ function(a, b, c) {\n        "use strict";\n        function d(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }\n        function e(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.PcCallbackHandler = void 0;\n        var f = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), g = a("../config/constants"), h = d(g), i = a("../utility/registry"), j = a("../utility/timestamps"), k = d(j), l = a("../config/callstatserrors"), m = d(l), n = a("../utility/csiologger"), o = d(n), p = function() {\n            function a(b, c, d, f, g, j) {\n                var l = this;\n                e(this, a), c && (this.conferenceId = b, this.pc = c, this.getStatsHandler = d, \n                this.userAlive = f, this.callback = j, this.remoteId = g, this.clocksync = i.Registry.getClockSync(), \n                this.emb = i.Registry.getEventMessageBuilder(), this.precalltest = i.Registry.getPreCallTest(), \n                this.genericevent = i.Registry.getGenericEventHandler(), this.iceCandidates = [], \n                this.iceConnectionState = c.iceConnectionState, this.iceGatheringState = c.iceGatheringState, \n                this.signalingState = c.signalingState, this.oldIceConnectionState = "", this.oldIceGatheringState = "", \n                this.iceConnectionStateTS = "", this.negotiationNeeded = 0, this.pcState = h.fabricState.initializing, \n                this.disruptedTS = 0, this.connectionDisruptedTS = 0, this.startTime = k.getCurrent(), \n                this.established = !1, this.activeIceCandidatePair = null, this.prevActiveIceCandidatePair = null, \n                this.localIceCandidates = [], this.remoteIceCandidates = [], this.iceCandidatePairs = [], \n                this.iceConnectivityDelay = 0, this.iceGatheringDelay = 0, this.fabricSetupSent = !1, \n                this.pc && this.pc.addEventListener ? (this.pc.addEventListener("icecandidate", this.iceCandidateCallback.bind(this), !1), \n                this.pc.addEventListener("iceconnectionstatechange", this.iceConnectionStateChangeCallback.bind(this), !1), \n                this.pc.addEventListener("signalingstatechange", this.pcSignalingStateChangeCallback.bind(this), !1), \n                this.pc.addEventListener("negotiationneeded", this.pcNegotiationNeededCallback.bind(this), !1)) : this.pc && this.pc.attachEvent ? (o.info("attachEvent"), \n                this.pc.attachEvent("onicecandidate", this.iceCandidateCallback.bind(this)), this.pc.attachEvent("oniceconnectionstatechange", this.iceConnectionStateChangeCallback.bind(this)), \n                this.pc.attachEvent("onsignalingstatechange", this.pcSignalingStateChangeCallback.bind(this)), \n                this.pc.attachEvent("onnegotiationneeded", this.pcNegotiationNeededCallback.bind(this))) : o.error("callstats cannot monitor or collect stats"), \n                !c || "connected" !== c.iceConnectionState && "completed" !== c.iceConnectionState || (this.pcState = h.fabricState.established, \n                this.getStatsHandler.getIceCandidates().then(function(a) {\n                    l.localIceCandidates = a.localIceCandidates, l.remoteIceCandidates = a.remoteIceCandidates, \n                    l.iceCandidatePairs = a.iceCandidatePairs, l.prevActiveIceCandidatePair = l.activeIceCandidatePair, \n                    l.activeIceCandidatePair = l.getActiveIceCandidatePair(), l.sendfabricSetup(), l.startStatsPolling();\n                })));\n            }\n            return f(a, [ {\n                key: "iceCandidateCallback",\n                value: function(a) {\n                    if (a && a.candidate) {\n                        var b = a.candidate.candidate.split(" ");\n                        if ("0" !== b[4] && "0" !== b[5]) {\n                            var c = -1 !== b[4].indexOf(":"), d = "1" === b[1] ? "rtp" : "rtcp", e = {\n                                transport: b[2],\n                                protocol: d,\n                                typePreference: b[3],\n                                address: c ? "[" + b[4] + "]:" + b[5] : b[4] + ":" + b[5],\n                                type: b[7],\n                                media: a.candidate.sdpMid\n                            };\n                            -1 === this.iceCandidates.indexOf(e) && (this.iceCandidates.push(e), o.warn("CALLBACK: ICE candidate", e));\n                        }\n                    }\n                }\n            }, {\n                key: "iceConnectionStateChangeCallback",\n                value: function(a) {\n                    var b = this;\n                    if (a) {\n                        o.log("pc states ", this.pc.iceGatheringState, this.pc.iceConnectionState), this.iceConnectionStateTS = this.clocksync.getSynchronizedTimestamp(), \n                        this.handleIceGatheringState(), this.handleIceConnectionState(), o.log("states ", this.iceGatheringState, this.iceConnectionState), \n                        "complete" === this.iceGatheringState && "checking" === this.iceConnectionState && this.handleIceChecking();\n                        var c = {\n                            prevIceConnectionState: this.oldIceConnectionState,\n                            currIceConnectionState: this.iceConnectionState\n                        }, d = this.iceConnectionState;\n                        this.getStatsHandler.getIceCandidates().then(function(a) {\n                            b.localIceCandidates = a.localIceCandidates, b.remoteIceCandidates = a.remoteIceCandidates, \n                            b.iceCandidatePairs = a.iceCandidatePairs, b.prevActiveIceCandidatePair = b.activeIceCandidatePair, \n                            b.activeIceCandidatePair = b.getActiveIceCandidatePair(), "connected" === d || "completed" === d ? b.handleIceConnectedOrCompleted(c) : "failed" === d ? b.handleIceFailed(c) : "disconnected" === d ? b.handleIceDisconnected(c) : "closed" === d ? b.handleIceClosed(c) : "new" === d && b.handleIceRestart(c);\n                        });\n                    }\n                }\n            }, {\n                key: "sendFabricStateChange",\n                value: function(a) {\n                    this.emb.make(h.internalFabricEvent.fabricStateChange, this.conferenceId, this.pc, a);\n                }\n            }, {\n                key: "handleIceConnectionState",\n                value: function() {\n                    this.oldIceConnectionState = this.iceConnectionState, this.iceConnectionState = this.pc.iceConnectionState, \n                    o.warn("CALLBACK: ICE connection state change", this.oldIceConnectionState, "->", this.iceConnectionState);\n                    var a = {\n                        changedState: h.fabricStateChangeType.iceConnectionState,\n                        prevState: this.oldIceConnectionState,\n                        newState: this.iceConnectionState\n                    };\n                    this.sendFabricStateChange(a);\n                }\n            }, {\n                key: "handleIceGatheringState",\n                value: function() {\n                    if (this.iceGatheringState !== this.pc.iceGatheringState) {\n                        "complete" === this.pc.iceGatheringState && (this.iceGatheringDelay = k.getCurrent() - this.startTime), \n                        this.oldIceGatheringState = this.iceGatheringState, this.iceGatheringState = this.pc.iceGatheringState, \n                        o.warn("CALLBACK: ICE gathering state change", this.oldIceGatheringState, "->", this.iceGatheringState);\n                        var a = {\n                            changedState: h.fabricStateChangeType.iceGatheringState,\n                            prevState: this.oldIceGatheringState,\n                            newState: this.iceGatheringState\n                        };\n                        this.sendFabricStateChange(a);\n                    }\n                }\n            }, {\n                key: "handleIceChecking",\n                value: function() {\n                    var a = k.getCurrent();\n                    if ("disconnected" === this.oldIceConnectionState && (this.pcState === h.fabricState.checkingDisrupted || this.pcState === h.fabricState.disrupted)) {\n                        var b = {\n                            prevIceConnectionState: this.oldIceConnectionState,\n                            currIceConnectionState: this.iceConnectionState,\n                            delay: a - this.connectionDisruptedTS\n                        };\n                        this.pcState === h.fabricState.disrupted && (b.prevIceCandidatePair = this.prevActiveIceCandidatePair, \n                        b.currIceCandidatePair = this.activeIceCandidatePair, b.delay = a - this.disruptedTS, \n                        this.emb.make(h.internalFabricEvent.iceDisruptionEnd, this.conferenceId, this.pc, b)), \n                        this.pcState = h.fabricState.initializing, this.emb.make(h.internalFabricEvent.iceConnectionDisruptionEnd, this.conferenceId, this.pc, b);\n                    }\n                }\n            }, {\n                key: "handleIceConnectedOrCompleted",\n                value: function(a) {\n                    var b = k.getCurrent();\n                    this.pcState === h.fabricState.disrupted && (a.prevIceCandidatePair = this.prevActiveIceCandidatePair, \n                    a.currIceCandidatePair = this.activeIceCandidatePair, a.delay = b - this.disruptedTS, \n                    this.emb.make(h.internalFabricEvent.iceDisruptionEnd, this.conferenceId, this.pc, a)), \n                    this.iceConnectivityDelay = b - this.startTime, this.established = !0, this.pcState = h.fabricState.established, \n                    this.sendfabricSetup(), this.startStatsPolling();\n                }\n            }, {\n                key: "sendfabricSetup",\n                value: function() {\n                    if (this.fabricSetupSent) return void o.log("fabricSetup has been sent already");\n                    var a = {\n                        delay: k.getCurrent() - this.startTime,\n                        iceGatheringDelay: this.iceGatheringDelay,\n                        iceConnectivityDelay: this.iceConnectivityDelay,\n                        localIceCandidates: this.localIceCandidates,\n                        remoteIceCandidates: this.remoteIceCandidates,\n                        iceCandidatePairs: this.iceCandidatePairs\n                    }, b = this.getActiveIceCandidatePair();\n                    b && (a.selectedCandidatePairID = b.id), this.fabricSetupSent = !0;\n                    var c = void 0;\n                    if (this.conferenceId) {\n                        c = i.Registry.getConferenceManager().get(this.conferenceId).getPeerConnectionManager().getPcHandler(this.pc), \n                        a.remoteEndpointType = c.getRemoteEndpointType(), a.fabricTransmissionDirection = c.getFabricTransmissionDirection();\n                    }\n                    this.pcState = h.fabricState.established, this.emb.make(h.internalFabricEvent.fabricSetup, this.conferenceId, this.pc, a);\n                }\n            }, {\n                key: "isFabricSetupSent",\n                value: function() {\n                    return this.fabricSetupSent;\n                }\n            }, {\n                key: "startStatsPolling",\n                value: function() {\n                    this.getStatsHandler.startStatsPolling();\n                }\n            }, {\n                key: "stopStatsPolling",\n                value: function() {\n                    this.getStatsHandler.stopStatsPolling();\n                }\n            }, {\n                key: "handleIceFailed",\n                value: function(a) {\n                    a.currIceCandidatePair = this.activeIceCandidatePair, a.failureDelay = k.getCurrent() - this.startTime, \n                    a.delay = k.getCurrent() - this.startTime, this.pcState = h.fabricState.failed, \n                    "checking" === a.prevIceConnectionState ? this.sendIceFailed(a) : "completed" === a.prevIceConnectionState || "connected" === a.prevIceConnectionState ? this.emb.make(h.internalFabricEvent.fabricDropped, this.conferenceId, this.pc, a) : "disconnected" === a.prevIceConnectionState && this.established ? this.emb.make(h.internalFabricEvent.fabricDropped, this.conferenceId, this.pc, a) : "disconnected" === a.prevIceConnectionState && this.sendIceFailed(a);\n                }\n            }, {\n                key: "getActiveIceCandidatePair",\n                value: function() {\n                    var a = null, b = this.iceCandidatePairs;\n                    if (b && b.length > 0) {\n                        var c = b.filter(function(a) {\n                            return "true" === a.selected || "true" === a.googActiveConnection || !0 === a.selected || !0 === a.googActiveConnection;\n                        });\n                        c.length > 0 && (a = c[0]);\n                    }\n                    return a;\n                }\n            }, {\n                key: "sendIceFailed",\n                value: function(a) {\n                    a.localIceCandidates = this.localIceCandidates, a.remoteIceCandidates = this.remoteIceCandidates, \n                    a.iceCandidatePairs = this.iceCandidatePairs, o.log("sending icefailed ", a), this.emb.make(h.internalFabricEvent.iceFailed, this.conferenceId, this.pc, a);\n                }\n            }, {\n                key: "sendFabricTransportSwitch",\n                value: function(a) {\n                    var b = this, c = {};\n                    c.prevIceCandidatePair = b.activeIceCandidatePair, c.relayType = a, c.currIceConnectionState = b.iceConnectionState, \n                    c.prevIceConnectionState = b.oldIceConnectionState, c.switchDelay = null, b.getStatsHandler.getIceCandidates().then(function(a) {\n                        b.localIceCandidates = a.localIceCandidates, b.remoteIceCandidates = a.remoteIceCandidates, \n                        b.iceCandidatePairs = a.iceCandidatePairs, b.activeIceCandidatePair = b.getActiveIceCandidatePair(), \n                        c.currIceCandidatePair = b.activeIceCandidatePair, c.localIceCandidates = b.localIceCandidates, \n                        c.remoteIceCandidates = b.remoteIceCandidates, o.log("sending fabric transport switch ", c), \n                        "completed" !== c.currIceConnectionState && "connected" !== c.currIceConnectionState || "completed" !== c.prevIceConnectionState && "connected" !== c.prevIceConnectionState || b.emb.make(h.internalFabricEvent.fabricTransportSwitch, b.conferenceId, b.pc, c);\n                    });\n                }\n            }, {\n                key: "handleIceDisconnected",\n                value: function(a) {\n                    var b = k.getCurrent();\n                    this.startTime = b, a.prevIceConnectionStateTs = this.iceConnectionStateTS, a.currIceCandidatePair = this.activeIceCandidatePair, \n                    "connected" === a.prevIceConnectionState || "completed" === a.prevIceConnectionState ? (this.pcState = h.fabricState.disrupted, \n                    this.disruptedTS = b, this.emb.make(h.internalFabricEvent.iceDisruptionStart, this.conferenceId, this.pc, a), \n                    this.callback && this.callback(m.csError.appConnectivityError, "Connectivity check for PC object to " + this.remoteId + " failed.")) : "checking" === a.prevIceConnectionState && (this.pcState = h.fabricState.checkingDisrupted, \n                    this.connectionDisruptedTS = b, this.emb.make(h.internalFabricEvent.iceConnectionDisruptionStart, this.conferenceId, this.pc, a), \n                    this.callback && this.callback(m.csError.appConnectivityError, "Connectivity check for PC object to " + this.remoteId + " failed."));\n                }\n            }, {\n                key: "handleIceClosed",\n                value: function(a) {\n                    "new" === a.prevIceConnectionState || "checking" === a.prevIceConnectionState ? (a.failureDelay = k.getCurrent() - this.startTime, \n                    a.localIceCandidates = this.localIceCandidates, a.remoteIceCandidates = this.remoteIceCandidates, \n                    a.iceCandidatePairs = this.iceCandidatePairs, this.emb.make(h.internalFabricEvent.iceAborted, this.conferenceId, this.pc, a)) : "connected" !== a.prevIceConnectionState && "completed" !== a.prevIceConnectionState || (a.prevIceCandidatePair = this.activeIceCandidatePair, \n                    this.emb.make(h.internalFabricEvent.iceTerminated, this.conferenceId, this.pc, a)), \n                    this.pcState = h.fabricState.terminated, this.stopStatsPolling();\n                }\n            }, {\n                key: "handleIceRestart",\n                value: function(a) {\n                    a.prevIceCandidatePair = this.prevActiveIceCandidatePair, "new" !== a.prevIceConnectionState && (o.log("iceRestarted sending"), \n                    this.established = !1, this.emb.make(h.internalFabricEvent.iceRestarted, this.conferenceId, this.pc, a));\n                }\n            }, {\n                key: "pcSignalingStateChangeCallback",\n                value: function(a) {\n                    var b = this;\n                    if (a) {\n                        var c = this.signalingState;\n                        this.signalingState = this.pc.signalingState, o.warn("CALLBACK: signaling state change", c, "->", this.signalingState);\n                        var d = {\n                            changedState: h.fabricStateChangeType.signalingState,\n                            prevState: c,\n                            newState: this.signalingState\n                        };\n                        this.sendFabricStateChange(d), "have-remote-offer" !== this.signalingState && "stable" !== this.signalingState || (this.precalltest.callStarts(), \n                        this.genericevent.sendEvent(h.logEvents.log, {\n                            msg: "precalltest told to stop "\n                        })), "closed" === this.signalingState && (this.emb.make(h.fabricEvent.fabricTerminated, this.conferenceId, this.pc), \n                        this.userAlive.stop(), this.precalltest.callFinished(), this.stopStatsPolling(), \n                        this.pcState = h.fabricState.terminated), "have-local-offer" !== this.signalingState && "have-local-pranswer" !== this.signalingState && "stable" !== this.signalingState || (o.log(this.signalingState, ".. requesting sender config."), \n                        i.Registry.getConfigServiceWrapper().initiateSenderConfig(this.pc).then(function() {\n                            var a = i.Registry.getConfigServiceWrapper().getSenderConfig();\n                            o.log("Sender config:", a);\n                            var c = h.callstatsChannels.senderConfiguration;\n                            a && i.Registry.getEventMessageBuilder().make(c, b.conferenceId, b.pc, a);\n                        }).catch(function(a) {\n                            o.warn(a);\n                        }));\n                    }\n                }\n            }, {\n                key: "pcNegotiationNeededCallback",\n                value: function(a) {\n                    a && (this.negotiationNeeded++, this.startTime = k.getCurrent(), o.warn("CALLBACK: negotiation needed", this.negotiationNeeded));\n                }\n            } ]), a;\n        }();\n        c.PcCallbackHandler = p;\n    }, {\n        "../config/callstatserrors": 32,\n        "../config/constants": 33,\n        "../utility/csiologger": 88,\n        "../utility/registry": 95,\n        "../utility/timestamps": 99\n    } ],\n    41: [ function(a, b, c) {\n        "use strict";\n        function d(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }\n        function e(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.PeerConnectionHandler = void 0;\n        var f = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), g = a("../utility/registry"), h = a("../peerconnection/pccallbackhandler"), i = a("../browserapi/devices"), j = a("./useralivehandler"), k = a("./getstatshandler"), l = a("../config/constants"), m = d(l), n = a("../utility/timestamps"), o = d(n), p = a("../utility/csiologger"), q = d(p), r = function() {\n            function a(b) {\n                e(this, a), this.pc = b.pc, this.remoteId = b.remoteId, this.fabricUsage = b.fabricUsage, \n                this.callback = b.callback, this.conferenceId = b.conferenceId, this.remoteEndpointType = b.remoteEndpointType, \n                this.fabricTransmissionDirection = b.fabricTransmissionDirection, this.clocksync = g.Registry.getClockSync(), \n                this.startTime = this.clocksync.getSynchronizedTimestamp(), this.credentials = g.Registry.getCredentials(), \n                this.pcHash = this.generatePcHash(), this.ssrcMap = new Map(), this.localSdp = null, \n                this.remoteSdp = null, this.transportInfo = null, this.userAliveHandler = new j.UserAliveHandler(this.conferenceId, this.pc), \n                this.userAliveHandler.start(), this.emb = g.Registry.getEventMessageBuilder(), this.devices = new i.Devices(this.conferenceId, this.pc);\n                var c = g.Registry.getEndpoint();\n                this.getStatsHandler = new k.GetStatsHandler(this.pc, this.pcHash, 5e3, c.getCodeBase(), c.getBrowserName()), \n                this.pcCallbackHandler = new h.PcCallbackHandler(this.conferenceId, this.pc, this.getStatsHandler, this.userAliveHandler, this.remoteId, this.callback), \n                this.devices.collectConnected(), this.fabricTransmissionDirection || (this.fabricTransmissionDirection = "sendrecv"), \n                this.remoteEndpointType || (this.remoteEndpointType = "peer");\n            }\n            return f(a, [ {\n                key: "getFabricTransmissionDirection",\n                value: function() {\n                    return this.fabricTransmissionDirection;\n                }\n            }, {\n                key: "getRemoteEndpointType",\n                value: function() {\n                    return this.remoteEndpointType;\n                }\n            }, {\n                key: "stopUserAliveHandler",\n                value: function() {\n                    this.userAliveHandler.stop();\n                }\n            }, {\n                key: "getPcState",\n                value: function() {\n                    return this.pcCallbackHandler.pcState;\n                }\n            }, {\n                key: "stopStatsPolling",\n                value: function() {\n                    this.getStatsHandler.stopStatsPolling();\n                }\n            }, {\n                key: "startStatsPolling",\n                value: function() {\n                    this.getStatsHandler.startStatsPolling();\n                }\n            }, {\n                key: "setPcState",\n                value: function(a) {\n                    a in m.fabricState ? this.pcCallbackHandler.pcState = a : q.error("setPcState: Invalid state");\n                }\n            }, {\n                key: "getAppId",\n                value: function() {\n                    return this.credentials.getAppId();\n                }\n            }, {\n                key: "getLocalId",\n                value: function() {\n                    return this.credentials.getUserId();\n                }\n            }, {\n                key: "getConferenceId",\n                value: function() {\n                    return this.conferenceId;\n                }\n            }, {\n                key: "getPeerConnection",\n                value: function() {\n                    return this.pc;\n                }\n            }, {\n                key: "getRemoteId",\n                value: function() {\n                    return this.remoteId;\n                }\n            }, {\n                key: "isFabricSetupSent",\n                value: function() {\n                    return this.pcCallbackHandler.isFabricSetupSent();\n                }\n            }, {\n                key: "getStartTime",\n                value: function() {\n                    return this.startTime;\n                }\n            }, {\n                key: "getCallback",\n                value: function() {\n                    return this.callback;\n                }\n            }, {\n                key: "getPcHash",\n                value: function() {\n                    return this.pcHash;\n                }\n            }, {\n                key: "getIceCandidates",\n                value: function() {\n                    return this.pcCallbackHandler ? this.pcCallbackHandler.iceCandidates : null;\n                }\n            }, {\n                key: "getIceConnectionState",\n                value: function() {\n                    return this.pcCallbackHandler ? this.pcCallbackHandler.iceConnectionState : null;\n                }\n            }, {\n                key: "getNegotiationsNumber",\n                value: function() {\n                    return this.pcCallbackHandler ? this.pcCallbackHandler.negotiationNeeded : 0;\n                }\n            }, {\n                key: "sendFabricTransportSwitch",\n                value: function(a) {\n                    this.pcCallbackHandler && this.pcCallbackHandler.sendFabricTransportSwitch(a);\n                }\n            }, {\n                key: "getSdp",\n                value: function() {\n                    return {\n                        localSdp: this.localSdp,\n                        remoteSdp: this.remoteSdp\n                    };\n                }\n            }, {\n                key: "setSdp",\n                value: function(a, b) {\n                    this.localSdp = a, this.remoteSdp = b;\n                }\n            }, {\n                key: "generatePcHash",\n                value: function() {\n                    var a = (Math.random() + 1).toString(36);\n                    return a.substring(2, a.length);\n                }\n            }, {\n                key: "getTransportInfo",\n                value: function() {\n                    return this.transportInfo;\n                }\n            }, {\n                key: "setTransportInfo",\n                value: function(a) {\n                    this.transportInfo = a;\n                }\n            }, {\n                key: "updateSDP",\n                value: function(a) {\n                    var b = this, c = void 0, d = void 0;\n                    if (this.pc && this.pc.localDescription && (c = this.pc.localDescription.sdp), this.pc && this.pc.remoteDescription && (d = this.pc.remoteDescription.sdp), \n                    c && d && (c !== this.localSdp || d !== this.remoteSdp)) {\n                        this.parseSDP(c, m.streamType.outbound), this.parseSDP(d, m.streamType.inbound);\n                        var e = {\n                            localSDP: c !== this.localSdp ? c : "",\n                            remoteSDP: d !== this.remoteSdp ? d : ""\n                        };\n                        "" === c && "" === remoteSDP || !g.Registry.getCredentials().getCollectSDP() || this.emb.make(m.internalFabricEvent.sdpSubmission, this.conferenceId, this.pc, e), \n                        a && a.forEach(function(a) {\n                            var c = String(a.data.ssrc), d = b.ssrcMap.get(c);\n                            d || (d = {}), d.mediaType = a.data.mediaType, d.reportType = a.data.isRemote ? "remote" : "local", \n                            d.ssrc = c, b.ssrcMap.set(c, d);\n                        });\n                        var f = [];\n                        this.ssrcMap.forEach(function(a, b) {\n                            a.msid && a.mslabel && a.label && f.push(a);\n                        });\n                        for (var h = {\n                            ssrcData: f\n                        }, i = 0; i < h.ssrcData.length; i += 1) {\n                            h.ssrcData[i].userID = g.Registry.getCredentials().getUserId();\n                        }\n                        this.emb.make(m.internalFabricEvent.ssrcMap, this.conferenceId, this.pc, h), this.setSdp(c, d);\n                    }\n                }\n            }, {\n                key: "parseSDP",\n                value: function(a, b) {\n                    var c = this, d = RegExp.prototype.test.bind(/^([a-z])=(.*)/), e = /^ssrc:(\\d*) ([\\w_]*):(.*)/, f = /^ssrc-group:SIM (\\d*)/;\n                    a.split(/(\\r\\n|\\r|\\n)/).filter(d).forEach(function(a) {\n                        var d = a[0], g = a.slice(2);\n                        if ("a" === d && e.test(g)) {\n                            var h = g.match(e), i = h[1], j = h[2], k = h[3], l = c.ssrcMap.get(i);\n                            if (l || (l = {}), l.ssrc = i, l[j] = k, l.localStartTime = o.getCurrent(), l.syncedStartTime = c.clocksync.getSynchronizedTimestamp(), \n                            l.streamType = b, !f.test(g)) return void c.ssrcMap.set(i, l);\n                            l.ssrcGroup = {}, l.ssrcGroup[b] = {}, l.ssrcGroup[b].simulcastGroup = g.match(/\\d+/g), \n                            c.ssrcMap.set(i, l);\n                        }\n                    });\n                }\n            }, {\n                key: "getSSRCInfo",\n                value: function(a) {\n                    return this.ssrcMap.get(a);\n                }\n            }, {\n                key: "setupVideoTagMethods",\n                value: function(a, b) {\n                    var c = this, d = document.getElementById(a);\n                    d && (d.oncanplay = function() {\n                        var a = {\n                            ssrc: String(b),\n                            highResTs: o.getCurrent()\n                        };\n                        c.emb.make(m.internalFabricEvent.mediaPlaybackStart, c.conferenceId, c.pc, a);\n                    }, d.onsuspend = function() {\n                        var a = {\n                            ssrc: String(b),\n                            highResTs: o.getCurrent()\n                        };\n                        c.emb.make(m.internalFabricEvent.mediaPlaybackSuspended, c.conferenceId, c.pc, a);\n                    });\n                }\n            }, {\n                key: "updateSSRCInfo",\n                value: function(a, b, c, d) {\n                    var e = this.ssrcMap.get(a);\n                    e || (e = {}), e.ssrc = a, e.remoteUserID = b, e.usageLabel = c, e.associatedVideoTag = d, \n                    this.ssrcMap.set(a, e), d && b !== this.credentials.getUserId() && this.setupVideoTagMethods(d, a);\n                }\n            }, {\n                key: "updateConferenceId",\n                value: function(a) {\n                    this.conferenceId = a, this.userAliveHandler.updateConferenceId(a);\n                }\n            }, {\n                key: "updateRemoteId",\n                value: function(a) {\n                    this.remoteId = a;\n                }\n            } ], [ {\n                key: "Builder",\n                get: function() {\n                    return function() {\n                        function b() {\n                            e(this, b);\n                        }\n                        return f(b, [ {\n                            key: "withPc",\n                            value: function(a) {\n                                return this.pc = a, this;\n                            }\n                        }, {\n                            key: "withRemoteId",\n                            value: function(a) {\n                                return this.remoteId = a, this;\n                            }\n                        }, {\n                            key: "withFabricUsage",\n                            value: function(a) {\n                                return this.fabricUsage = a, this;\n                            }\n                        }, {\n                            key: "withConferenceId",\n                            value: function(a) {\n                                return this.conferenceId = a, this;\n                            }\n                        }, {\n                            key: "withRemoteEndpointType",\n                            value: function(a) {\n                                return this.remoteEndpointType = a, this;\n                            }\n                        }, {\n                            key: "withFabricTransmissionDirection",\n                            value: function(a) {\n                                return this.fabricTransmissionDirection = a, this;\n                            }\n                        }, {\n                            key: "withCallback",\n                            value: function(a) {\n                                return this.callback = a, this;\n                            }\n                        }, {\n                            key: "make",\n                            value: function() {\n                                return new a(this);\n                            }\n                        } ]), b;\n                    }();\n                }\n            } ]), a;\n        }();\n        c.PeerConnectionHandler = r;\n    }, {\n        "../browserapi/devices": 19,\n        "../config/constants": 33,\n        "../peerconnection/pccallbackhandler": 40,\n        "../utility/csiologger": 88,\n        "../utility/registry": 95,\n        "../utility/timestamps": 99,\n        "./getstatshandler": 39,\n        "./useralivehandler": 43\n    } ],\n    42: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.PeerConnectionManager = void 0;\n        var e = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), f = a("./peerconnectionhandler"), g = function() {\n            function a() {\n                d(this, a), this.pcHandlers = new Map();\n            }\n            return e(a, [ {\n                key: "removePcHandler",\n                value: function(a) {\n                    var b = this.getPcHandler(a);\n                    if (b) {\n                        var c = b.getPcHash();\n                        this.pcHandlers.delete(c);\n                    }\n                }\n            }, {\n                key: "addPcHandler",\n                value: function(a, b, c, d, e, g, h) {\n                    if (!this.getPcHandler(a)) {\n                        var i = new f.PeerConnectionHandler.Builder().withPc(a).withRemoteId(b).withFabricUsage(c).withConferenceId(d).withRemoteEndpointType(e).withFabricTransmissionDirection(g).withCallback(h).make();\n                        this.pcHandlers.set(i.getPcHash(), i);\n                    }\n                }\n            }, {\n                key: "getPcHandler",\n                value: function(a) {\n                    var b = null;\n                    return a ? (this.pcHandlers.forEach(function(c, d) {\n                        c && c.getPeerConnection() === a && (b = c);\n                    }), b) : b;\n                }\n            }, {\n                key: "getPcHandlerByHash",\n                value: function(a) {\n                    return a && this.pcHandlers.has(a) ? this.pcHandlers.get(a) : null;\n                }\n            }, {\n                key: "updateConferenceId",\n                value: function(a) {\n                    this.pcHandlers.forEach(function(b, c) {\n                        b.updateConferenceId(a);\n                    });\n                }\n            } ]), a;\n        }();\n        c.PeerConnectionManager = g;\n    }, {\n        "./peerconnectionhandler": 41\n    } ],\n    43: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        function e(a, b) {\n            if (!a) throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");\n            return !b || "object" != typeof b && "function" != typeof b ? a : b;\n        }\n        function f(a, b) {\n            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);\n            a.prototype = Object.create(b && b.prototype, {\n                constructor: {\n                    value: a,\n                    enumerable: !1,\n                    writable: !0,\n                    configurable: !0\n                }\n            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.UserAliveHandler = void 0;\n        var g = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), h = a("../config/constants"), i = function(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }(h), j = a("../utility/timeoutprocess"), k = a("../utility/registry"), l = 1e4, m = function(a) {\n            function b(a, c) {\n                d(this, b);\n                var f = e(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, l));\n                return f.emb = k.Registry.getEventMessageBuilder(), f.pc = c, f.conferenceId = a, \n                f.setCallback(f.send), f;\n            }\n            return f(b, a), g(b, [ {\n                key: "send",\n                value: function() {\n                    this.conferenceId !== i.tmpConferenceId && this.pc && this.emb.make(i.internalFabricEvent.userAlive, this.conferenceId, this.pc);\n                }\n            }, {\n                key: "updateConferenceId",\n                value: function(a) {\n                    this.conferenceId = a;\n                }\n            } ]), b;\n        }(j.TimeoutProcess);\n        c.UserAliveHandler = m;\n    }, {\n        "../config/constants": 33,\n        "../utility/registry": 95,\n        "../utility/timeoutprocess": 98\n    } ],\n    44: [ function(a, b, c) {\n        "use strict";\n        function d(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }\n        function e(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        function f(a, b) {\n            if (!a) throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");\n            return !b || "object" != typeof b && "function" != typeof b ? a : b;\n        }\n        function g(a, b) {\n            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);\n            a.prototype = Object.create(b && b.prototype, {\n                constructor: {\n                    value: a,\n                    enumerable: !1,\n                    writable: !0,\n                    configurable: !0\n                }\n            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.Authenticator = void 0;\n        var h = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), i = function a(b, c, d) {\n            null === b && (b = Function.prototype);\n            var e = Object.getOwnPropertyDescriptor(b, c);\n            if (void 0 === e) {\n                var f = Object.getPrototypeOf(b);\n                return null === f ? void 0 : a(f, c, d);\n            }\n            if ("value" in e) return e.value;\n            var g = e.get;\n            if (void 0 !== g) return g.call(d);\n        }, j = a("./jwt/jwt"), k = a("./jwt/jwttoken"), l = a("../config/settings"), m = d(l), n = a("../utility/base64"), o = d(n), p = a("../config/callstatserrors"), q = d(p), r = a("../config/constants"), s = d(r), t = a("../browserapi/localstorage"), u = d(t), v = a("../utility/json"), w = d(v), x = a("./xmlhttp"), y = a("./xmlhttpservice"), z = a("../utility/registry"), A = a("../utility/csiologger"), B = d(A), C = m.authRetryTimeout, D = function(a) {\n            function b() {\n                e(this, b);\n                var a = f(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, "Authenticator"));\n                return a.clockSync = z.Registry.getClockSync(), a.credentials = z.Registry.getCredentials(), \n                a;\n            }\n            return g(b, a), h(b, [ {\n                key: "initiate",\n                value: function(a, c) {\n                    var d = this;\n                    return this.inProgress ? (c && c(q.csError.authOngoing, null), new Promise(function(a, b) {\n                        b(new Error(d.name + ": in progress"));\n                    })) : this.credentials.getAppId() && this.credentials.getUserId() ? (this.initCallback = c, \n                    "function" == typeof a ? (this.setTokenGenerator(a), i(b.prototype.__proto__ || Object.getPrototypeOf(b.prototype), "initiate", this).call(this)) : new Promise(function(c, e) {\n                        d.createTokenGenerator(a).then(function(a) {\n                            d.setTokenGenerator(a), i(b.prototype.__proto__ || Object.getPrototypeOf(b.prototype), "initiate", d).call(d).then(function() {\n                                c();\n                            }, function(a) {\n                                e(a);\n                            });\n                        }, function(a) {\n                            e(new Error(d.name + ": tokenGenerator creation problem (" + a + ")"));\n                        });\n                    })) : new Promise(function(a, b) {\n                        b(new Error(d.name + ": credentials not set"));\n                    });\n                }\n            }, {\n                key: "getToken",\n                value: function() {\n                    var a = null;\n                    return this.token && (a = this.token.getToken()), a;\n                }\n            }, {\n                key: "isTokenValid",\n                value: function() {\n                    return !!this.token && this.token.isValid(this.credentials);\n                }\n            }, {\n                key: "getElapsed",\n                value: function() {\n                    return this.isCompleted() ? this.elapsed : null;\n                }\n            }, {\n                key: "getIceServers",\n                value: function() {\n                    return this.iceServers;\n                }\n            }, {\n                key: "reset",\n                value: function() {\n                    this.token = null, this.reauthTimer = null, this.renew = !1, this.credentials = null, \n                    this.jwt = new j.Jwt(), this.tokenGenerator = function(a, b) {\n                        b("Token generator is not set");\n                    }, this.elapsed = 0, this.iceServers = null, i(b.prototype.__proto__ || Object.getPrototypeOf(b.prototype), "reset", this).call(this);\n                }\n            }, {\n                key: "setupToken",\n                value: function(a) {\n                    u.store("csio_auth_data", JSON.stringify(a)), this.token = new k.JwtToken(a, this.clockSync);\n                }\n            }, {\n                key: "clearReauthTimer",\n                value: function() {\n                    null !== this.reauthTimer && (clearTimeout(this.reauthTimer), this.reauthTimer = null);\n                }\n            }, {\n                key: "setupReauthTimer",\n                value: function(a) {\n                    var b = this;\n                    b.clearReauthTimer(), b.reauthTimer = setTimeout(function() {\n                        b.reAuthenticate();\n                    }, a);\n                }\n            }, {\n                key: "reAuthenticate",\n                value: function() {\n                    this.inProgress || (this.inProgress = !0, this.token = null, this.sendRequest());\n                }\n            }, {\n                key: "handleErrorActions",\n                value: function(a) {\n                    if (0 !== a.length) {\n                        var b = a.shift();\n                        if (b.action === q.authErrorActions.RETRY) {\n                            var c = b.params.timeout ? b.params.timeout : m.authRetryTimeout;\n                            this.setupReauthTimer(c), this.handleErrorActions(a);\n                        }\n                        b.action === q.authErrorActions.GET_NEW_TOKEN && (this.renew = !0, this.handleErrorActions(a)), \n                        b.action === q.authErrorActions.REPORT_ERROR && (B.error(this.name + ": " + b.params.errorReason), \n                        this.handleErrorActions(a));\n                    }\n                }\n            }, {\n                key: "setTokenGenerator",\n                value: function(a) {\n                    this.tokenGenerator = a;\n                }\n            }, {\n                key: "handleResponse",\n                value: function(a) {\n                    var b = a.getXhr(), c = a.getElapsed(), d = w.parse(b.response);\n                    if (!d) return B.error(this.name + ": invalid authentication response"), void this.sendNextRequest();\n                    if (d["urn:x-callstats:auth:errorActions"] && d["urn:x-callstats:auth:errorActions"].length > 0) return void this.handleErrorActions(d["urn:x-callstats:auth:errorActions"]);\n                    if (200 === b.status) {\n                        if ("bearer" !== d.token_type) return B.error(this.name + ": successful, but token type was not bearer. Scheduling retry."), \n                        void this.sendNextRequest();\n                        this.setupToken(d.access_token), d.iceServers && (this.iceServers = d.iceServers);\n                        var e = parseInt(1e3 * parseInt(d.expires_in) * .9);\n                        return this.setupReauthTimer(e), this.renew = !1, this.initCallback && this.initCallback(q.csError.success, s.csCallBackMessages.authSuccessful), \n                        this.elapsed = c, void this.completeProcess();\n                    }\n                    B.error("Authentication failed, but no error actions were defined in response."), \n                    this.sendNextRequest();\n                }\n            }, {\n                key: "request",\n                value: function() {\n                    var a = this;\n                    this.clearReauthTimer();\n                    var b = new Promise(function(b, c) {\n                        a.tempResolve = b, a.tempReject = c;\n                    });\n                    return this.tokenGenerator(this.renew, function(b, c) {\n                        if (null !== b) return a.initCallback && a.initCallback(q.csError.tokenGenerationError, b.toString()), \n                        a.rejectCb(new Error(a.name + ": tokenGenerationError")), B.error("tokenGenerationError ", b), \n                        null;\n                        var d = m.authServiceUrl + "authenticate", e = {\n                            client_id: a.credentials.userId + "@" + a.credentials.getAppId(),\n                            code: c,\n                            grant_type: "authorization_code"\n                        }, f = {\n                            "Content-Type": "application/x-www-form-urlencoded"\n                        };\n                        (0, x.sendPostRequest)(d, f, C, e).then(function(b) {\n                            a.tempResolve(b);\n                        }, function(b) {\n                            a.tempReject(b);\n                        });\n                    }), b;\n                }\n            }, {\n                key: "tokenGeneratorCreator",\n                value: function(a, b) {\n                    var c = this;\n                    return function(d, e) {\n                        var f = null, g = {\n                            alg: "HS256"\n                        };\n                        if (!d && null !== f) return e(null, f);\n                        var h = c.credentials, i = {\n                            userID: h.getUserId(),\n                            appID: h.getAppId()\n                        };\n                        b && (i.keyId = b), c.jwt.sign(g, i, a).then(function(a) {\n                            f = a, e(null, a);\n                        }).catch(function(a) {\n                            e(a);\n                        });\n                    };\n                }\n            }, {\n                key: "createTokenGenerator",\n                value: function(a) {\n                    var b = this;\n                    return new Promise(function(c, d) {\n                        var e = null;\n                        a.indexOf(":") > -1 && (e = o.strtohex(a.split(":")[0]), a = a.split(":")[1]), b.jwt.importKey(a).then(function(d) {\n                            a = null;\n                            var f = b.tokenGeneratorCreator(d, e);\n                            c(f);\n                        }).catch(function(a) {\n                            B.error(b.name + ": could not import key (" + a + ")"), d(a);\n                        });\n                    });\n                }\n            } ]), b;\n        }(y.XMLHttpService);\n        c.Authenticator = D;\n    }, {\n        "../browserapi/localstorage": 20,\n        "../config/callstatserrors": 32,\n        "../config/constants": 33,\n        "../config/settings": 34,\n        "../utility/base64": 85,\n        "../utility/csiologger": 88,\n        "../utility/json": 93,\n        "../utility/registry": 95,\n        "./jwt/jwt": 52,\n        "./jwt/jwttoken": 53,\n        "./xmlhttp": 58,\n        "./xmlhttpservice": 59\n    } ],\n    45: [ function(a, b, c) {\n        "use strict";\n        function d(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }\n        function e(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.GenericEventHandler = void 0;\n        var f = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), g = a("../config/settings"), h = d(g), i = a("./xmlhttp"), j = a("../utility/registry"), k = a("../utility/csiologger"), l = d(k), m = function() {\n            function a() {\n                e(this, a), this.credentials = j.Registry.getCredentials(), this.enabled = !1;\n            }\n            return f(a, [ {\n                key: "enable",\n                value: function() {\n                    this.enabled = !0;\n                }\n            }, {\n                key: "disable",\n                value: function() {\n                    this.enabled = !1;\n                }\n            }, {\n                key: "sendEvent",\n                value: function(a, b) {\n                    this.send(a, b).then(function(a) {\n                        l.log("Got generic response: %o", a);\n                    }).catch(function(a) {\n                        l.log("Got error for generic request", a);\n                    });\n                }\n            }, {\n                key: "send",\n                value: function(a, b) {\n                    if (!this.enabled) return new Promise(function(a, b) {\n                        b(new Error("GenericEvent Error: not enabled"));\n                    });\n                    var c = this;\n                    return new Promise(function(d, e) {\n                        var f = {\n                            "Content-Type": "application/json"\n                        }, g = {\n                            appID: c.credentials.appId,\n                            userID: encodeURIComponent(c.credentials.userId),\n                            version: h.version,\n                            eventType: a,\n                            data: b\n                        }, j = h.baseUrl + "generics";\n                        (0, i.sendPostRequest)(j, f, 5e3, g).then(function(a) {\n                            d(a.getXhr().response);\n                        }, function(a) {\n                            e(a);\n                        });\n                    });\n                }\n            } ]), a;\n        }();\n        c.GenericEventHandler = m;\n    }, {\n        "../config/settings": 34,\n        "../utility/csiologger": 88,\n        "../utility/registry": 95,\n        "./xmlhttp": 58\n    } ],\n    46: [ function(a, b, c) {\n        "use strict";\n        function d(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }\n        function e(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        function f(a, b) {\n            if (!a) throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");\n            return !b || "object" != typeof b && "function" != typeof b ? a : b;\n        }\n        function g(a, b) {\n            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);\n            a.prototype = Object.create(b && b.prototype, {\n                constructor: {\n                    value: a,\n                    enumerable: !1,\n                    writable: !0,\n                    configurable: !0\n                }\n            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.ClockSync = void 0;\n        var h = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), i = function a(b, c, d) {\n            null === b && (b = Function.prototype);\n            var e = Object.getOwnPropertyDescriptor(b, c);\n            if (void 0 === e) {\n                var f = Object.getPrototypeOf(b);\n                return null === f ? void 0 : a(f, c, d);\n            }\n            if ("value" in e) return e.value;\n            var g = e.get;\n            if (void 0 !== g) return g.call(d);\n        }, j = a("../config/settings"), k = d(j), l = a("./xmlhttp"), m = a("../utility/timestamps"), n = d(m), o = a("./xmlhttpservice"), p = a("../utility/registry"), q = a("../config/constants"), r = d(q), s = function(a) {\n            function b() {\n                e(this, b);\n                var a = f(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, "ClockSync"));\n                return a.currentOffset = 0, a.completed = !1, a;\n            }\n            return g(b, a), h(b, [ {\n                key: "initiate",\n                value: function() {\n                    return this.startTime = n.getCurrent(), i(b.prototype.__proto__ || Object.getPrototypeOf(b.prototype), "initiate", this).call(this);\n                }\n            }, {\n                key: "getSynchronizedTimestamp",\n                value: function() {\n                    return n.getCurrent() + this.currentOffset;\n                }\n            }, {\n                key: "getElapsed",\n                value: function() {\n                    return this.isCompleted() ? this.endTime - this.startTime : null;\n                }\n            }, {\n                key: "getOffset",\n                value: function() {\n                    return this.currentOffset;\n                }\n            }, {\n                key: "reset",\n                value: function() {\n                    this.currentOffset = 0, this.offsetResults = [], this.startTime = 0, this.endTime = 0, \n                    i(b.prototype.__proto__ || Object.getPrototypeOf(b.prototype), "reset", this).call(this);\n                }\n            }, {\n                key: "request",\n                value: function() {\n                    var a = k.baseUrl + "clockSync";\n                    return (0, l.sendGetRequest)(a, null, 5e3);\n                }\n            }, {\n                key: "handleResponse",\n                value: function(a) {\n                    var b = a.getXhr(), c = a.getElapsed(), d = JSON.parse(b.response), e = n.getCurrent();\n                    this.handleMessage(d, c, e);\n                }\n            }, {\n                key: "handleMessage",\n                value: function(a, b, c) {\n                    var d = b / 2;\n                    d > 6e4 ? this.offsetResults = [] : this.addOffset(a, d, c), this.offsetResults.length >= 5 ? (this.calculateOffset(), \n                    this.endTime = n.getCurrent(), this.completeProcess()) : this.sendRequest();\n                }\n            }, {\n                key: "isCompleted",\n                value: function() {\n                    return this.completed;\n                }\n            }, {\n                key: "addOffset",\n                value: function(a, b, c) {\n                    var d = a.now + b, e = d - c;\n                    this.offsetResults.push(e);\n                }\n            }, {\n                key: "calculateOffset",\n                value: function() {\n                    var a = this.offsetResults.reduce(function(a, b) {\n                        return a + b;\n                    });\n                    this.currentOffset = a / this.offsetResults.length, this.currentOffset = isNaN(this.currentOffset) ? 0 : this.currentOffset, \n                    p.Registry.getGenericEventHandler().sendEvent(r.logEvents.log, {\n                        msg: "clockSync Done, offset is: " + this.currentOffset + "results length" + this.offsetResults.length\n                    }), this.offsetResults = [], this.completed = !0;\n                }\n            } ]), b;\n        }(o.XMLHttpService);\n        c.ClockSync = s;\n    }, {\n        "../config/constants": 33,\n        "../config/settings": 34,\n        "../utility/registry": 95,\n        "../utility/timestamps": 99,\n        "./xmlhttp": 58,\n        "./xmlhttpservice": 59\n    } ],\n    47: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        });\n        var e = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), f = function() {\n            function a() {\n                d(this, a), this.connected = !1, this.reconnected = !1, this.conferenceUrl = {};\n            }\n            return e(a, [ {\n                key: "setup",\n                value: function() {\n                    return new Promise(function(a, b) {\n                        a();\n                    });\n                }\n            }, {\n                key: "isReady",\n                value: function() {\n                    return this.connected;\n                }\n            }, {\n                key: "send",\n                value: function(a) {}\n            } ]), a;\n        }();\n        c.CollectorConnection = f;\n    }, {} ],\n    48: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        function e(a, b) {\n            if (!a) throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");\n            return !b || "object" != typeof b && "function" != typeof b ? a : b;\n        }\n        function f(a, b) {\n            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);\n            a.prototype = Object.create(b && b.prototype, {\n                constructor: {\n                    value: a,\n                    enumerable: !1,\n                    writable: !0,\n                    configurable: !0\n                }\n            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.ConfigServiceGet = void 0;\n        var g = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), h = function a(b, c, d) {\n            null === b && (b = Function.prototype);\n            var e = Object.getOwnPropertyDescriptor(b, c);\n            if (void 0 === e) {\n                var f = Object.getPrototypeOf(b);\n                return null === f ? void 0 : a(f, c, d);\n            }\n            if ("value" in e) return e.value;\n            var g = e.get;\n            if (void 0 !== g) return g.call(d);\n        }, i = a("../xmlhttp"), j = a("../xmlhttpservice"), k = a("../../utility/registry"), l = function(a) {\n            function b() {\n                return d(this, b), e(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, "ConfigService"));\n            }\n            return f(b, a), g(b, [ {\n                key: "initiate",\n                value: function(a) {\n                    var c = this;\n                    return this.url = a, this.authToken = k.Registry.getAuthenticator().getToken(), \n                    this.authToken ? h(b.prototype.__proto__ || Object.getPrototypeOf(b.prototype), "initiate", this).call(this) : new Promise(function(a, b) {\n                        b(new Error(c.name + ": authToken has to be string"));\n                    });\n                }\n            }, {\n                key: "getConfig",\n                value: function() {\n                    return this.config;\n                }\n            }, {\n                key: "getElapsed",\n                value: function() {\n                    return this.isCompleted() ? this.elapsed : null;\n                }\n            }, {\n                key: "reset",\n                value: function() {\n                    this.authToken = null, this.url = null, this.config = null, this.elapsed = 0, h(b.prototype.__proto__ || Object.getPrototypeOf(b.prototype), "reset", this).call(this);\n                }\n            }, {\n                key: "request",\n                value: function() {\n                    var a = {\n                        Authorization: "Bearer " + this.authToken\n                    };\n                    return (0, i.sendGetRequest)(this.url, a, 2e3);\n                }\n            }, {\n                key: "handleResponse",\n                value: function(a) {\n                    var b = a.getXhr(), c = a.getElapsed();\n                    this.config = JSON.parse(b.response), this.elapsed = c, this.completeProcess();\n                }\n            } ]), b;\n        }(j.XMLHttpService);\n        c.ConfigServiceGet = l;\n    }, {\n        "../../utility/registry": 95,\n        "../xmlhttp": 58,\n        "../xmlhttpservice": 59\n    } ],\n    49: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        function e(a, b) {\n            if (!a) throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");\n            return !b || "object" != typeof b && "function" != typeof b ? a : b;\n        }\n        function f(a, b) {\n            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);\n            a.prototype = Object.create(b && b.prototype, {\n                constructor: {\n                    value: a,\n                    enumerable: !1,\n                    writable: !0,\n                    configurable: !0\n                }\n            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.ConfigServicePost = void 0;\n        var g = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), h = function a(b, c, d) {\n            null === b && (b = Function.prototype);\n            var e = Object.getOwnPropertyDescriptor(b, c);\n            if (void 0 === e) {\n                var f = Object.getPrototypeOf(b);\n                return null === f ? void 0 : a(f, c, d);\n            }\n            if ("value" in e) return e.value;\n            var g = e.get;\n            if (void 0 !== g) return g.call(d);\n        }, i = a("../xmlhttp"), j = a("./configserviceget"), k = function(a) {\n            function b() {\n                return d(this, b), e(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this));\n            }\n            return f(b, a), g(b, [ {\n                key: "initiate",\n                value: function(a, c) {\n                    return this.body = c, h(b.prototype.__proto__ || Object.getPrototypeOf(b.prototype), "initiate", this).call(this, a);\n                }\n            }, {\n                key: "request",\n                value: function() {\n                    var a = {\n                        Authorization: "Bearer " + this.authToken\n                    };\n                    return a["Content-Type"] = "application/json", (0, i.sendPostRequest)(this.url, a, 2e3, this.body);\n                }\n            } ]), b;\n        }(j.ConfigServiceGet);\n        c.ConfigServicePost = k;\n    }, {\n        "../xmlhttp": 58,\n        "./configserviceget": 48\n    } ],\n    50: [ function(a, b, c) {\n        "use strict";\n        function d(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }\n        function e(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.ConfigServiceWrapper = void 0;\n        var f = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(a) {\n            return typeof a;\n        } : function(a) {\n            return a && "function" == typeof Symbol && a.constructor === Symbol && a !== Symbol.prototype ? "symbol" : typeof a;\n        }, g = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), h = a("./configserviceget"), i = a("./configservicepost"), j = a("../../config/settings"), k = d(j), l = a("../../utility/registry"), m = a("../../utility/csiologger"), n = d(m), o = function() {\n            function a() {\n                e(this, a), this.internalConfigService = new h.ConfigServiceGet(), this.appConfigService = new h.ConfigServiceGet(), \n                this.senderConfigService = new i.ConfigServicePost(), this.defaultSenderConfig = null;\n            }\n            return g(a, [ {\n                key: "initiateInternalConfig",\n                value: function() {\n                    var a = this, b = l.Registry.getCredentials().getAppId();\n                    if (!b) return new Promise(function(b, c) {\n                        n.log("appId has to be string"), c(new Error(a.internalConfigService.name + ": appId has to be string"));\n                    });\n                    var c = k.configServiceUrl + b;\n                    return this.internalConfigService.initiate(c + "/configurations/internal");\n                }\n            }, {\n                key: "initiateAppConfig",\n                value: function() {\n                    var a = this, b = l.Registry.getCredentials().getAppId();\n                    if (!b) return new Promise(function(b, c) {\n                        n.log("appId has to be string"), c(new Error(a.appConfigService.name + ": appId has to be string"));\n                    });\n                    var c = k.configServiceUrl + b;\n                    return this.appConfigService.initiate(c + "/configurations");\n                }\n            }, {\n                key: "initiateSenderConfig",\n                value: function(a) {\n                    var b = this;\n                    if (this.senderConfigService.getConfig()) return new Promise(function(a, c) {\n                        n.log("sender config already present"), c(new Error(b.senderConfigService.name + ": sender config already present"));\n                    });\n                    var c = l.Registry.getCredentials().getAppId(), d = l.Registry.getCredentials().getUserId();\n                    if (!c || !d) return new Promise(function(a, c) {\n                        n.log("appId and userId have to be string"), c(new Error(b.senderConfigService.name + ": appId and userId have to be string"));\n                    });\n                    if (this.defaultSenderConfig = this.getCurrentVideoSenderConfig(a), !this.defaultSenderConfig) return new Promise(function(a, c) {\n                        n.log("Could not obtain a sender config"), c(new Error(b.senderConfigService.name + ": Could not obtain a sender config"));\n                    });\n                    var e = k.configServiceUrl + c, f = {\n                        app_id: c,\n                        local_id: d,\n                        rtc_rtp_parameters: this.defaultSenderConfig\n                    };\n                    return this.senderConfigService.initiate(e + "/configurations", f);\n                }\n            }, {\n                key: "getInternalConfig",\n                value: function() {\n                    return this.internalConfigService.getConfig();\n                }\n            }, {\n                key: "getAppDefaultConfig",\n                value: function() {\n                    var a = this.appConfigService.getConfig(), b = {\n                        peerConnection: null,\n                        media: null\n                    };\n                    return a.default ? (a.default.peerConnection && (b.peerConnection = a.default.peerConnection), \n                    a.default.media && (b.media = a.default.media), b) : b;\n                }\n            }, {\n                key: "getAppRecommendedConfig",\n                value: function() {\n                    var a = this.appConfigService.getConfig(), b = {};\n                    return a.recommended ? (a.recommended.peerConnection && (b.peerConnection = a.recommended.peerConnection), \n                    a.recommended.media && (b.media = a.recommended.media), b) : b;\n                }\n            }, {\n                key: "getSenderConfig",\n                value: function() {\n                    var a = this.senderConfigService.getConfig();\n                    return a && a.recommended && a.recommended.sender ? a.recommended.sender : null;\n                }\n            }, {\n                key: "getDefaultSenderConfig",\n                value: function() {\n                    return this.defaultSenderConfig ? this.defaultSenderConfig : null;\n                }\n            }, {\n                key: "getInternalElapsed",\n                value: function() {\n                    return this.internalConfigService.getElapsed();\n                }\n            }, {\n                key: "getAppElapsed",\n                value: function() {\n                    return this.appConfigService.getElapsed();\n                }\n            }, {\n                key: "getSenderElapsed",\n                value: function() {\n                    return this.senderConfigService.getElapsed();\n                }\n            }, {\n                key: "getCurrentVideoSenderConfig",\n                value: function(a) {\n                    var b = {\n                        encodings: [ {\n                            maxBitrate: 0\n                        } ]\n                    }, c = l.Registry.getConferenceManager().getConferenceForPc(a);\n                    if (!c) return n.warn("No conference found for PC, skipping"), null;\n                    if (c.getPeerConnectionManager().pcHandlers.size > 1) return n.warn("Multiple PCs found, skipping"), \n                    null;\n                    if (!a.getSenders || "function" != typeof a.getSenders) return n.warn("Get senders error"), \n                    b;\n                    for (var d = a.getSenders(), e = void 0, g = 0; g < d.length; g += 1) {\n                        var h = d[g];\n                        if ("object" !== (void 0 === h ? "undefined" : f(h)) || !h.track || "object" !== f(h.track) || !h.track.kind) return n.warn("Access senders error"), \n                        null;\n                        if ("video" === h.track.kind) {\n                            if (e) return n.warn("Multiple video sender, skipping"), null;\n                            e = h;\n                        }\n                    }\n                    if (!e) return n.warn("No video sender found"), null;\n                    if (!e.getParameters || "function" != typeof e.getParameters) return n.warn("Sender getParameters error"), \n                    b;\n                    var i = e.getParameters();\n                    return "object" !== (void 0 === i ? "undefined" : f(i)) ? null : ("encodings" in i || (i.encodings = []), \n                    0 === i.encodings.length && i.encodings.push({\n                        maxBitrate: 0\n                    }), i);\n                }\n            } ]), a;\n        }();\n        c.ConfigServiceWrapper = o;\n    }, {\n        "../../config/settings": 34,\n        "../../utility/csiologger": 88,\n        "../../utility/registry": 95,\n        "./configserviceget": 48,\n        "./configservicepost": 49\n    } ],\n    51: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.ConnectionManager = void 0;\n        var e = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), f = a("../config/constants"), g = function(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }(f), h = a("./wscollectorconnection"), i = a("./restcollectorconnection"), j = a("../utility/registry"), k = function() {\n            function a() {\n                d(this, a), this.connection = null;\n            }\n            return e(a, [ {\n                key: "setupCollectorConnection",\n                value: function(a) {\n                    a === g.transportType.rest ? this.connection = new i.RestCollectorConnection() : this.connection = new h.WsCollectorConnection();\n                }\n            }, {\n                key: "setup",\n                value: function() {\n                    return this.connection ? this.connection.setup() : new Promise(function(a, b) {\n                        b();\n                    });\n                }\n            }, {\n                key: "isReady",\n                value: function() {\n                    return !!this.connection && this.connection.isReady();\n                }\n            }, {\n                key: "send",\n                value: function(a) {\n                    if (!this.connection) return void j.Registry.getGenericEventHandler().sendEvent(g.logEvents.error, {\n                        msg: "Connection not available to the collector"\n                    });\n                    this.connection.send(a);\n                }\n            } ]), a;\n        }();\n        c.ConnectionManager = k;\n    }, {\n        "../config/constants": 33,\n        "../utility/registry": 95,\n        "./restcollectorconnection": 54,\n        "./wscollectorconnection": 57\n    } ],\n    52: [ function(a, b, c) {\n        "use strict";\n        function d(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }\n        function e(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.Jwt = void 0;\n        var f = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), g = a("../../utility/base64"), h = d(g), i = a("../../utility/csiologger"), j = d(i), k = a("../../utility/registry"), l = a("../../config/constants"), m = d(l), n = function() {\n            function a() {\n                e(this, a), this.cryptotype = null, window.crypto && window.crypto.subtle ? (this.cryptotype = "standard", \n                this.subtlecrypto = window.crypto.subtle) : window.crypto && !window.crypto.subtle && window.crypto.webkitSubtle ? (this.cryptotype = "webkit", \n                this.subtlecrypto = window.crypto.webkitSubtle) : window.msCrypto && window.msCrypto.subtle ? (this.cryptotype = "ie", \n                this.subtlecrypto = window.msCrypto.subtle) : (this.subtlecrypto = null, j.info("WebCryptography API not supported in this browser.")), \n                this.browserName = k.Registry.getEndpoint().getBrowserName();\n            }\n            return f(a, [ {\n                key: "sign",\n                value: function(a, b, c) {\n                    var d = this;\n                    return new Promise(function(e, f) {\n                        "HS256" !== a.alg && f("Use header.alg=HS256"), a = JSON.stringify(a), "string" != typeof b && (b = JSON.stringify(b));\n                        var g = h.urlencodeUnicode(a) + "." + h.urlencodeUnicode(b);\n                        window.csioReactNative && window.csiosign(g, c, function(a, b) {\n                            if (a) return j.log("Token sign error", a), void f(error);\n                            e(b);\n                        });\n                        var i = new ArrayBuffer(g.length), k = new Uint8Array(i), l = {\n                            name: "HMAC"\n                        };\n                        "ie" !== d.cryptotype && "webkit" !== d.cryptotype && d.browserName !== m.browserName.edge || (l.hash = {\n                            name: "sha-256"\n                        });\n                        for (var n = g.length - 1; n >= 0; n--) k[n] = g.charCodeAt(n);\n                        var o = d.subtlecrypto.sign(l, c, k);\n                        "ie" === d.cryptotype ? (o.onerror = f, o.oncomplete = function(a) {\n                            g = d.buildToken(a.target.result, g), e(g);\n                        }) : o.then(function(a) {\n                            g = d.buildToken(a, g), e(g);\n                        }).catch(function(a) {\n                            f(a);\n                        });\n                    });\n                }\n            }, {\n                key: "buildToken",\n                value: function(a, b) {\n                    for (var c = "", d = new Uint8Array(a), e = d.byteLength, f = 0; f < e; f++) c += String.fromCharCode(d[f]);\n                    return b += "." + h.urlencode(c);\n                }\n            }, {\n                key: "decode",\n                value: function(a) {\n                    try {\n                        var b = a.split(".")[1], c = h.decode(b);\n                        return JSON.parse(c);\n                    } catch (a) {\n                        return j.error("Could not decode token. "), null;\n                    }\n                }\n            }, {\n                key: "importKey",\n                value: function(a) {\n                    var b = this;\n                    return new Promise(function(c, d) {\n                        if (window.csioReactNative) return void c(a);\n                        if ("webkit" === b.cryptotype) for (;a.length < 32; ) a += "\\0";\n                        var e = {\n                            kty: "oct",\n                            k: h.urlencode(a),\n                            alg: "HS256"\n                        }, f = {\n                            name: "HMAC",\n                            hash: {\n                                name: "SHA-256"\n                            }\n                        };\n                        if ("ie" === b.cryptotype ? e.extractable = !1 : e.ext = !1, "webkit" === b.cryptotype && (f = null, \n                        e.use = "sig"), "ie" === b.cryptotype || "webkit" === b.cryptotype) {\n                            var g = JSON.stringify(e);\n                            e = new Uint8Array(g.length);\n                            for (var i = 0; i < g.length; i++) e[i] = g.charCodeAt(i);\n                        }\n                        var j = b.subtlecrypto.importKey("jwk", e, f, !1, [ "sign" ]);\n                        "ie" === b.cryptotype ? (j.onerror = d, j.oncomplete = function(a) {\n                            c(a.target.result);\n                        }) : j.then(c).catch(d);\n                    });\n                }\n            } ]), a;\n        }();\n        c.Jwt = n;\n    }, {\n        "../../config/constants": 33,\n        "../../utility/base64": 85,\n        "../../utility/csiologger": 88,\n        "../../utility/registry": 95\n    } ],\n    53: [ function(a, b, c) {\n        "use strict";\n        function d(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }\n        function e(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.JwtToken = void 0;\n        var f = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), g = a("./jwt"), h = a("../../utility/registry"), i = a("../../config/constants"), j = d(i), k = a("../../utility/csiologger"), l = d(k), m = function() {\n            function a(b) {\n                e(this, a), this.token = b, this.statsSubmissionInterval = 15e3, this.collectSDP = !1, \n                this.appId = null, this.userId = null, this.tokenPayload = null, this.jwt = new g.Jwt(), \n                this.expires = null, this.clockSync = h.Registry.getClockSync(), this.adaptiveInterval = !1, \n                this.transportType = j.transportType.rest, this.setupTokenPayload(), this.restApiTransport = !1;\n            }\n            return f(a, [ {\n                key: "getToken",\n                value: function() {\n                    return this.token;\n                }\n            }, {\n                key: "setupTokenPayload",\n                value: function() {\n                    var a = this.jwt.decode(this.token);\n                    if (this.statsSubmissionInterval = parseInt(a.submissionInterval, 10), this.collectSDP = a.collectSDP, \n                    this.adaptiveInterval = a.adaptiveInterval, this.appId = a.appID, this.userId = a.userID, \n                    this.restApiTransport = a.restApiTransport, navigator.mozGetUserMedia) {\n                        var b = a.expiry.split(" ").join("T");\n                        this.expires = Date.parse(b);\n                    } else this.expires = new Date(a.expiry);\n                    this.restApiTransport ? this.transportType = j.transportType.rest : this.transportType = j.transportType.ws, \n                    l.info("transportType is ", this.transportType, this.restApiTransport), h.Registry.getCredentials().setStatsSubmissionInterval(this.statsSubmissionInterval), \n                    h.Registry.getCredentials().setCollectSDP(this.collectSDP), h.Registry.getCredentials().setTransportType(this.transportType), \n                    h.Registry.getCredentials().setAdaptiveInterval(this.adaptiveInterval);\n                }\n            }, {\n                key: "isValid",\n                value: function(a) {\n                    var b = this, c = !1;\n                    if (null !== b.token && b.appId === a.appId && b.userId === encodeURIComponent(a.userId)) {\n                        new Date(this.clockSync.getSynchronizedTimestamp()) < b.expires && (c = !0);\n                    }\n                    return c;\n                }\n            } ]), a;\n        }();\n        c.JwtToken = m;\n    }, {\n        "../../config/constants": 33,\n        "../../utility/csiologger": 88,\n        "../../utility/registry": 95,\n        "./jwt": 52\n    } ],\n    54: [ function(a, b, c) {\n        "use strict";\n        function d(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }\n        function e(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        function f(a, b) {\n            if (!a) throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");\n            return !b || "object" != typeof b && "function" != typeof b ? a : b;\n        }\n        function g(a, b) {\n            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);\n            a.prototype = Object.create(b && b.prototype, {\n                constructor: {\n                    value: a,\n                    enumerable: !1,\n                    writable: !0,\n                    configurable: !0\n                }\n            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.RestCollectorConnection = void 0;\n        var h = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), i = a("../utility/registry"), j = a("./xmlhttp"), k = a("./collectorconnection"), l = a("./restrelays"), m = a("../config/constants"), n = d(m), o = a("../utility/csiologger"), p = d(o), q = function(a) {\n            function b() {\n                e(this, b);\n                var a = f(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this));\n                return a.relays = new l.RestRelays(), a;\n            }\n            return g(b, a), h(b, [ {\n                key: "isReady",\n                value: function() {\n                    return !0;\n                }\n            }, {\n                key: "send",\n                value: function(a) {\n                    var b = {\n                        "Content-Type": "application/json",\n                        Authorization: "Bearer " + i.Registry.getAuthenticator().getToken()\n                    }, c = a.eventType, d = a.confID, e = a.ucID, f = this.relays, g = f.getRequestUrl(c, d, e);\n                    if (!g) return void p.warn("No action for message type: " + c);\n                    var h = this.getMessage(c, a);\n                    p.log("sending ", g, a), (0, j.sendPostRequest)(g, b, 5e3, h).then(function(b) {\n                        if (!b || !b.xhr) return void p.log("Response for request is null");\n                        var e = JSON.parse(b.xhr.response);\n                        e && "success" !== e.status && (i.Registry.getGenericEventHandler().sendEvent(n.logEvents.restResponseError, {\n                            msg: "response failure " + d + ":" + c + ":" + e.msg + ":" + e.status + JSON.stringify(a)\n                        }), p.error("Response error:", e.msg, a)), f.handleResponse(c, e, d);\n                    }, function(a) {\n                        p.error(a);\n                    });\n                }\n            }, {\n                key: "getMessage",\n                value: function(a, b) {\n                    delete b.confID, delete b.channel, delete b.token, delete b.appID, delete b.action, \n                    delete b.ucID, delete b.version, delete b.timeShift;\n                    var c = decodeURIComponent(b.localID);\n                    b.localID = c;\n                    var d = decodeURIComponent(b.remoteID);\n                    return b.remoteID = d, a === n.callstatsChannels.processedStats && (b.eventType = "stats"), \n                    b;\n                }\n            } ]), b;\n        }(k.CollectorConnection);\n        c.RestCollectorConnection = q;\n    }, {\n        "../config/constants": 33,\n        "../utility/csiologger": 88,\n        "../utility/registry": 95,\n        "./collectorconnection": 47,\n        "./restrelays": 55,\n        "./xmlhttp": 58\n    } ],\n    55: [ function(a, b, c) {\n        "use strict";\n        function d(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }\n        function e(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        function f() {\n            var a = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : null, b = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : null;\n            return function(c, d, e) {\n                "success" === c.status ? a && a(c, d) : b && b(c);\n            };\n        }\n        function g(a) {\n            var b = f();\n            return new Map([ [ j.fabricEvent.fabricTerminated, new r(l.restEventUrl, "/events/fabric/terminated", b) ], [ j.fabricEvent.audioMute, new r(l.restEventUrl, "/events/media/actions", b) ], [ j.fabricEvent.audioUnmute, new r(l.restEventUrl, "/events/media/actions", b) ], [ j.fabricEvent.videoPause, new r(l.restEventUrl, "/events/media/actions", b) ], [ j.fabricEvent.videoResume, new r(l.restEventUrl, "/events/media/actions", b) ], [ j.fabricEvent.screenShareStart, new r(l.restEventUrl, "/events/media/actions", b) ], [ j.fabricEvent.screenShareStop, new r(l.restEventUrl, "/events/media/actions", b) ], [ j.fabricEvent.activeDeviceList, new r(l.restEventUrl, "/events/devices/list", b) ], [ j.fabricEvent.applicationErrorLog, new r(l.restEventUrl, "/events/app/logs", b) ], [ j.fabricEvent.dominantSpeaker, new r(l.restEventUrl, "/events/dominantspeaker", b) ], [ j.fabricEvent.fabricHold, new r(l.restEventUrl, "/events/fabric/actions", b) ], [ j.fabricEvent.fabricResume, new r(l.restEventUrl, "/events/fabric/actions", b) ], [ j.internalFabricEvent.fabricSetup, new r(l.restEventUrl, "/events/fabric/setup", b) ], [ j.fabricEvent.fabricSetupFailed, new r(l.restEventUrl, "/events/fabric/setupfailed", b) ], [ j.internalFabricEvent.userJoined, new r(l.restEventUrl, "", f(function(a, b) {\n                b = decodeURIComponent(b);\n                var c = m.Registry.getConferenceManager().get(b);\n                c && (p.log("UcId is - ", a.ucID, b), c.setUcId(a.ucID), m.Registry.getTransmissionManager().trySend());\n            })) ], [ j.internalFabricEvent.userLeft, new r(l.restEventUrl, "/events/user/left", b) ], [ j.internalFabricEvent.userAlive, new r(l.restEventUrl, "/events/user/alive", b) ], [ j.internalFabricEvent.fabricTransportSwitch, new r(l.restEventUrl, "/events/fabric/transportchange", b) ], [ j.internalFabricEvent.mediaPlaybackStart, new r(l.restEventUrl, "/events/media/pipeline", b) ], [ j.internalFabricEvent.mediaPlaybackSuspended, new r(l.restEventUrl, "/events/media/pipeline", b) ], [ j.internalFabricEvent.mediaPlaybackStalled, new r(l.restEventUrl, "/events/media/pipeline", b) ], [ j.internalFabricEvent.ssrcMap, new r(l.restEventUrl, "/events/ssrcmap", b) ], [ j.internalFabricEvent.connectedDeviceList, new r(l.restEventUrl, "/events/devices/list", b) ], [ j.internalFabricEvent.sdpSubmission, new r(l.restEventUrl, "/events/sdp", b) ], [ j.internalFabricEvent.iceDisruptionStart, new r(l.restEventUrl, "/events/ice/status", b) ], [ j.internalFabricEvent.iceDisruptionEnd, new r(l.restEventUrl, "/events/ice/status", b) ], [ j.internalFabricEvent.iceConnectionDisruptionStart, new r(l.restEventUrl, "/events/ice/status", b) ], [ j.internalFabricEvent.iceConnectionDisruptionEnd, new r(l.restEventUrl, "/events/ice/status", b) ], [ j.internalFabricEvent.iceAborted, new r(l.restEventUrl, "/events/ice/status", b) ], [ j.internalFabricEvent.iceTerminated, new r(l.restEventUrl, "/events/ice/status", b) ], [ j.internalFabricEvent.iceFailed, new r(l.restEventUrl, "/events/ice/status", b) ], [ j.internalFabricEvent.iceRestarted, new r(l.restEventUrl, "/events/ice/status", b) ], [ j.internalFabricEvent.fabricDropped, new r(l.restEventUrl, "/events/fabric/status", b) ], [ j.callstatsChannels.processedStats, new r(l.restStatsUrl, "/stats", b) ], [ j.internalFabricEvent.fabricStateChange, new r(l.restEventUrl, "/events/fabric/statechange", b) ], [ j.callstatsChannels.userFeedback, new r(l.restEventUrl, "/events/feedback", b) ], [ j.precalltestEvents.results, new r(l.restEventUrl, "/events/precall", b) ], [ j.precalltestEvents.associate, new r(l.restEventUrl, "/events/precall", b) ], [ j.internalFabricEvent.userDetails, new r(l.restEventUrl, "/events/userdetails", b) ] ]);\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.RestRelays = void 0;\n        var h = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), i = a("../config/constants"), j = d(i), k = a("../config/settings"), l = d(k), m = a("../utility/registry"), n = a("../utility/url"), o = a("../utility/csiologger"), p = d(o), q = function() {\n            function a() {\n                e(this, a), this.items = g();\n            }\n            return h(a, [ {\n                key: "getRequestUrl",\n                value: function(a, b, c) {\n                    return this.items.has(a) ? this.items.get(a).getRequestUrl(a, b, c) : (p.warn("EventType Unsupported ", a), \n                    null);\n                }\n            }, {\n                key: "handleResponse",\n                value: function(a, b, c) {\n                    if (!this.items.has(a)) return void p.warn("No response handler for event type " + a);\n                    this.items.get(a).handleResponse(b, c, a);\n                }\n            } ]), a;\n        }(), r = function() {\n            function a(b, c) {\n                var d = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : null;\n                e(this, a), this.baseUrl = b, this.urlAppendix = c, this.responseHandler = d;\n            }\n            return h(a, [ {\n                key: "getRequestUrl",\n                value: function(a, b, c) {\n                    return this.makeRequestUrl(a, b, c), this.requestUrl.toString();\n                }\n            }, {\n                key: "makeRequestUrl",\n                value: function(a, b, c) {\n                    a === j.precalltestEvents.results ? this.requestUrl = new n.Url(this.baseUrl, m.Registry.getCredentials().getAppId(), this.urlAppendix) : (a === j.internalFabricEvent.userJoined && c && (c = ""), \n                    this.requestUrl = new n.Url(this.baseUrl, m.Registry.getCredentials().getAppId() + "/conferences/" + b, c, this.urlAppendix));\n                }\n            }, {\n                key: "handleResponse",\n                value: function(a, b, c) {\n                    this.responseHandler(a, b, c);\n                }\n            } ]), a;\n        }();\n        c.RestRelays = q;\n    }, {\n        "../config/constants": 33,\n        "../config/settings": 34,\n        "../utility/csiologger": 88,\n        "../utility/registry": 95,\n        "../utility/url": 100\n    } ],\n    56: [ function(a, b, c) {\n        "use strict";\n        function d(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }\n        function e(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.TransmissionManager = void 0;\n        var f = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), g = a("../utility/timestamps"), h = d(g), i = a("../collections/cache"), j = a("../utility/registry"), k = a("../config/constants"), l = d(k), m = a("../utility/csiologger"), n = d(m), o = function() {\n            function a() {\n                e(this, a), this.cache = [], this.connectionManager = j.Registry.getConnectionManager(), \n                this.lastTS = 0, this.timerStarted = !1;\n            }\n            return f(a, [ {\n                key: "send",\n                value: function(a) {\n                    (a.isCachable() || a.canBeSent()) && (this.cache[a.getConferenceId()] || (this.cache[a.getConferenceId()] = new i.Cache()), \n                    this.cache[a.getConferenceId()].add(a, a.isPriority()), this.trySend());\n                }\n            }, {\n                key: "trySend",\n                value: function() {\n                    if (!this.connectionManager.isReady()) return void this.setupConnection();\n                    if (!this.timerStarted) return this.timeToSend() ? void (this.sendMessage() && this.startTimer()) : void (this.getCacheLength() > 0 && this.startTimer());\n                }\n            }, {\n                key: "setupConnection",\n                value: function() {\n                    this.connectionManager.setup().then(function() {\n                        n.log("Connected to connectionManager");\n                    }).catch(function(a) {\n                        return n.log("Could not connect to connectionManager", a);\n                    });\n                }\n            }, {\n                key: "sendMessage",\n                value: function() {\n                    var a = void 0, b = void 0;\n                    if (0 === this.getCacheLength()) return !1;\n                    for (var c in this.cache) if (this.cache.hasOwnProperty(c) && (b = c, (a = this.cache[b].peak()) && a.canBeSent())) break;\n                    return !(!a || !a.canBeSent()) && (n.log("sending message type :", a.toJson().action, a.toJson()), \n                    a = this.cache[b].pop(), this.lastTS = h.getCurrent(), this.connectionManager.send(a.toJson()), \n                    !0);\n                }\n            }, {\n                key: "startTimer",\n                value: function() {\n                    var a = this;\n                    this.timerStarted || 0 != this.getCacheLength() && (this.timerStarted = !0, setTimeout(function() {\n                        a.timerStarted = !1, a.trySend();\n                    }, 200));\n                }\n            }, {\n                key: "timeToSend",\n                value: function() {\n                    return h.getCurrent() >= this.lastTS + 200;\n                }\n            }, {\n                key: "getCacheLength",\n                value: function() {\n                    var a = 0;\n                    for (var b in this.cache) this.cache.hasOwnProperty(b) && (a += this.cache[b].length());\n                    return a;\n                }\n            }, {\n                key: "updateConferenceId",\n                value: function(a) {\n                    var b = l.tmpConferenceId;\n                    this.cache[b] && this.cache[b].updateConferenceId(a);\n                }\n            } ]), a;\n        }();\n        c.TransmissionManager = o;\n    }, {\n        "../collections/cache": 25,\n        "../config/constants": 33,\n        "../utility/csiologger": 88,\n        "../utility/registry": 95,\n        "../utility/timestamps": 99\n    } ],\n    57: [ function(a, b, c) {\n        "use strict";\n        function d(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }\n        function e(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        function f(a, b) {\n            if (!a) throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");\n            return !b || "object" != typeof b && "function" != typeof b ? a : b;\n        }\n        function g(a, b) {\n            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);\n            a.prototype = Object.create(b && b.prototype, {\n                constructor: {\n                    value: a,\n                    enumerable: !1,\n                    writable: !0,\n                    configurable: !0\n                }\n            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.WsCollectorConnection = void 0;\n        var h = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), i = a("../config/callstatserrors"), j = d(i), k = a("../config/constants"), l = d(k), m = a("../config/settings"), n = d(m), o = a("../utility/registry"), p = a("../utility/csiologger"), q = d(p), r = a("./collectorconnection"), s = function(a) {\n            function b() {\n                e(this, b);\n                var a = f(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this));\n                return a.wsConnection = null, a.wsConnectionState = l.wsConnectionState.closed, \n                a.connected = !1, a.reconnected = !1, a;\n            }\n            return g(b, a), h(b, [ {\n                key: "onOpenHandler",\n                value: function() {\n                    var a = this;\n                    a.wsConnectionState = l.wsConnectionState.connected, a.connected ? a.reconnected = !0 : a.connected = !0, \n                    a.reconnected = !1;\n                }\n            }, {\n                key: "onCloseHandler",\n                value: function() {\n                    var a = this;\n                    a.wsConnectionState = l.wsConnectionState.closed, q.log("**** Connection to the backend closed."), \n                    a.wsConnection && (a.wsConnection = null);\n                }\n            }, {\n                key: "onErrorHandler",\n                value: function(a) {\n                    var b = this;\n                    b.wsConnectionState = l.wsConnectionState.closed, q.log("**** Connection establishment to the backend failed."), \n                    b.callback && b.callback(j.csError.wsChannelFailure, "WebSocket establishment failed.", a);\n                }\n            }, {\n                key: "onMessageHandler",\n                value: function(a) {\n                    var b = a.data, c = JSON.parse(b);\n                    if ("200 OK" === c.status) {\n                        if ("feedback" === c.event) window.localStorage.removeItem("feedback"); else if (c.event === l.internalFabricEvent.userJoined) {\n                            var d = o.Registry.getConferenceManager().get(decodeURIComponent(c.conferenceID));\n                            d && d.setUcId(c.ucID), q.log("UcId =", c.ucID), o.Registry.getTransmissionManager().trySend();\n                        }\n                    } else q.error("Collector error:", c.reason);\n                }\n            }, {\n                key: "setup",\n                value: function() {\n                    var a = this;\n                    return new Promise(function(b, c) {\n                        if (a.wsConnectionState === l.wsConnectionState.initiated || a.wsConnectionState === l.wsConnectionState.connected) return q.log("setupWebSocketConnection is called when already connected!"), \n                        a.callback && a.callback(j.csError.success, l.csCallBackMessages.wsConnected), void b();\n                        a.wsConnectionState = l.wsConnectionState.initiated, q.log("creating new WebSocket", n.wsUrl), \n                        a.wsConnection = new WebSocket(n.wsUrl, "echo-protocol"), a.wsConnection.onopen = function() {\n                            b(), a.onOpenHandler();\n                        }, a.wsConnection.onclose = function() {\n                            a.onCloseHandler();\n                        }, a.wsConnection.onerror = function(b) {\n                            c(b), a.onErrorHandler(b);\n                        }, a.wsConnection.onmessage = function(b) {\n                            a.onMessageHandler(b);\n                        };\n                    });\n                }\n            }, {\n                key: "isReady",\n                value: function() {\n                    var a = this;\n                    return !(!a.wsConnection || 1 !== a.wsConnection.readyState);\n                }\n            }, {\n                key: "getState",\n                value: function() {\n                    var a = this;\n                    return a.wsConnection ? a.wsConnection.readyState : -1;\n                }\n            }, {\n                key: "send",\n                value: function(a) {\n                    this.wsConnection.send(JSON.stringify(a));\n                }\n            } ]), b;\n        }(r.CollectorConnection);\n        c.WsCollectorConnection = s;\n    }, {\n        "../config/callstatserrors": 32,\n        "../config/constants": 33,\n        "../config/settings": 34,\n        "../utility/csiologger": 88,\n        "../utility/registry": 95,\n        "./collectorconnection": 47\n    } ],\n    58: [ function(a, b, c) {\n        "use strict";\n        function d(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }\n        function e(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        function f(a, b, c, d, e) {\n            return new Promise(function(f, g) {\n                var h = null, i = null, j = null, l = new XMLHttpRequest(), p = n.Registry.getEndpoint().getBrowserName();\n                if (!l) return void g(new Error("creating instance failed"));\n                h = k.getCurrent(), l.open(a, b), p !== m.browserName.msie && (l.timeout = d);\n                for (var q in c) c.hasOwnProperty(q) && l.setRequestHeader(q, c[q]);\n                var r = null;\n                if ("POST" === a) {\n                    if ("application/x-www-form-urlencoded" === c["Content-Type"]) {\n                        var s = [];\n                        for (var t in e) e.hasOwnProperty(t) && s.push(encodeURIComponent(t) + "=" + encodeURIComponent(e[t]));\n                        r = s.join("&");\n                    }\n                    "application/json" === c["Content-Type"] && (r = JSON.stringify(e));\n                }\n                l.onload = function() {\n                    i = k.getCurrent(), j = i - h;\n                    var a = new o(l, j);\n                    f(a);\n                }, l.ontimeout = function() {\n                    g(new Error("connection timeout"));\n                }, l.onreadystatechange = function() {\n                    4 === l.readyState && 0 === l.status && g(new Error("no server response received"));\n                }, l.send(r);\n            });\n        }\n        function g(a, b, c) {\n            return f("GET", a, b, c, null);\n        }\n        function h(a, b, c, d) {\n            return f("POST", a, b, c, d);\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        });\n        var i = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }();\n        c.sendGetRequest = g, c.sendPostRequest = h;\n        var j = a("../utility/timestamps"), k = d(j), l = a("../config/constants"), m = d(l), n = a("../utility/registry"), o = function() {\n            function a(b, c) {\n                e(this, a), this.xhr = b, this.elapsed = c;\n            }\n            return i(a, [ {\n                key: "getXhr",\n                value: function() {\n                    return this.xhr;\n                }\n            }, {\n                key: "getElapsed",\n                value: function() {\n                    return this.elapsed;\n                }\n            } ]), a;\n        }();\n    }, {\n        "../config/constants": 33,\n        "../utility/registry": 95,\n        "../utility/timestamps": 99\n    } ],\n    59: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.XMLHttpService = void 0;\n        var e = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), f = a("../utility/sigmoid"), g = a("../utility/csiologger"), h = function(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }(g), i = 100, j = 1e4, k = function() {\n            function a() {\n                var b = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : "XMLHttpService", c = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : i, e = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : j;\n                d(this, a), this.name = b, this.minRetryTimeout = c, this.sigmoid = new f.Sigmoid(e - c, 15, .5), \n                this.reset();\n            }\n            return e(a, [ {\n                key: "reset",\n                value: function() {\n                    this.inProgress = !1, this.completed = !1, this.resolveCb && this.rejectCb(new Error(this.name + ": resetting")), \n                    this.resolveCb = null, this.rejectCb = null;\n                }\n            }, {\n                key: "initiate",\n                value: function() {\n                    var a = this;\n                    if (this.inProgress) return new Promise(function(b, c) {\n                        c(new Error(a.name + ": in progress"));\n                    });\n                    var b = new Promise(function(b, c) {\n                        a.resolveCb = b, a.rejectCb = c;\n                    });\n                    return this.inProgress = !0, this.sendRequest(), b;\n                }\n            }, {\n                key: "isCompleted",\n                value: function() {\n                    return this.completed;\n                }\n            }, {\n                key: "handleSendError",\n                value: function(a) {\n                    h.log(this.name + ": send next request (" + a + ")"), this.sendNextRequest();\n                }\n            }, {\n                key: "handleResponseProxy",\n                value: function(a) {\n                    this.handleResponse(a), this.resetTimeout();\n                }\n            }, {\n                key: "handleResponse",\n                value: function(a) {\n                    h.error(this.name + ": handleResponse() not implemented"), this.completeProcess();\n                }\n            }, {\n                key: "completeProcess",\n                value: function() {\n                    this.inProgress = !1, this.completed = !0, this.resolveCb.apply(this, arguments);\n                }\n            }, {\n                key: "request",\n                value: function() {\n                    return h.error(this.name + ": request() not implemented!"), new Promise(function(a, b) {\n                        a();\n                    });\n                }\n            }, {\n                key: "sendRequest",\n                value: function() {\n                    if (this.inProgress) {\n                        var a = this.request();\n                        a && a.then(this.handleResponseProxy.bind(this), this.handleSendError.bind(this));\n                    }\n                }\n            }, {\n                key: "sendNextRequest",\n                value: function() {\n                    setTimeout(this.sendRequest.bind(this), this.getTimeout());\n                }\n            }, {\n                key: "resetTimeout",\n                value: function() {\n                    this.sigmoid.reset();\n                }\n            }, {\n                key: "getTimeout",\n                value: function() {\n                    return this.minRetryTimeout + this.sigmoid.getActual();\n                }\n            } ]), a;\n        }();\n        c.XMLHttpService = k;\n    }, {\n        "../utility/csiologger": 88,\n        "../utility/sigmoid": 97\n    } ],\n    60: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.Measurement = void 0;\n        var e = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), f = a("./resolution"), g = a("./validator"), h = function(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }(g), i = function() {\n            function a() {\n                d(this, a), this.pcHash = null, this.ssrc = null, this.streamType = null, this.mediaType = null, \n                this.resolution = null, this.frameRateReceived = null, this.frameHeight = null, \n                this.frameWidth = null, this.droppedFramesNum = null, this.framesReceived = null, \n                this.rtt = null, this.jitter = null, this.lostPackets = -1, this.receivedPackets = -1, \n                this.sentPackets = -1, this.discardedPackets = -1, this.sentBytes = -1, this.receivedBytes = -1, \n                this.track = null, this.fractionLost = 0;\n            }\n            return e(a, null, [ {\n                key: "make",\n                value: function(b, c, d, e, f, g, i, j, k, l, m, n, o, p, q, r, s, t) {\n                    var u = new a(), v = function(a, b) {\n                        -1 === [ void 0, null ].indexOf(b) && (u[a] = b);\n                    };\n                    return v("pcHash", b), v("ssrc", c), v("streamType", d), v("mediaType", e), v("frameRateReceived", f), \n                    v("frameHeight", h.checkForNan(parseInt(g, 10))), v("frameWidth", h.checkForNan(parseInt(i, 10))), \n                    v("droppedFramesNum", j), v("framesReceived", k), v("rtt", l), v("jitter", m), v("lostPackets", n), \n                    v("receivedPackets", o), v("sentPackets", p), v("discardedPackets", q), v("sentBytes", r), \n                    v("receivedBytes", s), v("track", t), u.setFrameRateReceived(f), u;\n                }\n            } ]), e(a, [ {\n                key: "getPcHash",\n                value: function() {\n                    return this.pcHash;\n                }\n            }, {\n                key: "getSSRC",\n                value: function() {\n                    return this.ssrc;\n                }\n            }, {\n                key: "getStreamType",\n                value: function() {\n                    return this.streamType;\n                }\n            }, {\n                key: "getMediaType",\n                value: function() {\n                    return this.mediaType;\n                }\n            }, {\n                key: "getResolution",\n                value: function() {\n                    return this.resolution ? this.resolution.toString() : null;\n                }\n            }, {\n                key: "getFrameRateReceived",\n                value: function() {\n                    return this.frameRateReceived;\n                }\n            }, {\n                key: "getFrameHeight",\n                value: function() {\n                    return this.frameHeight;\n                }\n            }, {\n                key: "getFrameWidth",\n                value: function() {\n                    return this.frameWidth;\n                }\n            }, {\n                key: "getDroppedFramesNum",\n                value: function() {\n                    return this.droppedFramesNum;\n                }\n            }, {\n                key: "getFramesReceived",\n                value: function() {\n                    return this.framesReceived;\n                }\n            }, {\n                key: "setFrameRateReceived",\n                value: function(a) {\n                    this.frameRateReceived = a, void 0 !== this.frameRateReceived && void 0 !== this.frameWidth && void 0 !== this.frameHeight && this.frameWidth > 0 && this.frameHeight > 0 ? this.resolution = new f.Resolution(this.frameWidth, this.frameHeight, this.frameRateReceived) : this.resolution = null;\n                }\n            }, {\n                key: "getJitter",\n                value: function() {\n                    return this.jitter;\n                }\n            }, {\n                key: "getRTT",\n                value: function() {\n                    return this.rtt;\n                }\n            }, {\n                key: "getLostPackets",\n                value: function() {\n                    return this.lostPackets;\n                }\n            }, {\n                key: "getDiscardedPackets",\n                value: function() {\n                    return this.discardedPackets;\n                }\n            }, {\n                key: "getReceivedPackets",\n                value: function() {\n                    return this.receivedPackets;\n                }\n            }, {\n                key: "getSentPackets",\n                value: function() {\n                    return this.sentPackets;\n                }\n            }, {\n                key: "getSentBytes",\n                value: function() {\n                    return this.sentBytes;\n                }\n            }, {\n                key: "getReceivedBytes",\n                value: function() {\n                    return this.receivedBytes;\n                }\n            }, {\n                key: "setFractionLost",\n                value: function(a) {\n                    this.fractionLost = void 0 === a ? null : a;\n                }\n            }, {\n                key: "getFractionLost",\n                value: function() {\n                    return this.fractionLost;\n                }\n            }, {\n                key: "extractTrack",\n                value: function() {\n                    var a = this.track;\n                    return this.track = null, a;\n                }\n            }, {\n                key: "toString",\n                value: function() {\n                    return "pcHash: " + this.pcHash + ", ssrc: " + this.ssrc + ", streamType: " + this.streamType + ", mediaType: " + this.mediaType + ", frameRateReceived: " + this.frameRateReceived + ", frameHeight: " + this.frameHeight + ", frameWidth: " + this.frameWidth + ", droppedFramesNum: " + this.droppedFramesNum + ", rtt: " + this.rtt + ", jitter: " + this.jitter + ", lostPackets: " + this.lostPackets + ", receivedPackets: " + this.receivedPackets + ", sentPackets: " + this.sentPackets + ", discardedPackets: " + this.discardedPackets + ", sentBytes: " + this.sentBytes + ", receivedBytes: " + this.receivedBytes;\n                }\n            } ]), a;\n        }();\n        c.Measurement = i;\n    }, {\n        "./resolution": 68,\n        "./validator": 83\n    } ],\n    61: [ function(a, b, c) {\n        "use strict";\n        function d(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }\n        function e(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.CPULimitationObserver = void 0;\n        var f = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), g = a("../../config/constants"), h = d(g), i = a("../../utility/timestamps"), j = d(i), k = function() {\n            function a() {\n                e(this, a), this.ewmaDiscardedPackets = 0, this.ewmaLostPackets = 0, this.ewmaDroppedFrames = 0, \n                this.last = 0, this.noticed = 0;\n            }\n            return f(a, [ {\n                key: "test",\n                value: function(a) {\n                    var b = a.discardedPackets, c = a.lostPackets;\n                    if (!c || c < 1 || !b || b < 1) return !1;\n                    if (0 === this.last) return this.last = j.getCurrent(), this.ewmaLostPackets = c, \n                    this.ewmaDiscardedPackets = b, !1;\n                    var d = j.getCurrent(), e = Math.max(d - this.last, 1), f = Math.min((5e3 - e) / 5e3, .9), g = a.droppedFrames;\n                    return this.ewmaLostPackets = this.ewmaLostPackets * f + c, this.ewmaDroppedFrames = this.ewmaDroppedFrames * f + g, \n                    this.ewmaDiscardedPackets = this.ewmaDiscardedPackets * f + b, !(!g || g < 1) && (!(1 < this.ewmaLostPackets || 1 < this.ewmaDiscardedPackets) && (!(d - this.noticed < 1e4) && (!(this.ewmaDroppedFrames < 1) && (this.noticed = d, \n                    !0))));\n                }\n            } ]), a;\n        }(), l = function() {\n            function a(b) {\n                e(this, a), this.notifyCallback = b, this.inbVideoTesters = new Map();\n            }\n            return f(a, [ {\n                key: "accept",\n                value: function(a) {\n                    for (var b = a.filter(function(a) {\n                        return a.getMediaType() === h.mediaType.video && a.getStreamType() === h.streamType.inbound;\n                    }), c = 0; c < b.length; ++c) {\n                        var d = b[c];\n                        this.checkInboundVideo(d);\n                    }\n                }\n            }, {\n                key: "checkInboundVideo",\n                value: function(a) {\n                    var b = a.peek(), c = a.getSSRC();\n                    if (this.inbVideoTesters.has(c) || this.inbVideoTesters.set(c, new k()), this.inbVideoTesters.get(c).test(b)) {\n                        var d = {\n                            reason: h.limitationType.cpu,\n                            ssrc: c\n                        };\n                        this.notifyCallback(d);\n                    }\n                }\n            }, {\n                key: "toString",\n                value: function() {\n                    return "CPULimitationObserver";\n                }\n            } ]), a;\n        }();\n        c.CPULimitationObserver = l;\n    }, {\n        "../../config/constants": 33,\n        "../../utility/timestamps": 99\n    } ],\n    62: [ function(a, b, c) {\n        "use strict";\n        function d(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }\n        function e(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.OneWayMediaObserver = void 0;\n        var f = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), g = a("../../config/constants"), h = d(g), i = a("../onewaymediadisruption"), j = a("../../utility/timestamps"), k = d(j), l = function() {\n            function a(b) {\n                e(this, a), this.notifierCallback = b, this.inbOneWayAudioDisruption = {\n                    sent: !1,\n                    started: 0,\n                    hasTrafficTs: 0\n                }, this.outbOneWayAudioDisruption = {\n                    sent: !1,\n                    started: 0,\n                    hasTrafficTs: 0\n                };\n            }\n            return f(a, [ {\n                key: "accept",\n                value: function(a) {\n                    var b = a.filter(function(a) {\n                        return a.getMediaType() == h.mediaType.audio && a.getStreamType() === h.streamType.inbound;\n                    }), c = a.filter(function(a) {\n                        return a.getMediaType() == h.mediaType.audio && a.getStreamType() === h.streamType.outbound;\n                    }), d = [ this.getInbOneWayAudioDisruption(b, c), this.getOutbOneWayAudioDisruption(b, c) ], e = d.filter(function(a) {\n                        return null !== a;\n                    });\n                    0 < e.length && this.notifierCallback(e);\n                }\n            }, {\n                key: "toString",\n                value: function() {\n                    return "DisruptionObserver";\n                }\n            }, {\n                key: "getInbOneWayAudioDisruption",\n                value: function(a, b) {\n                    var c = this.inbOneWayAudioDisruption;\n                    if (c.sent) return null;\n                    var d = b.filter(function(a) {\n                        return 0 === a.getStartTime();\n                    }).length < 1, e = b.filter(function(a) {\n                        return !a.hasTraffic();\n                    }).length < 1;\n                    if (!d || e) return null;\n                    var f = a.filter(function(a) {\n                        return !a.hasTraffic();\n                    }).length < 1;\n                    return 0 < a.length && f ? (c.started = 0, null) : 0 === c.started ? (c.started = k.getCurrent(), \n                    null) : k.getCurrent() - 5e3 < c.started ? null : (c.sent = !0, new i.OneWayMediaDisruption(h.oneWayMediaTypes.audio));\n                }\n            }, {\n                key: "getOutbOneWayAudioDisruption",\n                value: function(a, b) {\n                    var c = this.outbOneWayAudioDisruption;\n                    if (c.sent) return null;\n                    var d = a.filter(function(a) {\n                        return 0 === a.getStartTime();\n                    }).length < 1, e = a.filter(function(a) {\n                        return !a.hasTraffic();\n                    }).length < 1;\n                    if (!d || !e) return null;\n                    var f = b.filter(function(a) {\n                        return !a.hasTraffic();\n                    }).length < 1;\n                    return 0 < b.length && f ? (c.started = 0, null) : 0 === c.started ? (c.started = k.getCurrent(), \n                    null) : k.getCurrent() - 5e3 < c.started ? null : (c.sent = !0, new i.OneWayMediaDisruption(h.oneWayMediaTypes.audio));\n                }\n            } ]), a;\n        }();\n        c.OneWayMediaObserver = l;\n    }, {\n        "../../config/constants": 33,\n        "../../utility/timestamps": 99,\n        "../onewaymediadisruption": 66\n    } ],\n    63: [ function(a, b, c) {\n        "use strict";\n        function d(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }\n        function e(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.QPSumObserver = void 0;\n        var f = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), g = a("../../config/constants"), h = d(g), i = a("../../utility/timestamps"), j = d(i), k = function() {\n            function a(b) {\n                e(this, a), this.lastQpSum = null, this.qpAvg = null, this.noticed = 0;\n            }\n            return f(a, [ {\n                key: "test",\n                value: function(a) {\n                    var b = a.getTrack();\n                    if (!b || !b.data || !b.data.qpSum) return !1;\n                    if (!this.lastQpSum) return this.lastQpSum = b.data.qpSum, !1;\n                    var c = b.data.qpSum - this.lastQpSum;\n                    if (this.lastQpSum = b.data.qpSum, null === this.qpAvg) this.qpAvg = c; else {\n                        this.qpAvg = .2 * c + .8 * this.qpAvg;\n                    }\n                    var d = Math.max(2 * this.qpAvg, 1);\n                    if (c < this.qpAvg + d) return !1;\n                    var e = j.getCurrent();\n                    return this.noticed < e - 1e4;\n                }\n            } ]), a;\n        }(), l = function() {\n            function a(b) {\n                e(this, a), this.notifyCallback = b, this.testers = new Map();\n            }\n            return f(a, [ {\n                key: "accept",\n                value: function(a) {\n                    for (var b = 0; b < a.length; ++b) {\n                        var c = a[b];\n                        if (c.getMediaType() === h.mediaType.video) {\n                            var d = c.getSSRC();\n                            this.testers.has(d) || this.testers.set(d, new k(c));\n                            if (this.testers.get(d).test(c)) {\n                                var e = {\n                                    reason: h.qualityDisruptionTypes.qpchange\n                                };\n                                this.notifyCallback(e);\n                            }\n                        }\n                    }\n                }\n            }, {\n                key: "toString",\n                value: function() {\n                    return "QPSumObserver";\n                }\n            } ]), a;\n        }();\n        c.QPSumObserver = l;\n    }, {\n        "../../config/constants": 33,\n        "../../utility/timestamps": 99\n    } ],\n    64: [ function(a, b, c) {\n        "use strict";\n        function d(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }\n        function e(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.SendingTrigger = void 0;\n        var f = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), g = a("../../utility/timestamps"), h = d(g), i = a("../validator"), j = d(i), k = 1e3, l = 3e4, m = function() {\n            function a(b, c, d) {\n                e(this, a), this.last = null, this.actual = 0, this.name = b, this.alpha = c, this.supplier = d;\n            }\n            return f(a, [ {\n                key: "update",\n                value: function(a) {\n                    if (null === this.last) return void (this.last = a);\n                    var b = Math.abs(a - this.last);\n                    this.actual = b * this.alpha + this.actual * (1 - this.alpha), this.last = a;\n                }\n            }, {\n                key: "doTest",\n                value: function(a) {\n                    var b = this.last;\n                    return this.update(a), null !== b && b + this.supplier(this.actual) < a;\n                }\n            } ]), a;\n        }(), n = function() {\n            function a() {\n                e(this, a);\n                var b = this;\n                this.marginFactor = 1, this.rttTester = new m("RTT Tester", .2, function(a) {\n                    return Math.max(50, a) * b.marginFactor;\n                }), this.throughputTester = new m("Throughput Tester", .1, function(a) {\n                    return Math.max(100, a) * b.marginFactor;\n                }), this.FLTester = new m("FL Tester", .1, function(a) {\n                    return Math.max(.2, a) * b.marginFactor;\n                }), this.lastDecreased = h.getCurrent();\n            }\n            return f(a, [ {\n                key: "test",\n                value: function(a) {\n                    var b = a.peek();\n                    if (!b) return !1;\n                    var c = a.getTrack(), d = c.data, e = b.getRTT(), f = j.checkForNan(parseInt(d.csioIntBRKbps, 10)), g = b.getFractionLost();\n                    if (this.rttTester.doTest(e) || this.throughputTester.doTest(f) || this.FLTester.doTest(g)) return this.marginFactor = Math.min(2 * this.marginFactor, 15), \n                    !0;\n                    var i = h.getCurrent();\n                    return 3e3 < i - this.lastChanged && (this.marginFactor = Math.max(this.marginFactor - .5, 1), \n                    this.lastDecreased = i), !1;\n                }\n            } ]), a;\n        }(), o = function() {\n            function a(b) {\n                e(this, a), this.notifyCallback = b, this.minInterval = k, this.maxInterval = l, \n                this.notified = 0, this.testers = new Map();\n            }\n            return f(a, [ {\n                key: "setup",\n                value: function(a, b) {\n                    this.minInterval = a, this.maxInterval = b;\n                }\n            }, {\n                key: "accept",\n                value: function(a) {\n                    var b = h.getCurrent(), c = b - this.notified;\n                    if (this.minInterval === this.maxInterval) return void (this.minInterval <= c && (this.notifyCallback(), \n                    this.notified = b));\n                    if (!(c < this.minInterval)) {\n                        if (c < this.maxInterval) {\n                            if (!1 === this.doSend(a)) return;\n                        }\n                        this.notifyCallback(), this.notified = b;\n                    }\n                }\n            }, {\n                key: "setIntervals",\n                value: function(a, b) {\n                    this.minInterval = a, this.maxInterval = b;\n                }\n            }, {\n                key: "toString",\n                value: function() {\n                    return "SendingTrigger";\n                }\n            }, {\n                key: "doSend",\n                value: function(a) {\n                    for (var b = 0; b < a.length; ++b) {\n                        var c = a[b], d = c.getSSRC();\n                        this.testers.has(d) || this.testers.set(d, new n());\n                        if (this.testers.get(d).test(c)) return !0;\n                    }\n                    return !1;\n                }\n            } ]), a;\n        }();\n        c.SendingTrigger = o;\n    }, {\n        "../../utility/timestamps": 99,\n        "../validator": 83\n    } ],\n    65: [ function(a, b, c) {\n        "use strict";\n        function d(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }\n        function e(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.ThroughputObserver = void 0;\n        var f = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), g = a("../../config/constants"), h = d(g), i = a("../../utility/timestamps"), j = d(i), k = function() {\n            function a(b) {\n                e(this, a), this.notifierCallback = b, this.observations = new Map();\n            }\n            return f(a, [ {\n                key: "accept",\n                value: function(a) {\n                    var b = a.filter(function(a) {\n                        return a.getMediaType() === h.mediaType.video && a.getStreamType() === h.streamType.outbound;\n                    });\n                    if (!(b.length < 1)) {\n                        var c = this;\n                        b.forEach(function(a) {\n                            c.observe(a);\n                        });\n                    }\n                }\n            }, {\n                key: "toString",\n                value: function() {\n                    return "ThroughputObserver";\n                }\n            }, {\n                key: "getObservations",\n                value: function(a) {\n                    if (this.observations.has(a)) return this.observations.get(a);\n                    var b = {\n                        ssrc: 0,\n                        started: 0,\n                        max: 0,\n                        maxTs: 0,\n                        stable: 0,\n                        stableTs: 0,\n                        ready: !1,\n                        maxVerified: !1,\n                        stableVerified: !1\n                    };\n                    return this.observations.set(a, b), this.observations.get(a);\n                }\n            }, {\n                key: "observe",\n                value: function(a) {\n                    var b = a.getSSRC(), c = this.getObservations(b), d = j.getCurrent();\n                    if (!0 !== c.ready) {\n                        if (0 === c.started) return c.ssrc = b, void (c.started = d);\n                        var e = a.getTrack(), f = e.data, g = f.csioIntBRKbps, h = Math.min(50, .05 * g);\n                        if (c.max < g ? (c.max = g, c.maxTs = d) : 1e4 < d - c.maxTs && (c.maxVerified = !0), \n                        !(d - c.started < 15e3) && (g - h < f.csioAvgBRKbps && f.csioAvgBRKbps < g + h && (c.stableTs = d, \n                        c.stable = g, c.stableVerified = !0), c.stableVerified && c.maxVerified)) {\n                            var i = {\n                                ssrc: String(c.ssrc),\n                                maxsendingKBitrate: c.max,\n                                timeToMaxSendingKBitrate: c.maxTs - c.started,\n                                stablesendingKBitrate: c.stable,\n                                timeToStableSendingKBitrate: c.stableTs - c.started\n                            };\n                            this.notifierCallback(i), c.ready = !0;\n                        }\n                    }\n                }\n            } ]), a;\n        }();\n        c.ThroughputObserver = k;\n    }, {\n        "../../config/constants": 33,\n        "../../utility/timestamps": 99\n    } ],\n    66: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        });\n        var e = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), f = function() {\n            function a(b) {\n                var c = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : "0";\n                d(this, a), this.mediaType = b, this.ssrc = c;\n            }\n            return e(a, [ {\n                key: "getContent",\n                value: function() {\n                    var a = this;\n                    return {\n                        mediaType: a.mediaType,\n                        ssrc: a.ssrc\n                    };\n                }\n            } ]), a;\n        }();\n        c.OneWayMediaDisruption = f;\n    }, {} ],\n    67: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        });\n        var e = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), f = function() {\n            function a(b, c, e, f, g, h) {\n                d(this, a), this.candidatePair = b, this.codec = c, this.pcHash = e, this.trackStats = f, \n                this.transportStats = g, this.measurements = h;\n            }\n            return e(a, [ {\n                key: "getCandidatePair",\n                value: function() {\n                    return this.candidatePair;\n                }\n            }, {\n                key: "getCodec",\n                value: function() {\n                    return this.codec;\n                }\n            }, {\n                key: "getPcHash",\n                value: function() {\n                    return this.pcHash;\n                }\n            }, {\n                key: "getTrackStats",\n                value: function() {\n                    return this.trackStats;\n                }\n            }, {\n                key: "getTransportStats",\n                value: function() {\n                    return this.transportStats;\n                }\n            }, {\n                key: "getMeasurements",\n                value: function() {\n                    return this.measurements;\n                }\n            } ]), a;\n        }();\n        c.PcStats = f;\n    }, {} ],\n    68: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        });\n        var e = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), f = function() {\n            function a(b, c, e) {\n                d(this, a), this.width = b, this.height = c, this.frameRate = e;\n            }\n            return e(a, [ {\n                key: "getWidth",\n                value: function() {\n                    return this.width;\n                }\n            }, {\n                key: "getHeight",\n                value: function() {\n                    return this.height;\n                }\n            }, {\n                key: "getFrameRate",\n                value: function() {\n                    return this.frameRate;\n                }\n            }, {\n                key: "toString",\n                value: function() {\n                    return this.width && this.height && this.frameRate ? this.width.toString() + "X" + this.height.toString() + "X" + this.frameRate.toString() : null;\n                }\n            } ]), a;\n        }();\n        c.Resolution = f;\n    }, {} ],\n    69: [ function(a, b, c) {\n        "use strict";\n        function d(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }\n        function e(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        function f(a, b) {\n            if (!a) throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");\n            return !b || "object" != typeof b && "function" != typeof b ? a : b;\n        }\n        function g(a, b) {\n            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);\n            a.prototype = Object.create(b && b.prototype, {\n                constructor: {\n                    value: a,\n                    enumerable: !1,\n                    writable: !0,\n                    configurable: !0\n                }\n            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.StatsAdapter = c.StatsAdapterIO = void 0;\n        var h = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), i = a("../config/constants"), j = d(i), k = a("../collections/component"), l = a("../utility/registry"), m = a("../utility/hash"), n = d(m), o = c.StatsAdapterIO = {\n            RawStatsIn: "RawStatsIn",\n            RawStatsOut: "RawStatsOut",\n            UnprocessedOut: "UnprocessedOut"\n        }, p = function(a) {\n            function b(a, c) {\n                e(this, b);\n                var d = f(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, "StatsAdapter"));\n                return d.bindPort(o.RawStatsIn, d.receiveRawData, d), d.declarePort(o.RawStatsOut), \n                d.declarePort(o.UnprocessedOut), d.codeBase = a, d.browser = c, d;\n            }\n            return g(b, a), h(b, [ {\n                key: "receiveRawData",\n                value: function(a, b) {\n                    if (a) {\n                        var c = this.extractRawStats(a);\n                        if (c) {\n                            window && window.csioReactNative && (c = this.removeValues(c)), this.isConnected(o.UnprocessedOut) && this.transmit(o.UnprocessedOut, c, b);\n                            var d = this.processRawStats(c, b);\n                            if (d && d.transportStats) for (var e = 0; e < d.transportStats.length; e++) d.transportStats[e].hash = this.getTransportHash(d.transportStats[e]);\n                            d && d.transportStats && this.checkTransportStatsUpdates(d.transportStats, b), d && d.trackStats && (d = this.backFillTrackStats(d)), \n                            d && d.transportStats && d.candidatePair && (d = this.backFillCandidatePairStats(d)), \n                            d.pcHash = b, this.transmit(o.RawStatsOut, d);\n                        }\n                    }\n                }\n            }, {\n                key: "removeValues",\n                value: function(a) {\n                    for (var b = 0; b < a.length; ++b) {\n                        var c = a[b];\n                        if (c && c.values) {\n                            for (var d = 0; d < c.values.length; ++d) Object.assign(c, c.values[d]);\n                            delete c.values;\n                        }\n                    }\n                    return a;\n                }\n            }, {\n                key: "getIceCandidates",\n                value: function(a) {\n                    if (!a) return {\n                        localIceCandidates: [],\n                        remoteIceCandidates: [],\n                        iceCandidatePairs: []\n                    };\n                    var b = this.extractRawStats(a);\n                    return this.processRawStatsForIceInfo(b);\n                }\n            }, {\n                key: "extractRawStats",\n                value: function(a) {\n                    var b = [];\n                    if (a && a.result) b = a.result(); else if (a && a.forEach) a.forEach(function(a) {\n                        b.push(a);\n                    }); else for (var c in a) a.hasOwnProperty(c) && b.push(a[c]);\n                    return b;\n                }\n            }, {\n                key: "normalizeIceCandidates",\n                value: function(a) {\n                    for (var b = 0; b < a.length; b += 1) {\n                        var c = a[b];\n                        c.transport = c.protocol ? c.protocol : "udp", c.ip = c.ip ? c.ip : c.ipAddress, \n                        c.port = c.portNumber ? Number(c.portNumber) : c.port, "ssltcp" === c.transport && (c.transport = "tcp"), \n                        c.id || (c.id = "csio" + c.port);\n                    }\n                    return a;\n                }\n            }, {\n                key: "normalizeCanidatePairs",\n                value: function(a) {\n                    for (var b = 0; b < a.length; b += 1) {\n                        var c = a[b];\n                        "in-progress" === c.state && (c.state = "inprogress"), c.state || (c.state = "succeeded"), \n                        c.nominated || (c.nominated = "true" === c.googActiveConnection), c.priority || (c.priority = 123), \n                        c.id || (c.id = "csio" + c.priority);\n                    }\n                    return a;\n                }\n            }, {\n                key: "processRawStatsForIceInfo",\n                value: function(a) {\n                    var b = [], c = [], d = [], e = void 0;\n                    if (!a) return {\n                        localIceCandidates: b,\n                        remoteIceCandidates: c,\n                        iceCandidatePairs: d\n                    };\n                    for (var f = 0; f < a.length; ++f) {\n                        var g = this.getParsedStats(a[f]), h = this.statsClassifier(g);\n                        if (h.candidatePair) d.push(h.candidatePair); else if (h.transportStats) {\n                            if ("transport" === h.transportStats.type) {\n                                e = h.transportStats.selectedCandidatePairId;\n                                continue;\n                            }\n                            d.push(h.transportStats);\n                        } else h.localCandidate ? b.push(h.localCandidate) : h.remoteCandidate && c.push(h.remoteCandidate);\n                    }\n                    if (e) for (var i = 0; i < d.length; ++i) d[i].id === e && (d[i].googActiveConnection = "true");\n                    return {\n                        localIceCandidates: this.normalizeIceCandidates(b),\n                        remoteIceCandidates: this.normalizeIceCandidates(c),\n                        iceCandidatePairs: this.normalizeCanidatePairs(d)\n                    };\n                }\n            }, {\n                key: "processRawStats",\n                value: function(a, b) {\n                    var c = {}, d = {}, e = {};\n                    c.tracks = [], c.candidatePair = [], c.transportStats = [], c.trackStats = [], c.codec = [];\n                    for (var f = 0; f < a.length; f++) {\n                        var g = this.getParsedStats(a[f]), h = this.statsClassifier(g);\n                        h.tracks ? c.tracks.push(h.tracks) : h.candidatePair ? c.candidatePair.push(h.candidatePair) : h.transportStats ? this.codeBase !== j.codeBaseType.firefox ? (parseInt(h.transportStats.bytesReceived, 10) > 0 || parseInt(h.transportStats.bytesSent, 10) > 0) && (c.transportStats.push(h.transportStats), \n                        "true" !== h.transportStats.googActiveConnection && !0 !== h.transportStats.googActiveConnection || (c.activeConnectionIndex = h.transportStats.length)) : "true" !== h.transportStats.selected && !0 !== h.transportStats.selected || (c.transportStats.push(h.transportStats), \n                        c.activeConnectionIndex = h.transportStats.length) : h.bwe ? c.bwe = h.bwe : h.trackStats ? c.trackStats.push(h.trackStats) : h.codec ? c.codec.push(h.codec) : h.localCandidate ? d[h.localCandidate.id] = h.localCandidate : h.remoteCandidate && (e[h.remoteCandidate.id] = h.remoteCandidate);\n                    }\n                    if (c.tracks) {\n                        var i = l.Registry.getConferenceManager().getConferenceForPcHash(b), k = void 0;\n                        i && (k = i.getPeerConnectionManager().getPcHandlerByHash(b)), c.tracks.forEach(function(a) {\n                            var b = k.getSSRCInfo(a.data.ssrc);\n                            void 0 !== b && b.localStartTime || k && (k.updateSDP(c.tracks), b = k.getSSRCInfo(a.data.ssrc)), \n                            b && (a.cname = b.cname, a.msid = b.msid, a.associatedVideoTag = b.associatedVideoTag, \n                            a.usageLabel = b.usageLabel);\n                        });\n                    }\n                    return c.transportStats && this.codeBase === j.codeBaseType.firefox && (c.transportStats = this.getAddressInfoFromCandidates(c.transportStats, d, e)), \n                    c;\n                }\n            }, {\n                key: "getParsedStats",\n                value: function(a) {\n                    var b = {};\n                    if (a.timestamp instanceof Date && (b.timestamp = a.timestamp.getTime().toString()), \n                    a.type && (b.type = a.type), a.names) {\n                        for (var c = a.names(), d = 0; d < c.length; ++d) b[c[d]] = a.stat(c[d]);\n                        a.id && (b.id = a.id);\n                    } else Object.assign(b, a);\n                    if (b.values) {\n                        for (var e = 0; e < b.values.length; ++e) Object.assign(b, b.values[e]);\n                        delete b.values;\n                    }\n                    return b;\n                }\n            }, {\n                key: "statsClassifier",\n                value: function(a) {\n                    var b = {}, c = function() {\n                        for (var b = arguments.length, c = Array(b), d = 0; d < b; d++) c[d] = arguments[d];\n                        return -1 !== c.indexOf(a.type);\n                    }, d = c("inbound-rtp", "inboundrtp", "remote-inbound-rtp"), e = "true" === a.isRemote || !0 === a.isRemote;\n                    return d || c("outbound-rtp", "outboundrtp", "remote-outbound-rtp") ? (b.tracks = {}, \n                    b.tracks.data = a, b.tracks.ssrc = a.ssrc, b.tracks.streamType = d ? "inbound" : "outbound", \n                    b.tracks.reportType = "local", void 0 !== a.isRemote && (b.tracks.reportType = e ? "remote" : "local")) : c("candidatepair") && a.selected ? b.transportStats = a : c("localcandidate", "local-candidate") ? b.localCandidate = a : c("remotecandidate", "remote-candidate") ? b.remoteCandidate = a : c("transport", "googCandidatePair") ? b.transportStats = a : c("VideoBwe") ? b.bwe = a : c("track") ? b.trackStats = a : c("candidate-pair") ? b.candidatePair = a : c("codec") ? b.codec = a : c("ssrc") && (b.tracks = {}, \n                    b.tracks.data = a, b.tracks.ssrc = a.ssrc, b.tracks.reportType = "local", b.tracks.streamType = a.bytesSent ? "outbound" : "inbound"), \n                    b;\n                }\n            }, {\n                key: "getAddressInfoFromCandidates",\n                value: function(a, b, c) {\n                    for (var d = void 0, e = void 0, f = 0; f < a.length; f++) d = b[a[f].localCandidateId], \n                    e = c[a[f].remoteCandidateId], d && e && (a[f].localAddr = d.ipAddress + ":" + d.portNumber, \n                    a[f].remoteAddr = e.ipAddress + ":" + e.portNumber, a[f].localAddrType = d.candidateType, \n                    a[f].remoteAddrType = e.candidateType, a[f].transportType = d.transport);\n                    return a;\n                }\n            }, {\n                key: "getTransportHash",\n                value: function(a) {\n                    var b = void 0;\n                    return a && (this.codeBase === j.codeBaseType.chrome ? a.googLocalAddress ? (b = a.googLocalAddress, \n                    b.concat(":", a.googRemoteAddress)) : a.selectedCandidatePairId && (b = a.selectedCandidatePairId) : this.codeBase === j.codeBaseType.firefox && (b = a.localAddr, \n                    b.concat(":", a.remoteAddr))), n.generateHash(b);\n                }\n            }, {\n                key: "backFillTrackStats",\n                value: function(a) {\n                    for (var b = a.tracks.length, c = void 0, d = void 0, e = void 0, f = 0; f < b; f++) c = a.tracks[f], \n                    c.data.trackId && (d = this.getStatsForId(a.trackStats, c.data.trackId)) && (a.tracks[f].data = this.mergeObjects(a.tracks[f].data, d)), \n                    c.data.codecId && (e = this.getStatsForId(a.codec, c.data.codecId)) && (a.tracks[f].data = this.mergeObjects(a.tracks[f].data, e));\n                    return a;\n                }\n            }, {\n                key: "backFillCandidatePairStats",\n                value: function(a) {\n                    for (var b = a.transportStats.length, c = void 0, d = void 0, e = 0; e < b; e++) d = a.transportStats[e], \n                    d.selectedCandidatePairId && (c = this.getStatsForId(a.candidatePair, d.selectedCandidatePairId)) && (a.transportStats[e] = this.mergeObjects(a.transportStats[e], c));\n                    return a;\n                }\n            }, {\n                key: "mergeObjects",\n                value: function(a, b) {\n                    for (var c in b) b.hasOwnProperty(c) && "id" !== c && "type" !== c && (a[c] = b[c]);\n                    return a;\n                }\n            }, {\n                key: "getStatsForId",\n                value: function(a, b) {\n                    if (a) {\n                        var c = a.filter(function(a) {\n                            return a.id === b;\n                        });\n                        if (c.length > 0) return c[0];\n                    }\n                }\n            }, {\n                key: "formatRelayType",\n                value: function(a) {\n                    var b = "None";\n                    switch (a) {\n                      case 0:\n                        b = "TURN/TLS";\n                        break;\n\n                      case 1:\n                        b = "TURN/TCP";\n                        break;\n\n                      case 2:\n                        b = "TURN/UDP";\n                    }\n                    return b;\n                }\n            }, {\n                key: "getRelayType",\n                value: function(a, b) {\n                    var c = this, d = void 0, e = function(b) {\n                        if (b.typePreference) {\n                            var e = b.typePreference >> 24;\n                            return "rtp" === b.protocol && b.address === a && (e >= 0 && e <= 2 && (d = c.formatTypePreference(e)), \n                            !0);\n                        }\n                        return !1;\n                    };\n                    return b.getIceCandidates().some(e), d;\n                }\n            }, {\n                key: "getTransportInfo",\n                value: function(a, b) {\n                    for (var c = {}, d = !1, e = 0; e < a.length; e++) {\n                        var f = a[e];\n                        if (navigator.mozGetUserMedia && "candidatepair" === f.type && ("true" === f.selected || !0 === f.selected)) {\n                            c.foundActive = !0, c.localAddr = f.localAddr, c.remoteAddr = f.remoteAddr, c.localAddrType = f.localAddrType, \n                            c.remoteAddrType = f.remoteAddrType, c.transportType = f.transportType, c.localCandidateId = f.localCandidateId, \n                            c.remoteCandidateId = f.remoteCandidateId;\n                            break;\n                        }\n                        if ("googCandidatePair" === f.type && ("true" === f.googActiveConnection || !0 === f.googActiveConnection)) {\n                            c.foundActive = !0, c.localAddr = f.googLocalAddress, c.remoteAddr = f.googRemoteAddress, \n                            c.localAddrType = f.googLocalCandidateType, c.remoteAddrType = f.googRemoteCandidateType, \n                            c.transportType = f.googTransportType;\n                            break;\n                        }\n                        if ("transport" === f.type) {\n                            d = !0, f.selectedCandidatePairId && (c.selectedCandidatePairId = f.selectedCandidatePairId);\n                            break;\n                        }\n                    }\n                    return d && c.localAddr && (c.ipv6 = 0 === c.localAddr.indexOf("["), c.relayType = getRelayType(c.localAddr, b)), \n                    c;\n                }\n            }, {\n                key: "sendFabricTransportSwitch",\n                value: function(a, b) {\n                    a.sendFabricTransportSwitch(b);\n                }\n            }, {\n                key: "checkTransportStatsUpdates",\n                value: function(a, b) {\n                    var c = l.Registry.getConferenceManager().getConferenceForPcHash(b);\n                    if (c) {\n                        var d = c.getPeerConnectionManager().getPcHandlerByHash(b);\n                        if (d) {\n                            var e = this.getTransportInfo(a, d), f = d.getTransportInfo();\n                            f && (f.localAddr === e.localAddr && f.remoteAddr === e.remoteAddr && f.transportType === e.transportType && f.selectedCandidatePairId === e.selectedCandidatePairId && f.localCandidateId === e.localCandidateId && f.remoteCandidateId === e.remoteCandidateId || (d.setTransportInfo(e), \n                            this.sendFabricTransportSwitch(d, e.relayType)));\n                        }\n                    }\n                }\n            } ]), b;\n        }(k.Component);\n        c.StatsAdapter = p;\n    }, {\n        "../collections/component": 26,\n        "../config/constants": 33,\n        "../utility/hash": 92,\n        "../utility/registry": 95\n    } ],\n    70: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        function e(a, b) {\n            if (!a) throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");\n            return !b || "object" != typeof b && "function" != typeof b ? a : b;\n        }\n        function f(a, b) {\n            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);\n            a.prototype = Object.create(b && b.prototype, {\n                constructor: {\n                    value: a,\n                    enumerable: !1,\n                    writable: !0,\n                    configurable: !0\n                }\n            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.StatsAssembler = c.StatsAssemblerIO = void 0;\n        var g = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), h = a("../collections/component"), i = c.StatsAssemblerIO = {\n            StatsTupleIn: "StatsTupleIn",\n            CallstatsOut: "CallstatsOut"\n        }, j = function(a) {\n            function b() {\n                d(this, b);\n                var a = e(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, "StatsAssembler"));\n                return a.pcHashes = [], a.bindPort(i.StatsTupleIn, a.receiveStats, a), a.declarePort(i.CallstatsOut), \n                a;\n            }\n            return f(b, a), g(b, [ {\n                key: "receiveStats",\n                value: function(a) {\n                    for (var b = this, c = 0; c < a.tracks.length; c++) {\n                        (function(c) {\n                            var d = a.tracks[c];\n                            if (b.pcHashes.find(function(a) {\n                                return a === d.pcHash;\n                            })) return "continue";\n                            b.pcHashes.push(d.pcHash);\n                        })(c);\n                    }\n                    for (var d = a.getTransportStats(), c = 0; c < this.pcHashes.length; c++) {\n                        var e = this.pcHashes[c], f = {};\n                        f.codec = a.getCodec(), f.trackStats = a.getTrackStats(), f.tracks = [];\n                        for (var g = 0; g < a.tracks.length; g++) {\n                            var h = a.tracks[g];\n                            h.pcHash === e && f.tracks.push(h);\n                        }\n                        var j = d.get(e);\n                        1 == j.length ? f.Transport = j[0] : f.Transport = j, this.transmit(i.CallstatsOut, e, f);\n                    }\n                }\n            } ]), b;\n        }(h.Component);\n        c.StatsAssembler = j;\n    }, {\n        "../collections/component": 26\n    } ],\n    71: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.StatsCallbackBuilder = void 0;\n        var e = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), f = a("../utility/registry"), g = function() {\n            function a() {\n                d(this, a), this.callback = null;\n            }\n            return e(a, [ {\n                key: "setCallback",\n                value: function(a) {\n                    this.callback = a;\n                }\n            }, {\n                key: "buildStats",\n                value: function(a, b) {\n                    this.callback && this.buildFromUnifiedFormat(a, b);\n                }\n            }, {\n                key: "getConnectionState",\n                value: function() {\n                    return !0 === navigator.onLine ? "online" : "offline";\n                }\n            }, {\n                key: "buildConferenceUrl",\n                value: function(a) {\n                    var b = a.getConferenceId(), c = f.Registry.getConferenceManager().get(b);\n                    return c ? c.getUrl() : null;\n                }\n            }, {\n                key: "buildFromUnifiedFormat",\n                value: function(a, b) {\n                    var c = {};\n                    c.connectionState = this.getConnectionState(), c.conferenceURL = this.buildConferenceUrl(b), \n                    c.fabricState = b.getPcState(), c.streams = {}, c.mediaStreamTracks = [];\n                    for (var d = 0; d < a.length; d++) {\n                        var e = a[d];\n                        if ("inbound-rtp" === e.type || "outbound-rtp" === e.type || "ssrc" === e.type || "inboundrtp" === e.type || "outboundrtp" === e.type) {\n                            var f = {\n                                ssrc: e.ssrc,\n                                statsType: e.type,\n                                fractionLoss: e.csioIntFL,\n                                bitrate: e.csioIntBRKbps,\n                                quality: e.csioMark,\n                                mediaType: e.csioMediaType,\n                                jitter: e.jitter,\n                                audioOutputLevel: e.audioOutputLevel,\n                                audioIntputLevel: e.audioInputLevel,\n                                audioLevel: e.audioLevel,\n                                averageRTT: e.csioAvgRtt,\n                                averageJitter: e.csioAvgJitter,\n                                packetLossPercentage: e.csioPktLossPercentage,\n                                rtt: e.roundTripTime,\n                                packetRate: e.csioIntPR,\n                                remoteUserID: b.getRemoteId()\n                            }, g = b.getSSRCInfo(e.ssrc + "");\n                            if (g && (f.cname = g.cname, f.msid = g.msid, f.usageLabel = g.usageLabel, f.associatedVideoTag = g.associatedVideoTag), \n                            e.hasOwnProperty("googRtt") && (f.rtt = e.googRtt), e.hasOwnProperty("mozRtt") && (f.rtt = e.mozRtt), \n                            e.hasOwnProperty("googJitterReceived") && (f.jitter = e.googJitterReceived), "inboundrtp" === f.statsType) f.statsType = "inbound-rtp"; else if ("outboundrtp" === f.statsType) f.statsType = "outbound-rtp"; else if ("ssrc" === f.statsType) {\n                                var h = e.id;\n                                h.indexOf("send") > 0 ? f.statsType = "outbound-rtp" : f.statsType = "inbound-rtp";\n                            }\n                            "remote-inbound-rtp" !== f.statsType && "remote-outbound-rtp" !== f.statsType && (!0 !== e.isRemote && "true" !== e.isRemote || (f.statsType = "remote-" + f.statsType)), \n                            c.streams[e.ssrc] = f, c.mediaStreamTracks.push(f);\n                        }\n                    }\n                    this.callback(c);\n                }\n            } ]), a;\n        }();\n        c.StatsCallbackBuilder = g;\n    }, {\n        "../utility/registry": 95\n    } ],\n    72: [ function(a, b, c) {\n        "use strict";\n        function d(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }\n        function e(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        function f(a, b) {\n            if (!a) throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");\n            return !b || "object" != typeof b && "function" != typeof b ? a : b;\n        }\n        function g(a, b) {\n            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);\n            a.prototype = Object.create(b && b.prototype, {\n                constructor: {\n                    value: a,\n                    enumerable: !1,\n                    writable: !0,\n                    configurable: !0\n                }\n            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.StatsMonitor = c.StatsMonitorIO = void 0;\n        var h = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), i = a("../collections/component"), j = a("./tracksmonitor"), k = a("./transportsmonitor"), l = a("./statstuple"), m = a("../utility/registry"), n = a("./monitorhooks/sendingtrigger"), o = a("./monitorhooks/onewaymediaobserver"), p = a("./monitorhooks/throughputobserver"), q = a("./monitorhooks/cpulimitationobserver"), r = a("./monitorhooks/qpsumobserver"), s = a("../config/constants"), t = d(s), u = a("../utility/csiologger"), v = d(u), w = c.StatsMonitorIO = {\n            PcStatsTupleIn: "PcStatsTupleIn",\n            StatsTupleOut: "StatsTupleOut"\n        }, x = function(a) {\n            function b(a) {\n                e(this, b);\n                var c = f(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, "StatsMonitor"));\n                return c.bindPort(w.PcStatsTupleIn, c.receive, c), c.declarePort(w.StatsTupleOut), \n                c.lastPcStats = null, c.lastPcHash = null, c.tracksmonitor = new j.TracksMonitor(), \n                c.transportsmonitor = new k.TransportsMonitor(a), c.candidatepairs = new Map(), \n                c.monitorhooks = [], c.sendingTrigger = new n.SendingTrigger(c.sendStatsTuple.bind(c)), \n                c.oneWayMediaObserver = new o.OneWayMediaObserver(c.sendDisruptions.bind(c)), c.throughputObserver = new p.ThroughputObserver(c.sendThroughputObservations.bind(c)), \n                c.cpuLimitationObserver = new q.CPULimitationObserver(c.sendCPULimitationObservations.bind(c)), \n                c.qpSumObserver = new r.QPSumObserver(c.sendQPSumDistortions.bind(c)), c.setupHooks(), \n                c;\n            }\n            return g(b, a), h(b, [ {\n                key: "setupHooks",\n                value: function() {\n                    this.monitorhooks.push(this.sendingTrigger.accept.bind(this.sendingTrigger)), this.monitorhooks.push(this.oneWayMediaObserver.accept.bind(this.oneWayMediaObserver)), \n                    this.monitorhooks.push(this.throughputObserver.accept.bind(this.throughputObserver)), \n                    this.monitorhooks.push(this.cpuLimitationObserver.accept.bind(this.cpuLimitationObserver)), \n                    this.monitorhooks.push(this.qpSumObserver.accept.bind(this.qpSumObserver));\n                }\n            }, {\n                key: "setIntervals",\n                value: function(a, b) {\n                    this.sendingTrigger.setup(a, b);\n                }\n            }, {\n                key: "receive",\n                value: function(a) {\n                    var b = a.getPcHash(), c = a.getMeasurements();\n                    this.candidatepairs.set(b, a.getCandidatePair()), this.transportsmonitor.set(b, a.getTransportStats());\n                    for (var d = 0; d < c.length; d++) {\n                        var e = c[d], f = this.tracksmonitor.getMonitor(e);\n                        f ? f.add(e) : v.warn("No monitor for ssrc " + e.getSSRC());\n                    }\n                    this.lastPcStats = a, this.lastPcHash = b;\n                    for (var g = this.tracksmonitor.getMonitors(), h = this.monitorhooks, i = 0; i < h.length; i++) {\n                        (0, h[i])(g);\n                    }\n                }\n            }, {\n                key: "getCandidatePairs",\n                value: function() {\n                    var a = [];\n                    return this.candidatepairs.forEach(function(b, c) {\n                        var d = [ c, b ];\n                        a.push(d);\n                    }), a;\n                }\n            }, {\n                key: "sendStatsTuple",\n                value: function() {\n                    var a = new l.StatsTuple(this.getCandidatePairs(), this.lastPcStats.getCodec(), this.lastPcStats.getTrackStats(), this.transportsmonitor.getIntervalStats(), this.tracksmonitor.extractTracks());\n                    this.transmit(w.StatsTupleOut, a);\n                }\n            }, {\n                key: "sendDisruptions",\n                value: function(a) {\n                    var b = this;\n                    a.forEach(function(a) {\n                        b.sendEventMsg(t.internalFabricEvent.oneWayMedia, a.getContent());\n                    });\n                }\n            }, {\n                key: "sendCPULimitationObservations",\n                value: function(a) {}\n            }, {\n                key: "sendQPSumDistortions",\n                value: function(a) {}\n            }, {\n                key: "sendThroughputObservations",\n                value: function(a) {\n                    this.sendEventMsg(t.internalFabricEvent.sendingThroughputObservations, a);\n                }\n            }, {\n                key: "sendEventMsg",\n                value: function(a, b) {\n                    if (this.lastPcHash) {\n                        var c = m.Registry.getConferenceManager().getConferenceForPcHash(this.lastPcHash);\n                        if (c) {\n                            var d = c.getPeerConnectionManager().getPcHandlerByHash(this.lastPcHash), e = d.getPeerConnection(), f = d.getConferenceId();\n                            m.Registry.getEventMessageBuilder().make(a, f, e, b);\n                        }\n                    }\n                }\n            } ]), b;\n        }(i.Component);\n        c.StatsMonitor = x;\n    }, {\n        "../collections/component": 26,\n        "../config/constants": 33,\n        "../utility/csiologger": 88,\n        "../utility/registry": 95,\n        "./monitorhooks/cpulimitationobserver": 61,\n        "./monitorhooks/onewaymediaobserver": 62,\n        "./monitorhooks/qpsumobserver": 63,\n        "./monitorhooks/sendingtrigger": 64,\n        "./monitorhooks/throughputobserver": 65,\n        "./statstuple": 75,\n        "./tracksmonitor": 81,\n        "./transportsmonitor": 82\n    } ],\n    73: [ function(a, b, c) {\n        "use strict";\n        function d(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }\n        function e(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        function f(a, b) {\n            if (!a) throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");\n            return !b || "object" != typeof b && "function" != typeof b ? a : b;\n        }\n        function g(a, b) {\n            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);\n            a.prototype = Object.create(b && b.prototype, {\n                constructor: {\n                    value: a,\n                    enumerable: !1,\n                    writable: !0,\n                    configurable: !0\n                }\n            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.StatsParser = c.StatsParserIO = void 0;\n        var h = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), i = a("../collections/component"), j = a("./measurement"), k = a("./pcstats"), l = a("../utility/rttregistry"), m = a("./validator"), n = d(m), o = a("../config/constants"), p = d(o), q = a("../utility/csiologger"), r = d(q), s = c.StatsParserIO = {\n            RawStatsIn: "RawStatsIn",\n            PcStatsTupleOut: "PcStatsTupleOut"\n        }, t = function(a) {\n            function b() {\n                e(this, b);\n                var a = f(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, "StatsParser"));\n                return a.bindPort(s.RawStatsIn, a.receive, a), a.declarePort(s.PcStatsTupleOut), \n                a;\n            }\n            return g(b, a), h(b, [ {\n                key: "receive",\n                value: function(a) {\n                    if (null === a) return void r.warn("Stats object can not be null");\n                    for (var b = a.tracks, c = [], d = 0; d < b.length; ++d) {\n                        var e = b[d];\n                        if (e && e.data) {\n                            var f = j.Measurement.make(a.pcHash, this.getSSRC(e), this.getStreamType(e), this.getMediaType(e), this.getFrameRateReceived(e), this.getFrameHeight(e), this.getFrameWidth(e), this.getDroppedFramesNum(e), this.getFramesReceived(e), this.getRTT(e), this.getJitter(e), this.getLostPackets(e), this.getReceivedPackets(e), this.getSentPackets(e), this.getDiscardedPackets(e), this.getSentBytes(e), this.getReceivedBytes(e), e);\n                            c.push(f);\n                        } else r.log("No track or track.data.");\n                    }\n                    var g = new k.PcStats(a.candidatePair, a.codec, a.pcHash, a.trackStats, a.transportStats, c);\n                    this.transmit(s.PcStatsTupleOut, g);\n                }\n            }, {\n                key: "getSSRC",\n                value: function(a) {\n                    return a.ssrc;\n                }\n            }, {\n                key: "getStreamType",\n                value: function(a) {\n                    return a.streamType === p.streamType.inbound ? p.streamType.inbound : a.streamType === p.streamType.outbound ? p.streamType.outbound : void 0;\n                }\n            }, {\n                key: "getSentBytes",\n                value: function(a) {\n                    if (void 0 === a.data.bytesSent) return -1;\n                    var b = n.checkForNan(parseInt(a.data.bytesSent, 10));\n                    return null !== b ? b : -1;\n                }\n            }, {\n                key: "getReceivedBytes",\n                value: function(a) {\n                    if (void 0 === a.data.bytesReceived) return -1;\n                    var b = n.checkForNan(parseInt(a.data.bytesReceived, 10));\n                    return null !== b ? b : -1;\n                }\n            }, {\n                key: "getReceivedPackets",\n                value: function(a) {\n                    if (void 0 === a.data.packetsReceived) return -1;\n                    var b = n.checkForNegativeValue(parseInt(a.data.packetsReceived, 10));\n                    return null !== b ? b : -1;\n                }\n            }, {\n                key: "getSentPackets",\n                value: function(a) {\n                    if (void 0 === a.data.packetsSent) return -1;\n                    var b = n.checkForNegativeValue(parseInt(a.data.packetsSent, 10));\n                    return null !== b ? b : -1;\n                }\n            }, {\n                key: "getDiscardedPackets",\n                value: function(a) {\n                    if (void 0 === a.data.discardedPackets) return -1;\n                    var b = n.checkForNan(parseInt(a.data.discardedPackets, 10));\n                    return null !== b ? b : -1;\n                }\n            }, {\n                key: "getLostPackets",\n                value: function(a) {\n                    if (void 0 === a.data.packetsLost) return -1;\n                    var b = n.checkForNegativeValue(parseInt(a.data.packetsLost, 10));\n                    return null !== b ? b : -1;\n                }\n            }, {\n                key: "getDroppedFramesNum",\n                value: function(a) {\n                    if (void 0 === a.data.droppedFrames) return -1;\n                    var b = n.checkForNegativeValue(parseInt(a.data.droppedFrames, 10));\n                    return null !== b ? b : -1;\n                }\n            }, {\n                key: "getFramesReceived",\n                value: function(a) {\n                    if (void 0 === a.data.framesReceived) return -1;\n                    var b = n.checkForNegativeValue(parseInt(a.data.framesReceived, 10));\n                    return null !== b ? b : -1;\n                }\n            }, {\n                key: "getFrameRateReceived",\n                value: function(a) {\n                    var b = null;\n                    return void 0 !== a.data.googFrameRateOutput ? b = parseInt(a.data.googFrameRateOutput, 10) : void 0 !== a.data.googFrameRateDecoded ? b = parseInt(a.data.googFrameRateDecoded, 10) : void 0 !== a.data.googFrameRateReceived ? b = parseInt(a.data.googFrameRateReceived, 10) : void 0 !== a.data.googFrameRateSent ? b = parseInt(a.data.googFrameRateSent, 10) : void 0 !== a.data.framerateMean ? b = parseInt(a.data.framerateMean, 10) : void 0 !== a.data.framesPerSecond && (b = parseInt(a.data.framesPerSecond, 10)), \n                    void 0 !== b && (b = n.checkForNegativeValue(b)), b;\n                }\n            }, {\n                key: "getFrameHeight",\n                value: function(a) {\n                    var b = void 0;\n                    return void 0 !== a.data.googFrameHeightReceived ? b = a.data.googFrameHeightReceived : void 0 !== a.data.googFrameHeightSent ? b = a.data.googFrameHeightSent : void 0 !== a.data.frameHeight && (b = a.data.frameHeight), \n                    b;\n                }\n            }, {\n                key: "getJitter",\n                value: function(a) {\n                    return void 0 !== a.data.googJitterReceived ? n.checkForNan(parseFloat(a.data.googJitterReceived, 10)) : void 0 !== a.data.jitter ? n.checkForNan(parseFloat(a.data.jitter, 10)) : void 0;\n                }\n            }, {\n                key: "getFrameWidth",\n                value: function(a) {\n                    return void 0 !== a.data.googFrameWidthReceived ? a.data.googFrameWidthReceived : void 0 !== a.data.googFrameWidthSent ? a.data.googFrameWidthSent : void 0 !== a.data.frameWidth ? a.data.frameWidth : void 0;\n                }\n            }, {\n                key: "getRTT",\n                value: function(a) {\n                    var b = function(a) {\n                        return isNaN(a) || a < 0 ? null : a;\n                    };\n                    if (void 0 !== a.data.googRtt) return b(parseFloat(a.data.googRtt, 10));\n                    if (void 0 !== a.data.mozRtt) return b(parseFloat(a.data.mozRtt, 10));\n                    if (a.data.roundTripTime) return b(parseFloat(a.data.roundTripTime, 10));\n                    var c = this.getSSRC(a), d = (0, l.getRTTRegistry)().getRTT(c);\n                    return d && (a.data.roundTripTime = d), d;\n                }\n            }, {\n                key: "getMediaType",\n                value: function(a) {\n                    var b = p.mediaType.unknown;\n                    return a.data && void 0 !== a.data.mediaType ? a.data.mediaType : (void 0 !== a.data.googFrameRateReceived || void 0 !== a.data.googFrameRateSent ? b = p.mediaType.video : void 0 !== a.data.audioInputLevel || void 0 !== a.data.audioOutputLevel ? b = p.mediaType.audio : a.data.mediaType ? b = a.data.mediaType : void 0 !== a.data.framerateMean && (b = p.mediaType.video), \n                    b);\n                }\n            } ]), b;\n        }(i.Component);\n        c.StatsParser = t;\n    }, {\n        "../collections/component": 26,\n        "../config/constants": 33,\n        "../utility/csiologger": 88,\n        "../utility/rttregistry": 96,\n        "./measurement": 60,\n        "./pcstats": 67,\n        "./validator": 83\n    } ],\n    74: [ function(a, b, c) {\n        "use strict";\n        function d(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }\n        function e(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        function f(a, b) {\n            if (!a) throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");\n            return !b || "object" != typeof b && "function" != typeof b ? a : b;\n        }\n        function g(a, b) {\n            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);\n            a.prototype = Object.create(b && b.prototype, {\n                constructor: {\n                    value: a,\n                    enumerable: !1,\n                    writable: !0,\n                    configurable: !0\n                }\n            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.StatsTransmitter = c.StatsTransmitterIO = void 0;\n        var h = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), i = a("../collections/component"), j = a("../utility/registry"), k = a("../config/constants"), l = d(k), m = a("../utility/csiologger"), n = d(m), o = c.StatsTransmitterIO = {\n            CallstatsIn: "CallstatsIn",\n            UnprocessedIn: "UnprocessedIn"\n        }, p = function(a) {\n            function b() {\n                e(this, b);\n                var a = f(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, "StatsTransmitter"));\n                return a.battery = j.Registry.getBattery(), a.lastUnprocessedStats = {}, a.bindPort(o.CallstatsIn, a.receiveCallstats, a), \n                a.bindPort(o.UnprocessedIn, a.receiveUnprocessed, a), a;\n            }\n            return g(b, a), h(b, [ {\n                key: "receiveUnprocessed",\n                value: function(a, b) {\n                    this.lastUnprocessedStats[b] = a;\n                }\n            }, {\n                key: "receiveCallstats",\n                value: function(a, b) {\n                    var c = null;\n                    if (!(c = this.getUnifiedFormat(b, a))) return void n.warn("Content can not be sent");\n                    this.send(a, c);\n                }\n            }, {\n                key: "send",\n                value: function(a, b) {\n                    var c = j.Registry.getConferenceManager().getConferenceForPcHash(a);\n                    if (c) {\n                        var d = c.getPeerConnectionManager().getPcHandlerByHash(a);\n                        if (d) {\n                            var e = d.getPcState();\n                            if (e !== l.fabricState.terminated && e !== l.fabricState.hold) {\n                                j.Registry.getEventMessageBuilder().make(l.callstatsChannels.processedStats, d.getConferenceId(), d.getPeerConnection(), b), \n                                this.sendToStatsCallback(b.stats, d);\n                            }\n                        }\n                    }\n                }\n            }, {\n                key: "sendToStatsCallback",\n                value: function(a, b) {\n                    var c = j.Registry.getStatsCallbackBuilder();\n                    c && c.buildStats(a, b);\n                }\n            }, {\n                key: "getUnifiedFormat",\n                value: function(a, b) {\n                    for (var c = this.lastUnprocessedStats[b], d = [], e = 0; e < c.length; e++) {\n                        var f = c[e], g = {};\n                        if (f.id && (g.id = f.id), f.timestamp && (g.timestamp = f.timestamp), f.type && (g.type = f.type), \n                        f.names) for (var h = f.names(), i = 0; i < h.length; ++i) g[h[i]] = f.stat(h[i]); else Object.assign(g, f);\n                        if (g.values) {\n                            for (var k = 0; k < g.values.length; ++k) Object.assign(g, g.values[k]);\n                            delete g.values;\n                        }\n                        var l = function(b) {\n                            for (var c = 0; c < a.tracks.length; c++) {\n                                var d = a.tracks[c];\n                                if (d.data.id === b.id && d.data.type === b.type) return d.data;\n                            }\n                            return b.id === a.Transport.id && b.type === a.Transport.type ? a.Transport : null;\n                        }(f);\n                        if (l) {\n                            for (var m in l) if (l.hasOwnProperty(m)) {\n                                if ("id" === m || "type" === m || "timestamp" === m) continue;\n                                g[m] = l[m];\n                            }\n                            d.push(g);\n                        } else d.push(g);\n                    }\n                    var n = {\n                        stats: d\n                    };\n                    return n.wifiStats = j.Registry.getWifiStatsExecutor().getWifiStats(), n.batteryStatus = {}, \n                    n.batteryStatus.batteryLevel = this.battery.getLevel(), n.batteryStatus.isBatteryCharging = this.battery.getCharging(), \n                    n;\n                }\n            } ]), b;\n        }(i.Component);\n        c.StatsTransmitter = p;\n    }, {\n        "../collections/component": 26,\n        "../config/constants": 33,\n        "../utility/csiologger": 88,\n        "../utility/registry": 95\n    } ],\n    75: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        });\n        var e = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), f = function() {\n            function a(b, c, e, f, g) {\n                d(this, a), this.candidatePairs = b, this.codec = c, this.trackStats = e, this.transportStats = f, \n                this.tracks = g;\n            }\n            return e(a, [ {\n                key: "getCandidatePairs",\n                value: function() {\n                    return this.candidatePairs;\n                }\n            }, {\n                key: "getCodec",\n                value: function() {\n                    return this.codec;\n                }\n            }, {\n                key: "getTrackStats",\n                value: function() {\n                    return this.trackStats;\n                }\n            }, {\n                key: "getTransportStats",\n                value: function() {\n                    return this.transportStats;\n                }\n            }, {\n                key: "getTracks",\n                value: function() {\n                    return this.tracks;\n                }\n            } ]), a;\n        }();\n        c.StatsTuple = f;\n    }, {} ],\n    76: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        function e(a, b) {\n            if (!a) throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");\n            return !b || "object" != typeof b && "function" != typeof b ? a : b;\n        }\n        function f(a, b) {\n            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);\n            a.prototype = Object.create(b && b.prototype, {\n                constructor: {\n                    value: a,\n                    enumerable: !1,\n                    writable: !0,\n                    configurable: !0\n                }\n            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.SWAvg = void 0;\n        var g = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), h = a("./swplugin"), i = function(a) {\n            function b(a, c) {\n                var f = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : null;\n                d(this, b);\n                var g = e(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, a, c, f));\n                return g.sum = 0, g.counter = 0, g;\n            }\n            return f(b, a), g(b, [ {\n                key: "add",\n                value: function(a) {\n                    this.filter(a) && (this.sum += this.extract(a), ++this.counter, this.calculate());\n                }\n            }, {\n                key: "remove",\n                value: function(a) {\n                    this.filter(a) && (this.sum -= this.extract(a), --this.counter, this.calculate());\n                }\n            }, {\n                key: "calculate",\n                value: function() {\n                    var a = 0;\n                    if (this.counter < 1) return void this.notify(a);\n                    a = this.sum / this.counter, this.notify(a);\n                }\n            } ]), b;\n        }(h.SWPlugin);\n        c.SWAvg = i;\n    }, {\n        "./swplugin": 79\n    } ],\n    77: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        function e(a, b) {\n            if (!a) throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");\n            return !b || "object" != typeof b && "function" != typeof b ? a : b;\n        }\n        function f(a, b) {\n            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);\n            a.prototype = Object.create(b && b.prototype, {\n                constructor: {\n                    value: a,\n                    enumerable: !1,\n                    writable: !0,\n                    configurable: !0\n                }\n            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.SWBTreePercentile = void 0;\n        var g = function() {\n            function a(a, b) {\n                var c = [], d = !0, e = !1, f = void 0;\n                try {\n                    for (var g, h = a[Symbol.iterator](); !(d = (g = h.next()).done) && (c.push(g.value), \n                    !b || c.length !== b); d = !0) ;\n                } catch (a) {\n                    e = !0, f = a;\n                } finally {\n                    try {\n                        !d && h.return && h.return();\n                    } finally {\n                        if (e) throw f;\n                    }\n                }\n                return c;\n            }\n            return function(b, c) {\n                if (Array.isArray(b)) return b;\n                if (Symbol.iterator in Object(b)) return a(b, c);\n                throw new TypeError("Invalid attempt to destructure non-iterable instance");\n            };\n        }(), h = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), i = a("./swplugin"), j = a("../../collections/binarytree"), k = function(a) {\n            function b(a, c, f, g) {\n                var h = arguments.length > 4 && void 0 !== arguments[4] ? arguments[4] : null, i = arguments.length > 5 && void 0 !== arguments[5] ? arguments[5] : null, k = arguments.length > 6 && void 0 !== arguments[6] ? arguments[6] : null;\n                d(this, b);\n                var l = e(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, f, g, i));\n                if (99 < a || a < 1) throw new RangeError("Percentile parameter must be between 1 and 99");\n                return l.comparator = c, l.percentile = a, l.meanCalcer = k, l.estimator = h, l.ratio = a / (100 - a), \n                l.maxtree = new j.BinaryTree(c), l.mintree = new j.BinaryTree(c), l.ratio < 1 ? l.required = 1 / l.ratio + 1 : 1 < l.ratio ? l.required = l.ratio + 1 : l.required = 2, \n                l.result = null, l;\n            }\n            return f(b, a), h(b, [ {\n                key: "add",\n                value: function(a) {\n                    if (this.filter(a)) {\n                        if (this.maxtree.getNodeCounter() < 1) return this.maxtree.insert(a), void this.calculate();\n                        this.comparator(a, this.maxtree.getTopValue()) <= 0 ? this.maxtree.insert(a) : this.mintree.insert(a), \n                        this.balancing(), this.calculate();\n                    }\n                }\n            }, {\n                key: "remove",\n                value: function(a) {\n                    if (this.filter(a)) {\n                        var b = this.mintree.getNodeCounter();\n                        this.maxtree.getNodeCounter() < 1 ? this.mintree.delete(a) : b < 1 ? this.maxtree.delete(a) : this.comparator(a, this.maxtree.getTopValue()) <= 0 ? this.maxtree.delete(a) : this.mintree.delete(a), \n                        this.calculate();\n                    }\n                }\n            }, {\n                key: "getThresholds",\n                value: function() {\n                    var a = this.mintree.getSize(), b = this.maxtree.getSize(), c = a + 1, d = b + 1;\n                    return 1 < this.ratio ? (c = Math.ceil(a * this.ratio), d = Math.floor(b / this.ratio) + 1) : this.ratio < 1 && (c = Math.floor(a * this.ratio) + 1, \n                    d = Math.ceil(b / this.ratio)), [ c, d ];\n                }\n            }, {\n                key: "balancing",\n                value: function() {\n                    var a = this.mintree, b = this.maxtree, c = a.getSize(), d = b.getSize();\n                    if (!(d + c < this.required)) {\n                        if (c < 1) return void a.insertNodeAtBottom(b.popTopNode());\n                        for (d < 1 && b.insertNodeAtTop(a.popBottomNode()); ;) {\n                            var e = 1 < a.getNodeCounter(), f = 1 < b.getNodeCounter(), h = a.getBottomNode().getLength(), i = b.getTopNode().getLength();\n                            if (a.getNodeCounter() < 1 || b.getNodeCounter() < 1) break;\n                            var j = this.getThresholds(), k = g(j, 2), l = k[0], m = k[1];\n                            if (f &= c + i <= m, e &= d + h <= l, c = a.getSize(), d = b.getSize(), l < d && f) a.insertNodeAtBottom(b.popTopNode()); else {\n                                if (!(m < c && e)) break;\n                                b.insertNodeAtTop(a.popBottomNode());\n                            }\n                        }\n                    }\n                }\n            }, {\n                key: "getMean",\n                value: function(a, b) {\n                    return this.meanCalcer ? this.meanCalcer(a, b) : a;\n                }\n            }, {\n                key: "estimate",\n                value: function(a, b) {\n                    return this.estimator ? this.estimator(a, b) : null;\n                }\n            }, {\n                key: "calculate",\n                value: function() {\n                    var a = null, b = this.mintree, c = this.maxtree, d = b.getSize(), e = c.getSize(), f = e + d;\n                    if (!(f < 1)) {\n                        if (f < this.required || d < 1 || e < 1) {\n                            if (0 == f) return;\n                            var g = void 0, h = void 0;\n                            d < 1 ? (g = this.maxtree.getBottomValue(), h = this.maxtree.getTopValue()) : e < 1 ? (g = this.mintree.getBottomValue(), \n                            h = this.mintree.getTopValue()) : (h = this.mintree.getTopValue(), g = this.maxtree.getBottomValue());\n                            var i = this.estimate(g, h);\n                            return void this.notify(i);\n                        }\n                        var j = c.getTopNode(), k = b.getBottomNode();\n                        if (j || k) {\n                            if (!j) {\n                                var l = this.extract(k);\n                                return void this.notify(l);\n                            }\n                            if (!k) {\n                                var m = this.extract(j);\n                                return void this.notify(m);\n                            }\n                            var n = f * (this.percentile / 100);\n                            if (!Number.isInteger(n)) {\n                                var o = e / d;\n                                a = this.ratio < o ? j.peek() : o < this.ratio ? k.peek() : this.ratio < 1 ? k.peek() : j.peek();\n                            } else {\n                                var p = Math.floor(n);\n                                a = Math.ceil(n + 1) <= e ? j.peek() : p <= e ? this.getMean(j.peek(), k.peek()) : k.peek();\n                            }\n                            var q = this.extract(a);\n                            this.notify(q);\n                        }\n                    }\n                }\n            } ]), b;\n        }(i.SWPlugin);\n        c.SWBTreePercentile = k;\n    }, {\n        "../../collections/binarytree": 23,\n        "./swplugin": 79\n    } ],\n    78: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        function e(a, b) {\n            if (!a) throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");\n            return !b || "object" != typeof b && "function" != typeof b ? a : b;\n        }\n        function f(a, b) {\n            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);\n            a.prototype = Object.create(b && b.prototype, {\n                constructor: {\n                    value: a,\n                    enumerable: !1,\n                    writable: !0,\n                    configurable: !0\n                }\n            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.SWFunctor = void 0;\n        var g = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), h = a("./swplugin"), i = function(a) {\n            function b(a, c) {\n                var f = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : null;\n                d(this, b);\n                var g = e(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, null, null, f));\n                return g.addFunc = a, g.remFunc = c, g;\n            }\n            return f(b, a), g(b, [ {\n                key: "add",\n                value: function(a) {\n                    this.filter(a) && this.addFunc && this.addFunc(a);\n                }\n            }, {\n                key: "remove",\n                value: function(a) {\n                    this.filter(a) && this.remFunc && this.remFunc(a);\n                }\n            }, {\n                key: "toString",\n                value: function() {\n                    return "SWFuncPlugin";\n                }\n            } ]), b;\n        }(h.SWPlugin);\n        c.SWFunctor = i;\n    }, {\n        "./swplugin": 79\n    } ],\n    79: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.SWPlugin = void 0;\n        var e = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), f = a("../../utility/csiologger"), g = function(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }(f), h = function() {\n            function a(b, c) {\n                var e = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : null;\n                d(this, a), this.extractorFnc = b, this.notifierFnc = c, this.filterFunc = e;\n            }\n            return e(a, [ {\n                key: "notify",\n                value: function(a) {\n                    if (!this.notifierFnc) return void g.warn("Failed notification for " + this.toString());\n                    this.notifierFnc(a);\n                }\n            }, {\n                key: "extract",\n                value: function(a) {\n                    return this.extractorFnc ? this.extractorFnc(a) : (g.warn(this.toString() + " tried to extract without extractorFnc"), \n                    null);\n                }\n            }, {\n                key: "filter",\n                value: function(a) {\n                    return !this.filterFunc || this.filterFunc(a);\n                }\n            }, {\n                key: "add",\n                value: function(a) {\n                    g.log("Abstract method is called width value: " + a);\n                }\n            }, {\n                key: "remove",\n                value: function(a) {\n                    g.log("Abstract method is called with value: " + a);\n                }\n            }, {\n                key: "toString",\n                value: function() {\n                    return "SWPlugin";\n                }\n            } ]), a;\n        }();\n        c.SWPlugin = h;\n    }, {\n        "../../utility/csiologger": 88\n    } ],\n    80: [ function(a, b, c) {\n        "use strict";\n        function d(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }\n        function e(a, b) {\n            if (!a) throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");\n            return !b || "object" != typeof b && "function" != typeof b ? a : b;\n        }\n        function f(a, b) {\n            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);\n            a.prototype = Object.create(b && b.prototype, {\n                constructor: {\n                    value: a,\n                    enumerable: !1,\n                    writable: !0,\n                    configurable: !0\n                }\n            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);\n        }\n        function g(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        function h(a, b) {\n            return b.green <= a ? t.avQualityRatings.excellent : b.red < a ? t.avQualityRatings.fair : t.avQualityRatings.bad;\n        }\n        function i(a, b) {\n            return b.red < a ? t.avQualityRatings.bad : b.green <= a ? t.avQualityRatings.fair : t.avQualityRatings.excellent;\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.TrackMonitor = void 0;\n        var j = function a(b, c, d) {\n            null === b && (b = Function.prototype);\n            var e = Object.getOwnPropertyDescriptor(b, c);\n            if (void 0 === e) {\n                var f = Object.getPrototypeOf(b);\n                return null === f ? void 0 : a(f, c, d);\n            }\n            if ("value" in e) return e.value;\n            var g = e.get;\n            if (void 0 !== g) return g.call(d);\n        }, k = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), l = a("../utility/registry"), m = a("../collections/slidingwindow"), n = a("../statspipeline/swplugins/swavg"), o = a("../statspipeline/swplugins/swbtreepercentile"), p = a("../statspipeline/swplugins/swfunctor"), q = a("../utility/timestamps"), r = d(q), s = a("../config/constants"), t = d(s), u = a("../utility/csiologger"), v = d(u), w = a("../utility/rttregistry"), x = function() {\n            function a() {\n                g(this, a), this.evaluators = [];\n            }\n            return k(a, [ {\n                key: "addEvaluator",\n                value: function(a) {\n                    var b = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 1, c = {\n                        processFnc: a,\n                        weight: b\n                    };\n                    this.evaluators.push(c);\n                }\n            }, {\n                key: "getQuality",\n                value: function(a) {\n                    for (var b = 0, c = [], d = 0, e = 0; e < this.evaluators.length; e++) {\n                        var f = this.evaluators[e], g = 0, h = f.processFnc ? f.processFnc(a) : 0;\n                        if (h) {\n                            if (h === t.avQualityRatings.bad) g = t.qualityRating.bad; else if (h === t.avQualityRatings.fair) g = t.qualityRating.fair; else if (h === t.avQualityRatings.excellent) g = t.qualityRating.excellent; else if (h === t.avQualityRatings.unknown) continue;\n                            b += f.weight, c.push({\n                                result: g,\n                                weight: f.weight\n                            });\n                        }\n                    }\n                    for (var i = 0; i < c.length; i++) {\n                        var j = c[i];\n                        d += j.result * (j.weight / b);\n                    }\n                    return d = Math.floor(d), d === t.qualityRating.excellent ? t.avQualityRatings.excellent : d === t.qualityRating.good ? t.avQualityRatings.fair : d === t.qualityRating.fair ? t.avQualityRatings.fair : d === t.qualityRating.poor ? t.avQualityRatings.fair : d === t.qualityRating.bad ? t.avQualityRatings.bad : void 0;\n                }\n            } ]), a;\n        }(), y = function(a) {\n            function b(a, c, d, f) {\n                g(this, b);\n                var h = e(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, a, c));\n                return h.thresholds = [], h.enableThresholds = !1, h.requestTime = 0, h.started = 0, \n                h.created = r.getCurrent(), h.mediaType = f, h.streamType = d, h.qualityHelper = new x(), \n                h.metrics = h.makeTrack(), h.lastTrack = {}, h.prevFrameRateMean = null, h.ssrc = null, \n                h.scsHelper = {\n                    total: 0,\n                    above: 0,\n                    ccDriven: 0,\n                    sumMaxBitrateDiff: 0,\n                    sumThroughputDiff: 0,\n                    prevCsioAvgBRKbps: 0\n                }, h;\n            }\n            return f(b, a), k(b, null, [ {\n                key: "make",\n                value: function(a, c, d, e) {\n                    var f = new b(a, c, d, e), g = f.metrics;\n                    return f.attach(new n.SWAvg(function(a) {\n                        return a.getJitter();\n                    }, function(a) {\n                        g.csioAvgJitter = a;\n                    }, function(a) {\n                        var b = a.getJitter();\n                        return null !== b && void 0 !== b;\n                    })), f.attach(new n.SWAvg(function(a) {\n                        return a.getRTT();\n                    }, function(a) {\n                        g.csioAvgRtt = a;\n                    }, function(a) {\n                        var b = a.getRTT();\n                        return null !== b && void 0 !== b;\n                    })), f.attach(new o.SWBTreePercentile(95, function(a, b) {\n                        var c = a.getJitter(), d = b.getJitter();\n                        return c == d ? 0 : c < d ? -1 : 1;\n                    }, function(a) {\n                        return a.getJitter();\n                    }, function(a) {\n                        g.csioPercentileJitter = a;\n                    }, function(a, b) {\n                        return b ? b.getJitter() : a ? a.getJitter() : void 0;\n                    }, function(a) {\n                        var b = a.getJitter();\n                        return null !== b && void 0 !== b;\n                    }, function(a, b) {\n                        return a;\n                    })), f.attach(new o.SWBTreePercentile(95, function(a, b) {\n                        var c = a.getRTT(), d = b.getRTT();\n                        return c == d ? 0 : c < d ? -1 : 1;\n                    }, function(a) {\n                        return a.getRTT();\n                    }, function(a) {\n                        g.csioSig2Latency = a, g.csioeM = a + 40;\n                    }, function(a, b) {\n                        return b ? b.getRTT() : a ? a.getRTT() : void 0;\n                    }, function(a) {\n                        var b = a.getRTT();\n                        return null !== b && void 0 !== b;\n                    }, function(a, b) {\n                        return a;\n                    })), d === t.streamType.inbound ? b.setupInboundMonitor(f) : d === t.streamType.outbound ? b.setupOutboundMonitor(f) : v.warn("Unrecognized streamType (" + d + ") at TrackMonitor"), \n                    e === t.mediaType.audio ? b.setupAudioMonitor(f) : e === t.mediaType.video ? b.setupVideoMonitor(f) : v.warn("Unrecognized mediaType (" + e + ") at TrackMonitor"), \n                    d === t.streamType.inbound && e === t.mediaType.audio ? b.setupInbAudioQualityEvaluator(f) : d === t.streamType.inbound && e === t.mediaType.video ? b.setupInbVideoQualityEvaluator(f) : d === t.streamType.outbound && e === t.mediaType.audio ? b.setupOutbAudioQualityEvaluator(f) : d === t.streamType.outbound && e === t.mediaType.video && (b.setupOutbVideoQualityEvaluator(f), \n                    b.setupSCSValidator(f)), f.addPostProcess(function(a) {\n                        g.csioMark = f.getQuality(a);\n                    }), f;\n                }\n            }, {\n                key: "setupInbAudioQualityEvaluator",\n                value: function(a) {\n                    var b = a.metrics;\n                    a.addQualityEvaluator(function(a) {\n                        return void 0 === b.csioIntBRKbps || null === b.csioIntBRKbps || b.csioIntBRKbps < 0 ? t.avQualityRatings.unknown : h(b.csioIntBRKbps, t.throughputThreshold.audio);\n                    }), a.addQualityEvaluator(function(a) {\n                        return void 0 === b.csioIntFL || null === b.csioIntFL || b.csioIntFL < 0 ? t.avQualityRatings.unknown : i(b.csioIntFL, t.fractionalLossThreshold.audio);\n                    }), a.addQualityEvaluator(function(a) {\n                        return void 0 === b.csioeM || null === b.csioeM ? t.avQualityRatings.unknown : i(b.csioeM, t.eModelThreshold.audio);\n                    });\n                }\n            }, {\n                key: "setupOutbAudioQualityEvaluator",\n                value: function(a) {\n                    var b = a.metrics;\n                    a.addQualityEvaluator(function(a) {\n                        return void 0 === b.csioIntBRKbps || null === b.csioIntBRKbps || b.csioIntBRKbps < 0 ? t.avQualityRatings.unknown : h(b.csioIntBRKbps, t.throughputThreshold.audio);\n                    }), a.addQualityEvaluator(function(a) {\n                        return void 0 === b.csioeM || null === b.csioeM ? t.avQualityRatings.unknown : i(b.csioeM, t.eModelThreshold.audio);\n                    });\n                }\n            }, {\n                key: "setupInbVideoQualityEvaluator",\n                value: function(a) {\n                    var b = a.metrics;\n                    a.addQualityEvaluator(function(a) {\n                        return void 0 === b.csioIntBRKbps || null === b.csioIntBRKbps || b.csioIntBRKbps < 0 ? t.avQualityRatings.unknown : h(b.csioIntBRKbps, t.throughputThreshold.video);\n                    }), a.addQualityEvaluator(function(c) {\n                        return void 0 === b.csioFrameRateMean || null === b.csioFrameRateMean ? t.avQualityRatings.unknown : b.csioFrameRateMean && a.prevFrameRateMean ? h(b.csioFrameRateMean / a.prevFrameRateMean, t.currOverPrevFrameRateThreshold.video) : t.avQualityRatings.bad;\n                    }), a.addQualityEvaluator(function(a) {\n                        return void 0 === b.csioSig2Latency || null === b.csioSig2Latency ? t.avQualityRatings.unknown : i(b.csioSig2Latency, t.rttThreshold.video);\n                    });\n                }\n            }, {\n                key: "setupOutbVideoQualityEvaluator",\n                value: function(a) {\n                    var b = a.metrics;\n                    a.addQualityEvaluator(function(a) {\n                        return void 0 == b.csioIntBRKbps || null == b.csioIntBRKbps ? t.avQualityRatings.unknown : h(b.csioIntBRKbps, t.throughputThreshold.video);\n                    }), a.addQualityEvaluator(function(c) {\n                        return void 0 === b.csioFrameRateMean || null === b.csioFrameRateMean ? t.avQualityRatings.unknown : b.csioFrameRateMean && a.prevFrameRateMean ? h(b.csioFrameRateMean / a.prevFrameRateMean, t.currOverPrevFrameRateThreshold.video) : t.avQualityRatings.bad;\n                    }), a.addQualityEvaluator(function(a) {\n                        return void 0 === b.csioSig2Latency || null === b.csioSig2Latency ? t.avQualityRatings.unknown : i(b.csioSig2Latency, t.rttThreshold.video);\n                    });\n                }\n            }, {\n                key: "setupInboundMonitor",\n                value: function(a) {\n                    var b = a.metrics;\n                    a.addPreProcess(function(c) {\n                        var d = c.getLostPackets(), e = c.getReceivedPackets(), f = a.getRequestedMeasurement(), g = 0, h = 0;\n                        f ? (g = d - f.getLostPackets(), h = e - f.getReceivedPackets()) : (g = d, h = e);\n                        var i = 0;\n                        if ((0 < g || 0 < h) && (i = g / (h + g)), b.csioIntPktLoss = g, b.csioIntFL = i, \n                        c.setFractionLost(i), !c.getFrameRateReceived() && c.getFramesReceived() && 0 < a.started) {\n                            var j = c.getFramesReceived(), k = r.getCurrent() - a.started;\n                            b.csioEstFrameRatePerSecond = 1e3 * j / k;\n                            var l = c.getSSRC(), m = (0, w.getRTTRegistry)().getFrameRate(l);\n                            m && (b.legacyFrameRatePerSecond = m);\n                        }\n                    }), a.attach(new p.SWFunctor(function(c) {\n                        var d = r.getCurrent(), e = c.getResolution(), f = a.getRequestedMeasurement(), g = a.getRequestTime(), h = c.getLostPackets(), i = 8 * c.getReceivedBytes(), j = c.getReceivedPackets(), k = d - a.getStartTime(), m = 0, n = 0, o = 0, p = 0, q = 1e3, s = Math.max(d - a.getStartTime(), q);\n                        f ? (p = j - f.getReceivedPackets(), m = i - 8 * f.getReceivedBytes(), n = h - f.getLostPackets(), \n                        o = Math.max(d - g, q)) : (q = (l.Registry.getCredentials().getAdaptiveInterval(), \n                        l.Registry.getCredentials().getStatsSubmissionInterval()), s = Math.max(d - a.getStartTime(), q), \n                        p = j, m = i, n = h, o = Math.max(s, q)), b.csioIntPktRcv = p, b.csioIntPR = p / (o / 1e3), \n                        b.csioAvgBRKbps = i / s, b.csioIntBRKbps = m / o, b.csioAvgPacketSize = c.getReceivedBytes() / j, \n                        b.csioIntMs = k, b.csioTimeElapseMs = o, b.csiores = e, b.csioPktLostPercentage = n / m * 100;\n                    }, null, null)), a.attach(new o.SWBTreePercentile(95, function(a, b) {\n                        var c = a.getFractionLost(), d = b.getFractionLost();\n                        return c == d ? 0 : c < d ? -1 : 1;\n                    }, function(a) {\n                        return a.getFractionLost();\n                    }, function(a) {\n                        b.csioPercentileFl = a;\n                    }, function(a, b) {\n                        return b ? b.getFractionLost() : a ? a.getFractionLost() : void 0;\n                    }, function(a) {\n                        var b = a.getFractionLost();\n                        return null !== b && void 0 !== b;\n                    }, function(a, b) {\n                        return a;\n                    }));\n                }\n            }, {\n                key: "setupOutboundMonitor",\n                value: function(a) {\n                    var b = a.metrics;\n                    a.addPreProcess(function(c) {\n                        var d = c.getLostPackets(), e = c.getSentPackets(), f = a.getRequestedMeasurement(), g = 0, h = 0;\n                        f ? (g = d - f.getLostPackets(), h = e - f.getSentPackets()) : (g = d, h = e);\n                        var i = 0;\n                        (0 < g || 0 < h) && (i = g / (h + g)), b.csioIntPktLoss = g, b.csioIntFL = i, c.setFractionLost(i);\n                    }), a.attach(new p.SWFunctor(function(c) {\n                        var d = r.getCurrent(), e = c.getResolution(), f = a.getRequestedMeasurement(), g = a.getRequestTime(), h = c.getLostPackets(), i = 8 * c.getSentBytes(), j = c.getSentPackets(), k = d - a.getStartTime(), m = 0, n = 0, o = 0, p = 0, q = 1e3, s = Math.max(d - a.getStartTime(), q);\n                        f ? (p = j - f.getSentPackets(), m = i - 8 * f.getSentBytes(), n = h - f.getLostPackets(), \n                        o = Math.max(d - g, q)) : (q = (l.Registry.getCredentials().getAdaptiveInterval(), \n                        l.Registry.getCredentials().getStatsSubmissionInterval()), s = Math.max(d - a.getStartTime(), q), \n                        p = j, m = i, n = h, o = Math.max(s, q)), b.csioIntPktRcv = p, b.csioAvgBRKbps = i / s, \n                        b.csioIntBRKbps = m / o, b.csioIntPR = p / (o / 1e3), b.csioAvgPacketSize = c.getSentBytes() / j, \n                        b.csioIntMs = k, b.csioTimeElapseMs = o, b.csiores = e, b.csioPktLostPercentage = n / m * 100;\n                    }, null, null)), a.attach(new o.SWBTreePercentile(95, function(a, b) {\n                        var c = a.getFractionLost(), d = b.getFractionLost();\n                        return c == d ? 0 : c < d ? -1 : 1;\n                    }, function(a) {\n                        return a.getFractionLost();\n                    }, function(a) {\n                        b.csioPercentileFl = a;\n                    }, function(a, b) {\n                        return b ? b.getFractionLost() : a ? a.getFractionLost() : void 0;\n                    }, function(a) {\n                        var b = a.getFractionLost();\n                        return null !== b && void 0 !== b;\n                    }, function(a, b) {\n                        return a;\n                    }));\n                }\n            }, {\n                key: "setupAudioMonitor",\n                value: function(a) {\n                    var b = a.metrics;\n                    a.attach(new p.SWFunctor(function(a) {\n                        b.csioMediaType = t.mediaType.audio;\n                    }, null, null));\n                }\n            }, {\n                key: "setupVideoMonitor",\n                value: function(a) {\n                    var b = a.metrics;\n                    a.attach(new n.SWAvg(function(a) {\n                        return a.getFrameRateReceived();\n                    }, function(c) {\n                        a.prevFrameRateMean = b.csioFrameRateMean, b.csioFrameRateMean = c;\n                    }, function(a) {\n                        var b = a.getFrameRateReceived();\n                        return null !== b && void 0 !== b;\n                    })), a.attach(new n.SWAvg(function(a) {\n                        return a.getFrameHeight();\n                    }, function(a) {\n                        b.csioFrameHeightMean = a;\n                    }, function(a) {\n                        var b = a.getFrameHeight();\n                        return null !== b && void 0 !== b;\n                    })), a.attach(new n.SWAvg(function(a) {\n                        return a.getFrameWidth();\n                    }, function(a) {\n                        b.csioFrameWidthMean = a;\n                    }, function(a) {\n                        var b = a.getFrameWidth();\n                        return null !== b && void 0 !== b;\n                    })), a.attach(new o.SWBTreePercentile(95, function(a, b) {\n                        var c = a.getFrameRateReceived(), d = b.getFrameRateReceived();\n                        return c == d ? 0 : c < d ? -1 : 1;\n                    }, function(a) {\n                        return a.getFrameRateReceived();\n                    }, function(a) {\n                        b.csioFrameRate95Percentile = a;\n                    }, function(a, b) {\n                        return b ? b.getFrameRateReceived() : a ? a.getFrameRateReceived() : void 0;\n                    }, function(a) {\n                        var b = a.getFrameRateReceived();\n                        return null !== b && void 0 !== b;\n                    }, function(a, b) {\n                        return a;\n                    })), a.attach(new o.SWBTreePercentile(50, function(a, b) {\n                        var c = a.getFrameRateReceived(), d = b.getFrameRateReceived();\n                        return c == d ? 0 : c < d ? -1 : 1;\n                    }, function(a) {\n                        return a.getFrameRateReceived();\n                    }, function(a) {\n                        b.csioFrameRate50Percentile = a;\n                    }, function(a, b) {\n                        return b ? b.getFrameRateReceived() : a ? a.getFrameRateReceived() : void 0;\n                    }, function(a) {\n                        var b = a.getFrameRateReceived();\n                        return null !== b && void 0 !== b;\n                    }, function(a, b) {\n                        return a;\n                    })), a.attach(new o.SWBTreePercentile(95, function(a, b) {\n                        var c = a.getFrameHeight(), d = b.getFrameHeight();\n                        return c == d ? 0 : c < d ? -1 : 1;\n                    }, function(a) {\n                        return a.getFrameHeight();\n                    }, function(a) {\n                        b.csioFrameHeight95Percentile = a;\n                    }, function(a, b) {\n                        return b ? b.getFrameHeight() : a ? a.getFrameHeight() : void 0;\n                    }, function(a) {\n                        var b = a.getFrameHeight();\n                        return null !== b && void 0 !== b;\n                    }, function(a, b) {\n                        return a;\n                    })), a.attach(new o.SWBTreePercentile(50, function(a, b) {\n                        var c = a.getFrameHeight(), d = b.getFrameHeight();\n                        return c == d ? 0 : c < d ? -1 : 1;\n                    }, function(a) {\n                        return a.getFrameHeight();\n                    }, function(a) {\n                        b.csioFrameHeight50Percentile = a;\n                    }, function(a, b) {\n                        return b ? b.getFrameHeight() : a ? a.getFrameHeight() : void 0;\n                    }, function(a) {\n                        var b = a.getFrameHeight();\n                        return null !== b && void 0 !== b;\n                    }, function(a, b) {\n                        return a;\n                    })), a.attach(new o.SWBTreePercentile(95, function(a, b) {\n                        var c = a.getFrameWidth(), d = b.getFrameWidth();\n                        return c == d ? 0 : c < d ? -1 : 1;\n                    }, function(a) {\n                        return a.getFrameWidth();\n                    }, function(a) {\n                        b.csioFrameWidth95Percentile = a;\n                    }, function(a, b) {\n                        return b ? b.getFrameWidth() : a ? a.getFrameWidth() : void 0;\n                    }, function(a) {\n                        var b = a.getFrameWidth();\n                        return null !== b && void 0 !== b;\n                    }, function(a, b) {\n                        return a;\n                    })), a.attach(new o.SWBTreePercentile(50, function(a, b) {\n                        var c = a.getFrameWidth(), d = b.getFrameWidth();\n                        return c == d ? 0 : c < d ? -1 : 1;\n                    }, function(a) {\n                        return a.getFrameWidth();\n                    }, function(a) {\n                        b.csioFrameWidth50Percentile = a;\n                    }, function(a, b) {\n                        return b ? b.getFrameWidth() : a ? a.getFrameWidth() : void 0;\n                    }, function(a) {\n                        var b = a.getFrameWidth();\n                        return null !== b && void 0 !== b;\n                    }, function(a, b) {\n                        return a;\n                    })), a.attach(new p.SWFunctor(function(a) {\n                        b.csioMediaType = t.mediaType.video;\n                    }, null, null));\n                }\n            }, {\n                key: "setupSCSValidator",\n                value: function(a) {\n                    var b = a.metrics;\n                    a.attach(new p.SWFunctor(function(c) {\n                        var d = l.Registry.getConfigServiceWrapper().getSenderConfig();\n                        if (!d || !d.rtc_rtp_parameters || !d.rtc_rtp_parameters.encodings) return b.csioSCSValidationSampleCount = null, \n                        b.csioAvgMaxBitrateDiff = null, b.csioAvgDeltaThroughput = null, b.csioMaxBitrateAboveRatio = null, \n                        void (b.csioCCDrivenRatio = null);\n                        var e = 0;\n                        d.rtc_rtp_parameters.encodings.forEach(function(a) {\n                            a && (e = Math.max(e, a.maxBitrate));\n                        });\n                        var f = 0, g = l.Registry.getConfigServiceWrapper().getDefaultSenderConfig();\n                        if (g && g.encodings) {\n                            g.encodings.forEach(function(a) {\n                                f = Math.max(f, a.maxBitrate);\n                            });\n                            var h = 0, i = 0, j = null, k = null, m = a.getSCSHelper();\n                            0 < f && .9 * f < 1e3 * b.csioAvgBRKbps ? (h = e - f, k = !1) : (h = e - 1e3 * b.csioAvgBRKbps, \n                            k = !0), j = 0 < h, i = b.csioAvgBRKbps - b.prevCsioAvgBRKbps, m.prevCsioAvgBRKbps = b.csioAvgBRKbps, \n                            b.csioSCSValidationSampleCount = ++m.total, m.sumMaxBitrateDiff += h, b.csioAvgMaxBitrateDiff = m.sumMaxBitrateDiff / m.total, \n                            m.sumThroughputDiff += i, b.csioAvgDeltaThroughput = m.sumThroughputDiff / m.total, \n                            j && (m.above += 1), b.csioMaxBitrateAboveRatio = m.above / m.total, k && (m.ccDriven += 1), \n                            b.csioCCDrivenRatio = m.ccDriven / m.total;\n                        }\n                    }, null, null));\n                }\n            } ]), k(b, [ {\n                key: "makeTrack",\n                value: function() {\n                    var a = {};\n                    return a.csioMediaType = void 0, a.csioMark = void 0, a.csioIntBRKbps = void 0, \n                    a.csioAvgBRKbps = void 0, a.csioIntFL = void 0, a.csioIntMs = void 0, a.csioIntPR = void 0, \n                    a.csioPercentileFl = void 0, a.csioAvgJitter = void 0, a.csioAvgRtt = void 0, a.csioPercentileJitter = void 0, \n                    a.csioSig2Latency = void 0, a.csioTimeElapseMs = void 0, a.csioeM = void 0, a.csiores = void 0, \n                    a.csioFrameWidth95Percentile = void 0, a.csioFrameWidth50Percentile = void 0, a.csioFrameHeight95Percentile = void 0, \n                    a.csioFrameHeight50Percentile = void 0, a.csioFrameRate95Percentile = void 0, a.csioFrameRate50Percentile = void 0, \n                    a.csioFrameWidthMean = void 0, a.csioFrameHeightMean = void 0, a.csioFrameRateMean = void 0, \n                    a.csioIntPktRcv = void 0, a.csioSCSValidationSampleCount = null, a.csioAvgMaxBitrateDiff = null, \n                    a.csioAvgDeltaThroughput = null, a.csioMaxBitrateAboveRatio = null, a.csioCCDrivenRatio = null, \n                    a;\n                }\n            }, {\n                key: "getSSRC",\n                value: function() {\n                    return this.ssrc;\n                }\n            }, {\n                key: "add",\n                value: function(a) {\n                    this.ssrc = a.getSSRC(), this.lastTrack = a.extractTrack(), this.lastTrack.pcHash = a.getPcHash(), \n                    0 === this.started && (this.started = r.getCurrent()), j(b.prototype.__proto__ || Object.getPrototypeOf(b.prototype), "add", this).call(this, a);\n                }\n            }, {\n                key: "hasTraffic",\n                value: function() {\n                    return 0 < this.metrics.csioIntBRKbps;\n                }\n            }, {\n                key: "getTrack",\n                value: function() {\n                    var a = this.lastTrack;\n                    return Object.assign(a.data, this.metrics), a;\n                }\n            }, {\n                key: "extractTrack",\n                value: function() {\n                    var a = this.lastTrack;\n                    return Object.assign(a.data, this.metrics), this.requestTime = r.getCurrent(), this.requestedMeasurement = this.peek(), \n                    a;\n                }\n            }, {\n                key: "getMediaType",\n                value: function() {\n                    return this.mediaType;\n                }\n            }, {\n                key: "getStreamType",\n                value: function() {\n                    return this.streamType;\n                }\n            }, {\n                key: "getStartTime",\n                value: function() {\n                    return this.started;\n                }\n            }, {\n                key: "getCreationTime",\n                value: function() {\n                    return this.created;\n                }\n            }, {\n                key: "getRequestTime",\n                value: function() {\n                    return Math.max(this.started, this.requestTime);\n                }\n            }, {\n                key: "getRequestedMeasurement",\n                value: function() {\n                    return this.requestedMeasurement;\n                }\n            }, {\n                key: "getSCSHelper",\n                value: function() {\n                    return this.scsHelper;\n                }\n            }, {\n                key: "addQualityEvaluator",\n                value: function(a) {\n                    var b = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 1;\n                    this.qualityHelper.addEvaluator(a, b);\n                }\n            }, {\n                key: "getQuality",\n                value: function(a) {\n                    return this.qualityHelper.getQuality(a);\n                }\n            }, {\n                key: "addPreProcess",\n                value: function(a) {\n                    j(b.prototype.__proto__ || Object.getPrototypeOf(b.prototype), "addPreProcess", this).call(this, a);\n                }\n            }, {\n                key: "addPostProcess",\n                value: function(a) {\n                    j(b.prototype.__proto__ || Object.getPrototypeOf(b.prototype), "addPostProcess", this).call(this, a);\n                }\n            } ]), b;\n        }(m.SlidingWindow);\n        c.TrackMonitor = y;\n    }, {\n        "../collections/slidingwindow": 28,\n        "../config/constants": 33,\n        "../statspipeline/swplugins/swavg": 76,\n        "../statspipeline/swplugins/swbtreepercentile": 77,\n        "../statspipeline/swplugins/swfunctor": 78,\n        "../utility/csiologger": 88,\n        "../utility/registry": 95,\n        "../utility/rttregistry": 96,\n        "../utility/timestamps": 99\n    } ],\n    81: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.TracksMonitor = void 0;\n        var e = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), f = a("./trackmonitor"), g = a("../config/constants"), h = function(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }(g), i = function() {\n            function a() {\n                d(this, a), this.inbMonitors = new Map(), this.outbMonitors = new Map();\n            }\n            return e(a, [ {\n                key: "getMonitor",\n                value: function(a) {\n                    var b = a.getStreamType(), c = a.getMediaType(), d = a.getSSRC(), e = null;\n                    return b === h.streamType.inbound ? c === h.mediaType.audio ? e = this.getInbAudioMonitor(d) : c === h.mediaType.video && (e = this.getInbVideoMonitor(d)) : b === h.streamType.outbound && (c === h.mediaType.audio ? e = this.getOutbAudioMonitor(d) : c === h.mediaType.video && (e = this.getOutbVideoMonitor(d))), \n                    e;\n                }\n            }, {\n                key: "extractTracks",\n                value: function() {\n                    var a = [];\n                    return this.outbMonitors.forEach(function(b, c) {\n                        a.push(b.extractTrack());\n                    }), this.inbMonitors.forEach(function(b, c) {\n                        a.push(b.extractTrack());\n                    }), a;\n                }\n            }, {\n                key: "getTracks",\n                value: function() {\n                    var a = [];\n                    return this.outbMonitors.forEach(function(b, c) {\n                        a.push(b.getTrack());\n                    }), this.inbMonitors.forEach(function(b, c) {\n                        a.push(b.getTrack());\n                    }), a;\n                }\n            }, {\n                key: "getMonitors",\n                value: function() {\n                    var a = [];\n                    return this.outbMonitors.forEach(function(b, c) {\n                        a.push(b);\n                    }), this.inbMonitors.forEach(function(b, c) {\n                        a.push(b);\n                    }), a;\n                }\n            }, {\n                key: "getInbAudioMonitor",\n                value: function(a) {\n                    var b = this.inbMonitors.get(a);\n                    return b || (b = f.TrackMonitor.make(1e3, 3e4, h.streamType.inbound, h.mediaType.audio), \n                    this.inbMonitors.set(a, b)), b;\n                }\n            }, {\n                key: "getInbVideoMonitor",\n                value: function(a) {\n                    var b = this.inbMonitors.get(a);\n                    return b || (b = f.TrackMonitor.make(1e3, 3e4, h.streamType.inbound, h.mediaType.video), \n                    this.inbMonitors.set(a, b)), b;\n                }\n            }, {\n                key: "getOutbAudioMonitor",\n                value: function(a) {\n                    var b = this.outbMonitors.get(a);\n                    return b || (b = f.TrackMonitor.make(1e3, 3e4, h.streamType.outbound, h.mediaType.audio), \n                    this.outbMonitors.set(a, b)), b;\n                }\n            }, {\n                key: "getOutbVideoMonitor",\n                value: function(a) {\n                    var b = this.outbMonitors.get(a);\n                    return b || (b = f.TrackMonitor.make(1e3, 3e4, h.streamType.outbound, h.mediaType.video), \n                    this.outbMonitors.set(a, b)), b;\n                }\n            } ]), a;\n        }();\n        c.TracksMonitor = i;\n    }, {\n        "../config/constants": 33,\n        "./trackmonitor": 80\n    } ],\n    82: [ function(a, b, c) {\n        "use strict";\n        function d(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }\n        function e(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.TransportsMonitor = void 0;\n        var f = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), g = a("../config/constants"), h = d(g), i = a("../utility/timestamps"), j = d(i), k = a("../utility/rttregistry"), l = function() {\n            function a(b) {\n                e(this, a), this.previous = b, this.actual = b, this.outdated = j.getCurrent();\n            }\n            return f(a, [ {\n                key: "setActual",\n                value: function(a) {\n                    this.actual = a;\n                }\n            }, {\n                key: "outdate",\n                value: function() {\n                    this.previous = this.actual, this.outdated = j.getCurrent();\n                }\n            }, {\n                key: "getActual",\n                value: function() {\n                    return this.actual;\n                }\n            }, {\n                key: "getPrevious",\n                value: function() {\n                    return this.previous;\n                }\n            }, {\n                key: "getElapsedTime",\n                value: function() {\n                    return j.getCurrent() - this.outdated;\n                }\n            } ]), a;\n        }(), m = function() {\n            function a(b) {\n                e(this, a), this.stats = new Map(), this.codeBase = b;\n            }\n            return f(a, [ {\n                key: "set",\n                value: function(a, b) {\n                    var c = this.stats.get(a);\n                    if (!c) return void this.stats.set(a, new l(b));\n                    c.setActual(b);\n                }\n            }, {\n                key: "getIntervalStats",\n                value: function() {\n                    var a = this, b = new Map();\n                    return this.stats.forEach(function(c, d) {\n                        b.set(d, a.getIntervalStat(c)), c.outdate();\n                    }), b;\n                }\n            }, {\n                key: "getIntervalStat",\n                value: function(a) {\n                    var b = null;\n                    switch (this.codeBase) {\n                      case h.codeBaseType.chrome:\n                        b = this.getIntervalStatForChrome(a);\n                        break;\n\n                      default:\n                        b = a.getActual();\n                    }\n                    return b;\n                }\n            }, {\n                key: "getIntervalStatForChrome",\n                value: function(a) {\n                    var b = a.getActual(), c = a.getPrevious(), d = a.getElapsedTime();\n                    if (!c) return actual;\n                    for (var e = 0; e < b.length; ++e) {\n                        var f = b[e], g = c[e];\n                        if (!g || !f) return b;\n                        var i = parseInt(g.bytesReceived, 10), j = parseInt(g.bytesSent, 10);\n                        f.csioReceivedBwKbps = 8 * (parseInt(f.bytesReceived, 10) - i) / d, f.csioSentBwKbps = 8 * (parseInt(f.bytesSent, 10) - j) / d, \n                        f.csioIntBytesReceived = parseInt(f.bytesReceived, 10) - i, f.csioIntBytesSent = parseInt(f.bytesSent, 10) - j, \n                        void 0 !== g.packetsSent && void 0 !== f.packetsSent && (f.csioSentPacketRate = (parseInt(f.packetsSent, 10) - parseInt(g.packetsSent, 10)) / (d / 1e3), \n                        f.csioIntPacketsSent = parseInt(f.packetsSent, 10) - parseInt(g.packetsSent, 10)), \n                        void 0 !== g.packetsReceived && void 0 !== f.packetsReceived && (f.csioReceivedPacketRate = (parseInt(f.packetsReceived, 10) - parseInt(g.packetsReceived, 10)) / (d / 1e3), \n                        f.csioIntPacketsReceived = parseInt(f.packetsReceived, 10) - parseInt(g.packetsReceived, 10)), \n                        this.codeBase == h.codeBaseType.chrome && (f.currentRoundTripTime = (0, k.getRTTRegistry)().getTransportRTT());\n                    }\n                    return b;\n                }\n            } ]), a;\n        }();\n        c.TransportsMonitor = m;\n    }, {\n        "../config/constants": 33,\n        "../utility/rttregistry": 96,\n        "../utility/timestamps": 99\n    } ],\n    83: [ function(a, b, c) {\n        "use strict";\n        function d(a) {\n            return isNaN(a) ? null : a;\n        }\n        function e(a) {\n            return null !== d(a) && 0 < a ? a : null;\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.checkForNan = d, c.checkForNegativeValue = e;\n    }, {} ],\n    84: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        });\n        var e = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), f = function() {\n            function a() {\n                d(this, a), this.getWifiStatsMethod = null, this.wifiStats = null, this.interval = 1e4;\n            }\n            return e(a, [ {\n                key: "setGetWifiStatsMethod",\n                value: function(a) {\n                    this.getWifiStatsMethod = a, this.wifiStatsHandler();\n                }\n            }, {\n                key: "getWifiStats",\n                value: function() {\n                    return this.wifiStats;\n                }\n            }, {\n                key: "wifiStatsHandler",\n                value: function() {\n                    var a = this;\n                    a.getWifiStatsMethod && a.getWifiStatsMethod().then(function(b) {\n                        a.wifiStats = JSON.parse(b), setTimeout(function() {\n                            a.wifiStatsHandler();\n                        }, a.interval);\n                    }).catch(function() {\n                        setTimeout(function() {\n                            a.wifiStatsHandler();\n                        }, a.interval);\n                    });\n                }\n            } ]), a;\n        }();\n        c.WifiStatsExecutor = f;\n    }, {} ],\n    85: [ function(a, b, c) {\n        "use strict";\n        function d(a) {\n            return window.btoa(a);\n        }\n        function e(a) {\n            return window.atob(a);\n        }\n        function f(a) {\n            return d(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g, function(a, b) {\n                return String.fromCharCode("0x" + b);\n            }));\n        }\n        function g(a) {\n            return d(a).replace(/\\+/g, "-").replace(/\\//g, "_").replace(/\\=+$/, "");\n        }\n        function h(a) {\n            return f(a).replace(/\\+/g, "-").replace(/\\//g, "_").replace(/\\=+$/, "");\n        }\n        function i(a) {\n            for (var b = e(a.replace(/[ \\r\\n]+$/, "")), c = [], d = 0; d < b.length; ++d) {\n                var f = b.charCodeAt(d).toString(16);\n                1 === f.length && (f = "0" + f), c.push(f);\n            }\n            return c.join("");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.encode = d, c.decode = e, c.urlencode = g, c.urlencodeUnicode = h, c.strtohex = i;\n    }, {} ],\n    86: [ function(a, b, c) {\n        "use strict";\n        function d(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }\n        function e(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.Callbacks = void 0;\n        var f = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), g = a("../config/constants"), h = d(g), i = a("./registry"), j = a("./csiologger"), k = d(j), l = function() {\n            function a() {\n                e(this, a), this.callbacks = {};\n            }\n            return f(a, [ {\n                key: "set",\n                value: function(a, b) {\n                    if ("function" == typeof b) return h.callbackFunctions.hasOwnProperty(a) ? (this.callbacks[a] = b, \n                    void (a === h.callbackFunctions.stats && i.Registry.getStatsCallbackBuilder().setCallback(b))) : void k.error("Couldn\'t set callback: " + a);\n                }\n            }, {\n                key: "get",\n                value: function(a) {\n                    return this.callbacks.hasOwnProperty(a) ? this.callbacks[a] : null;\n                }\n            } ]), a;\n        }();\n        c.Callbacks = l;\n    }, {\n        "../config/constants": 33,\n        "./csiologger": 88,\n        "./registry": 95\n    } ],\n    87: [ function(a, b, c) {\n        "use strict";\n        function d(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }\n        function e(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.Credentials = void 0;\n        var f = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(a) {\n            return typeof a;\n        } : function(a) {\n            return a && "function" == typeof Symbol && a.constructor === Symbol && a !== Symbol.prototype ? "symbol" : typeof a;\n        }, g = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), h = a("../config/constants"), i = d(h), j = a("./csiologger"), k = d(j), l = function() {\n            function a() {\n                e(this, a), this.appId = null, this.userId = null, this.userIdObject = null, this.deviceId = null, \n                this.statsSubmissionInterval = 15e3, this.collectSDP = !1, this.transportType = i.transportType.rest, \n                this.adaptiveInterval = !1;\n            }\n            return g(a, [ {\n                key: "getAppId",\n                value: function() {\n                    return this.appId;\n                }\n            }, {\n                key: "setAppId",\n                value: function(a) {\n                    this.appId = "string" == typeof a ? parseInt(a, 10) : a;\n                }\n            }, {\n                key: "getUserId",\n                value: function() {\n                    return this.userId;\n                }\n            }, {\n                key: "setUserId",\n                value: function(a) {\n                    "object" === (void 0 === a ? "undefined" : f(a)) ? (this.userId = a.aliasName, this.setUserIdObject(a)) : this.userId = a;\n                }\n            }, {\n                key: "getUserIdObject",\n                value: function() {\n                    return this.userIdObject;\n                }\n            }, {\n                key: "setUserIdObject",\n                value: function(a) {\n                    this.userIdObject = a;\n                }\n            }, {\n                key: "getStatsSubmissionInterval",\n                value: function() {\n                    return this.statsSubmissionInterval;\n                }\n            }, {\n                key: "setStatsSubmissionInterval",\n                value: function(a) {\n                    k.log("setStatsSubmissionInterval is ", a), this.statsSubmissionInterval = a;\n                }\n            }, {\n                key: "getCollectSDP",\n                value: function() {\n                    return this.collectSDP;\n                }\n            }, {\n                key: "setCollectSDP",\n                value: function(a) {\n                    this.collectSDP = a;\n                }\n            }, {\n                key: "getTransportType",\n                value: function() {\n                    return this.transportType;\n                }\n            }, {\n                key: "setTransportType",\n                value: function(a) {\n                    this.transportType = a;\n                }\n            }, {\n                key: "getAdaptiveInterval",\n                value: function() {\n                    return this.adaptiveInterval;\n                }\n            }, {\n                key: "setAdaptiveInterval",\n                value: function(a) {\n                    this.adaptiveInterval = a;\n                }\n            } ]), a;\n        }();\n        c.Credentials = l;\n    }, {\n        "../config/constants": 33,\n        "./csiologger": 88\n    } ],\n    88: [ function(a, b, c) {\n        "use strict";\n        function d() {\n            if ("true" === i.csioDebug) {\n                var a;\n                (a = console).info.apply(a, arguments);\n            }\n        }\n        function e() {\n            if ("true" === i.csioDebug) {\n                var a;\n                (a = console).log.apply(a, arguments);\n            }\n        }\n        function f() {\n            if ("true" === i.csioDebug) {\n                var a;\n                (a = console).warn.apply(a, arguments);\n            }\n        }\n        function g() {\n            var a;\n            (a = console).warn.apply(a, arguments);\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.info = d, c.log = e, c.warn = f, c.error = g;\n        var h = a("../config/settings"), i = function(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }(h);\n    }, {\n        "../config/settings": 34\n    } ],\n    89: [ function(a, b, c) {\n        "use strict";\n        function d(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }\n        function e(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.Endpoint = void 0;\n        var f = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), g = a("../browserapi/localstorage"), h = d(g), i = a("../browserapi/detectbrowser"), j = d(i), k = a("../utility/timestamps"), l = d(k), m = a("../utility/hash"), n = d(m), o = function() {\n            function a() {\n                e(this, a), this.id = null, this.appversion = null, this.magicKey = Math.floor(4294967296 * Math.random()), \n                this.browserName = null, this.browserVersion = null, this.osName = null, this.osVersion = null, \n                this.codeBase = null, this.userAgent = null, this.retrieveId();\n            }\n            return f(a, [ {\n                key: "setup",\n                value: function() {\n                    var a = j.detect();\n                    this.browserName = a.browserName, this.browserVersion = a.browserVersion, this.osName = a.os, \n                    this.osVersion = a.osVersion, this.codeBase = a.codeBase, this.userAgent = a.userAgent;\n                }\n            }, {\n                key: "retrieveId",\n                value: function() {\n                    var a = this, b = h.get("endpointID");\n                    if (null === b) {\n                        var c = l.getCurrent(), d = Math.random() * c;\n                        n.generateSHA256(d.toString(), function(b) {\n                            a.id = b, h.store("endpointID", b);\n                        });\n                    } else this.id = b;\n                }\n            }, {\n                key: "getId",\n                value: function() {\n                    return this.id;\n                }\n            }, {\n                key: "getAppVersion",\n                value: function() {\n                    return this.appversion;\n                }\n            }, {\n                key: "setAppVersion",\n                value: function(a) {\n                    this.appversion = a;\n                }\n            }, {\n                key: "getMagicKey",\n                value: function() {\n                    return this.magicKey;\n                }\n            }, {\n                key: "getBrowserName",\n                value: function() {\n                    return this.browserName;\n                }\n            }, {\n                key: "getBrowserVersion",\n                value: function() {\n                    return this.browserVersion;\n                }\n            }, {\n                key: "getOsName",\n                value: function() {\n                    return this.osName;\n                }\n            }, {\n                key: "getOsVersion",\n                value: function() {\n                    return this.osVersion;\n                }\n            }, {\n                key: "getCodeBase",\n                value: function() {\n                    return this.codeBase;\n                }\n            }, {\n                key: "getUserAgent",\n                value: function() {\n                    return this.userAgent;\n                }\n            }, {\n                key: "serialize",\n                value: function() {\n                    return {\n                        type: "browser",\n                        buildName: this.browserName,\n                        buildVersion: this.browserVersion,\n                        appVersion: this.appversion,\n                        os: this.osName,\n                        osVersion: this.osVersion,\n                        userAgent: this.userAgent\n                    };\n                }\n            } ]), a;\n        }();\n        c.Endpoint = o;\n    }, {\n        "../browserapi/detectbrowser": 18,\n        "../browserapi/localstorage": 20,\n        "../utility/hash": 92,\n        "../utility/timestamps": 99\n    } ],\n    90: [ function(a, b, c) {\n        "use strict";\n        function d(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }\n        function e(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.EventMessage = void 0;\n        var f = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(a) {\n            return typeof a;\n        } : function(a) {\n            return a && "function" == typeof Symbol && a.constructor === Symbol && a !== Symbol.prototype ? "symbol" : typeof a;\n        }, g = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), h = a("../config/constants"), i = d(h), j = a("../config/settings"), k = d(j), l = a("./registry"), m = a("./csiologger"), n = d(m), o = function() {\n            function a(b, c, d, f) {\n                e(this, a), this.eventType = b, this.customEntries = d, this.pcHandler = f, this.auth = l.Registry.getAuthenticator(), \n                this.clocksync = l.Registry.getClockSync(), this.timestamp = this.clocksync.getSynchronizedTimestamp(), \n                this.conferenceId = c, this.clockUnSynced = !this.clocksync.isCompleted();\n            }\n            return g(a, [ {\n                key: "updateConferenceId",\n                value: function(a) {\n                    n.log("updating conferenceId to ", this.eventType, this.conferenceId, a), this.conferenceId = a;\n                }\n            }, {\n                key: "toJson",\n                value: function() {\n                    if (!this.canBeSent()) return null;\n                    var a = this.getCommonHeader();\n                    return Object.assign(a, this.customEntries), this.eventType === i.internalFabricEvent.userJoined && delete a.connectionID, \n                    a;\n                }\n            }, {\n                key: "getCallback",\n                value: function() {\n                    return this.pcHandler ? this.pcHandler.getCallback() : null;\n                }\n            }, {\n                key: "canBeSent",\n                value: function() {\n                    var a = void 0, b = i.tmpConferenceId;\n                    if (this.conferenceId === b) return !1;\n                    if (this.pcHandler && !this.pcHandler.getRemoteId()) return !1;\n                    if (this.eventType !== i.precalltestEvents.results) {\n                        var c = l.Registry.getConferenceManager().get(this.conferenceId);\n                        if (!c) return !1;\n                        a = c.getUcId();\n                    }\n                    return !!this.auth.getToken() && (this.auth.isTokenValid() ? !!(this.isPriority() || this.clocksync.isCompleted() && a) && !(this.eventType === i.internalFabricEvent.userAlive && !a) : (this.auth.reAuthenticate(), \n                    !1));\n                }\n            }, {\n                key: "isCachable",\n                value: function() {\n                    return -1 === [ i.internalFabricEvent.userAlive ].indexOf(this.eventType);\n                }\n            }, {\n                key: "isPriority",\n                value: function() {\n                    var a = !1;\n                    return this.eventType !== i.internalFabricEvent.userJoined && this.eventType !== i.precalltestEvents.results && this.eventType !== i.internalFabricEvent.userAlive || (a = !0), \n                    a;\n                }\n            }, {\n                key: "getConferenceId",\n                value: function() {\n                    return this.conferenceId;\n                }\n            }, {\n                key: "getCommonHeader",\n                value: function() {\n                    var a = {\n                        version: k.version,\n                        callstatsVersion: k.version,\n                        channel: this.decideChannel(),\n                        timestamp: this.timestamp,\n                        action: this.eventType,\n                        eventType: this.eventType,\n                        localID: encodeURIComponent(l.Registry.getCredentials().getUserId()),\n                        timeShift: 0,\n                        appID: l.Registry.getCredentials().getAppId(),\n                        deviceID: l.Registry.getEndpoint().getId(),\n                        token: this.auth.getToken(),\n                        confID: encodeURIComponent(this.conferenceId)\n                    };\n                    this.clockUnSynced && (a.timestamp += this.clocksync.getOffset());\n                    var b = l.Registry.getConferenceManager().get(this.conferenceId);\n                    return a.ucID = b ? b.getUcId() : null, this.pcHandler ? (a.remoteID = encodeURIComponent(this.pcHandler.getRemoteId()), \n                    a.connectionID = this.pcHandler.getPcHash()) : (a.remoteID = encodeURIComponent(l.Registry.getCredentials().getUserId()), \n                    a.connectionID = encodeURIComponent(l.Registry.getCredentials().getUserId())), a.remoteID || (a.remoteID = encodeURIComponent(l.Registry.getCredentials().getUserId())), \n                    a;\n                }\n            }, {\n                key: "decideChannel",\n                value: function() {\n                    if (this.eventType == i.callstatsChannels.sdpSubmission) return i.callstatsChannels.sdpSubmission;\n                    if (this.eventType == i.callstatsChannels.userFeedback) return i.callstatsChannels.userFeedback;\n                    if (this.eventType == i.callstatsChannels.processedStats) return i.callstatsChannels.processedStats;\n                    for (var a in i.precalltestEvents) if (this.eventType == i.precalltestEvents[a]) return i.callstatsChannels.preCallTest;\n                    return i.callstatsChannels.callstatsEvent;\n                }\n            } ], [ {\n                key: "checkCustomEntries",\n                value: function(a, b) {\n                    if (!p[a]) return n.error("eventType not recognized:", a), !1;\n                    var c = p[a];\n                    for (var d in c) if (!b.hasOwnProperty(d) || f(b[d]) !== c[d]) return n.error("customEntries for", a, "should have", d, "of type", c[d]), \n                    !1;\n                    return !0;\n                }\n            } ]), a;\n        }(), p = {};\n        p[i.internalFabricEvent.userJoined] = {\n            endpointInfo: "object"\n        }, p[i.internalFabricEvent.userLeft] = {}, p[i.internalFabricEvent.userAlive] = {}, \n        p[i.internalFabricEvent.userDetails] = {\n            userName: "string"\n        }, p[i.internalFabricEvent.connectedDeviceList] = {\n            mediaDeviceList: "object"\n        }, p[i.fabricEvent.activeDeviceList] = {\n            mediaDeviceList: "object"\n        }, p[i.fabricEvent.audioMute] = {}, p[i.fabricEvent.audioUnmute] = {}, p[i.fabricEvent.videoPause] = {}, \n        p[i.fabricEvent.videoResume] = {}, p[i.fabricEvent.screenShareStart] = {}, p[i.fabricEvent.screenShareStop] = {}, \n        p[i.internalFabricEvent.mediaPlaybackStart] = {\n            ssrc: "string"\n        }, p[i.internalFabricEvent.mediaPlaybackSuspended] = {\n            ssrc: "string"\n        }, p[i.internalFabricEvent.mediaPlaybackStalled] = {\n            ssrc: "string"\n        }, p[i.internalFabricEvent.oneWayMedia] = {\n            mediaType: "string",\n            ssrc: "string"\n        }, p[i.internalFabricEvent.fabricSetup] = {\n            localIceCandidates: "object",\n            remoteIceCandidates: "object",\n            iceCandidatePairs: "object"\n        }, p[i.fabricEvent.fabricSetupFailed] = {\n            failureDelay: "number",\n            reason: "string",\n            function: "string",\n            endpoint: "object"\n        }, p[i.internalFabricEvent.fabricStateChange] = {\n            changedState: "string",\n            prevState: "string",\n            newState: "string"\n        }, p[i.internalFabricEvent.fabricDropped] = {\n            prevIceConnectionState: "string",\n            currIceConnectionState: "string",\n            currIceCandidatePair: "object",\n            failureDelay: "number"\n        }, p[i.internalFabricEvent.iceConnectionDisruptionStart] = {\n            prevIceConnectionState: "string",\n            currIceConnectionState: "string",\n            prevIceConnectionStateTs: "number",\n            currIceCandidatePair: "object"\n        }, p[i.internalFabricEvent.iceConnectionDisruptionEnd] = {\n            prevIceConnectionState: "string",\n            currIceConnectionState: "string",\n            delay: "number"\n        }, p[i.internalFabricEvent.iceDisruptionStart] = {\n            prevIceConnectionState: "string",\n            currIceConnectionState: "string",\n            prevIceConnectionStateTs: "number",\n            currIceCandidatePair: "object"\n        }, p[i.internalFabricEvent.iceDisruptionEnd] = {\n            prevIceConnectionState: "string",\n            currIceConnectionState: "string",\n            prevIceCandidatePair: "object"\n        }, p[i.internalFabricEvent.iceFailed] = {\n            localIceCandidates: "object",\n            prevIceConnectionState: "string",\n            currIceConnectionState: "string",\n            currIceCandidatePair: "object",\n            failureDelay: "number"\n        }, p[i.internalFabricEvent.iceAborted] = {\n            prevIceConnectionState: "string",\n            currIceConnectionState: "string"\n        }, p[i.internalFabricEvent.iceRestarted] = {\n            prevIceConnectionState: "string",\n            currIceConnectionState: "string",\n            prevIceCandidatePair: "object"\n        }, p[i.internalFabricEvent.fabricTransportSwitch] = {\n            prevIceCandidatePair: "object",\n            currIceCandidatePair: "object"\n        }, p[i.internalFabricEvent.iceTerminated] = {\n            prevIceConnectionState: "string",\n            currIceConnectionState: "string"\n        }, p[i.fabricEvent.fabricTerminated] = {}, p[i.fabricEvent.fabricHold] = {}, p[i.fabricEvent.fabricResume] = {}, \n        p[i.callstatsChannels.sdpSubmission] = {\n            localSDP: "string",\n            remoteSDP: "string"\n        }, p[i.internalFabricEvent.ssrcMap] = {\n            ssrcData: "object"\n        }, p[i.callstatsChannels.userFeedback] = {\n            feedback: "object"\n        }, p[i.internalFabricEvent.sendingThroughputObservations] = {\n            ssrc: "string",\n            maxsendingKBitrate: "number",\n            timeToMaxSendingKBitrate: "number",\n            stablesendingKBitrate: "number",\n            timeToStableSendingKBitrate: "number"\n        }, p[i.fabricEvent.dominantSpeaker] = {}, p[i.fabricEvent.applicationErrorLog] = {\n            message: "string",\n            messageType: "string"\n        }, p[i.callstatsChannels.processedStats] = {\n            stats: "object"\n        }, p[i.callstatsChannels.senderConfiguration] = {\n            rtc_rtp_parameters: "object"\n        }, p[i.internalFabricEvent.limitationObservations] = {\n            reason: "string"\n        }, p[i.qualityDisruptionTypes.qpchange] = {\n            reason: "string"\n        }, p[i.precalltestEvents.results] = {\n            results: "object"\n        }, p[i.precalltestEvents.associate] = {\n            ids: "object"\n        }, c.EventMessage = o;\n    }, {\n        "../config/constants": 33,\n        "../config/settings": 34,\n        "./csiologger": 88,\n        "./registry": 95\n    } ],\n    91: [ function(a, b, c) {\n        "use strict";\n        function d(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }\n        function e(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.EventMessageBuilder = void 0;\n        var f = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(a) {\n            return typeof a;\n        } : function(a) {\n            return a && "function" == typeof Symbol && a.constructor === Symbol && a !== Symbol.prototype ? "symbol" : typeof a;\n        }, g = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), h = a("./eventmessage"), i = a("../config/constants"), j = d(i), k = a("./registry"), l = a("./csiologger"), m = d(l), n = function() {\n            function a() {\n                e(this, a), this.transmissionmanager = k.Registry.getTransmissionManager();\n            }\n            return g(a, [ {\n                key: "make",\n                value: function(a, b, c) {\n                    var d = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : {};\n                    if ("string" != typeof a || null === d || "object" !== (void 0 === d ? "undefined" : f(d))) return m.error("failed typeof checks:", a, void 0 === a ? "undefined" : f(a), void 0 === d ? "undefined" : f(d), d), \n                    k.Registry.getGenericEventHandler().sendEvent(j.logEvents.error, {\n                        msg: "failed typeof checks:" + a + ":" + (void 0 === d ? "undefined" : f(d)) + ":" + (void 0 === a ? "undefined" : f(a))\n                    }), !1;\n                    if (null === b && a !== j.precalltestEvents.results) return m.error("failed conferenceId checks:", a, b), \n                    k.Registry.getGenericEventHandler().sendEvent(j.logEvents.error, {\n                        msg: "failed conferenceId checks:" + a\n                    }), !1;\n                    if (!c && a !== j.callstatsChannels.userFeedback && a !== j.fabricEvent.applicationErrorLog && a !== j.fabricEvent.fabricSetupFailed && a !== j.internalFabricEvent.userJoined && a !== j.precalltestEvents.results) return m.error("peerconnection cannot be null", a), \n                    k.Registry.getGenericEventHandler().sendEvent(j.logEvents.error, {\n                        msg: "peerconnection cannot be null" + a\n                    }), !1;\n                    if (!h.EventMessage.checkCustomEntries(a, d)) return m.error("failed checks:", a, d), \n                    k.Registry.getGenericEventHandler().sendEvent(j.logEvents.error, {\n                        msg: "failed customEntries checks:" + a\n                    }), !1;\n                    var e = void 0;\n                    if (b) {\n                        var g = k.Registry.getConferenceManager().get(b);\n                        g && c && (e = g.getPeerConnectionManager().getPcHandler(c));\n                    }\n                    var i = new h.EventMessage(a, b, d, e);\n                    return this.transmissionmanager.send(i), !0;\n                }\n            } ]), a;\n        }();\n        c.EventMessageBuilder = n;\n    }, {\n        "../config/constants": 33,\n        "./csiologger": 88,\n        "./eventmessage": 90,\n        "./registry": 95\n    } ],\n    92: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            var c = {\n                name: "SHA-256"\n            };\n            if (window.crypto) {\n                var d = window.crypto.subtle || window.crypto.webkitSubtle;\n                if (!d) return void e(a, b);\n                d.digest(c, f(a)).then(function(a) {\n                    b(g(a));\n                }).catch(function() {\n                    e(a, b);\n                });\n            } else if (window.msCrypto) {\n                if (!window.msCrypto.subtle) return void e(a, b);\n                var h = window.msCrypto.subtle.digest(c, f(a));\n                h.oncomplete = function(a) {\n                    a.target && b(g(a.target.result));\n                }, h.onerror = function() {\n                    e(a, b);\n                };\n            } else e(a, b);\n        }\n        function e(a) {\n            var b = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : null, c = 0;\n            if (!a) return c;\n            for (var d = 0, e = a.length; d < e; d++) {\n                c = (c << 5) - c + a.charCodeAt(d), c |= 0;\n            }\n            return b && b(c + ""), c + "";\n        }\n        function f(a) {\n            for (var b = [], c = 0; c < a.length; ++c) {\n                var d = a.charCodeAt(c);\n                d < 128 ? b[b.length] = d : d > 127 && d < 2048 ? (b[b.length] = d >> 6 | 192, b[b.length] = 63 & d | 128) : (b[b.length] = d >> 12 | 224, \n                b[b.length] = d >> 6 & 63 | 128, b[b.length] = 63 & d | 128);\n            }\n            return new Uint8Array(b).buffer;\n        }\n        function g(a) {\n            for (var b = new DataView(a), c = "", d = void 0, e = 0; e < b.byteLength; e++) d = b.getUint8(e).toString(16), \n            d.length < 2 && (d = "0" + d), c += d;\n            return c;\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.generateSHA256 = d, c.generateHash = e;\n    }, {} ],\n    93: [ function(a, b, c) {\n        "use strict";\n        function d(a) {\n            return !!/^[\\],:{}\\s]*$/.test(a.replace(/\\\\["\\\\\\/bfnrtu]/g, "@").replace(/"[^"\\\\\\n\\r]*"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g, "]").replace(/(?:^|:|,)(?:\\s*\\[)+/g, ""));\n        }\n        function e(a) {\n            var b = null;\n            return null === a ? b : (d(a) && (b = JSON.parse(a)), b);\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.isValid = d, c.parse = e;\n    }, {} ],\n    94: [ function(a, b, c) {\n        "use strict";\n        function d(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }\n        function e() {\n            window && window.addEventListener && window.addEventListener("error", function(a) {\n                var b = f.Registry.getGenericEventHandler();\n                if (a && a.filename && a.filename.indexOf("callstats") > -1) {\n                    for (var c = !1, d = {\n                        fileName: a.filename,\n                        line: a.lineno,\n                        col: a.colno,\n                        jsVersion: h.version,\n                        eventType: "error",\n                        message: a.message,\n                        pageURL: window.location.href\n                    }, e = f.Registry.getConferenceManager().getConferenceIds(), g = 0; g < e.length; g++) d.conferenceID = e[g], \n                    b.sendEvent(j.logEvents.error, d), c = !0;\n                    c || b.sendEvent(j.logEvents.error, d);\n                }\n            });\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.setErrorEventListener = e;\n        var f = a("./registry"), g = a("../config/settings"), h = d(g), i = a("../config/constants"), j = d(i);\n    }, {\n        "../config/constants": 33,\n        "../config/settings": 34,\n        "./registry": 95\n    } ],\n    95: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.Registry = void 0;\n        var e = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), f = a("../services/clocksync"), g = a("../services/configservice/configservicewrapper"), h = a("../services/authenticator"), i = a("../services/backendlog"), j = a("../services/transmissionmanager"), k = a("./eventmessagebuilder"), l = a("../conference/conferencemanager"), m = a("../utility/credentials"), n = a("../statspipeline/statsadapter"), o = a("../statspipeline/statsparser"), p = a("../statspipeline/statsmonitor"), q = a("../statspipeline/statstransmitter"), r = a("../statspipeline/statsassembler"), s = a("../utility/endpoint"), t = a("../browserapi/battery"), u = a("precalltest"), v = a("../statspipeline/wifistatsexecutor"), w = a("./callbacks"), x = a("../statspipeline/statscallbackbuilder"), y = a("../services/connectionmanager"), z = null, A = null, B = null, C = null, D = null, E = null, F = null, G = null, H = null, I = null, J = null, K = null, L = null, M = null, N = null, O = null, P = null, Q = null, R = null, S = null, T = function() {\n            function a() {\n                d(this, a);\n            }\n            return e(a, null, [ {\n                key: "getConferenceManager",\n                value: function() {\n                    return O || (O = new l.ConferenceManager()), O;\n                }\n            }, {\n                key: "getStatsCallbackBuilder",\n                value: function() {\n                    return R || (R = new x.StatsCallbackBuilder()), R;\n                }\n            }, {\n                key: "getClockSync",\n                value: function() {\n                    return A || (A = new f.ClockSync()), A;\n                }\n            }, {\n                key: "getWifiStatsExecutor",\n                value: function() {\n                    return P || (P = new v.WifiStatsExecutor()), P;\n                }\n            }, {\n                key: "getAuthenticator",\n                value: function() {\n                    return B || (B = new h.Authenticator()), B;\n                }\n            }, {\n                key: "getConfigServiceWrapper",\n                value: function() {\n                    return C || (C = new g.ConfigServiceWrapper()), C;\n                }\n            }, {\n                key: "getGenericEventHandler",\n                value: function() {\n                    return D || (D = new i.GenericEventHandler(), D.enable()), D;\n                }\n            }, {\n                key: "getConnectionManager",\n                value: function() {\n                    return S || (S = new y.ConnectionManager()), S;\n                }\n            }, {\n                key: "getTransmissionManager",\n                value: function() {\n                    return E || (E = new j.TransmissionManager()), E;\n                }\n            }, {\n                key: "getEventMessageBuilder",\n                value: function() {\n                    return F || (F = new k.EventMessageBuilder()), F;\n                }\n            }, {\n                key: "getCredentials",\n                value: function() {\n                    return G || (G = new m.Credentials()), G;\n                }\n            }, {\n                key: "getEndpoint",\n                value: function() {\n                    return H || (H = new s.Endpoint()), H;\n                }\n            }, {\n                key: "getStatsAdapter",\n                value: function() {\n                    if (!I) {\n                        var b = a.getEndpoint().getCodeBase(), c = a.getEndpoint().getBrowserName();\n                        I = new n.StatsAdapter(b, c);\n                    }\n                    return I;\n                }\n            }, {\n                key: "getPreCallTest",\n                value: function() {\n                    return z || (z = new u.PreCallTest()), z;\n                }\n            }, {\n                key: "getStatsParser",\n                value: function() {\n                    return J || (J = new o.StatsParser()), J;\n                }\n            }, {\n                key: "getStatsMonitor",\n                value: function() {\n                    if (!K) {\n                        var b = a.getEndpoint().getCodeBase();\n                        K = new p.StatsMonitor(b);\n                    }\n                    return K;\n                }\n            }, {\n                key: "getStatsTransmitter",\n                value: function() {\n                    return L || (L = new q.StatsTransmitter()), L;\n                }\n            }, {\n                key: "getStatsAssembler",\n                value: function() {\n                    return M || (M = new r.StatsAssembler()), M;\n                }\n            }, {\n                key: "getBattery",\n                value: function() {\n                    return N || (N = new t.Battery()), N;\n                }\n            }, {\n                key: "getCallbacks",\n                value: function() {\n                    return Q || (Q = new w.Callbacks()), Q;\n                }\n            } ]), a;\n        }();\n        c.Registry = T;\n    }, {\n        "../browserapi/battery": 17,\n        "../conference/conferencemanager": 31,\n        "../services/authenticator": 44,\n        "../services/backendlog": 45,\n        "../services/clocksync": 46,\n        "../services/configservice/configservicewrapper": 50,\n        "../services/connectionmanager": 51,\n        "../services/transmissionmanager": 56,\n        "../statspipeline/statsadapter": 69,\n        "../statspipeline/statsassembler": 70,\n        "../statspipeline/statscallbackbuilder": 71,\n        "../statspipeline/statsmonitor": 72,\n        "../statspipeline/statsparser": 73,\n        "../statspipeline/statstransmitter": 74,\n        "../statspipeline/wifistatsexecutor": 84,\n        "../utility/credentials": 87,\n        "../utility/endpoint": 89,\n        "./callbacks": 86,\n        "./eventmessagebuilder": 91,\n        precalltest: 2\n    } ],\n    96: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        function e() {\n            return null === i && (i = new j()), i;\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        });\n        var f = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }();\n        c.getRTTRegistry = e;\n        var g = a("../statspipeline/validator"), h = function(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }(g), i = null, j = function() {\n            function a() {\n                d(this, a), this.rtts = new Map(), this.frameRates = new Map(), this.transportRTT = null;\n            }\n            return f(a, [ {\n                key: "getFrameRateReceived",\n                value: function(a) {\n                    for (var b = null, c = [ "googFrameRateOutput", "googFrameRateDecoded", "googFrameRateReceived", "googFrameRateSent", "framerateMean", "framesPerSecond" ], d = 0, e = c.length; d < e; d++) {\n                        var f = c[d];\n                        if (void 0 !== (b = a.stat(f))) break;\n                    }\n                    return b;\n                }\n            }, {\n                key: "update",\n                value: function(a) {\n                    var b = this;\n                    a.getStats(function(a) {\n                        for (var c = [], d = a.result(), e = 0; e < d.length; ++e) {\n                            var f = d[e];\n                            if ("googCandidatePair" !== f.type) {\n                                if ("ssrc" === f.type) {\n                                    var g = b.getFrameRateReceived(f), i = f.stat("googRtt"), j = f.stat("ssrc");\n                                    i && b.rtts.set(h.checkForNan(parseInt(j, 10)), h.checkForNan(parseInt(i, 10))), \n                                    g && b.frameRates.set(h.checkForNan(parseInt(j, 10)), h.checkForNan(parseInt(g, 10)));\n                                }\n                            } else {\n                                var k = f.stat("googRtt");\n                                c.push(k);\n                            }\n                        }\n                        b.transportRTT = Math.max.apply(Math, c);\n                    });\n                }\n            }, {\n                key: "getTransportRTT",\n                value: function() {\n                    return this.transportRTT;\n                }\n            }, {\n                key: "getRTT",\n                value: function(a) {\n                    var b = h.checkForNan(parseInt(a, 10));\n                    return this.rtts.has(b) ? this.rtts.get(b) : null;\n                }\n            }, {\n                key: "getFrameRate",\n                value: function(a) {\n                    var b = h.checkForNan(parseInt(a, 10));\n                    return this.frameRates.has(b) ? this.frameRates.get(b) : null;\n                }\n            } ]), a;\n        }();\n    }, {\n        "../statspipeline/validator": 83\n    } ],\n    97: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        });\n        var e = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), f = function() {\n            function a(b, c, e) {\n                d(this, a), this.max = b, this.midpoint = c, this.stepness = e, this.actualStep = 0, \n                this.reset();\n            }\n            return e(a, [ {\n                key: "reset",\n                value: function() {\n                    this.actualStep = 0;\n                }\n            }, {\n                key: "setMidpoint",\n                value: function(a) {\n                    this.midpoint = a;\n                }\n            }, {\n                key: "setMax",\n                value: function(a) {\n                    this.max = a;\n                }\n            }, {\n                key: "setStepness",\n                value: function(a) {\n                    this.stepness = a;\n                }\n            }, {\n                key: "increaseActualStep",\n                value: function(a) {\n                    this.actualStep += a;\n                }\n            }, {\n                key: "getActual",\n                value: function() {\n                    var a = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 1;\n                    return this.actualStep += a, this.max / (1 + Math.exp(-1 * this.stepness * (this.actualStep - this.midpoint)));\n                }\n            } ]), a;\n        }();\n        c.Sigmoid = f;\n    }, {} ],\n    98: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.TimeoutProcess = void 0;\n        var e = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), f = a("./csiologger"), g = function(a) {\n            if (a && a.__esModule) return a;\n            var b = {};\n            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);\n            return b.default = a, b;\n        }(f), h = function() {\n            function a(b) {\n                d(this, a), this.interval = b, this.timerId = null, this.callback = function() {\n                    g.warn("no callback function set", this);\n                };\n            }\n            return e(a, [ {\n                key: "setCallback",\n                value: function(a) {\n                    this.callback = a;\n                }\n            }, {\n                key: "start",\n                value: function() {\n                    var a = this;\n                    this.timerId = setInterval(function() {\n                        a.callback();\n                    }, this.interval);\n                }\n            }, {\n                key: "stop",\n                value: function() {\n                    clearInterval(this.timerId), this.timerId = null;\n                }\n            }, {\n                key: "isStarted",\n                value: function() {\n                    return null !== this.timerId;\n                }\n            } ]), a;\n        }();\n        c.TimeoutProcess = h;\n    }, {\n        "./csiologger": 88\n    } ],\n    99: [ function(a, b, c) {\n        "use strict";\n        function d() {\n            return window && window.performance && window.performance.now && window.performance.timing && window.performance.timing.navigationStart ? window.performance.now() + window.performance.timing.navigationStart : Date.now();\n        }\n        function e() {\n            return window && window.performance && window.performance.now ? window.performance.now() : null;\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.getCurrent = d, c.getSinceOrigin = e;\n    }, {} ],\n    100: [ function(a, b, c) {\n        "use strict";\n        function d(a, b) {\n            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        });\n        var e = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(a) {\n            return typeof a;\n        } : function(a) {\n            return a && "function" == typeof Symbol && a.constructor === Symbol && a !== Symbol.prototype ? "symbol" : typeof a;\n        }, f = function() {\n            function a(a, b) {\n                for (var c = 0; c < b.length; c++) {\n                    var d = b[c];\n                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), \n                    Object.defineProperty(a, d.key, d);\n                }\n            }\n            return function(b, c, d) {\n                return c && a(b.prototype, c), d && a(b, d), b;\n            };\n        }(), g = function() {\n            function a(b) {\n                d(this, a), this.base = b;\n                for (var c = arguments.length, e = Array(c > 1 ? c - 1 : 0), f = 1; f < c; f++) e[f - 1] = arguments[f];\n                this.appendixes = e;\n            }\n            return f(a, null, [ {\n                key: "concat",\n                value: function(a, b) {\n                    if (!b) return a;\n                    if (!a) return b;\n                    var c = "/" === a.substr(a.length - 1), d = "/" === b.substring(0, 1);\n                    return c || d ? c && d ? a + b.substring(1) : a + b : a + "/" + b;\n                }\n            } ]), f(a, [ {\n                key: "append",\n                value: function(a) {\n                    this.appendixes.push(a);\n                }\n            }, {\n                key: "toString",\n                value: function() {\n                    var b = this.getString(this.base), c = this;\n                    return this.appendixes.forEach(function(d) {\n                        if (null !== d && void 0 !== d) {\n                            var e = c.getString(d);\n                            b = a.concat(b, e);\n                        }\n                    }), b;\n                }\n            }, {\n                key: "getString",\n                value: function(a) {\n                    switch (void 0 === a ? "undefined" : e(a)) {\n                      case "function":\n                        return this.getString(a());\n\n                      case "number":\n                        return a + "";\n\n                      case "string":\n                      default:\n                        return a;\n                    }\n                }\n            } ]), a;\n        }();\n        c.Url = g;\n    }, {} ],\n    101: [ function(a, b, c) {\n        "use strict";\n        function d(a) {\n            var b = [];\n            if (!a) return b;\n            for (var c = 0; c < a.length; c++) {\n                var d = {};\n                d.mediaDeviceID = a[c].deviceId, d.groupID = a[c].groupId, d.kind = a[c].kind, d.label = a[c].label, \n                b.push(d);\n            }\n            return b;\n        }\n        function e() {\n            Number.isInteger || (Number.isInteger = Number.isInteger || function(a) {\n                return "number" == typeof a && isFinite(a) && Math.floor(a) === a;\n            });\n        }\n        function f() {\n            "function" != typeof Object.assign && Object.defineProperty(Object, "assign", {\n                value: function(a, b) {\n                    if (null == a) throw new TypeError("Cannot convert undefined or null to object");\n                    for (var c = Object(a), d = 1; d < arguments.length; d++) {\n                        var e = arguments[d];\n                        if (null != e) for (var f in e) Object.prototype.hasOwnProperty.call(e, f) && (c[f] = e[f]);\n                    }\n                    return c;\n                },\n                writable: !0,\n                configurable: !0\n            });\n        }\n        Object.defineProperty(c, "__esModule", {\n            value: !0\n        }), c.normalizeMediaDeviceList = d, c.isIntegerPollyfill = e, c.assignPollyfill = f;\n    }, {} ]\n}, {}, [ 22 ]);'},function(e,n,t){"use strict";var r=t(16);e.exports=function(e){var n=new r(e);Object.defineProperties(this,{client:{enumerable:!0,value:n}})}},function(e,n,t){const r=t(30),i=t(12),a=t(1),s=t(8),o=t(2),c=t(43),l=t(9),u=t(14),d=t(3),h=t(61);t(0)("PlivoSIP")("version %s",i.version),e.exports={C:a,Exceptions:s,Utils:o,UA:c,URI:l,NameAddrHeader:u,WebSocketInterface:h,Grammar:d,debug:t(0),adapter:r,get name(){return i.title},get version(){return i.version}}},function(e,n,t){"use strict";(function(n){var r=t(32);e.exports=r({window:n.window})}).call(this,t(31))},function(e,n){var t;t=function(){return this}();try{t=t||new Function("return this")()}catch(e){"object"==typeof window&&(t=window)}e.exports=t},function(e,n,t){"use strict";var r=t(4);e.exports=function(e,n){var i=e&&e.window,a={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var s in n)hasOwnProperty.call(n,s)&&(a[s]=n[s]);var o=r.log,c=r.detectBrowser(i),l=t(33)||null,u=t(35)||null,d=t(39)||null,h=t(41)||null,f=t(42)||null,p={browserDetails:c,commonShim:f,extractVersion:r.extractVersion,disableLog:r.disableLog,disableWarnings:r.disableWarnings};switch(c.browser){case"chrome":if(!l||!l.shimPeerConnection||!a.shimChrome)return o("Chrome shim is not included in this adapter release."),p;o("adapter.js shimming chrome."),p.browserShim=l,f.shimCreateObjectURL(i),l.shimGetUserMedia(i),l.shimMediaStream(i),l.shimSourceObject(i),l.shimPeerConnection(i),l.shimOnTrack(i),l.shimAddTrackRemoveTrack(i),l.shimGetSendersWithDtmf(i),l.shimSenderReceiverGetStats(i),l.fixNegotiationNeeded(i),f.shimRTCIceCandidate(i),f.shimMaxMessageSize(i),f.shimSendThrowTypeError(i);break;case"firefox":if(!d||!d.shimPeerConnection||!a.shimFirefox)return o("Firefox shim is not included in this adapter release."),p;o("adapter.js shimming firefox."),p.browserShim=d,f.shimCreateObjectURL(i),d.shimGetUserMedia(i),d.shimSourceObject(i),d.shimPeerConnection(i),d.shimOnTrack(i),d.shimRemoveStream(i),d.shimSenderGetStats(i),d.shimReceiverGetStats(i),d.shimRTCDataChannel(i),f.shimRTCIceCandidate(i),f.shimMaxMessageSize(i),f.shimSendThrowTypeError(i);break;case"edge":if(!u||!u.shimPeerConnection||!a.shimEdge)return o("MS edge shim is not included in this adapter release."),p;o("adapter.js shimming edge."),p.browserShim=u,f.shimCreateObjectURL(i),u.shimGetUserMedia(i),u.shimPeerConnection(i),u.shimReplaceTrack(i),u.shimGetDisplayMedia(i),f.shimMaxMessageSize(i),f.shimSendThrowTypeError(i);break;case"safari":if(!h||!a.shimSafari)return o("Safari shim is not included in this adapter release."),p;o("adapter.js shimming safari."),p.browserShim=h,f.shimCreateObjectURL(i),h.shimRTCIceServerUrls(i),h.shimCreateOfferLegacy(i),h.shimCallbacksAPI(i),h.shimLocalStreamsAPI(i),h.shimRemoteStreamsAPI(i),h.shimTrackEventTransceiver(i),h.shimGetUserMedia(i),f.shimRTCIceCandidate(i),f.shimMaxMessageSize(i),f.shimSendThrowTypeError(i);break;default:o("Unsupported browser!")}return p}},function(e,n,t){"use strict";var r=t(4),i=r.log;function a(e,n,t){var r=t?"outbound-rtp":"inbound-rtp",i=new Map;if(null===n)return i;var a=[];return e.forEach(function(e){"track"===e.type&&e.trackIdentifier===n.id&&a.push(e)}),a.forEach(function(n){e.forEach(function(t){t.type===r&&t.trackId===n.id&&function e(n,t,r){t&&!r.has(t.id)&&(r.set(t.id,t),Object.keys(t).forEach(function(i){i.endsWith("Id")?e(n,n.get(t[i]),r):i.endsWith("Ids")&&t[i].forEach(function(t){e(n,n.get(t),r)})}))}(e,t,i)})}),i}e.exports={shimGetUserMedia:t(34),shimMediaStream:function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},shimOnTrack:function(e){if("object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype)r.wrapPeerConnectionEvent(e,"track",function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e});else{Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var t=this;return t._ontrackpoly||(t._ontrackpoly=function(n){n.stream.addEventListener("addtrack",function(r){var i;i=e.RTCPeerConnection.prototype.getReceivers?t.getReceivers().find(function(e){return e.track&&e.track.id===r.track.id}):{track:r.track};var a=new Event("track");a.track=r.track,a.receiver=i,a.transceiver={receiver:i},a.streams=[n.stream],t.dispatchEvent(a)}),n.stream.getTracks().forEach(function(r){var i;i=e.RTCPeerConnection.prototype.getReceivers?t.getReceivers().find(function(e){return e.track&&e.track.id===r.id}):{track:r};var a=new Event("track");a.track=r,a.receiver=i,a.transceiver={receiver:i},a.streams=[n.stream],t.dispatchEvent(a)})},t.addEventListener("addstream",t._ontrackpoly)),n.apply(t,arguments)}}},shimGetSendersWithDtmf:function(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var n=function(e,n){return{track:n,get dtmf(){return void 0===this._dtmf&&("audio"===n.kind?this._dtmf=e.createDTMFSender(n):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){var i=t.apply(this,arguments);return i||(i=n(this,e),this._senders.push(i)),i};var r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){r.apply(this,arguments);var n=this._senders.indexOf(e);-1!==n&&this._senders.splice(n,1)}}var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;t._senders=t._senders||[],i.apply(t,[e]),e.getTracks().forEach(function(e){t._senders.push(n(t,e))})};var a=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var n=this;n._senders=n._senders||[],a.apply(n,[e]),e.getTracks().forEach(function(e){var t=n._senders.find(function(n){return n.track===e});t&&n._senders.splice(n._senders.indexOf(t),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var s=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,n=s.apply(e,[]);return n.forEach(function(n){n._pc=e}),n},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},shimSenderReceiverGetStats:function(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=n.apply(e,[]);return t.forEach(function(n){n._pc=e}),t});var t=e.RTCPeerConnection.prototype.addTrack;t&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=t.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(n){return a(n,e.track,!0)})}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,n=i.apply(e,[]);return n.forEach(function(n){n._pc=e}),n}),r.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(n){return a(n,e.track,!1)})}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var s=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var n,t,r,i=arguments[0];return this.getSenders().forEach(function(e){e.track===i&&(n?r=!0:n=e)}),this.getReceivers().forEach(function(e){return e.track===i&&(t?r=!0:t=e),e.track===i}),r||n&&t?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):n?n.getStats():t?t.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return s.apply(this,arguments)}}}},shimSourceObject:function(e){var n=e&&e.URL;"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var t=this;this._srcObject=e,this.src&&n.revokeObjectURL(this.src),e?(this.src=n.createObjectURL(e),e.addEventListener("addtrack",function(){t.src&&n.revokeObjectURL(t.src),t.src=n.createObjectURL(e)}),e.addEventListener("removetrack",function(){t.src&&n.revokeObjectURL(t.src),t.src=n.createObjectURL(e)})):this.src=""}}))},shimAddTrackRemoveTrackWithNative:function(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(n){return e._shimmedLocalStreams[n][0]})};var n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,t){if(!t)return n.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var r=n.apply(this,arguments);return this._shimmedLocalStreams[t.id]?-1===this._shimmedLocalStreams[t.id].indexOf(r)&&this._shimmedLocalStreams[t.id].push(r):this._shimmedLocalStreams[t.id]=[t,r],r};var t=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(function(e){if(n.getSenders().find(function(n){return n.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")});var r=n.getSenders();t.apply(this,arguments);var i=n.getSenders().filter(function(e){return-1===r.indexOf(e)});this._shimmedLocalStreams[e.id]=[e].concat(i)};var r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var n=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(function(t){var r=n._shimmedLocalStreams[t].indexOf(e);-1!==r&&n._shimmedLocalStreams[t].splice(r,1),1===n._shimmedLocalStreams[t].length&&delete n._shimmedLocalStreams[t]}),i.apply(this,arguments)}},shimAddTrackRemoveTrack:function(e){if(e.RTCPeerConnection){var n=r.detectBrowser(e);if(e.RTCPeerConnection.prototype.addTrack&&n.version>=65)return this.shimAddTrackRemoveTrackWithNative(e);var t=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,n=t.apply(this);return e._reverseStreams=e._reverseStreams||{},n.map(function(n){return e._reverseStreams[n.id]})};var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(n){var t=this;if(t._streams=t._streams||{},t._reverseStreams=t._reverseStreams||{},n.getTracks().forEach(function(e){if(t.getSenders().find(function(n){return n.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")}),!t._reverseStreams[n.id]){var r=new e.MediaStream(n.getTracks());t._streams[n.id]=r,t._reverseStreams[r.id]=n,n=r}i.apply(t,[n])};var a=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var n=this;n._streams=n._streams||{},n._reverseStreams=n._reverseStreams||{},a.apply(n,[n._streams[e.id]||e]),delete n._reverseStreams[n._streams[e.id]?n._streams[e.id].id:e.id],delete n._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(n,t){var r=this;if("closed"===r.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find(function(e){return e===n}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(r.getSenders().find(function(e){return e.track===n}))throw new DOMException("Track already exists.","InvalidAccessError");r._streams=r._streams||{},r._reverseStreams=r._reverseStreams||{};var a=r._streams[t.id];if(a)a.addTrack(n),Promise.resolve().then(function(){r.dispatchEvent(new Event("negotiationneeded"))});else{var s=new e.MediaStream([n]);r._streams[t.id]=s,r._reverseStreams[s.id]=t,r.addStream(s)}return r.getSenders().find(function(e){return e.track===n})},["createOffer","createAnswer"].forEach(function(n){var t=e.RTCPeerConnection.prototype[n];e.RTCPeerConnection.prototype[n]=function(){var e=this,n=arguments;return arguments.length&&"function"==typeof arguments[0]?t.apply(e,[function(t){var r=c(e,t);n[0].apply(null,[r])},function(e){n[1]&&n[1].apply(null,e)},arguments[2]]):t.apply(e,arguments).then(function(n){return c(e,n)})}});var s=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,n){var t=n.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(n){var r=e._reverseStreams[n],i=e._streams[r.id];t=t.replace(new RegExp(r.id,"g"),i.id)}),new RTCSessionDescription({type:n.type,sdp:t})}(this,arguments[0]),s.apply(this,arguments)):s.apply(this,arguments)};var o=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=o.get.apply(this);return""===e.type?e:c(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var n,t=this;if("closed"===t.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===t))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");t._streams=t._streams||{},Object.keys(t._streams).forEach(function(r){t._streams[r].getTracks().find(function(n){return e.track===n})&&(n=t._streams[r])}),n&&(1===n.getTracks().length?t.removeStream(t._reverseStreams[n.id]):n.removeTrack(e.track),t.dispatchEvent(new Event("negotiationneeded")))}}function c(e,n){var t=n.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(n){var r=e._reverseStreams[n],i=e._streams[r.id];t=t.replace(new RegExp(i.id,"g"),r.id)}),new RTCSessionDescription({type:n.type,sdp:t})}},shimPeerConnection:function(e){var n=r.detectBrowser(e);if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=function(n,t){return i("PeerConnection"),n&&n.iceTransportPolicy&&(n.iceTransports=n.iceTransportPolicy),new e.webkitRTCPeerConnection(n,t)},e.RTCPeerConnection.prototype=e.webkitRTCPeerConnection.prototype,e.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.webkitRTCPeerConnection.generateCertificate}})),e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,n,r){var i=this,a=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof arguments[0]))return t.apply(this,[]);var s=function(e){var n={};return e.result().forEach(function(e){var t={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(n){t[n]=e.stat(n)}),n[t.id]=t}),n},o=function(e){return new Map(Object.keys(e).map(function(n){return[n,e[n]]}))};if(arguments.length>=2){return t.apply(this,[function(e){a[1](o(s(e)))},arguments[0]])}return new Promise(function(e,n){t.apply(i,[function(n){e(o(s(n)))},n])}).then(n,r)},n.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){var t=e.RTCPeerConnection.prototype[n];e.RTCPeerConnection.prototype[n]=function(){var e=arguments,n=this,r=new Promise(function(r,i){t.apply(n,[e[0],r,i])});return e.length<2?r:r.then(function(){e[1].apply(null,[])},function(n){e.length>=3&&e[2].apply(null,[n])})}}),n.version<52&&["createOffer","createAnswer"].forEach(function(n){var t=e.RTCPeerConnection.prototype[n];e.RTCPeerConnection.prototype[n]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var n=1===arguments.length?arguments[0]:void 0;return new Promise(function(r,i){t.apply(e,[r,i,n])})}return t.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){var t=e.RTCPeerConnection.prototype[n];e.RTCPeerConnection.prototype[n]=function(){return arguments[0]=new("addIceCandidate"===n?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),t.apply(this,arguments)}});var a=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?a.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}},fixNegotiationNeeded:function(e){r.wrapPeerConnectionEvent(e,"negotiationneeded",function(e){if("stable"===e.target.signalingState)return e})},shimGetDisplayMedia:function(e,n){!e.navigator||!e.navigator.mediaDevices||"getDisplayMedia"in e.navigator.mediaDevices||("function"==typeof n?(e.navigator.mediaDevices.getDisplayMedia=function(t){return n(t).then(function(n){var r=t.video&&t.video.width,i=t.video&&t.video.height,a=t.video&&t.video.frameRate;return t.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:n,maxFrameRate:a||3}},r&&(t.video.mandatory.maxWidth=r),i&&(t.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(t)})},e.navigator.getDisplayMedia=function(n){return r.deprecated("navigator.getDisplayMedia","navigator.mediaDevices.getDisplayMedia"),e.navigator.mediaDevices.getDisplayMedia(n)}):console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}}},function(e,n,t){"use strict";var r=t(4),i=r.log;e.exports=function(e){var n=r.detectBrowser(e),t=e&&e.navigator,a=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var n={};return Object.keys(e).forEach(function(t){if("require"!==t&&"advanced"!==t&&"mediaSource"!==t){var r="object"==typeof e[t]?e[t]:{ideal:e[t]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var i=function(e,n){return e?e+n.charAt(0).toUpperCase()+n.slice(1):"deviceId"===n?"sourceId":n};if(void 0!==r.ideal){n.optional=n.optional||[];var a={};"number"==typeof r.ideal?(a[i("min",t)]=r.ideal,n.optional.push(a),(a={})[i("max",t)]=r.ideal,n.optional.push(a)):(a[i("",t)]=r.ideal,n.optional.push(a))}void 0!==r.exact&&"number"!=typeof r.exact?(n.mandatory=n.mandatory||{},n.mandatory[i("",t)]=r.exact):["min","max"].forEach(function(e){void 0!==r[e]&&(n.mandatory=n.mandatory||{},n.mandatory[i(e,t)]=r[e])})}}),e.advanced&&(n.optional=(n.optional||[]).concat(e.advanced)),n},s=function(e,r){if(n.version>=61)return r(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){var s=function(e,n,t){n in e&&!(t in e)&&(e[t]=e[n],delete e[n])};s((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),s(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=a(e.audio)}if(e&&"object"==typeof e.video){var o=e.video.facingMode;o=o&&("object"==typeof o?o:{ideal:o});var c,l=n.version<66;if(o&&("user"===o.exact||"environment"===o.exact||"user"===o.ideal||"environment"===o.ideal)&&(!t.mediaDevices.getSupportedConstraints||!t.mediaDevices.getSupportedConstraints().facingMode||l))if(delete e.video.facingMode,"environment"===o.exact||"environment"===o.ideal?c=["back","rear"]:"user"!==o.exact&&"user"!==o.ideal||(c=["front"]),c)return t.mediaDevices.enumerateDevices().then(function(n){var t=(n=n.filter(function(e){return"videoinput"===e.kind})).find(function(e){return c.some(function(n){return-1!==e.label.toLowerCase().indexOf(n)})});return!t&&n.length&&-1!==c.indexOf("back")&&(t=n[n.length-1]),t&&(e.video.deviceId=o.exact?{exact:t.deviceId}:{ideal:t.deviceId}),e.video=a(e.video),i("chrome: "+JSON.stringify(e)),r(e)});e.video=a(e.video)}return i("chrome: "+JSON.stringify(e)),r(e)},o=function(e){return n.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};t.getUserMedia=function(e,n,r){s(e,function(e){t.webkitGetUserMedia(e,n,function(e){r&&r(o(e))})})};var c=function(e){return new Promise(function(n,r){t.getUserMedia(e,n,r)})};if(t.mediaDevices||(t.mediaDevices={getUserMedia:c,enumerateDevices:function(){return new Promise(function(n){var t={audio:"audioinput",video:"videoinput"};return e.MediaStreamTrack.getSources(function(e){n(e.map(function(e){return{label:e.label,kind:t[e.kind],deviceId:e.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),t.mediaDevices.getUserMedia){var l=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return s(e,function(e){return l(e).then(function(n){if(e.audio&&!n.getAudioTracks().length||e.video&&!n.getVideoTracks().length)throw n.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return n},function(e){return Promise.reject(o(e))})})}}else t.mediaDevices.getUserMedia=function(e){return c(e)};void 0===t.mediaDevices.addEventListener&&(t.mediaDevices.addEventListener=function(){i("Dummy mediaDevices.addEventListener called.")}),void 0===t.mediaDevices.removeEventListener&&(t.mediaDevices.removeEventListener=function(){i("Dummy mediaDevices.removeEventListener called.")})}},function(e,n,t){"use strict";var r=t(4),i=t(36),a=t(37);e.exports={shimGetUserMedia:t(38),shimPeerConnection:function(e){var n=r.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),n.version<15025)){var t=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){t.set.call(this,e);var n=new Event("enabled");n.enabled=e,this.dispatchEvent(n)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var s=a(e,n.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=i(e.iceServers)),new s(e)},e.RTCPeerConnection.prototype=s.prototype},shimReplaceTrack:function(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)},shimGetDisplayMedia:function(e,n){if("getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&!("getDisplayMedia"in e.navigator.mediaDevices)){var t=e.navigator.getDisplayMedia;e.navigator.mediaDevices.getDisplayMedia=function(n){return t.call(e.navigator,n)},e.navigator.getDisplayMedia=function(n){return r.deprecated("navigator.getDisplayMedia","navigator.mediaDevices.getDisplayMedia"),t.call(e.navigator,n)}}}}},function(e,n,t){"use strict";var r=t(4);e.exports=function(e,n){var t=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var i=e.urls||e.url;e.url&&!e.urls&&r.deprecated("RTCIceServer.url","RTCIceServer.urls");var a="string"==typeof i;return a&&(i=[i]),i=i.filter(function(e){return 0===e.indexOf("turn:")&&-1!==e.indexOf("transport=udp")&&-1===e.indexOf("turn:[")&&!t?(t=!0,!0):0===e.indexOf("stun:")&&n>=14393&&-1===e.indexOf("?transport=udp")}),delete e.url,e.urls=a?i[0]:i,!!i.length}})}},function(e,n,t){"use strict";var r=t(18);function i(e,n,t,i,a){var s=r.writeRtpDescription(e.kind,n);if(s+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),s+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===t?"actpass":a||"active"),s+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?s+="a=sendrecv\r\n":e.rtpSender?s+="a=sendonly\r\n":e.rtpReceiver?s+="a=recvonly\r\n":s+="a=inactive\r\n",e.rtpSender){var o=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=o;var c="msid:"+(i?i.id:"-")+" "+o+"\r\n";s+="a="+c,s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+c,e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+c,s+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"),s}function a(e,n){var t={codecs:[],headerExtensions:[],fecMechanisms:[]},r=function(e,n){e=parseInt(e,10);for(var t=0;t<n.length;t++)if(n[t].payloadType===e||n[t].preferredPayloadType===e)return n[t]},i=function(e,n,t,i){var a=r(e.parameters.apt,t),s=r(n.parameters.apt,i);return a&&s&&a.name.toLowerCase()===s.name.toLowerCase()};return e.codecs.forEach(function(r){for(var a=0;a<n.codecs.length;a++){var s=n.codecs[a];if(r.name.toLowerCase()===s.name.toLowerCase()&&r.clockRate===s.clockRate){if("rtx"===r.name.toLowerCase()&&r.parameters&&s.parameters.apt&&!i(r,s,e.codecs,n.codecs))continue;(s=JSON.parse(JSON.stringify(s))).numChannels=Math.min(r.numChannels,s.numChannels),t.codecs.push(s),s.rtcpFeedback=s.rtcpFeedback.filter(function(e){for(var n=0;n<r.rtcpFeedback.length;n++)if(r.rtcpFeedback[n].type===e.type&&r.rtcpFeedback[n].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var r=0;r<n.headerExtensions.length;r++){var i=n.headerExtensions[r];if(e.uri===i.uri){t.headerExtensions.push(i);break}}}),t}function s(e,n,t){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[n][e].indexOf(t)}function o(e,n){var t=e.getRemoteCandidates().find(function(e){return n.foundation===e.foundation&&n.ip===e.ip&&n.port===e.port&&n.priority===e.priority&&n.protocol===e.protocol&&n.type===e.type});return t||e.addRemoteCandidate(n),!t}function c(e,n){var t=new Error(n);return t.name=e,t.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],t}e.exports=function(e,n){function t(n,t){t.addTrack(n),t.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:n}))}function l(n,t,r,i){var a=new Event("track");a.track=t,a.receiver=r,a.transceiver={receiver:r},a.streams=i,e.setTimeout(function(){n._dispatchEvent("track",a)})}var u=function(t){var i=this,a=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){i[e]=a[e].bind(a)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",t=JSON.parse(JSON.stringify(t||{})),this.usingBundle="max-bundle"===t.bundlePolicy,"negotiate"===t.rtcpMuxPolicy)throw c("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(t.rtcpMuxPolicy||(t.rtcpMuxPolicy="require"),t.iceTransportPolicy){case"all":case"relay":break;default:t.iceTransportPolicy="all"}switch(t.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:t.bundlePolicy="balanced"}if(t.iceServers=function(e,n){var t=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var r=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"==typeof r;return i&&(r=[r]),r=r.filter(function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||t?0===e.indexOf("stun:")&&n>=14393&&-1===e.indexOf("?transport=udp"):(t=!0,!0)}),delete e.url,e.urls=i?r[0]:r,!!r.length}})}(t.iceServers||[],n),this._iceGatherers=[],t.iceCandidatePoolSize)for(var s=t.iceCandidatePoolSize;s>0;s--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:t.iceServers,gatherPolicy:t.iceTransportPolicy}));else t.iceCandidatePoolSize=0;this._config=t,this.transceivers=[],this._sdpSessionId=r.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(u.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(u.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),u.prototype.onicecandidate=null,u.prototype.onaddstream=null,u.prototype.ontrack=null,u.prototype.onremovestream=null,u.prototype.onsignalingstatechange=null,u.prototype.oniceconnectionstatechange=null,u.prototype.onconnectionstatechange=null,u.prototype.onicegatheringstatechange=null,u.prototype.onnegotiationneeded=null,u.prototype.ondatachannel=null,u.prototype._dispatchEvent=function(e,n){this._isClosed||(this.dispatchEvent(n),"function"==typeof this["on"+e]&&this["on"+e](n))},u.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},u.prototype.getConfiguration=function(){return this._config},u.prototype.getLocalStreams=function(){return this.localStreams},u.prototype.getRemoteStreams=function(){return this.remoteStreams},u.prototype._createTransceiver=function(e,n){var t=this.transceivers.length>0,r={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&t)r.iceTransport=this.transceivers[0].iceTransport,r.dtlsTransport=this.transceivers[0].dtlsTransport;else{var i=this._createIceAndDtlsTransports();r.iceTransport=i.iceTransport,r.dtlsTransport=i.dtlsTransport}return n||this.transceivers.push(r),r},u.prototype.addTrack=function(n,t){if(this._isClosed)throw c("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var r;if(this.transceivers.find(function(e){return e.track===n}))throw c("InvalidAccessError","Track already exists.");for(var i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==n.kind||(r=this.transceivers[i]);return r||(r=this._createTransceiver(n.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(t)&&this.localStreams.push(t),r.track=n,r.stream=t,r.rtpSender=new e.RTCRtpSender(n,r.dtlsTransport),r.rtpSender},u.prototype.addStream=function(e){var t=this;if(n>=15025)e.getTracks().forEach(function(n){t.addTrack(n,e)});else{var r=e.clone();e.getTracks().forEach(function(e,n){var t=r.getTracks()[n];e.addEventListener("enabled",function(e){t.enabled=e.enabled})}),r.getTracks().forEach(function(e){t.addTrack(e,r)})}},u.prototype.removeTrack=function(n){if(this._isClosed)throw c("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(n instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var t=this.transceivers.find(function(e){return e.rtpSender===n});if(!t)throw c("InvalidAccessError","Sender was not created by this connection.");var r=t.stream;t.rtpSender.stop(),t.rtpSender=null,t.track=null,t.stream=null,-1===this.transceivers.map(function(e){return e.stream}).indexOf(r)&&this.localStreams.indexOf(r)>-1&&this.localStreams.splice(this.localStreams.indexOf(r),1),this._maybeFireNegotiationNeeded()},u.prototype.removeStream=function(e){var n=this;e.getTracks().forEach(function(e){var t=n.getSenders().find(function(n){return n.track===e});t&&n.removeTrack(t)})},u.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},u.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},u.prototype._createIceGatherer=function(n,t){var r=this;if(t&&n>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[n].bufferedCandidateEvents=[],this.transceivers[n].bufferCandidates=function(e){var t=!e.candidate||0===Object.keys(e.candidate).length;i.state=t?"completed":"gathering",null!==r.transceivers[n].bufferedCandidateEvents&&r.transceivers[n].bufferedCandidateEvents.push(e)},i.addEventListener("localcandidate",this.transceivers[n].bufferCandidates),i},u.prototype._gather=function(n,t){var i=this,a=this.transceivers[t].iceGatherer;if(!a.onlocalcandidate){var s=this.transceivers[t].bufferedCandidateEvents;this.transceivers[t].bufferedCandidateEvents=null,a.removeEventListener("localcandidate",this.transceivers[t].bufferCandidates),a.onlocalcandidate=function(e){if(!(i.usingBundle&&t>0)){var s=new Event("icecandidate");s.candidate={sdpMid:n,sdpMLineIndex:t};var o=e.candidate,c=!o||0===Object.keys(o).length;if(c)"new"!==a.state&&"gathering"!==a.state||(a.state="completed");else{"new"===a.state&&(a.state="gathering"),o.component=1,o.ufrag=a.getLocalParameters().usernameFragment;var l=r.writeCandidate(o);s.candidate=Object.assign(s.candidate,r.parseCandidate(l)),s.candidate.candidate=l,s.candidate.toJSON=function(){return{candidate:s.candidate.candidate,sdpMid:s.candidate.sdpMid,sdpMLineIndex:s.candidate.sdpMLineIndex,usernameFragment:s.candidate.usernameFragment}}}var u=r.getMediaSections(i._localDescription.sdp);u[s.candidate.sdpMLineIndex]+=c?"a=end-of-candidates\r\n":"a="+s.candidate.candidate+"\r\n",i._localDescription.sdp=r.getDescription(i._localDescription.sdp)+u.join("");var d=i.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});"gathering"!==i.iceGatheringState&&(i.iceGatheringState="gathering",i._emitGatheringStateChange()),c||i._dispatchEvent("icecandidate",s),d&&(i._dispatchEvent("icecandidate",new Event("icecandidate")),i.iceGatheringState="complete",i._emitGatheringStateChange())}},e.setTimeout(function(){s.forEach(function(e){a.onlocalcandidate(e)})},0)}},u.prototype._createIceAndDtlsTransports=function(){var n=this,t=new e.RTCIceTransport(null);t.onicestatechange=function(){n._updateIceConnectionState(),n._updateConnectionState()};var r=new e.RTCDtlsTransport(t);return r.ondtlsstatechange=function(){n._updateConnectionState()},r.onerror=function(){Object.defineProperty(r,"state",{value:"failed",writable:!0}),n._updateConnectionState()},{iceTransport:t,dtlsTransport:r}},u.prototype._disposeIceAndDtlsTransports=function(e){var n=this.transceivers[e].iceGatherer;n&&(delete n.onlocalcandidate,delete this.transceivers[e].iceGatherer);var t=this.transceivers[e].iceTransport;t&&(delete t.onicestatechange,delete this.transceivers[e].iceTransport);var r=this.transceivers[e].dtlsTransport;r&&(delete r.ondtlsstatechange,delete r.onerror,delete this.transceivers[e].dtlsTransport)},u.prototype._transceive=function(e,t,i){var s=a(e.localCapabilities,e.remoteCapabilities);t&&e.rtpSender&&(s.encodings=e.sendEncodingParameters,s.rtcp={cname:r.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(s.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(s)),i&&e.rtpReceiver&&s.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&n<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),e.recvEncodingParameters.length?s.encodings=e.recvEncodingParameters:s.encodings=[{}],s.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(s.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(s.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(s))},u.prototype.setLocalDescription=function(e){var n,t,i=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(c("TypeError",'Unsupported type "'+e.type+'"'));if(!s("setLocalDescription",e.type,i.signalingState)||i._isClosed)return Promise.reject(c("InvalidStateError","Can not set local "+e.type+" in state "+i.signalingState));if("offer"===e.type)n=r.splitSections(e.sdp),t=n.shift(),n.forEach(function(e,n){var t=r.parseRtpParameters(e);i.transceivers[n].localCapabilities=t}),i.transceivers.forEach(function(e,n){i._gather(e.mid,n)});else if("answer"===e.type){n=r.splitSections(i._remoteDescription.sdp),t=n.shift();var o=r.matchPrefix(t,"a=ice-lite").length>0;n.forEach(function(e,n){var s=i.transceivers[n],c=s.iceGatherer,l=s.iceTransport,u=s.dtlsTransport,d=s.localCapabilities,h=s.remoteCapabilities;if(!(r.isRejected(e)&&0===r.matchPrefix(e,"a=bundle-only").length)&&!s.rejected){var f=r.getIceParameters(e,t),p=r.getDtlsParameters(e,t);o&&(p.role="server"),i.usingBundle&&0!==n||(i._gather(s.mid,n),"new"===l.state&&l.start(c,f,o?"controlling":"controlled"),"new"===u.state&&u.start(p));var g=a(d,h);i._transceive(s,g.codecs.length>0,!1)}})}return i._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?i._updateSignalingState("have-local-offer"):i._updateSignalingState("stable"),Promise.resolve()},u.prototype.setRemoteDescription=function(i){var u=this;if(-1===["offer","answer"].indexOf(i.type))return Promise.reject(c("TypeError",'Unsupported type "'+i.type+'"'));if(!s("setRemoteDescription",i.type,u.signalingState)||u._isClosed)return Promise.reject(c("InvalidStateError","Can not set remote "+i.type+" in state "+u.signalingState));var d={};u.remoteStreams.forEach(function(e){d[e.id]=e});var h=[],f=r.splitSections(i.sdp),p=f.shift(),g=r.matchPrefix(p,"a=ice-lite").length>0,b=r.matchPrefix(p,"a=group:BUNDLE ").length>0;u.usingBundle=b;var v=r.matchPrefix(p,"a=ice-options:")[0];return u.canTrickleIceCandidates=!!v&&v.substr(14).split(" ").indexOf("trickle")>=0,f.forEach(function(s,c){var l=r.splitLines(s),f=r.getKind(s),v=r.isRejected(s)&&0===r.matchPrefix(s,"a=bundle-only").length,m=l[0].substr(2).split(" ")[2],y=r.getDirection(s,p),_=r.parseMsid(s),S=r.getMid(s)||r.generateIdentifier();if(v||"application"===f&&("DTLS/SCTP"===m||"UDP/DTLS/SCTP"===m))u.transceivers[c]={mid:S,kind:f,protocol:m,rejected:!0};else{var C,T,w,E,k,R,I,P,A;!v&&u.transceivers[c]&&u.transceivers[c].rejected&&(u.transceivers[c]=u._createTransceiver(f,!0));var O,D,j=r.parseRtpParameters(s);v||(O=r.getIceParameters(s,p),(D=r.getDtlsParameters(s,p)).role="client"),I=r.parseRtpEncodingParameters(s);var M=r.parseRtcpParameters(s),x=r.matchPrefix(s,"a=end-of-candidates",p).length>0,N=r.matchPrefix(s,"a=candidate:").map(function(e){return r.parseCandidate(e)}).filter(function(e){return 1===e.component});if(("offer"===i.type||"answer"===i.type)&&!v&&b&&c>0&&u.transceivers[c]&&(u._disposeIceAndDtlsTransports(c),u.transceivers[c].iceGatherer=u.transceivers[0].iceGatherer,u.transceivers[c].iceTransport=u.transceivers[0].iceTransport,u.transceivers[c].dtlsTransport=u.transceivers[0].dtlsTransport,u.transceivers[c].rtpSender&&u.transceivers[c].rtpSender.setTransport(u.transceivers[0].dtlsTransport),u.transceivers[c].rtpReceiver&&u.transceivers[c].rtpReceiver.setTransport(u.transceivers[0].dtlsTransport)),"offer"!==i.type||v){if("answer"===i.type&&!v){T=(C=u.transceivers[c]).iceGatherer,w=C.iceTransport,E=C.dtlsTransport,k=C.rtpReceiver,R=C.sendEncodingParameters,P=C.localCapabilities,u.transceivers[c].recvEncodingParameters=I,u.transceivers[c].remoteCapabilities=j,u.transceivers[c].rtcpParameters=M,N.length&&"new"===w.state&&(!g&&!x||b&&0!==c?N.forEach(function(e){o(C.iceTransport,e)}):w.setRemoteCandidates(N)),b&&0!==c||("new"===w.state&&w.start(T,O,"controlling"),"new"===E.state&&E.start(D)),!a(C.localCapabilities,C.remoteCapabilities).codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&C.sendEncodingParameters[0].rtx&&delete C.sendEncodingParameters[0].rtx,u._transceive(C,"sendrecv"===y||"recvonly"===y,"sendrecv"===y||"sendonly"===y),!k||"sendrecv"!==y&&"sendonly"!==y?delete C.rtpReceiver:(A=k.track,_?(d[_.stream]||(d[_.stream]=new e.MediaStream),t(A,d[_.stream]),h.push([A,k,d[_.stream]])):(d.default||(d.default=new e.MediaStream),t(A,d.default),h.push([A,k,d.default])))}}else{(C=u.transceivers[c]||u._createTransceiver(f)).mid=S,C.iceGatherer||(C.iceGatherer=u._createIceGatherer(c,b)),N.length&&"new"===C.iceTransport.state&&(!x||b&&0!==c?N.forEach(function(e){o(C.iceTransport,e)}):C.iceTransport.setRemoteCandidates(N)),P=e.RTCRtpReceiver.getCapabilities(f),n<15019&&(P.codecs=P.codecs.filter(function(e){return"rtx"!==e.name})),R=C.sendEncodingParameters||[{ssrc:1001*(2*c+2)}];var F,U=!1;if("sendrecv"===y||"sendonly"===y){if(U=!C.rtpReceiver,k=C.rtpReceiver||new e.RTCRtpReceiver(C.dtlsTransport,f),U)A=k.track,_&&"-"===_.stream||(_?(d[_.stream]||(d[_.stream]=new e.MediaStream,Object.defineProperty(d[_.stream],"id",{get:function(){return _.stream}})),Object.defineProperty(A,"id",{get:function(){return _.track}}),F=d[_.stream]):(d.default||(d.default=new e.MediaStream),F=d.default)),F&&(t(A,F),C.associatedRemoteMediaStreams.push(F)),h.push([A,k,F])}else C.rtpReceiver&&C.rtpReceiver.track&&(C.associatedRemoteMediaStreams.forEach(function(n){var t=n.getTracks().find(function(e){return e.id===C.rtpReceiver.track.id});t&&function(n,t){t.removeTrack(n),t.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:n}))}(t,n)}),C.associatedRemoteMediaStreams=[]);C.localCapabilities=P,C.remoteCapabilities=j,C.rtpReceiver=k,C.rtcpParameters=M,C.sendEncodingParameters=R,C.recvEncodingParameters=I,u._transceive(u.transceivers[c],!1,U)}}}),void 0===u._dtlsRole&&(u._dtlsRole="offer"===i.type?"active":"passive"),u._remoteDescription={type:i.type,sdp:i.sdp},"offer"===i.type?u._updateSignalingState("have-remote-offer"):u._updateSignalingState("stable"),Object.keys(d).forEach(function(n){var t=d[n];if(t.getTracks().length){if(-1===u.remoteStreams.indexOf(t)){u.remoteStreams.push(t);var r=new Event("addstream");r.stream=t,e.setTimeout(function(){u._dispatchEvent("addstream",r)})}h.forEach(function(e){var n=e[0],r=e[1];t.id===e[2].id&&l(u,n,r,[t])})}}),h.forEach(function(e){e[2]||l(u,e[0],e[1],[])}),e.setTimeout(function(){u&&u.transceivers&&u.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},u.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},u.prototype._updateSignalingState=function(e){this.signalingState=e;var n=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",n)},u.prototype._maybeFireNegotiationNeeded=function(){var n=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout(function(){if(n.needNegotiation){n.needNegotiation=!1;var e=new Event("negotiationneeded");n._dispatchEvent("negotiationneeded",e)}},0))},u.prototype._updateIceConnectionState=function(){var e,n={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){e.iceTransport&&!e.rejected&&n[e.iceTransport.state]++}),e="new",n.failed>0?e="failed":n.checking>0?e="checking":n.disconnected>0?e="disconnected":n.new>0?e="new":n.connected>0?e="connected":n.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var t=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",t)}},u.prototype._updateConnectionState=function(){var e,n={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(n[e.iceTransport.state]++,n[e.dtlsTransport.state]++)}),n.connected+=n.completed,e="new",n.failed>0?e="failed":n.connecting>0?e="connecting":n.disconnected>0?e="disconnected":n.new>0?e="new":n.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var t=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",t)}},u.prototype.createOffer=function(){var t=this;if(t._isClosed)return Promise.reject(c("InvalidStateError","Can not call createOffer after close"));var a=t.transceivers.filter(function(e){return"audio"===e.kind}).length,s=t.transceivers.filter(function(e){return"video"===e.kind}).length,o=arguments[0];if(o){if(o.mandatory||o.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==o.offerToReceiveAudio&&(a=!0===o.offerToReceiveAudio?1:!1===o.offerToReceiveAudio?0:o.offerToReceiveAudio),void 0!==o.offerToReceiveVideo&&(s=!0===o.offerToReceiveVideo?1:!1===o.offerToReceiveVideo?0:o.offerToReceiveVideo)}for(t.transceivers.forEach(function(e){"audio"===e.kind?--a<0&&(e.wantReceive=!1):"video"===e.kind&&--s<0&&(e.wantReceive=!1)});a>0||s>0;)a>0&&(t._createTransceiver("audio"),a--),s>0&&(t._createTransceiver("video"),s--);var l=r.writeSessionBoilerplate(t._sdpSessionId,t._sdpSessionVersion++);t.transceivers.forEach(function(i,a){var s=i.track,o=i.kind,c=i.mid||r.generateIdentifier();i.mid=c,i.iceGatherer||(i.iceGatherer=t._createIceGatherer(a,t.usingBundle));var l=e.RTCRtpSender.getCapabilities(o);n<15019&&(l.codecs=l.codecs.filter(function(e){return"rtx"!==e.name})),l.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),i.remoteCapabilities&&i.remoteCapabilities.codecs&&i.remoteCapabilities.codecs.forEach(function(n){e.name.toLowerCase()===n.name.toLowerCase()&&e.clockRate===n.clockRate&&(e.preferredPayloadType=n.payloadType)})}),l.headerExtensions.forEach(function(e){(i.remoteCapabilities&&i.remoteCapabilities.headerExtensions||[]).forEach(function(n){e.uri===n.uri&&(e.id=n.id)})});var u=i.sendEncodingParameters||[{ssrc:1001*(2*a+1)}];s&&n>=15019&&"video"===o&&!u[0].rtx&&(u[0].rtx={ssrc:u[0].ssrc+1}),i.wantReceive&&(i.rtpReceiver=new e.RTCRtpReceiver(i.dtlsTransport,o)),i.localCapabilities=l,i.sendEncodingParameters=u}),"max-compat"!==t._config.bundlePolicy&&(l+="a=group:BUNDLE "+t.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),l+="a=ice-options:trickle\r\n",t.transceivers.forEach(function(e,n){l+=i(e,e.localCapabilities,"offer",e.stream,t._dtlsRole),l+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===t.iceGatheringState||0!==n&&t.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,l+="a="+r.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(l+="a=end-of-candidates\r\n"))});var u=new e.RTCSessionDescription({type:"offer",sdp:l});return Promise.resolve(u)},u.prototype.createAnswer=function(){var t=this;if(t._isClosed)return Promise.reject(c("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==t.signalingState&&"have-local-pranswer"!==t.signalingState)return Promise.reject(c("InvalidStateError","Can not call createAnswer in signalingState "+t.signalingState));var s=r.writeSessionBoilerplate(t._sdpSessionId,t._sdpSessionVersion++);t.usingBundle&&(s+="a=group:BUNDLE "+t.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),s+="a=ice-options:trickle\r\n";var o=r.getMediaSections(t._remoteDescription.sdp).length;t.transceivers.forEach(function(e,r){if(!(r+1>o)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?s+="m=application 0 DTLS/SCTP 5000\r\n":s+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?s+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(s+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(s+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var c;if(e.stream)"audio"===e.kind?c=e.stream.getAudioTracks()[0]:"video"===e.kind&&(c=e.stream.getVideoTracks()[0]),c&&n>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1});var l=a(e.localCapabilities,e.remoteCapabilities);!l.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,s+=i(e,l,"answer",e.stream,t._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(s+="a=rtcp-rsize\r\n")}});var l=new e.RTCSessionDescription({type:"answer",sdp:s});return Promise.resolve(l)},u.prototype.addIceCandidate=function(e){var n,t=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(i,a){if(!t._remoteDescription)return a(c("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var s=e.sdpMLineIndex;if(e.sdpMid)for(var l=0;l<t.transceivers.length;l++)if(t.transceivers[l].mid===e.sdpMid){s=l;break}var u=t.transceivers[s];if(!u)return a(c("OperationError","Can not add ICE candidate"));if(u.rejected)return i();var d=Object.keys(e.candidate).length>0?r.parseCandidate(e.candidate):{};if("tcp"===d.protocol&&(0===d.port||9===d.port))return i();if(d.component&&1!==d.component)return i();if((0===s||s>0&&u.iceTransport!==t.transceivers[0].iceTransport)&&!o(u.iceTransport,d))return a(c("OperationError","Can not add ICE candidate"));var h=e.candidate.trim();0===h.indexOf("a=")&&(h=h.substr(2)),(n=r.getMediaSections(t._remoteDescription.sdp))[s]+="a="+(d.type?h:"end-of-candidates")+"\r\n",t._remoteDescription.sdp=r.getDescription(t._remoteDescription.sdp)+n.join("")}else for(var f=0;f<t.transceivers.length&&(t.transceivers[f].rejected||(t.transceivers[f].iceTransport.addRemoteCandidate({}),(n=r.getMediaSections(t._remoteDescription.sdp))[f]+="a=end-of-candidates\r\n",t._remoteDescription.sdp=r.getDescription(t._remoteDescription.sdp)+n.join(""),!t.usingBundle));f++);i()})},u.prototype.getStats=function(n){if(n&&n instanceof e.MediaStreamTrack){var t=null;if(this.transceivers.forEach(function(e){e.rtpSender&&e.rtpSender.track===n?t=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===n&&(t=e.rtpReceiver)}),!t)throw c("InvalidAccessError","Invalid selector.");return t.getStats()}var r=[];return this.transceivers.forEach(function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(n){e[n]&&r.push(e[n].getStats())})}),Promise.all(r).then(function(e){var n=new Map;return e.forEach(function(e){e.forEach(function(e){n.set(e.id,e)})}),n})};["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(n){var t=e[n];if(t&&t.prototype&&t.prototype.getStats){var r=t.prototype.getStats;t.prototype.getStats=function(){return r.apply(this).then(function(e){var n=new Map;return Object.keys(e).forEach(function(t){e[t].type=function(e){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type}(e[t]),n.set(t,e[t])}),n})}}});var d=["createOffer","createAnswer"];return d.forEach(function(e){var n=u.prototype[e];u.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?n.apply(this,[arguments[2]]).then(function(n){"function"==typeof e[0]&&e[0].apply(null,[n])},function(n){"function"==typeof e[1]&&e[1].apply(null,[n])}):n.apply(this,arguments)}}),(d=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(e){var n=u.prototype[e];u.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?n.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)},function(n){"function"==typeof e[2]&&e[2].apply(null,[n])}):n.apply(this,arguments)}}),["getStats"].forEach(function(e){var n=u.prototype[e];u.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?n.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)}):n.apply(this,arguments)}}),u}},function(e,n,t){"use strict";e.exports=function(e){var n=e&&e.navigator,t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return t(e).catch(function(e){return Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}}(e))})}}},function(e,n,t){"use strict";var r=t(4);e.exports={shimGetUserMedia:t(40),shimOnTrack:function(e){"object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(n){var t=new Event("track");t.track=n,t.receiver={track:n},t.transceiver={receiver:t.receiver},t.streams=[e.stream],this.dispatchEvent(t)}.bind(this))}.bind(this))},enumerable:!0,configurable:!0}),"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(e){"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(e){var n=r.detectBrowser(e);if("object"==typeof e&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){e.RTCPeerConnection||(e.RTCPeerConnection=function(t,r){if(n.version<38&&t&&t.iceServers){for(var i=[],a=0;a<t.iceServers.length;a++){var s=t.iceServers[a];if(s.hasOwnProperty("urls"))for(var o=0;o<s.urls.length;o++){var c={url:s.urls[o]};0===s.urls[o].indexOf("turn")&&(c.username=s.username,c.credential=s.credential),i.push(c)}else i.push(t.iceServers[a])}t.iceServers=i}return new e.mozRTCPeerConnection(t,r)},e.RTCPeerConnection.prototype=e.mozRTCPeerConnection.prototype,e.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.mozRTCPeerConnection.generateCertificate}}),e.RTCSessionDescription=e.mozRTCSessionDescription,e.RTCIceCandidate=e.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){var t=e.RTCPeerConnection.prototype[n];e.RTCPeerConnection.prototype[n]=function(){return arguments[0]=new("addIceCandidate"===n?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),t.apply(this,arguments)}});var t=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},a=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,t,r){return a.apply(this,[e||null]).then(function(e){if(n.version<48&&(e=function(e){var n=new Map;return Object.keys(e).forEach(function(t){n.set(t,e[t]),n[t]=e[t]}),n}(e)),n.version<53&&!t)try{e.forEach(function(e){e.type=i[e.type]||e.type})}catch(n){if("TypeError"!==n.name)throw n;e.forEach(function(n,t){e.set(t,Object.assign({},n,{type:i[n.type]||n.type}))})}return e}).then(t,r)}}},shimSenderGetStats:function(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)){var n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=n.apply(e,[]);return t.forEach(function(n){n._pc=e}),t});var t=e.RTCPeerConnection.prototype.addTrack;t&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=t.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}},shimReceiverGetStats:function(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)){var n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=n.apply(e,[]);return t.forEach(function(n){n._pc=e}),t}),r.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},shimRemoveStream:function(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var n=this;r.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(t){t.track&&-1!==e.getTracks().indexOf(t.track)&&n.removeTrack(t)})})},shimRTCDataChannel:function(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)},shimGetDisplayMedia:function(e,n){!e.navigator||!e.navigator.mediaDevices||"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=function(t){if(!t||!t.video){var r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return!0===t.video?t.video={mediaSource:n}:t.video.mediaSource=n,e.navigator.mediaDevices.getUserMedia(t)},e.navigator.getDisplayMedia=function(n){return r.deprecated("navigator.getDisplayMedia","navigator.mediaDevices.getDisplayMedia"),e.navigator.mediaDevices.getDisplayMedia(n)})}}},function(e,n,t){"use strict";var r=t(4),i=r.log;e.exports=function(e){var n=r.detectBrowser(e),t=e&&e.navigator,a=e&&e.MediaStreamTrack,s=function(e){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},o=function(e,r,a){var o=function(e){if("object"!=typeof e||e.require)return e;var n=[];return Object.keys(e).forEach(function(t){if("require"!==t&&"advanced"!==t&&"mediaSource"!==t){var r=e[t]="object"==typeof e[t]?e[t]:{ideal:e[t]};if(void 0===r.min&&void 0===r.max&&void 0===r.exact||n.push(t),void 0!==r.exact&&("number"==typeof r.exact?r.min=r.max=r.exact:e[t]=r.exact,delete r.exact),void 0!==r.ideal){e.advanced=e.advanced||[];var i={};"number"==typeof r.ideal?i[t]={min:r.ideal,max:r.ideal}:i[t]=r.ideal,e.advanced.push(i),delete r.ideal,Object.keys(r).length||delete e[t]}}}),n.length&&(e.require=n),e};return e=JSON.parse(JSON.stringify(e)),n.version<38&&(i("spec: "+JSON.stringify(e)),e.audio&&(e.audio=o(e.audio)),e.video&&(e.video=o(e.video)),i("ff37: "+JSON.stringify(e))),t.mozGetUserMedia(e,r,function(e){a(s(e))})};if(t.mediaDevices||(t.mediaDevices={getUserMedia:function(e){return new Promise(function(n,t){o(e,n,t)})},addEventListener:function(){},removeEventListener:function(){}}),t.mediaDevices.enumerateDevices=t.mediaDevices.enumerateDevices||function(){return new Promise(function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},n.version<41){var c=t.mediaDevices.enumerateDevices.bind(t.mediaDevices);t.mediaDevices.enumerateDevices=function(){return c().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(n.version<49){var l=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return l(e).then(function(n){if(e.audio&&!n.getAudioTracks().length||e.video&&!n.getVideoTracks().length)throw n.getTracks().forEach(function(e){e.stop()}),new DOMException("The object can not be found here.","NotFoundError");return n},function(e){return Promise.reject(s(e))})}}if(!(n.version>55&&"autoGainControl"in t.mediaDevices.getSupportedConstraints())){var u=function(e,n,t){n in e&&!(t in e)&&(e[t]=e[n],delete e[n])},d=t.mediaDevices.getUserMedia.bind(t.mediaDevices);if(t.mediaDevices.getUserMedia=function(e){return"object"==typeof e&&"object"==typeof e.audio&&(e=JSON.parse(JSON.stringify(e)),u(e.audio,"autoGainControl","mozAutoGainControl"),u(e.audio,"noiseSuppression","mozNoiseSuppression")),d(e)},a&&a.prototype.getSettings){var h=a.prototype.getSettings;a.prototype.getSettings=function(){var e=h.apply(this,arguments);return u(e,"mozAutoGainControl","autoGainControl"),u(e,"mozNoiseSuppression","noiseSuppression"),e}}if(a&&a.prototype.applyConstraints){var f=a.prototype.applyConstraints;a.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"==typeof e&&(e=JSON.parse(JSON.stringify(e)),u(e,"autoGainControl","mozAutoGainControl"),u(e,"noiseSuppression","mozNoiseSuppression")),f.apply(this,[e])}}}t.getUserMedia=function(e,i,a){if(n.version<44)return o(e,i,a);r.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),t.mediaDevices.getUserMedia(e).then(i,a)}}},function(e,n,t){"use strict";var r=t(4);e.exports={shimLocalStreamsAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getStreamById=function(e){var n=null;return this._localStreams&&this._localStreams.forEach(function(t){t.id===e&&(n=t)}),this._remoteStreams&&this._remoteStreams.forEach(function(t){t.id===e&&(n=t)}),n}),!("addStream"in e.RTCPeerConnection.prototype)){var n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),-1===this._localStreams.indexOf(e)&&this._localStreams.push(e);var t=this;e.getTracks().forEach(function(r){n.call(t,r,e)})},e.RTCPeerConnection.prototype.addTrack=function(e,t){return t&&(this._localStreams?-1===this._localStreams.indexOf(t)&&this._localStreams.push(t):this._localStreams=[t]),n.call(this,e,t)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);var n=this._localStreams.indexOf(e);if(-1!==n){this._localStreams.splice(n,1);var t=this,r=e.getTracks();this.getSenders().forEach(function(e){-1!==r.indexOf(e.track)&&t.removeTrack(e)})}})}},shimRemoteStreamsAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){this._onaddstream&&this.removeEventListener("addstream",this._onaddstream),this.addEventListener("addstream",this._onaddstream=e)}});var n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(n){n.streams.forEach(function(n){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(n)>=0)){e._remoteStreams.push(n);var t=new Event("addstream");t.stream=n,e.dispatchEvent(t)}})}),n.apply(e,arguments)}}},shimCallbacksAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){var n=e.RTCPeerConnection.prototype,t=n.createOffer,r=n.createAnswer,i=n.setLocalDescription,a=n.setRemoteDescription,s=n.addIceCandidate;n.createOffer=function(e,n){var r=arguments.length>=2?arguments[2]:arguments[0],i=t.apply(this,[r]);return n?(i.then(e,n),Promise.resolve()):i},n.createAnswer=function(e,n){var t=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[t]);return n?(i.then(e,n),Promise.resolve()):i};var o=function(e,n,t){var r=i.apply(this,[e]);return t?(r.then(n,t),Promise.resolve()):r};n.setLocalDescription=o,o=function(e,n,t){var r=a.apply(this,[e]);return t?(r.then(n,t),Promise.resolve()):r},n.setRemoteDescription=o,o=function(e,n,t){var r=s.apply(this,[e]);return t?(r.then(n,t),Promise.resolve()):r},n.addIceCandidate=o}},shimGetUserMedia:function(e){var n=e&&e.navigator;n.getUserMedia||(n.webkitGetUserMedia?n.getUserMedia=n.webkitGetUserMedia.bind(n):n.mediaDevices&&n.mediaDevices.getUserMedia&&(n.getUserMedia=function(e,t,r){n.mediaDevices.getUserMedia(e).then(t,r)}.bind(n)))},shimRTCIceServerUrls:function(e){var n=e.RTCPeerConnection;e.RTCPeerConnection=function(e,t){if(e&&e.iceServers){for(var i=[],a=0;a<e.iceServers.length;a++){var s=e.iceServers[a];!s.hasOwnProperty("urls")&&s.hasOwnProperty("url")?(r.deprecated("RTCIceServer.url","RTCIceServer.urls"),(s=JSON.parse(JSON.stringify(s))).urls=s.url,delete s.url,i.push(s)):i.push(e.iceServers[a])}e.iceServers=i}return new n(e,t)},e.RTCPeerConnection.prototype=n.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return n.generateCertificate}})},shimTrackEventTransceiver:function(e){"object"==typeof e&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimCreateOfferLegacy:function(e){var n=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){var t=this;if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var r=t.getTransceivers().find(function(e){return e.sender.track&&"audio"===e.sender.track.kind});!1===e.offerToReceiveAudio&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveAudio||r||t.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var i=t.getTransceivers().find(function(e){return e.sender.track&&"video"===e.sender.track.kind});!1===e.offerToReceiveVideo&&i?"sendrecv"===i.direction?i.setDirection("sendonly"):"recvonly"===i.direction&&i.setDirection("inactive"):!0!==e.offerToReceiveVideo||i||t.addTransceiver("video")}return n.apply(t,arguments)}}}},function(e,n,t){"use strict";var r=t(18),i=t(4);e.exports={shimRTCIceCandidate:function(e){if(e.RTCIceCandidate&&!(e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var n=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var t=new n(e),i=r.parseCandidate(e.candidate),a=Object.assign(t,i);return a.toJSON=function(){return{candidate:a.candidate,sdpMid:a.sdpMid,sdpMLineIndex:a.sdpMLineIndex,usernameFragment:a.usernameFragment}},a}return new n(e)},e.RTCIceCandidate.prototype=n.prototype,i.wrapPeerConnectionEvent(e,"icecandidate",function(n){return n.candidate&&Object.defineProperty(n,"candidate",{value:new e.RTCIceCandidate(n.candidate),writable:"false"}),n})}},shimCreateObjectURL:function(){},shimMaxMessageSize:function(e){if(!e.RTCSctpTransport&&e.RTCPeerConnection){var n=i.detectBrowser(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,function(e){var n=r.splitSections(e.sdp);return n.shift(),n.some(function(e){var n=r.parseMLine(e);return n&&"application"===n.kind&&-1!==n.protocol.indexOf("SCTP")})}(arguments[0])){var e,i=function(e){var n=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===n||n.length<2)return-1;var t=parseInt(n[1],10);return t!=t?-1:t}(arguments[0]),a=function(e){var t=65536;return"firefox"===n.browser&&(t=n.version<57?-1===e?16384:2147483637:n.version<60?57===n.version?65535:65536:2147483637),t}(i),s=function(e,t){var i=65536;"firefox"===n.browser&&57===n.version&&(i=65535);var a=r.matchPrefix(e.sdp,"a=max-message-size:");return a.length>0?i=parseInt(a[0].substr(19),10):"firefox"===n.browser&&-1!==t&&(i=2147483637),i}(arguments[0],i);e=0===a&&0===s?Number.POSITIVE_INFINITY:0===a||0===s?Math.max(a,s):Math.min(a,s);var o={};Object.defineProperty(o,"maxMessageSize",{get:function(){return e}}),this._sctp=o}return t.apply(this,arguments)}}},shimSendThrowTypeError:function(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=n.apply(this,arguments);return t(e,this),e},i.wrapPeerConnectionEvent(e,"datachannel",function(e){return t(e.channel,e.target),e})}function t(e,n){var t=e.send;e.send=function(){var r=arguments[0],i=r.length||r.size||r.byteLength;if("open"===e.readyState&&n.sctp&&i>n.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+n.sctp.maxMessageSize+" bytes)");return t.apply(e,arguments)}}}}},function(e,n,t){const r=t(5).EventEmitter,i=t(1),a=t(44),s=t(23),o=t(56),c=t(10),l=t(57),u=t(2),d=t(8),h=t(9),f=t(3),p=t(58),g=t(6),b=t(59),v=t(60),m=t(0)("PlivoSIP:UA"),y=t(0)("PlivoSIP:ERROR:UA");y.log=console.warn.bind(console);const _={STATUS_INIT:0,STATUS_READY:1,STATUS_USER_CLOSED:2,STATUS_NOT_READY:3,CONFIGURATION_ERROR:1,NETWORK_ERROR:2};e.exports=class extends r{static get C(){return _}constructor(e){if(m("new() [configuration:%o]",e),super(),this._cache={credentials:{}},this._configuration=Object.assign({},v.settings),this._dynConfiguration={},this._dialogs={},this._applicants={},this._sessions={},this._transport=null,this._contact=null,this._status=_.STATUS_INIT,this._error=null,this._transactions={nist:{},nict:{},ist:{},ict:{}},this._data={},this._closeTimer=null,void 0===e)throw new TypeError("Not enough arguments");try{this._loadConfig(e)}catch(e){throw this._status=_.STATUS_NOT_READY,this._error=_.CONFIGURATION_ERROR,e}this._registrator=new a(this)}get C(){return _}get status(){return this._status}get contact(){return this._contact}get configuration(){return this._configuration}get transport(){return this._transport}start(){m("start()"),this._status===_.STATUS_INIT?this._transport.connect():this._status===_.STATUS_USER_CLOSED?(m("restarting UA"),null!==this._closeTimer&&(clearTimeout(this._closeTimer),this._closeTimer=null,this._transport.disconnect()),this._status=_.STATUS_INIT,this._transport.connect()):this._status===_.STATUS_READY?m("UA is in READY status, not restarted"):m("ERROR: connection is down, Auto-Recovery system is trying to reconnect"),this._dynConfiguration.register=this._configuration.register}register(){m("register()"),this._dynConfiguration.register=!0,this._registrator.register()}unregister(e){m("unregister()"),this._dynConfiguration.register=!1,this._registrator.unregister(e)}registrator(){return this._registrator}isRegistered(){return this._registrator.registered}isConnected(){return this._transport.isConnected()}call(e,n){m("call()");const t=new s(this);return t.connect(e,n),t}sendMessage(e,n,t){m("sendMessage()");const r=new o(this);return r.send(e,n,t),r}terminateSessions(e){m("terminateSessions()");for(const n in this._sessions)this._sessions[n].isEnded()||this._sessions[n].terminate(e)}stop(){if(m("stop()"),this._dynConfiguration={},this._status===_.STATUS_USER_CLOSED)return void m("UA already closed");this._registrator.close();const e=Object.keys(this._sessions).length;for(const e in this._sessions)if(Object.prototype.hasOwnProperty.call(this._sessions,e)){m(`closing session ${e}`);try{this._sessions[e].terminate()}catch(e){}}for(const e in this._applicants)if(Object.prototype.hasOwnProperty.call(this._applicants,e))try{this._applicants[e].close()}catch(e){}this._status=_.STATUS_USER_CLOSED,0===Object.keys(this._transactions.nict).length+Object.keys(this._transactions.nist).length+Object.keys(this._transactions.ict).length+Object.keys(this._transactions.ist).length&&0===e?this._transport.disconnect():this._closeTimer=setTimeout(()=>{this._closeTimer=null,this._transport.disconnect()},2e3)}normalizeTarget(e){return u.normalizeTarget(e,this._configuration.hostport_params)}get(e){switch(e){case"realm":return this._configuration.realm;case"ha1":return this._configuration.ha1;default:return void y('get() | cannot get "%s" parameter in runtime',e)}}set(e,n){switch(e){case"password":this._configuration.password=String(n);break;case"realm":this._configuration.realm=String(n);break;case"ha1":this._configuration.ha1=String(n),this._configuration.password=null;break;case"display_name":if(-1===f.parse(`"${n}"`,"display_name"))return y('set() | wrong "display_name"'),!1;this._configuration.display_name=n;break;default:return y('set() | cannot set "%s" parameter in runtime',e),!1}return!0}newTransaction(e){this._transactions[e.type][e.id]=e,this.emit("newTransaction",{transaction:e})}destroyTransaction(e){delete this._transactions[e.type][e.id],this.emit("transactionDestroyed",{transaction:e})}newDialog(e){this._dialogs[e.id]=e}destroyDialog(e){delete this._dialogs[e.id]}newMessage(e,n){this._applicants[e]=e,this.emit("newMessage",n)}destroyMessage(e){delete this._applicants[e]}newRTCSession(e,n){this._sessions[e.id]=e,this.emit("newRTCSession",n)}destroyRTCSession(e){delete this._sessions[e.id]}registered(e){this.emit("registered",e)}unregistered(e){this.emit("unregistered",e)}registrationFailed(e){this.emit("registrationFailed",e)}receiveRequest(e){const n=e.method;if(e.ruri.user!==this._configuration.uri.user&&e.ruri.user!==this._contact.uri.user)return m("Request-URI does not point to us"),void(e.method!==i.ACK&&e.reply_sl(404));if(e.ruri.scheme===i.SIPS)return void e.reply_sl(416);if(c.checkTransaction(this,e))return;if(n===i.INVITE?new c.InviteServerTransaction(this,this._transport,e):n!==i.ACK&&n!==i.CANCEL&&new c.NonInviteServerTransaction(this,this._transport,e),n===i.OPTIONS)e.reply(200);else if(n===i.MESSAGE){if(0===this.listeners("newMessage").length)return void e.reply(405);new o(this).init_incoming(e)}else if(n===i.INVITE&&!e.to_tag&&0===this.listeners("newRTCSession").length)return void e.reply(405);let t,r;if(e.to_tag)(t=this._findDialog(e.call_id,e.from_tag,e.to_tag))?t.receiveRequest(e):n===i.NOTIFY?(r=this._findSession(e))?r.receiveRequest(e):(m("received NOTIFY request for a non existent subscription"),e.reply(481,"Subscription does not exist")):n!==i.ACK&&e.reply(481);else switch(n){case i.INVITE:if(window.RTCPeerConnection)if(e.hasHeader("replaces")){const n=e.replaces;(t=this._findDialog(n.call_id,n.from_tag,n.to_tag))?(r=t.owner).isEnded()?e.reply(603):r.receiveRequest(e):e.reply(481)}else(r=new s(this)).init_incoming(e);else y("INVITE received but WebRTC is not supported"),e.reply(488);break;case i.BYE:e.reply(481);break;case i.CANCEL:(r=this._findSession(e))?r.receiveRequest(e):m("received CANCEL request for a non existent session");break;case i.ACK:break;default:e.reply(405)}}_findSession({call_id:e,from_tag:n,to_tag:t}){const r=e+n,i=this._sessions[r],a=e+t,s=this._sessions[a];return i||(s||null)}_findDialog(e,n,t){let r=e+n+t,i=this._dialogs[r];return i||(r=e+t+n,(i=this._dialogs[r])||null)}_loadConfig(e){try{v.load(this._configuration,e)}catch(e){throw e}0===this._configuration.display_name&&(this._configuration.display_name="0"),this._configuration.instance_id||(this._configuration.instance_id=u.newUUID()),this._configuration.plivosip_id=u.createRandomToken(5);const n=this._configuration.uri.clone();n.user=null,this._configuration.hostport_params=n.toString().replace(/^sip:/i,"");try{this._transport=new l(this._configuration.sockets,{max_interval:this._configuration.connection_recovery_max_interval,min_interval:this._configuration.connection_recovery_min_interval}),this._transport.onconnecting=function(e){this.emit("connecting",e)}.bind(this),this._transport.onconnect=function(e){if(this._status===_.STATUS_USER_CLOSED)return;this._status=_.STATUS_READY,this._error=null,this.emit("connected",e),this._dynConfiguration.register&&this._registrator.register()}.bind(this),this._transport.ondisconnect=function(e){const n=["nict","ict","nist","ist"];for(const e of n)for(const n in this._transactions[e])Object.prototype.hasOwnProperty.call(this._transactions[e],n)&&this._transactions[e][n].onTransportError();this.emit("disconnected",e),this._registrator.onTransportClosed(),this._status!==_.STATUS_USER_CLOSED&&(this._status=_.STATUS_NOT_READY,this._error=_.NETWORK_ERROR)}.bind(this),this._transport.ondata=function(e){const n=e.transport;let t=e.message;if(!(t=p.parseMessage(t,this)))return;if(this._status===_.STATUS_USER_CLOSED&&t instanceof g.IncomingRequest)return;if(!b(t,this,n))return;if(t instanceof g.IncomingRequest)t.transport=n,this.receiveRequest(t);else if(t instanceof g.IncomingResponse){let e;switch(t.method){case i.INVITE:(e=this._transactions.ict[t.via_branch])&&e.receiveResponse(t);break;case i.ACK:break;default:(e=this._transactions.nict[t.via_branch])&&e.receiveResponse(t)}}}.bind(this)}catch(e){throw y(e),new d.ConfigurationError("sockets",this._configuration.sockets)}if(delete this._configuration.sockets,this._configuration.authorization_user||(this._configuration.authorization_user=this._configuration.uri.user),!this._configuration.registrar_server){const e=this._configuration.uri.clone();e.user=null,e.clearParams(),e.clearHeaders(),this._configuration.registrar_server=e}this._configuration.no_answer_timeout*=1e3,this._configuration.contact_uri?this._configuration.via_host=this._configuration.contact_uri.host:this._configuration.contact_uri=new h("sip",u.createRandomToken(8),this._configuration.via_host,null,{transport:"ws"}),this._contact={pub_gruu:null,temp_gruu:null,uri:this._configuration.contact_uri,toString(e={}){const n=e.anonymous||null,t=e.outbound||null;let r="<";return r+=n?this.temp_gruu||"sip:anonymous@anonymous.invalid;transport=ws":this.pub_gruu||this.uri.toString(),!t||(n?this.temp_gruu:this.pub_gruu)||(r+=";ob"),r+=">"}};const t=["password","realm","ha1","display_name","register"];for(const e in this._configuration)Object.prototype.hasOwnProperty.call(this._configuration,e)&&(-1!==t.indexOf(e)?Object.defineProperty(this._configuration,e,{writable:!0,configurable:!1}):Object.defineProperty(this._configuration,e,{writable:!1,configurable:!1}));m("configuration parameters after validation:");for(const e in this._configuration)if(Object.prototype.hasOwnProperty.call(v.settings,e))switch(e){case"uri":case"registrar_server":m(`- ${e}: ${this._configuration[e]}`);break;case"password":case"ha1":m(`- ${e}: NOT SHOWN`);break;default:m(`- ${e}: ${JSON.stringify(this._configuration[e])}`)}}}},function(e,n,t){const r=t(2),i=t(1),a=t(6),s=t(13),o=t(0)("PlivoSIP:Registrator");e.exports=class{constructor(e,n){this._ua=e,this._transport=n,this._registrar=e.configuration.registrar_server,this._expires=e.configuration.register_expires,this._call_id=r.createRandomToken(22),this._cseq=0,this._to_uri=e.configuration.uri,this._registrationTimer=null,this._registering=!1,this._registered=!1,this._contact=this._ua.contact.toString(),this._contact+=";+sip.ice",this._extraHeaders=[],this._extraContactParams="",this._contact+=";reg-id=1",this._contact+=`;+sip.instance="<urn:uuid:${this._ua.configuration.instance_id}>"`}get registered(){return this._registered}setExtraHeaders(e){Array.isArray(e)||(e=[]),this._extraHeaders=e.slice()}setExtraContactParams(e){e instanceof Object||(e={}),this._extraContactParams="";for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)){const t=e[n];this._extraContactParams+=`;${n}`,t&&(this._extraContactParams+=`=${t}`)}}register(){if(this._registering)return void o("Register request in progress...");const e=this._extraHeaders.slice();e.push(`Contact: ${this._contact};expires=${this._expires}${this._extraContactParams}`),e.push(`Expires: ${this._expires}`);const n=new a.OutgoingRequest(i.REGISTER,this._registrar,this._ua,{to_uri:this._to_uri,call_id:this._call_id,cseq:this._cseq+=1},e),t=new s(this._ua,n,{onRequestTimeout:()=>{this._registrationFailure(null,i.causes.REQUEST_TIMEOUT)},onTransportError:()=>{this._registrationFailure(null,i.causes.CONNECTION_ERROR)},onAuthenticated:()=>{this._cseq+=1},onReceiveResponse:e=>{let n,t,a=e.getHeaders("contact").length;if(e.cseq===this._cseq)switch(null!==this._registrationTimer&&(clearTimeout(this._registrationTimer),this._registrationTimer=null),!0){case/^1[0-9]{2}$/.test(e.status_code):break;case/^2[0-9]{2}$/.test(e.status_code):if(this._registering=!1,!a){o("no Contact header in response to REGISTER, response ignored");break}for(;a--;){if((n=e.parseHeader("contact",a)).uri.user===this._ua.contact.uri.user){t=n.getParam("expires");break}n=null}if(!n){o("no Contact header pointing to us, response ignored");break}!t&&e.hasHeader("expires")&&(t=e.getHeader("expires")),t||(t=this._expires),(t=Number(t))<10&&(t=10),this._registrationTimer=setTimeout(()=>{this._registrationTimer=null,0===this._ua.listeners("registrationExpiring").length?this.register():this._ua.emit("registrationExpiring")},1e3*t-5e3),n.hasParam("temp-gruu")&&(this._ua.contact.temp_gruu=n.getParam("temp-gruu").replace(/"/g,"")),n.hasParam("pub-gruu")&&(this._ua.contact.pub_gruu=n.getParam("pub-gruu").replace(/"/g,"")),this._registered||(this._registered=!0,this._ua.registered({response:e}));break;case/^423$/.test(e.status_code):e.hasHeader("min-expires")?(this._expires=Number(e.getHeader("min-expires")),this._expires<10&&(this._expires=10),this.register()):(o("423 response received for REGISTER without Min-Expires"),this._registrationFailure(e,i.causes.SIP_FAILURE_CODE));break;default:{const n=r.sipErrorCause(e.status_code);this._registrationFailure(e,n)}}}});this._registering=!0,t.send()}unregister(e={}){if(!this._registered)return void o("already unregistered");this._registered=!1,null!==this._registrationTimer&&(clearTimeout(this._registrationTimer),this._registrationTimer=null);const n=this._extraHeaders.slice();e.all?n.push(`Contact: *${this._extraContactParams}`):n.push(`Contact: ${this._contact};expires=0${this._extraContactParams}`),n.push("Expires: 0");const t=new a.OutgoingRequest(i.REGISTER,this._registrar,this._ua,{to_uri:this._to_uri,call_id:this._call_id,cseq:this._cseq+=1},n);new s(this._ua,t,{onRequestTimeout:()=>{this._unregistered(null,i.causes.REQUEST_TIMEOUT)},onTransportError:()=>{this._unregistered(null,i.causes.CONNECTION_ERROR)},onAuthenticated:()=>{this._cseq+=1},onReceiveResponse:e=>{switch(!0){case/^1[0-9]{2}$/.test(e.status_code):break;case/^2[0-9]{2}$/.test(e.status_code):this._unregistered(e);break;default:{const n=r.sipErrorCause(e.status_code);this._unregistered(e,n)}}}}).send()}close(){this._registered&&this.unregister()}onTransportClosed(){this._registering=!1,null!==this._registrationTimer&&(clearTimeout(this._registrationTimer),this._registrationTimer=null),this._registered&&(this._registered=!1,this._ua.unregistered({}))}_registrationFailure(e,n){this._registering=!1,this._ua.registrationFailed({response:e||null,cause:n}),this._registered&&(this._registered=!1,this._ua.unregistered({response:e||null,cause:n}))}_unregistered(e,n){this._registering=!1,this._registered=!1,this._ua.unregistered({response:e||null,cause:n||null})}}},function(e,n,t){var r=function(e){return String(Number(e))===e?Number(e):e},i=function(e,n,t){var i=e.name&&e.names;e.push&&!n[e.push]?n[e.push]=[]:i&&!n[e.name]&&(n[e.name]={});var a=e.push?{}:i?n[e.name]:n;!function(e,n,t,i){if(i&&!t)n[i]=r(e[1]);else for(var a=0;a<t.length;a+=1)null!=e[a+1]&&(n[t[a]]=r(e[a+1]))}(t.match(e.reg),a,e.names,e.name),e.push&&n[e.push].push(a)},a=t(20),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);n.parse=function(e){var n={},t=[],r=n;return e.split(/(\r\n|\r|\n)/).filter(s).forEach(function(e){var n=e[0],s=e.slice(2);"m"===n&&(t.push({rtp:[],fmtp:[]}),r=t[t.length-1]);for(var o=0;o<(a[n]||[]).length;o+=1){var c=a[n][o];if(c.reg.test(s))return i(c,r,s)}}),n.media=t,n};var o=function(e,n){var t=n.split(/=(.+)/,2);return 2===t.length?e[t[0]]=r(t[1]):1===t.length&&n.length>1&&(e[t[0]]=void 0),e};n.parseParams=function(e){return e.split(/;\s?/).reduce(o,{})},n.parseFmtpConfig=n.parseParams,n.parsePayloads=function(e){return e.toString().split(" ").map(Number)},n.parseRemoteCandidates=function(e){for(var n=[],t=e.split(" ").map(r),i=0;i<t.length;i+=3)n.push({component:t[i],ip:t[i+1],port:t[i+2]});return n},n.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(o,{})})},n.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var n,t=!1;return"~"!==e[0]?n=r(e):(n=r(e.substring(1,e.length)),t=!0),{scid:n,paused:t}})})}},function(e,n,t){var r=t(20),i=/%[sdv%]/g,a=function(e,n,t){var r=[e+"="+(n.format instanceof Function?n.format(n.push?t:t[n.name]):n.format)];if(n.names)for(var a=0;a<n.names.length;a+=1){var s=n.names[a];n.name?r.push(t[n.name][s]):r.push(t[n.names[a]])}else r.push(t[n.name]);return function(e){var n=1,t=arguments,r=t.length;return e.replace(i,function(e){if(n>=r)return e;var i=t[n];switch(n+=1,e){case"%%":return"%";case"%s":return String(i);case"%d":return Number(i);case"%v":return""}})}.apply(null,r)},s=["v","o","s","i","u","e","p","c","b","t","r","z","a"],o=["i","c","b","a"];e.exports=function(e,n){n=n||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var t=n.outerOrder||s,i=n.innerOrder||o,c=[];return t.forEach(function(n){r[n].forEach(function(t){t.name in e&&null!=e[t.name]?c.push(a(n,t,e)):t.push in e&&null!=e[t.push]&&e[t.push].forEach(function(e){c.push(a(n,t,e))})})}),e.media.forEach(function(e){c.push(a("m",r.m[0],e)),i.forEach(function(n){r[n].forEach(function(t){t.name in e&&null!=e[t.name]?c.push(a(n,t,e)):t.push in e&&null!=e[t.push]&&e[t.push].forEach(function(e){c.push(a(n,t,e))})})})}),c.join("\r\n")+"\r\n"}},function(e,n,t){var r;function i(e){function t(){if(t.enabled){var e=t,i=+new Date,a=i-(r||i);e.diff=a,e.prev=r,e.curr=i,r=i;for(var s=new Array(arguments.length),o=0;o<s.length;o++)s[o]=arguments[o];s[0]=n.coerce(s[0]),"string"!=typeof s[0]&&s.unshift("%O");var c=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,function(t,r){if("%%"===t)return t;c++;var i=n.formatters[r];if("function"==typeof i){var a=s[c];t=i.call(e,a),s.splice(c,1),c--}return t}),n.formatArgs.call(e,s),(t.log||n.log||console.log.bind(console)).apply(e,s)}}return t.namespace=e,t.enabled=n.enabled(e),t.useColors=n.useColors(),t.color=function(e){var t,r=0;for(t in e)r=(r<<5)-r+e.charCodeAt(t),r|=0;return n.colors[Math.abs(r)%n.colors.length]}(e),"function"==typeof n.init&&n.init(t),t}(n=e.exports=i.debug=i.default=i).coerce=function(e){return e instanceof Error?e.stack||e.message:e},n.disable=function(){n.enable("")},n.enable=function(e){n.save(e),n.names=[],n.skips=[];for(var t=("string"==typeof e?e:"").split(/[\s,]+/),r=t.length,i=0;i<r;i++)t[i]&&("-"===(e=t[i].replace(/\*/g,".*?"))[0]?n.skips.push(new RegExp("^"+e.substr(1)+"$")):n.names.push(new RegExp("^"+e+"$")))},n.enabled=function(e){var t,r;for(t=0,r=n.skips.length;t<r;t++)if(n.skips[t].test(e))return!1;for(t=0,r=n.names.length;t<r;t++)if(n.names[t].test(e))return!0;return!1},n.humanize=t(48),n.names=[],n.skips=[],n.formatters={}},function(e,n){var t=1e3,r=60*t,i=60*r,a=24*i,s=365.25*a;function o(e,n,t){if(!(e<n))return e<1.5*n?Math.floor(e/n)+" "+t:Math.ceil(e/n)+" "+t+"s"}e.exports=function(e,n){n=n||{};var c=typeof e;if("string"===c&&e.length>0)return function(e){if((e=String(e)).length>100)return;var n=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!n)return;var o=parseFloat(n[1]);switch((n[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return o*s;case"days":case"day":case"d":return o*a;case"hours":case"hour":case"hrs":case"hr":case"h":return o*i;case"minutes":case"minute":case"mins":case"min":case"m":return o*r;case"seconds":case"second":case"secs":case"sec":case"s":return o*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}(e);if("number"===c&&!1===isNaN(e))return n.long?function(e){return o(e,a,"day")||o(e,i,"hour")||o(e,r,"minute")||o(e,t,"second")||e+" ms"}(e):function(e){if(e>=a)return Math.round(e/a)+"d";if(e>=i)return Math.round(e/i)+"h";if(e>=r)return Math.round(e/r)+"m";if(e>=t)return Math.round(e/t)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,n,t){const r=t(2),i=t(0)("PlivoSIP:DigestAuthentication"),a=t(0)("PlivoSIP:ERROR:DigestAuthentication");a.log=console.warn.bind(console),e.exports=class{constructor(e){this._credentials=e,this._cnonce=null,this._nc=0,this._ncHex="00000000",this._algorithm=null,this._realm=null,this._nonce=null,this._opaque=null,this._stale=null,this._qop=null,this._method=null,this._uri=null,this._ha1=null,this._response=null}get(e){switch(e){case"realm":return this._realm;case"ha1":return this._ha1;default:return void a('get() | cannot get "%s" parameter',e)}}authenticate({method:e,ruri:n,body:t},s,o=null){if(this._algorithm=s.algorithm,this._realm=s.realm,this._nonce=s.nonce,this._opaque=s.opaque,this._stale=s.stale,this._algorithm){if("MD5"!==this._algorithm)return a('authenticate() | challenge with Digest algorithm different than "MD5", authentication aborted'),!1}else this._algorithm="MD5";if(!this._nonce)return a("authenticate() | challenge without Digest nonce, authentication aborted"),!1;if(!this._realm)return a("authenticate() | challenge without Digest realm, authentication aborted"),!1;if(!this._credentials.password){if(!this._credentials.ha1)return a("authenticate() | no plain SIP password nor ha1 provided, authentication aborted"),!1;if(this._credentials.realm!==this._realm)return a('authenticate() | no plain SIP password, and stored `realm` does not match the given `realm`, cannot authenticate [stored:"%s", given:"%s"]',this._credentials.realm,this._realm),!1}if(s.qop)if(s.qop.indexOf("auth-int")>-1)this._qop="auth-int";else{if(!(s.qop.indexOf("auth")>-1))return a('authenticate() | challenge without Digest qop different than "auth" or "auth-int", authentication aborted'),!1;this._qop="auth"}else this._qop=null;this._method=e,this._uri=n,this._cnonce=o||r.createRandomToken(12),this._nc+=1;const c=Number(this._nc).toString(16);let l;return this._ncHex="00000000".substr(0,8-c.length)+c,4294967296===this._nc&&(this._nc=1,this._ncHex="00000001"),this._credentials.password?this._ha1=r.calculateMD5(`${this._credentials.username}:${this._realm}:${this._credentials.password}`):this._ha1=this._credentials.ha1,"auth"===this._qop?(l=r.calculateMD5(`${this._method}:${this._uri}`),this._response=r.calculateMD5(`${this._ha1}:${this._nonce}:${this._ncHex}:${this._cnonce}:auth:${l}`)):"auth-int"===this._qop?(l=r.calculateMD5(`${this._method}:${this._uri}:${r.calculateMD5(t||"")}`),this._response=r.calculateMD5(`${this._ha1}:${this._nonce}:${this._ncHex}:${this._cnonce}:auth-int:${l}`)):null===this._qop&&(l=r.calculateMD5(`${this._method}:${this._uri}`),this._response=r.calculateMD5(`${this._ha1}:${this._nonce}:${l}`)),i("authenticate() | response generated"),!0}toString(){const e=[];if(!this._response)throw new Error("response field does not exist, cannot generate Authorization header");return e.push(`algorithm=${this._algorithm}`),e.push(`username="${this._credentials.username}"`),e.push(`realm="${this._realm}"`),e.push(`nonce="${this._nonce}"`),e.push(`uri="${this._uri}"`),e.push(`response="${this._response}"`),this._opaque&&e.push(`opaque="${this._opaque}"`),this._qop&&(e.push(`qop=${this._qop}`),e.push(`cnonce="${this._cnonce}"`),e.push(`nc=${this._ncHex}`)),`Digest ${e.join(", ")}`}}},function(e,n,t){const r=t(6),i=t(1),a=t(10),s=t(51),o=t(2),c=t(0)("PlivoSIP:Dialog"),l={STATUS_EARLY:1,STATUS_CONFIRMED:2};e.exports=class{static get C(){return l}constructor(e,n,t,i=l.STATUS_CONFIRMED){if(this._owner=e,this._ua=e._ua,this._uac_pending_reply=!1,this._uas_pending_reply=!1,!n.hasHeader("contact"))return{error:"unable to create a Dialog without Contact header field"};n instanceof r.IncomingResponse&&(i=n.status_code<200?l.STATUS_EARLY:l.STATUS_CONFIRMED);const a=n.parseHeader("contact");"UAS"===t?(this._id={call_id:n.call_id,local_tag:n.to_tag,remote_tag:n.from_tag,toString(){return this.call_id+this.local_tag+this.remote_tag}},this._state=i,this._remote_seqnum=n.cseq,this._local_uri=n.parseHeader("to").uri,this._remote_uri=n.parseHeader("from").uri,this._remote_target=a.uri,this._route_set=n.getHeaders("record-route"),this._ack_seqnum=this._remote_seqnum):"UAC"===t&&(this._id={call_id:n.call_id,local_tag:n.from_tag,remote_tag:n.to_tag,toString(){return this.call_id+this.local_tag+this.remote_tag}},this._state=i,this._local_seqnum=n.cseq,this._local_uri=n.parseHeader("from").uri,this._remote_uri=n.parseHeader("to").uri,this._remote_target=a.uri,this._route_set=n.getHeaders("record-route").reverse(),this._ack_seqnum=null),this._ua.newDialog(this),c(`new ${t} dialog created with status ${this._state===l.STATUS_EARLY?"EARLY":"CONFIRMED"}`)}get id(){return this._id}get local_seqnum(){return this._local_seqnum}set local_seqnum(e){this._local_seqnum=e}get owner(){return this._owner}get uac_pending_reply(){return this._uac_pending_reply}set uac_pending_reply(e){this._uac_pending_reply=e}get uas_pending_reply(){return this._uas_pending_reply}update(e,n){this._state=l.STATUS_CONFIRMED,c(`dialog ${this._id.toString()}  changed to CONFIRMED state`),"UAC"===n&&(this._route_set=e.getHeaders("record-route").reverse())}terminate(){c(`dialog ${this._id.toString()} deleted`),this._ua.destroyDialog(this)}sendRequest(e,n={}){const t=o.cloneArray(n.extraHeaders),r=n.eventHandlers||{},i=n.body||null,a=this._createRequest(e,t,i);return r.onAuthenticated=(()=>{this._local_seqnum+=1}),new s(this,a,r).send(),a}receiveRequest(e){this._checkInDialogRequest(e)&&(e.method===i.ACK&&null!==this._ack_seqnum?this._ack_seqnum=null:e.method===i.INVITE&&(this._ack_seqnum=e.cseq),this._owner.receiveRequest(e))}_createRequest(e,n,t){n=o.cloneArray(n),this._local_seqnum||(this._local_seqnum=Math.floor(1e4*Math.random()));const a=e===i.CANCEL||e===i.ACK?this._local_seqnum:this._local_seqnum+=1;return new r.OutgoingRequest(e,this._remote_target,this._ua,{cseq:a,call_id:this._id.call_id,from_uri:this._local_uri,from_tag:this._id.local_tag,to_uri:this._remote_uri,to_tag:this._id.remote_tag,route_set:this._route_set},n,t)}_checkInDialogRequest(e){if(this._remote_seqnum)if(e.cseq<this._remote_seqnum){if(e.method!==i.ACK)return e.reply(500),!1;if(null===this._ack_seqnum||e.cseq!==this._ack_seqnum)return!1}else e.cseq>this._remote_seqnum&&(this._remote_seqnum=e.cseq);else this._remote_seqnum=e.cseq;if(e.method===i.INVITE||e.method===i.UPDATE&&e.body){if(!0===this._uac_pending_reply)e.reply(491);else{if(!0===this._uas_pending_reply){const n=1+(10*Math.random()|0);return e.reply(500,null,[`Retry-After:${n}`]),!1}{this._uas_pending_reply=!0;const n=()=>{e.server_transaction.state!==a.C.STATUS_ACCEPTED&&e.server_transaction.state!==a.C.STATUS_COMPLETED&&e.server_transaction.state!==a.C.STATUS_TERMINATED||(e.server_transaction.removeListener("stateChanged",n),this._uas_pending_reply=!1)};e.server_transaction.on("stateChanged",n)}}e.hasHeader("contact")&&e.server_transaction.on("stateChanged",()=>{e.server_transaction.state===a.C.STATUS_ACCEPTED&&(this._remote_target=e.parseHeader("contact").uri)})}else e.method===i.NOTIFY&&e.hasHeader("contact")&&e.server_transaction.on("stateChanged",()=>{e.server_transaction.state===a.C.STATUS_COMPLETED&&(this._remote_target=e.parseHeader("contact").uri)});return!0}}},function(e,n,t){const r=t(1),i=t(10),a=t(23),s=t(13),o={onRequestTimeout:()=>{},onTransportError:()=>{},onSuccessResponse:()=>{},onErrorResponse:()=>{},onAuthenticated:()=>{},onDialogError:()=>{}};e.exports=class{constructor(e,n,t){this._dialog=e,this._ua=e._ua,this._request=n,this._eventHandlers=t,this._reattempt=!1,this._reattemptTimer=null;for(const e in o)Object.prototype.hasOwnProperty.call(o,e)&&(this._eventHandlers[e]||(this._eventHandlers[e]=o[e]))}get request(){return this._request}send(){const e=new s(this._ua,this._request,{onRequestTimeout:()=>{this._eventHandlers.onRequestTimeout()},onTransportError:()=>{this._eventHandlers.onTransportError()},onAuthenticated:e=>{this._eventHandlers.onAuthenticated(e)},onReceiveResponse:e=>{this._receiveResponse(e)}});if(e.send(),(this._request.method===r.INVITE||this._request.method===r.UPDATE&&this._request.body)&&e.clientTransaction.state!==i.C.STATUS_TERMINATED){this._dialog.uac_pending_reply=!0;const n=()=>{e.clientTransaction.state!==i.C.STATUS_ACCEPTED&&e.clientTransaction.state!==i.C.STATUS_COMPLETED&&e.clientTransaction.state!==i.C.STATUS_TERMINATED||(e.clientTransaction.removeListener("stateChanged",n),this._dialog.uac_pending_reply=!1)};e.clientTransaction.on("stateChanged",n)}}_receiveResponse(e){408===e.status_code||481===e.status_code?this._eventHandlers.onDialogError(e):e.method===r.INVITE&&491===e.status_code?this._reattempt?e.status_code>=200&&e.status_code<300?this._eventHandlers.onSuccessResponse(e):e.status_code>=300&&this._eventHandlers.onErrorResponse(e):(this._request.cseq.value=this._dialog.local_seqnum+=1,this._reattemptTimer=setTimeout(()=>{this._dialog.owner.status!==a.C.STATUS_TERMINATED&&(this._reattempt=!0,this._request_sender.send())},1e3)):e.status_code>=200&&e.status_code<300?this._eventHandlers.onSuccessResponse(e):e.status_code>=300&&this._eventHandlers.onErrorResponse(e)}}},function(e,n,t){const r=t(5).EventEmitter,i=t(1),a=t(8),s=t(2),o=t(0)("PlivoSIP:RTCSession:DTMF");t(0)("PlivoSIP:ERROR:RTCSession:DTMF").log=console.warn.bind(console);const c={MIN_DURATION:70,MAX_DURATION:6e3,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500};e.exports=class extends r{constructor(e){super(),this._session=e,this._direction=null,this._tone=null,this._duration=null,this._request=null}get tone(){return this._tone}get duration(){return this._duration}send(e,n={}){if(void 0===e)throw new TypeError("Not enough arguments");if(this._direction="outgoing",this._session.status!==this._session.C.STATUS_CONFIRMED&&this._session.status!==this._session.C.STATUS_WAITING_FOR_ACK)throw new a.InvalidStateError(this._session.status);const t=s.cloneArray(n.extraHeaders);if(this.eventHandlers=n.eventHandlers||{},"string"==typeof e)e=e.toUpperCase();else{if("number"!=typeof e)throw new TypeError(`Invalid tone: ${e}`);e=e.toString()}if(!e.match(/^[0-9A-DR#*]$/))throw new TypeError(`Invalid tone: ${e}`);this._tone=e,this._duration=n.duration,t.push("Content-Type: application/dtmf-relay");let r=`Signal=${this._tone}\r\n`;r+=`Duration=${this._duration}`,this._session.newDTMF({originator:"local",dtmf:this,request:this._request}),this._session.sendRequest(i.INFO,{extraHeaders:t,eventHandlers:{onSuccessResponse:e=>{this.emit("succeeded",{originator:"remote",response:e})},onErrorResponse:e=>{this.eventHandlers.onFailed&&this.eventHandlers.onFailed(),this.emit("failed",{originator:"remote",response:e})},onRequestTimeout:()=>{this._session.onRequestTimeout()},onTransportError:()=>{this._session.onTransportError()},onDialogError:()=>{this._session.onDialogError()}},body:r})}init_incoming(e){const n=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/,t=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;if(this._direction="incoming",this._request=e,e.reply(200),e.body){const r=e.body.split("\n");r.length>=1&&n.test(r[0])&&(this._tone=r[0].replace(n,"$2")),r.length>=2&&t.test(r[1])&&(this._duration=parseInt(r[1].replace(t,"$2"),10))}this._duration||(this._duration=c.DEFAULT_DURATION),this._tone?this._session.newDTMF({originator:"remote",dtmf:this,request:e}):o("invalid INFO DTMF received, discarded")}},e.exports.C=c},function(e,n,t){const r=t(5).EventEmitter;t(0)("PlivoSIP:ERROR:RTCSession:Info").log=console.warn.bind(console);const i=t(1),a=t(8),s=t(2);e.exports=class extends r{constructor(e){super(),this._session=e,this._direction=null,this._contentType=null,this._body=null}get contentType(){return this._contentType}get body(){return this._body}send(e,n,t={}){if(this._direction="outgoing",void 0===e)throw new TypeError("Not enough arguments");if(this._session.status!==this._session.C.STATUS_CONFIRMED&&this._session.status!==this._session.C.STATUS_WAITING_FOR_ACK)throw new a.InvalidStateError(this._session.status);this._contentType=e,this._body=n;const r=s.cloneArray(t.extraHeaders);r.push(`Content-Type: ${e}`),this._session.newInfo({originator:"local",info:this,request:this.request}),this._session.sendRequest(i.INFO,{extraHeaders:r,eventHandlers:{onSuccessResponse:e=>{this.emit("succeeded",{originator:"remote",response:e})},onErrorResponse:e=>{this.emit("failed",{originator:"remote",response:e})},onTransportError:()=>{this._session.onTransportError()},onRequestTimeout:()=>{this._session.onRequestTimeout()},onDialogError:()=>{this._session.onDialogError()}},body:n})}init_incoming(e){this._direction="incoming",this.request=e,e.reply(200),this._contentType=e.getHeader("content-type"),this._body=e.body,this._session.newInfo({originator:"remote",info:this,request:e})}}},function(e,n,t){const r=t(1),i=t(0)("PlivoSIP:RTCSession:ReferNotifier"),a="refer",s="message/sipfrag;version=2.0",o=300;e.exports=class{constructor(e,n,t){this._session=e,this._id=n,this._expires=t||o,this._active=!0,this.notify(100)}notify(e,n){if(i("notify()"),!1===this._active)return;let t;n=n||r.REASON_PHRASE[e]||"",t=e>=200?"terminated;reason=noresource":`active;expires=${this._expires}`,this._session.sendRequest(r.NOTIFY,{extraHeaders:[`Event: ${a};id=${this._id}`,`Subscription-State: ${t}`,`Content-Type: ${s}`],body:`SIP/2.0 ${e} ${n}`,eventHandlers:{onErrorResponse(){this._active=!1}}})}}},function(e,n,t){const r=t(5).EventEmitter,i=t(1),a=t(3),s=t(2),o=t(0)("PlivoSIP:RTCSession:ReferSubscriber");e.exports=class extends r{constructor(e){super(),this._id=null,this._session=e}get id(){return this._id}sendRefer(e,n={}){o("sendRefer()");const t=s.cloneArray(n.extraHeaders),r=n.eventHandlers||{};for(const e in r)Object.prototype.hasOwnProperty.call(r,e)&&this.on(e,r[e]);let a=null;n.replaces&&(a=n.replaces._request.call_id,a+=`;to-tag=${n.replaces._to_tag}`,a+=`;from-tag=${n.replaces._from_tag}`,a=encodeURIComponent(a));const c=`Refer-To: <${e}${a?`?Replaces=${a}`:""}>`;t.push(c),t.push(`Contact: ${this._session.contact}`);const l=this._session.sendRequest(i.REFER,{extraHeaders:t,eventHandlers:{onSuccessResponse:e=>{this._requestSucceeded(e)},onErrorResponse:e=>{this._requestFailed(e,i.causes.REJECTED)},onTransportError:()=>{this._requestFailed(null,i.causes.CONNECTION_ERROR)},onRequestTimeout:()=>{this._requestFailed(null,i.causes.REQUEST_TIMEOUT)},onDialogError:()=>{this._requestFailed(null,i.causes.DIALOG_ERROR)}}});this._id=l.cseq}receiveNotify(e){if(o("receiveNotify()"),!e.body)return;const n=a.parse(e.body.trim(),"Status_Line");if(-1!==n)switch(!0){case/^100$/.test(n.status_code):this.emit("trying",{request:e,status_line:n});break;case/^1[0-9]{2}$/.test(n.status_code):this.emit("progress",{request:e,status_line:n});break;case/^2[0-9]{2}$/.test(n.status_code):this.emit("accepted",{request:e,status_line:n});break;default:this.emit("failed",{request:e,status_line:n})}else o(`receiveNotify() | error parsing NOTIFY body: "${e.body}"`)}_requestSucceeded(e){o("REFER succeeded"),o('emit "requestSucceeded"'),this.emit("requestSucceeded",{response:e})}_requestFailed(e,n){o("REFER failed"),o('emit "requestFailed"'),this.emit("requestFailed",{response:e||null,cause:n})}}},function(e,n,t){const r=t(5).EventEmitter,i=t(1),a=t(6),s=t(2),o=t(13),c=t(8),l=t(0)("PlivoSIP:Message");e.exports=class extends r{constructor(e){super(),this._ua=e,this._request=null,this._closed=!1,this._direction=null,this._local_identity=null,this._remote_identity=null,this._is_replied=!1,this._data={}}get direction(){return this._direction}get local_identity(){return this._local_identity}get remote_identity(){return this._remote_identity}send(e,n,t={}){const r=e;if(void 0===e||void 0===n)throw new TypeError("Not enough arguments");if(!(e=this._ua.normalizeTarget(e)))throw new TypeError(`Invalid target: ${r}`);const c=s.cloneArray(t.extraHeaders),l=t.eventHandlers||{},u=t.contentType||"text/plain";for(const e in l)Object.prototype.hasOwnProperty.call(l,e)&&this.on(e,l[e]);c.push(`Content-Type: ${u}`),this._request=new a.OutgoingRequest(i.MESSAGE,e,this._ua,null,c),n&&(this._request.body=n);const d=new o(this._ua,this._request,{onRequestTimeout:()=>{this._onRequestTimeout()},onTransportError:()=>{this._onTransportError()},onReceiveResponse:e=>{this._receiveResponse(e)}});this._newMessage("local",this._request),d.send()}init_incoming(e){this._request=e,this._newMessage("remote",e),this._is_replied||(this._is_replied=!0,e.reply(200)),this._close()}accept(e={}){const n=s.cloneArray(e.extraHeaders),t=e.body;if("incoming"!==this._direction)throw new c.NotSupportedError('"accept" not supported for outgoing Message');if(this._is_replied)throw new Error("incoming Message already replied");this._is_replied=!0,this._request.reply(200,null,n,t)}reject(e={}){const n=e.status_code||480,t=e.reason_phrase,r=s.cloneArray(e.extraHeaders),i=e.body;if("incoming"!==this._direction)throw new c.NotSupportedError('"reject" not supported for outgoing Message');if(this._is_replied)throw new Error("incoming Message already replied");if(n<300||n>=700)throw new TypeError(`Invalid status_code: ${n}`);this._is_replied=!0,this._request.reply(n,t,r,i)}_receiveResponse(e){if(!this._closed)switch(!0){case/^1[0-9]{2}$/.test(e.status_code):break;case/^2[0-9]{2}$/.test(e.status_code):this._succeeded("remote",e);break;default:{const n=s.sipErrorCause(e.status_code);this._failed("remote",e,n);break}}}_onRequestTimeout(){this._closed||this._failed("system",null,i.causes.REQUEST_TIMEOUT)}_onTransportError(){this._closed||this._failed("system",null,i.causes.CONNECTION_ERROR)}_close(){this._closed=!0,this._ua.destroyMessage(this)}_newMessage(e,n){"remote"===e?(this._direction="incoming",this._local_identity=n.to,this._remote_identity=n.from):"local"===e&&(this._direction="outgoing",this._local_identity=n.from,this._remote_identity=n.to),this._ua.newMessage(this,{originator:e,message:this,request:n})}_failed(e,n,t){l("MESSAGE failed"),this._close(),l('emit "failed"'),this.emit("failed",{originator:e,response:n||null,cause:t})}_succeeded(e,n){l("MESSAGE succeeded"),this._close(),l('emit "succeeded"'),this.emit("succeeded",{originator:e,response:n})}}},function(e,n,t){const r=t(24),i=t(0)("PlivoSIP:Transport"),a=t(0)("PlivoSIP:ERROR:Transport");a.log=console.warn.bind(console);const s=0,o=1,c=2,l=0,u=1,d={min_interval:2,max_interval:30};e.exports=class{constructor(e,n=d){if(i("new()"),this.status=c,this.socket=null,this.sockets=[],this.recovery_options=n,this.recover_attempts=0,this.recovery_timer=null,this.close_requested=!1,void 0===e)throw new TypeError("Invalid argument. undefined 'sockets' argument");e instanceof Array||(e=[e]),e.forEach(function(e){if(!r.isSocket(e.socket))throw new TypeError("Invalid argument. invalid 'JsSIP.Socket' instance");if(e.weight&&!Number(e.weight))throw new TypeError("Invalid argument. 'weight' attribute is not a number");this.sockets.push({socket:e.socket,weight:e.weight||0,status:l})},this),this._getSocket()}get via_transport(){return this.socket.via_transport}get url(){return this.socket.url}get sip_uri(){return this.socket.sip_uri}connect(){i("connect()"),this.isConnected()?i("Transport is already connected"):this.isConnecting()?i("Transport is connecting"):(this.close_requested=!1,this.status=o,this.onconnecting({socket:this.socket,attempts:this.recover_attempts}),this.close_requested||(this.socket.onconnect=this._onConnect.bind(this),this.socket.ondisconnect=this._onDisconnect.bind(this),this.socket.ondata=this._onData.bind(this),this.socket.connect()))}disconnect(){i("close()"),this.close_requested=!0,this.recover_attempts=0,this.status=c,null!==this.recovery_timer&&(clearTimeout(this.recovery_timer),this.recovery_timer=null),this.socket.onconnect=(()=>{}),this.socket.ondisconnect=(()=>{}),this.socket.ondata=(()=>{}),this.socket.disconnect(),this.ondisconnect({socket:this.socket,error:!1})}send(e){if(i("send()"),!this.isConnected())return a("unable to send message, transport is not connected"),!1;const n=e.toString();return i(`sending message:\n\n${n}\n`),this.socket.send(n)}isConnected(){return this.status===s}isConnecting(){return this.status===o}_reconnect(){this.recover_attempts+=1;let e=Math.floor(Math.random()*Math.pow(2,this.recover_attempts)+1);e<this.recovery_options.min_interval?e=this.recovery_options.min_interval:e>this.recovery_options.max_interval&&(e=this.recovery_options.max_interval),i(`reconnection attempt: ${this.recover_attempts}. next connection attempt in ${e} seconds`),this.recovery_timer=setTimeout(()=>{this.close_requested||this.isConnected()||this.isConnecting()||(this._getSocket(),this.connect())},1e3*e)}_getSocket(){let e=[];if(this.sockets.forEach(n=>{n.status!==u&&(0===e.length?e.push(n):n.weight>e[0].weight?e=[n]:n.weight===e[0].weight&&e.push(n))}),0===e.length)return this.sockets.forEach(e=>{e.status=l}),void this._getSocket();const n=Math.floor(Math.random()*e.length);this.socket=e[n].socket}_onConnect(){this.recover_attempts=0,this.status=s,null!==this.recovery_timer&&(clearTimeout(this.recovery_timer),this.recovery_timer=null),this.onconnect({socket:this})}_onDisconnect(e,n,t){this.status=c,this.ondisconnect({socket:this.socket,error:e,code:n,reason:t}),this.close_requested||(this.sockets.forEach(function(e){this.socket===e.socket&&(e.status=u)},this),this._reconnect(e))}_onData(e){if("\r\n"!==e){if("string"!=typeof e){try{e=String.fromCharCode.apply(null,new Uint8Array(e))}catch(e){return void i("received binary message failed to be converted into string, message discarded")}i(`received binary message:\n\n${e}\n`)}else i(`received text message:\n\n${e}\n`);this.ondata({transport:this,message:e})}else i("received message with CRLF Keep Alive response")}}},function(e,n,t){const r=t(3),i=t(6),a=t(0)("PlivoSIP:ERROR:Parser");function s(e,n){let t=n,r=0,i=0;if(e.substring(t,t+2).match(/(^\r\n)/))return-2;for(;0===r;){if(-1===(i=e.indexOf("\r\n",t)))return i;!e.substring(i+2,i+4).match(/(^\r\n)/)&&e.charAt(i+2).match(/(^\s+)/)?t=i+2:r=i}return r}function o(e,n,t,a){let s;const o=n.indexOf(":",t),c=n.substring(t,o).trim(),l=n.substring(o+1,a).trim();switch(c.toLowerCase()){case"via":case"v":e.addHeader("via",l),1===e.getHeaders("via").length?(s=e.parseHeader("Via"))&&(e.via=s,e.via_branch=s.branch):s=0;break;case"from":case"f":e.setHeader("from",l),(s=e.parseHeader("from"))&&(e.from=s,e.from_tag=s.getParam("tag"));break;case"to":case"t":e.setHeader("to",l),(s=e.parseHeader("to"))&&(e.to=s,e.to_tag=s.getParam("tag"));break;case"record-route":if(-1===(s=r.parse(l,"Record_Route")))s=void 0;else for(const n of s)e.addHeader("record-route",l.substring(n.possition,n.offset)),e.headers["Record-Route"][e.getHeaders("record-route").length-1].parsed=n.parsed;break;case"call-id":case"i":e.setHeader("call-id",l),(s=e.parseHeader("call-id"))&&(e.call_id=l);break;case"contact":case"m":if(-1===(s=r.parse(l,"Contact")))s=void 0;else for(const n of s)e.addHeader("contact",l.substring(n.possition,n.offset)),e.headers.Contact[e.getHeaders("contact").length-1].parsed=n.parsed;break;case"content-length":case"l":e.setHeader("content-length",l),s=e.parseHeader("content-length");break;case"content-type":case"c":e.setHeader("content-type",l),s=e.parseHeader("content-type");break;case"cseq":e.setHeader("cseq",l),(s=e.parseHeader("cseq"))&&(e.cseq=s.value),e instanceof i.IncomingResponse&&(e.method=s.method);break;case"max-forwards":e.setHeader("max-forwards",l),s=e.parseHeader("max-forwards");break;case"www-authenticate":e.setHeader("www-authenticate",l),s=e.parseHeader("www-authenticate");break;case"proxy-authenticate":e.setHeader("proxy-authenticate",l),s=e.parseHeader("proxy-authenticate");break;case"session-expires":case"x":e.setHeader("session-expires",l),(s=e.parseHeader("session-expires"))&&(e.session_expires=s.expires,e.session_expires_refresher=s.refresher);break;case"refer-to":case"r":e.setHeader("refer-to",l),(s=e.parseHeader("refer-to"))&&(e.refer_to=s);break;case"replaces":e.setHeader("replaces",l),(s=e.parseHeader("replaces"))&&(e.replaces=s);break;case"event":case"o":e.setHeader("event",l),(s=e.parseHeader("event"))&&(e.event=s);break;default:e.setHeader(c,l),s=0}return void 0!==s||{error:`error parsing header "${c}"`}}a.log=console.warn.bind(console),n.parseMessage=((e,n)=>{let t,c,l=e.indexOf("\r\n");if(-1===l)return void a("parseMessage() | no CRLF found, not a SIP message");const u=e.substring(0,l);let d=r.parse(u,"Request_Response");if(-1===d)return void a(`parseMessage() | error parsing first line of SIP message: "${u}"`);d.status_code?((t=new i.IncomingResponse).status_code=d.status_code,t.reason_phrase=d.reason_phrase):((t=new i.IncomingRequest(n)).method=d.method,t.ruri=d.uri),t.data=e;let h=l+2;for(;;){if(-2===(l=s(e,h))){c=h+2;break}if(-1===l)return void a("parseMessage() | malformed message");if(!0!==(d=o(t,e,h,l)))return void a("parseMessage() |",d.error);h=l+2}if(t.hasHeader("content-length")){const n=t.getHeader("content-length");t.body=e.substr(c,n)}else t.body=e.substring(c);return t})},function(e,n,t){const r=t(1),i=t(6),a=t(2),s=t(0)("PlivoSIP:sanityCheck"),o=[function(){const e=["from","to","call_id","cseq","via"];for(const n of e)if(!u.hasHeader(n))return s(`missing mandatory header field : ${n}, dropping the response`),!1}],c=[function(){if("sip"!==u.s("to").uri.scheme)return f(416),!1},function(){if(!u.to_tag&&u.call_id.substr(0,5)===d.configuration.plivosip_id)return f(482),!1},function(){const e=a.str_utf8_length(u.body),n=u.getHeader("content-length");if(e<n)return f(400),!1},function(){const e=u.from_tag,n=u.call_id,t=u.cseq;let i;if(u.to_tag)return;if(u.method===r.INVITE){if(d._transactions.ist[u.via_branch])return!1;for(const r in d._transactions.ist)if(Object.prototype.hasOwnProperty.call(d._transactions.ist,r)&&(i=d._transactions.ist[r]).request.from_tag===e&&i.request.call_id===n&&i.request.cseq===t)return f(482),!1}else{if(d._transactions.nist[u.via_branch])return!1;for(const r in d._transactions.nist)if(Object.prototype.hasOwnProperty.call(d._transactions.nist,r)&&(i=d._transactions.nist[r]).request.from_tag===e&&i.request.call_id===n&&i.request.cseq===t)return f(482),!1}}],l=[function(){if(u.getHeaders("via").length>1)return s("more than one Via header field present in the response, dropping the response"),!1},function(){const e=a.str_utf8_length(u.body),n=u.getHeader("content-length");if(e<n)return s("message body length is lower than the value in Content-Length header field, dropping the response"),!1}];let u,d,h;function f(e){const n=u.getHeaders("via");let t,i=`SIP/2.0 ${e} ${r.REASON_PHRASE[e]}\r\n`;for(const e of n)i+=`Via: ${e}\r\n`;t=u.getHeader("To"),u.to_tag||(t+=`;tag=${a.newTag()}`),i+=`To: ${t}\r\n`,i+=`From: ${u.getHeader("From")}\r\n`,i+=`Call-ID: ${u.call_id}\r\n`,i+=`CSeq: ${u.cseq} ${u.method}\r\n`,i+="\r\n",h.send(i)}e.exports=((e,n,t)=>{u=e,d=n,h=t;for(const e of o)if(!1===e())return!1;if(u instanceof i.IncomingRequest){for(const e of c)if(!1===e())return!1}else if(u instanceof i.IncomingResponse)for(const e of l)if(!1===e())return!1;return!0})},function(e,n,t){const r=t(2),i=t(1),a=t(3),s=t(9),o=t(24),c=t(8);n.settings={authorization_user:null,password:null,realm:null,ha1:null,display_name:null,uri:null,contact_uri:null,instance_id:null,use_preloaded_route:!1,session_timers:!0,session_timers_refresh_method:i.UPDATE,no_answer_timeout:60,register:!0,register_expires:600,registrar_server:null,sockets:null,connection_recovery_max_interval:null,connection_recovery_min_interval:null,via_host:`${r.createRandomToken(12)}.invalid`};const l={mandatory:{sockets(e){const n=[];if(o.isSocket(e))n.push({socket:e});else{if(!Array.isArray(e)||!e.length)return;for(const t of e)Object.prototype.hasOwnProperty.call(t,"socket")&&o.isSocket(t.socket)?n.push(t):o.isSocket(t)&&n.push({socket:t})}return n},uri(e){/^sip:/i.test(e)||(e=`${i.SIP}:${e}`);const n=s.parse(e);return n&&n.user?n:void 0}},optional:{authorization_user:e=>-1===a.parse(`"${e}"`,"quoted_string")?void 0:e,user_agent(e){if("string"==typeof e)return e},connection_recovery_max_interval(e){if(r.isDecimal(e)){const n=Number(e);if(n>0)return n}},connection_recovery_min_interval(e){if(r.isDecimal(e)){const n=Number(e);if(n>0)return n}},contact_uri(e){if("string"==typeof e){const n=a.parse(e,"SIP_URI");if(-1!==n)return n}},display_name:e=>-1===a.parse(`"${e}"`,"display_name")?void 0:e,instance_id:e=>(/^uuid:/i.test(e)&&(e=e.substr(5)),-1===a.parse(e,"uuid")?void 0:e),no_answer_timeout(e){if(r.isDecimal(e)){const n=Number(e);if(n>0)return n}},session_timers(e){if("boolean"==typeof e)return e},session_timers_refresh_method(e){if("string"==typeof e&&((e=e.toUpperCase())===i.INVITE||e===i.UPDATE))return e},password:e=>String(e),realm:e=>String(e),ha1:e=>String(e),register(e){if("boolean"==typeof e)return e},register_expires(e){if(r.isDecimal(e)){const n=Number(e);if(n>0)return n}},registrar_server(e){/^sip:/i.test(e)||(e=`${i.SIP}:${e}`);const n=s.parse(e);return n?n.user?void 0:n:void 0},use_preloaded_route(e){if("boolean"==typeof e)return e}}};n.load=((e,n)=>{for(const t in l.mandatory){if(!n.hasOwnProperty(t))throw new c.ConfigurationError(t);{const r=n[t],i=l.mandatory[t](r);if(void 0===i)throw new c.ConfigurationError(t,r);e[t]=i}}for(const t in l.optional)if(n.hasOwnProperty(t)){const i=n[t];if(r.isEmpty(i))continue;const a=l.optional[t](i);if(void 0===a)throw new c.ConfigurationError(t,i);e[t]=a}})},function(e,n,t){const r=t(3),i=t(0)("PlivoSIP:WebSocketInterface"),a=t(0)("PlivoSIP:ERROR:WebSocketInterface");a.log=console.warn.bind(console),e.exports=class{constructor(e){i('new() [url:"%s"]',e),this._url=e,this._sip_uri=null,this._via_transport=null,this._ws=null;const n=r.parse(e,"absoluteURI");if(-1===n)throw a(`invalid WebSocket URI: ${e}`),new TypeError(`Invalid argument: ${e}`);if("wss"!==n.scheme&&"ws"!==n.scheme)throw a(`invalid WebSocket URI scheme: ${n.scheme}`),new TypeError(`Invalid argument: ${e}`);this._sip_uri=`sip:${n.host}${n.port?`:${n.port}`:""};transport=ws`,this._via_transport=n.scheme.toUpperCase()}get via_transport(){return this._via_transport}set via_transport(e){this._via_transport=e.toUpperCase()}get sip_uri(){return this._sip_uri}get url(){return this._url}connect(){if(i("connect()"),this.isConnected())i(`WebSocket ${this._url} is already connected`);else if(this.isConnecting())i(`WebSocket ${this._url} is connecting`);else{this._ws&&this.disconnect(),i(`connecting to WebSocket ${this._url}`);try{this._ws=new WebSocket(this._url,"sip"),this._ws.binaryType="arraybuffer",this._ws.onopen=this._onOpen.bind(this),this._ws.onclose=this._onClose.bind(this),this._ws.onmessage=this._onMessage.bind(this),this._ws.onerror=this._onError.bind(this)}catch(e){this._onError(e)}}}disconnect(){i("disconnect()"),this._ws&&(this._ws.onopen=(()=>{}),this._ws.onclose=(()=>{}),this._ws.onmessage=(()=>{}),this._ws.onerror=(()=>{}),this._ws.close(),this._ws=null)}send(e){return i("send()"),this.isConnected()?(this._ws.send(e),!0):(a("unable to send message, WebSocket is not open"),!1)}isConnected(){return this._ws&&this._ws.readyState===this._ws.OPEN}isConnecting(){return this._ws&&this._ws.readyState===this._ws.CONNECTING}_onOpen(){i(`WebSocket ${this._url} connected`),this.onconnect()}_onClose({wasClean:e,code:n,reason:t}){i(`WebSocket ${this._url} closed`),!1===e&&i("WebSocket abrupt disconnection");const r={socket:this,error:!e,code:n,reason:t};this.ondisconnect(r)}_onMessage({data:e}){i("received WebSocket message"),this.ondata(e)}_onError(e){a(`WebSocket ${this._url} error: ${e}`)}}},function(e,n,t){(function(e){var r=Object.getOwnPropertyDescriptors||function(e){for(var n=Object.keys(e),t={},r=0;r<n.length;r++)t[n[r]]=Object.getOwnPropertyDescriptor(e,n[r]);return t},i=/%[sdj%]/g;n.format=function(e){if(!v(e)){for(var n=[],t=0;t<arguments.length;t++)n.push(o(arguments[t]));return n.join(" ")}t=1;for(var r=arguments,a=r.length,s=String(e).replace(i,function(e){if("%%"===e)return"%";if(t>=a)return e;switch(e){case"%s":return String(r[t++]);case"%d":return Number(r[t++]);case"%j":try{return JSON.stringify(r[t++])}catch(e){return"[Circular]"}default:return e}}),c=r[t];t<a;c=r[++t])g(c)||!_(c)?s+=" "+c:s+=" "+o(c);return s},n.deprecate=function(t,r){if(void 0!==e&&!0===e.noDeprecation)return t;if(void 0===e)return function(){return n.deprecate(t,r).apply(this,arguments)};var i=!1;return function(){if(!i){if(e.throwDeprecation)throw new Error(r);e.traceDeprecation?console.trace(r):console.error(r),i=!0}return t.apply(this,arguments)}};var a,s={};function o(e,t){var r={seen:[],stylize:l};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),p(t)?r.showHidden=t:t&&n._extend(r,t),m(r.showHidden)&&(r.showHidden=!1),m(r.depth)&&(r.depth=2),m(r.colors)&&(r.colors=!1),m(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=c),u(r,e,r.depth)}function c(e,n){var t=o.styles[n];return t?"["+o.colors[t][0]+"m"+e+"["+o.colors[t][1]+"m":e}function l(e,n){return e}function u(e,t,r){if(e.customInspect&&t&&T(t.inspect)&&t.inspect!==n.inspect&&(!t.constructor||t.constructor.prototype!==t)){var i=t.inspect(r,e);return v(i)||(i=u(e,i,r)),i}var a=function(e,n){if(m(n))return e.stylize("undefined","undefined");if(v(n)){var t="'"+JSON.stringify(n).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(t,"string")}if(b(n))return e.stylize(""+n,"number");if(p(n))return e.stylize(""+n,"boolean");if(g(n))return e.stylize("null","null")}(e,t);if(a)return a;var s=Object.keys(t),o=function(e){var n={};return e.forEach(function(e,t){n[e]=!0}),n}(s);if(e.showHidden&&(s=Object.getOwnPropertyNames(t)),C(t)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return d(t);if(0===s.length){if(T(t)){var c=t.name?": "+t.name:"";return e.stylize("[Function"+c+"]","special")}if(y(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(S(t))return e.stylize(Date.prototype.toString.call(t),"date");if(C(t))return d(t)}var l,_="",w=!1,E=["{","}"];(f(t)&&(w=!0,E=["[","]"]),T(t))&&(_=" [Function"+(t.name?": "+t.name:"")+"]");return y(t)&&(_=" "+RegExp.prototype.toString.call(t)),S(t)&&(_=" "+Date.prototype.toUTCString.call(t)),C(t)&&(_=" "+d(t)),0!==s.length||w&&0!=t.length?r<0?y(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),l=w?function(e,n,t,r,i){for(var a=[],s=0,o=n.length;s<o;++s)R(n,String(s))?a.push(h(e,n,t,r,String(s),!0)):a.push("");return i.forEach(function(i){i.match(/^\d+$/)||a.push(h(e,n,t,r,i,!0))}),a}(e,t,r,o,s):s.map(function(n){return h(e,t,r,o,n,w)}),e.seen.pop(),function(e,n,t){if(e.reduce(function(e,n){return 0,n.indexOf("\n")>=0&&0,e+n.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return t[0]+(""===n?"":n+"\n ")+" "+e.join(",\n  ")+" "+t[1];return t[0]+n+" "+e.join(", ")+" "+t[1]}(l,_,E)):E[0]+_+E[1]}function d(e){return"["+Error.prototype.toString.call(e)+"]"}function h(e,n,t,r,i,a){var s,o,c;if((c=Object.getOwnPropertyDescriptor(n,i)||{value:n[i]}).get?o=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(o=e.stylize("[Setter]","special")),R(r,i)||(s="["+i+"]"),o||(e.seen.indexOf(c.value)<0?(o=g(t)?u(e,c.value,null):u(e,c.value,t-1)).indexOf("\n")>-1&&(o=a?o.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+o.split("\n").map(function(e){return"   "+e}).join("\n")):o=e.stylize("[Circular]","special")),m(s)){if(a&&i.match(/^\d+$/))return o;(s=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+o}function f(e){return Array.isArray(e)}function p(e){return"boolean"==typeof e}function g(e){return null===e}function b(e){return"number"==typeof e}function v(e){return"string"==typeof e}function m(e){return void 0===e}function y(e){return _(e)&&"[object RegExp]"===w(e)}function _(e){return"object"==typeof e&&null!==e}function S(e){return _(e)&&"[object Date]"===w(e)}function C(e){return _(e)&&("[object Error]"===w(e)||e instanceof Error)}function T(e){return"function"==typeof e}function w(e){return Object.prototype.toString.call(e)}function E(e){return e<10?"0"+e.toString(10):e.toString(10)}n.debuglog=function(t){if(m(a)&&(a=e.env.NODE_DEBUG||""),t=t.toUpperCase(),!s[t])if(new RegExp("\\b"+t+"\\b","i").test(a)){var r=e.pid;s[t]=function(){var e=n.format.apply(n,arguments);console.error("%s %d: %s",t,r,e)}}else s[t]=function(){};return s[t]},n.inspect=o,o.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},o.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},n.isArray=f,n.isBoolean=p,n.isNull=g,n.isNullOrUndefined=function(e){return null==e},n.isNumber=b,n.isString=v,n.isSymbol=function(e){return"symbol"==typeof e},n.isUndefined=m,n.isRegExp=y,n.isObject=_,n.isDate=S,n.isError=C,n.isFunction=T,n.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},n.isBuffer=t(63);var k=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function R(e,n){return Object.prototype.hasOwnProperty.call(e,n)}n.log=function(){console.log("%s - %s",function(){var e=new Date,n=[E(e.getHours()),E(e.getMinutes()),E(e.getSeconds())].join(":");return[e.getDate(),k[e.getMonth()],n].join(" ")}(),n.format.apply(n,arguments))},n.inherits=t(64),n._extend=function(e,n){if(!n||!_(n))return e;for(var t=Object.keys(n),r=t.length;r--;)e[t[r]]=n[t[r]];return e};var I="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function P(e,n){if(!e){var t=new Error("Promise was rejected with a falsy value");t.reason=e,e=t}return n(e)}n.promisify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');if(I&&e[I]){var n;if("function"!=typeof(n=e[I]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(n,I,{value:n,enumerable:!1,writable:!1,configurable:!0}),n}function n(){for(var n,t,r=new Promise(function(e,r){n=e,t=r}),i=[],a=0;a<arguments.length;a++)i.push(arguments[a]);i.push(function(e,r){e?t(e):n(r)});try{e.apply(this,i)}catch(e){t(e)}return r}return Object.setPrototypeOf(n,Object.getPrototypeOf(e)),I&&Object.defineProperty(n,I,{value:n,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(n,r(e))},n.promisify.custom=I,n.callbackify=function(n){if("function"!=typeof n)throw new TypeError('The "original" argument must be of type Function');function t(){for(var t=[],r=0;r<arguments.length;r++)t.push(arguments[r]);var i=t.pop();if("function"!=typeof i)throw new TypeError("The last argument must be of type Function");var a=this,s=function(){return i.apply(a,arguments)};n.apply(this,t).then(function(n){e.nextTick(s,null,n)},function(n){e.nextTick(P,n,s)})}return Object.setPrototypeOf(t,Object.getPrototypeOf(n)),Object.defineProperties(t,r(n)),t}}).call(this,t(21))},function(e,n){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,n){"function"==typeof Object.create?e.exports=function(e,n){e.super_=n,e.prototype=Object.create(n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,n){e.super_=n;var t=function(){};t.prototype=n.prototype,e.prototype=new t,e.prototype.constructor=e}},function(e,n){e.exports.DOMAIN="phone.plivo.com",e.exports.WS_SERVERS="wss://phone.plivo.com:5063",e.exports.S3BUCKET_API_URL="https://stats.plivo.com/v1/browser/bucketurl/",e.exports.SDKVERSION_API_URL="https://stats.plivo.com/v1/browser/websdkversion/",e.exports.STATSSOCKET_URL="wss://insights.plivo.com/ws",e.exports.STATS_API_URL="https://stats.plivo.com/v1/browser/validate/"},function(e,n){e.exports=function(e,n){function t(e,n){var t=new RegExp("a=rtpmap:.* "+e+"(.*)","ig");return!!n.match(t)&&n.match(t)[0].split(" ")[0].match(/\d+/)}if(e.length>0){var r=["OPUS","G722","PCMA","PCMU","ISAC","CN"],i="";e.forEach(function(e){var a=r.indexOf(e);a>-1&&r.splice(a,1);var s=t(e,n);s&&(i+=s+" ")}),i=i.slice(0,-1),n=n.replace(n.match(/m=audio .*[a-z] (.*)/i)[1],i),n=function(e,n){var r;return e.forEach(function(e){var i=t(e,n);r=new RegExp("\na=rtpmap:.*"+e+"/.*","ig"),n=n.replace(r,""),r=new RegExp("\na=fmtp:"+i+" (.*)","ig"),n=n.replace(r,""),r=new RegExp("\na=rtcp-fb:"+i+" (.*)","ig"),n=n.replace(r,"")}),n}(r,n)}return n}},function(e,n,t){const r={log:t(7)};e.exports=function(e,n,t){var i=this;function a(n,a,s){var o=i.storage[n];if(2==o.length){o.push(Number(a));var c={},l=null;for(var u in o.forEach(function(e){c[e]=c[e]+1||1}),c)c[u]>=2&&(l=Number(u));"number"==typeof l?(i.storage.warning[n]=!0,l>1?r.log.debug("Same audioLevel detected for "+n+" : ",i.str(o)):r.log.debug("Audio mute detected for "+n+" : ",i.str(o)),t&&"local_audio"==n||e.call(i,"audio","warning","no_audio_received",l,!0,n,s)):i.storage.warning[n]&&(i.storage.warning[n]=!1,e.call(i,"audio","warning","no_audio_received",0,!1,n,s))}else o.push(Number(a));3==o.length&&o.splice(0,2)}function s(n,t,a){t=Number(t);var s=i.storage[n];if(2==s.length){s.push(t);var o=s.filter(function(e,n){return e>30});if(o.length>=2){var c=o.reduce(function(e,n){return e+n})/o.length;i.storage.warning[n]=!0,r.log.debug(n+" : getting high jitter rate : ",i.str(o)),e.call(i,"network","warning","high_jitter",c,!0,n,a)}else i.storage.warning[n]&&(i.storage.warning[n]=!1,e.call(i,"network","warning","high_jitter",0,!1,n,a))}else s.push(t);3==s.length&&s.splice(0,2)}function o(n,t,a){t=Number(t);var s=i.storage[n];if(2==s.length){s.push(t);var o=s.filter(function(e,n){return"opus"==i.storage.audioCodec?e>=.1:e>=.02});if(o.length>=2){var c=o.reduce(function(e,n){return e+n})/o.length;c=c.toFixed(3),i.storage.warning[n]=!0,r.log.debug(n+" : ploss score value is high :",i.str(o)),e.call(i,"network","warning","high_packetloss",c,!0,n,a)}else i.storage.warning[n]&&(i.storage.warning[n]=!1,e.call(i,"network","warning","high_packetloss",0,!1,n,a))}else s.push(t);3==s.length&&s.splice(0,2)}i.storage&&i.storage.startAnalysis&&(n.local&&(function(n,t){t=Number(t);var a=i.storage[n];if(2==a.length){a.push(t);var s=a.filter(function(e,n){return e>400});if(s.length>=2){var o=(s.reduce(function(e,n){return e+n})/s.length).toFixed(2);i.storage.warning[n]=!0,r.log.debug(n+" : getting high rtt  : ",i.str(s)),e.call(i,"network","warning","high_rtt",o,!0,"high latency","None")}else i.storage.warning[n]&&(i.storage.warning[n]=!1,e.call(i,"network","warning","high_rtt",0,!1,"high latency","None"))}else a.push(t);3==a.length&&a.splice(0,2)}("rtt",n.local.rtt),s("jitterLocalMeasures",n.local.jitter,"local"),function(n,t){var a=i.storage[n];if(2==a.length){a.push(t);var s=a.filter(function(e,n){return e<3.5});s.length>=2?(i.storage.warning[n]=!0,r.log.debug(n+" : getting low mos : ",i.str(a)),e.call(i,"network","warning","low_mos",s[0],!0,n,"None")):i.storage.warning[n]&&(i.storage.warning[n]=!1,e.call(i,"network","warning","low_mos",0,!1,n,"None"))}else a.push(t);3==a.length&&a.splice(0,2)}("mosRemoteMeasures",n.local.mos),o("packetLossLocalMeasures",n.local.fractionLoss,"local"),a("local_audio",n.local.audioLevel,"local")),n.remote&&(s("jitterRemoteMeasures",n.remote.jitter,"remote"),o("packetLossRemoteMeasures",n.remote.fractionLoss,"remote"),a("remote_audio",n.remote.audioLevel,"remote")))}},function(e,n,t){var r=t(11),i=t(17),a=t(7),s=(t(16),null),o=null,c=null,l=new i;const u={log:a,audioConstraints:{}};let d=[],h={},f={},p=null;var g=function(e){return new Promise(function(n,t){navigator.mediaDevices.enumerateDevices().then(function(t){var r=[];t.filter(function(n){"input"==e?"audioinput"==n.kind&&r.push(n):"output"==e?"audiooutput"==n.kind&&r.push(n):/video/i.test(n.kind)||r.push(n)}),n(r)}).catch(function(e){t(e)})})},b={set:function(e){if("string"!=typeof e)return u.log.error("deviceId should be string"),!1;if(!d.filter(n=>n.deviceId===e&&"audioinput"===n.kind).length)return u.log.error("Invalid input device Id"),!1;if("object"==typeof u.audioConstraints&&"optional"in u.audioConstraints){let n=!1;u.audioConstraints.optional.forEach(t=>{t.sourceId&&(t.sourceId=e,n=!0)}),n||u.audioConstraints.optional.push({sourceId:e}),function(e){for(deviceObject of e)"audioinput"==deviceObject.kind&&(h[deviceObject.deviceId]=deviceObject.groupId,f[deviceObject.groupId]=deviceObject.deviceId)}(d),s.getPeerConnection().pc&&("default"==e?(groupId=h[e],e=f[groupId],u.log.debug(e),_(e,s,"added")):_(e,s,"added"))}else"boolean"==typeof u.audioConstraints?u.audioConstraints={deviceId:e}:u.audioConstraints.deviceId=e;return!0},get:function(){if(u.audioConstraints.optional){var e=u.audioConstraints.optional.filter(function(e){return e.sourceId});return e.length>0?e[0].sourceId:""}return u.audioConstraints.deviceId?u.audioConstraints.deviceId:""},reset:function(){return u.audioConstraints.optional?u.audioConstraints.optional=u.audioConstraints.optional.filter(function(e){return!e.sourceId}):u.audioConstraints.deviceId&&delete u.audioConstraints.deviceId,!0}},v={set:function(e){return d.filter(n=>n.deviceId===e&&"audiooutput"===n.kind).length?(document.querySelectorAll('[data-devicetype="speakerDevice"]').forEach(function(n){n.setSinkId&&n.setSinkId(e)}),!0):(u.log.error("Invalid output device Id"),!1)},get:function(){var e=document.querySelector('[data-devicetype="speakerDevice"]');if(e.sinkId)return e.sinkId},reset:function(){return document.querySelectorAll('[data-devicetype="speakerDevice"]').forEach(function(e){e.setSinkId&&e.setSinkId("")}),!0},media:function(e){var n={dtmf:"dtmfstar",ringback:r.RINGBACK_ELEMENT_ID};return e&&e in n?document.getElementById(n[e]):document.getElementById(r.RINGBACK_ELEMENT_ID)}},m={set:function(e){if(!d.filter(n=>n.deviceId===e&&"audiooutput"===n.kind).length)return u.log.error("Invalid output device Id"),!1;var n=document.getElementById(r.RINGTONE_ELEMENT_ID);return n.setSinkId&&n.setSinkId(e),!0},get:function(){var e=document.getElementById(r.RINGTONE_ELEMENT_ID);if(e.sinkId)return e.sinkId},reset:function(){var e=document.getElementById(r.RINGTONE_ELEMENT_ID);return e.setSinkId&&e.setSinkId(""),!0},media:function(){return document.getElementById(r.RINGTONE_ELEMENT_ID)}},y=function(e){return new Promise(function(n,t){g().then(function(t){var r=[];let i=!1;t.forEach(function(e){if(e.label){var n=JSON.stringify(e);r.push(n),i=!0}else r=null}),e?(i&&(d=t),p&&p(r),n(!0)):n({devices:t,audioRef:r})}).catch(function(e){u.log.error("Error availableDevices() ",e),t(e)})})},_=function(e,n,t){u.log.debug("inside replacetrack device id  : "+e),sender=null;var r=null;n._currentSession?(r=n._currentSession.session.connection,constraints="added"==t?{audio:{deviceId:e?{exact:e}:void 0},video:!1}:{audio:!0,video:!1},navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(constraints).then(function(e){return e}).then(function(e){r&&(sender=r.getSenders()[0],o&&(o.getTracks().forEach(e=>e.stop()),o=null),sender&&(sender.replaceTrack(e.getAudioTracks()[0]),u.log.debug("replaced sender : "+sender),o=e,0==c&&C(n)))}).then(function(){w()}).then(function(){T(n)}).catch(function(e){u.log.error(e)}):u.debug.log("no getUserMedia support")):o&&o.getTracks().forEach(e=>e.stop())},S=function(){that=this,o?o.getAudioTracks()[0].enabled=!1:this._currentSession.session.mute(),c=!1},C=function(e){S()},T=function(e){if(e._currentSession){var n=e._currentSession.session.connection,t=null,r=n.getRemoteStreams()[0];o?(t=o,setTimeout(function(){l.start(e,t,r)},3e3)):(t=n.getLocalStreams()[0],l.start(e,t,r))}},w=function(){setTimeout(function(){window._localContext&&window._localContext.suspend(),l&&l.stop()},3e3)};e.exports.inputDevices=b,e.exports.outputDevices=v,e.exports.ringtoneDevices=m,e.exports.revealAudioDevices=function(e){return new Promise(function(n,t){navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(t){"returnStream"==e?n(t):(t.getTracks().forEach(function(e){e.stop()}),n("success"))}).catch(function(e){u.log.error("failed to get user media :: "+e.name),t(e.name)}):t("no getUserMedia support")})},e.exports.availableDevices=g,e.exports.audioDevDictionary=y,e.exports.checkAudioDevChange=function(){var e=this;isIE=!!document.documentMode,isEdge=!isIE&&!!window.StyleMedia,isChrome=!(!window.chrome||!window.chrome.webstore&&!window.chrome.runtime),isFirefox="undefined"!=typeof InstallTrigger,y().then(function(n){const t=n.devices,r=n.audioRef;d&&t&&(t.forEach(function(n){if(!d.filter(e=>e.deviceId===n.deviceId).length){let t=s.audio.microphoneDevices.get();""!=t&&"default"!=t||u.log.debug("last connected device"+t),/default/i.test(n.deviceId)||(e.emit("audioDeviceChange",{change:"added",device:n}),"audioinput"!=n.kind||""!=t&&"default"!=t||((isEdge||isChrome)&&_(n.deviceId,e,"added"),isFirefox&&n.deviceId))}}),d.forEach(function(n){t.filter(e=>e.deviceId===n.deviceId).length||/default/i.test(n.deviceId)||(e.emit("audioDeviceChange",{change:"removed",device:n}),"audioinput"==n.kind&&((isEdge||isChrome)&&_(n.deviceId,e,"removed"),isFirefox&&n.deviceId))})),d||e.emit("audioDeviceChange",{change:"",device:""}),t&&(d=t,p&&p(r))}).catch(function(e){u.log.error("Error checkAudioDevChange() ",e)})},e.exports.setAudioContraints=function(e){s=e,u.audioConstraints=s.audioConstraints},e.exports.audioDevDicSetter=function(e){p=e},e.exports.mute=S,e.exports.unmute=function(){o?o.getAudioTracks()[0].enabled=!0:this._currentSession.session.unmute(),c=!0},e.exports.updateAudioDeviceFlags=function(){o&&o.getTracks().forEach(e=>e.stop()),o=null},e.exports.startVolumeDataStreaming=T,e.exports.stopVolumeDataStreaming=w},function(e,n,t){"use strict";var r=t(11);const i={log:t(7)};var a=function(e,n){navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({audio:e,video:!1}).then(function(e){window.localStream=e,i.log.debug("getUserMedia success"),n({status:"success",stream:!0})}).catch(function(e){i.log.error("failed to get user media :: "+e.name),n({status:"failure",error:e.name})}):(i.log.error("getUserMedia not available"),n({status:"failure",error:"getUserMedia not supported"}))};e.exports.setup=function(e,n){var t=document.createElement("audio");t.id=r.REMOTE_VIEW_ID,t.hidden=!0,t.autoplay=!0,t.width=0,t.height=0,t.setAttribute("data-devicetype","speakerDevice"),document.body.appendChild(t);var i=document.createElement("audio");i.id=r.CONNECT_TONE_ELEMENT_ID,i.loop="loop",i.src=r.CONNECT_TONE_URL,i.setAttribute("data-devicetype","speakerDevice"),document.body.appendChild(i);var s=document.createElement("audio");s.id=r.RINGBACK_ELEMENT_ID,s.loop="loop",s.src=r.RINGBACK_URL,s.setAttribute("data-devicetype","speakerDevice"),document.body.appendChild(s);var o=document.createElement("audio");o.id=r.RINGTONE_ELEMENT_ID,o.loop="loop",o.src=r.RINGTONE_URL,o.setAttribute("data-devicetype","ringtoneDevice"),document.body.appendChild(o);for(var c="https://cdn.plivo.com/sdk/browser/audio/dtmf-",l=function(e,n,t){var r="dtmf"+n,i=e+n+"."+t,a=document.createElement("audio");a.id=r,a.src=i,a.setAttribute("data-devicetype","speakerDevice"),document.body.appendChild(a)},u=0;u<=9;u++)l(c,u,"mp3");l(c,"star","mp3"),l(c,"pound","mp3"),e.permOnClick?(window.localStream=null,n({status:"success",stream:!1})):a(e.audioConstraints,function(e){n(e)})},e.exports.getLocalMedia=a,e.exports.playAudio=function(e){try{const n=document.getElementById(e);n.currentTime=0,n.play(),i.log.debug("playAudio - "+e)}catch(n){i.log.debug("failed to play audio for elementId "+e+" Cause: "+n)}},e.exports.stopAudio=function(e){try{document.getElementById(e).pause(),i.log.debug("stopAudio - "+e)}catch(n){i.log.debug("failed to stop audio for elementId "+e+" Cause: "+n)}},e.exports.maskPage=function(){var e=document.createElement("div");e.id="plivo_mask",document.body.insertBefore(e,document.body.firstChild),e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.background="#000",e.style.opacity="0.8",e.style.filter="alpha(opacity=80)",e.style.zindex="50"}},function(e,n,t){"use strict";var r=function(e){if(!e.toUpperCase().startsWith("X-PH"))return!1;return!1!==/^([a-z0-9A-Z\-]){1,19}$/.test(e.substr(5))},i=function(e){return!1!==/^([a-z0-9A-Z_\-\+\(\)%]){1,120}$/.test(e)};e.exports.checkExtraHeaderKey=r,e.exports.checkExtraHeaderVal=i,e.exports.receiveExtraHeader=function(e,n){var t={};for(var a in n){var s=e.getHeader(a);r(a)&&i(s)&&(t[a]=s)}return t}},function(e,n,t){const r={log:t(7)};e.exports={codecs:function(e,n){if("[object Array]"==Object.prototype.toString.call(e)){var t=!0;return e.forEach(function(e){-1==n.indexOf(e)&&(t=!1,r.log.warn("Ignoring invalid codec - ",e),r.log.debug("Allowed list: ",n))}),!!t}return r.log.error("Please send codecs in Array. Eg:",n),!1},isBoolean:function(e,n){return"boolean"==typeof n||(r.log.error(e+" has to be boolean. "+n+" is not accepted"),!1)},isNumber:function(e,n){return"number"==typeof n||(r.log.error(e+" has to be number. "+n+" is not accepted"),!1)},debug:function(e,n){return-1!=n.indexOf(e)||(r.log.error("debug method "+e+" is not allowed"),r.log.debug("Allowed list for debug: ",n),!1)},region:function(e,n){return-1!=n.indexOf(e)||(r.log.error("region name "+e+" is not allowed"),r.log.debug("Allowed list for regions: ",n),!1)}}},function(e,n,t){var r,i,a;i=[],void 0===(a="function"==typeof(r=function(){var e=/^v?(?:\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+))?(?:-[\da-z\-]+(?:\.[\da-z\-]+)*)?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i;function n(e){var n=e.replace(/^v/,"").replace(/\+.*$/,""),t=function(e,n){return-1===e.indexOf(n)?e.length:e.indexOf(n)}(n,"-"),r=n.substring(0,t).split(".");return r.push(n.substring(t+1)),r}function t(e){return isNaN(Number(e))?e:Number(e)}function r(n){if("string"!=typeof n)throw new TypeError("Invalid argument expected string");if(!e.test(n))throw new Error("Invalid argument not valid semver ('"+n+"' received)")}function i(e,i){[e,i].forEach(r);for(var a=n(e),s=n(i),o=0;o<Math.max(a.length-1,s.length-1);o++){var c=parseInt(a[o]||0,10),l=parseInt(s[o]||0,10);if(c>l)return 1;if(l>c)return-1}var u=a[a.length-1],d=s[s.length-1];if(u&&d){var h=u.split(".").map(t),f=d.split(".").map(t);for(o=0;o<Math.max(h.length,f.length);o++){if(void 0===h[o]||"string"==typeof f[o]&&"number"==typeof h[o])return-1;if(void 0===f[o]||"string"==typeof h[o]&&"number"==typeof f[o])return 1;if(h[o]>f[o])return 1;if(f[o]>h[o])return-1}}else if(u||d)return u?-1:1;return 0}var a=[">",">=","=","<","<="],s={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1]};return i.validate=function(n){return"string"==typeof n&&e.test(n)},i.compare=function(e,n,t){!function(e){if("string"!=typeof e)throw new TypeError("Invalid operator type, expected string but got "+typeof e);if(-1===a.indexOf(e))throw new TypeError("Invalid operator, expected one of "+a.join("|"))}(t);var r=i(e,n);return s[t].indexOf(r)>-1},i})?r.apply(n,i):r)||(e.exports=a)},function(e,n){function t(e){this._STATE={INITIALIZED:"initialized",RINGING:"ringing",ANSWERED:"answered",REJECTED:"rejected",IGNORED:"ignored",CANCELED:"canceled",FAILED:"failed",ENDED:"ended"},this.callUUID=e.callUUID,this.sipCallID=e.sipCallID,this.direction=e.direction,this.src=e.src,this.dest=e.dest,this.state=this._STATE.INITIALIZED,this.extraHeaders=e.extraHeaders,this.session=e.session,this.connectionStages=[],this.gotInitalIce=!1,this._stats=null,this.signallingInfo={},this.mediaConnectionInfo={},e.call_initiation_time&&(this.signallingInfo.call_initiation_time=e.call_initiation_time),this.postDialDelayEndTime}t.prototype.setCallState=function(){this._connectionStages=[]},t.prototype.setCallUUID=function(e){this.callUUID=e},t.prototype.setState=function(e){this.state=e},t.prototype.addConnectionStage=function(e){this.connectionStages.push(e)},t.prototype.getConnectionStages=function(){return this.connectionStages},t.prototype.setCallStats=function(e){this._stats=e},t.prototype.clearCallStats=function(){this._stats&&(clearInterval(this._stats.statsTimer),this._stats.stop(),this._stats=null)},t.prototype.updateSignallingInfo=function(e){this.signallingInfo=Object.assign(this.signallingInfo,e)},t.prototype.updateMediaConnectionInfo=function(e){this.mediaConnectionInfo=Object.assign(this.mediaConnectionInfo,e)},t.prototype.getSignallingInfo=function(){return Object.assign(this.signallingInfo,{post_dial_delay:this.postDialDelayEndTime-this.signallingInfo.call_initiation_time})},t.prototype.getMediaConnectionInfo=function(){return Object.assign(this.mediaConnectionInfo,{})},t.prototype.setPostDialDelayEndTime=function(e){this.postDialDelayEndTime||(this.postDialDelayEndTime=e)},t.prototype.getCallInfo=function(){return{callUUID:this.callUUID,direction:this.direction,src:this.src,dest:this.dest,state:this.state,extraHeaders:this.extraHeaders}},e.exports=t},function(e,n,t){"use strict";const{getType:r,isString:i}=t(75),a="(?:0|[1-9]\\d*)",s=`(?:\\d*[A-z-][A-z\\d-]*|${a})`,o=`(${a}(?:\\.${a}){2})(?:-(${`${s}(?:\\.${s})*`}))?(?:\\+((?:\\d*[A-z-][A-z\\d-]*|\\d+)(?:\\.(?:\\d*[A-z-][A-z\\d-]*|\\d+))*))?`,c=new RegExp(`^${a}$`),l=new RegExp(`^v?${o}$`),u=new RegExp(`^${o}$`),d=(e,n=!1)=>{if(!i(e))throw new TypeError(`Expected String but got ${r(e)}`);return(n&&u||l).test(e)},h=(e,n=!1)=>{if(!i(e))throw new TypeError(`Expected String but got ${r(e)}.`);if(!n&&!c.test(e))throw new Error(`${e} is not a stringified positive integer.`);if(c.test(e)){if(e=parseInt(e,10),Number.isNaN(e))throw new TypeError(`${e} is not a Number.`);if(!Number.isSafeInteger(e))throw new RangeError(`${e} exceeds ${Number.MAX_SAFE_INTEGER}.`)}return e};e.exports={compareSemVer:(e,n,t=!1)=>{if(!i(e))throw new TypeError(`Expected String but got ${r(e)}`);if(!i(n))throw new TypeError(`Expected String but got ${r(n)}`);if(!d(e,!!t))throw new Error(`${e} is not valid version string.`);if(!d(n,!!t))throw new Error(`${n} is not valid version string.`);let a;if(e===n)a=0;else{const r=t&&u||l,[,s,o]=e.match(r),[,c,d]=n.match(r),[f,p,g]=s.split(".").map(h),[b,v,m]=c.split(".").map(h);if(f>b)a=1;else if(f<b)a=-1;else if(p>v)a=1;else if(p<v)a=-1;else if(g>m)a=1;else if(g<m)a=-1;else if(o===d)a=0;else if(!o&&d)a=1;else if(o&&!d)a=-1;else{const e=o.split(".").map(e=>h(e,!0)),n=d.split(".").map(e=>h(e,!0)),t=Math.max(e.length,n.length);let r=0;for(;r<t;){const t=e[r],s=n[r];if(t&&!s||i(t)&&Number.isInteger(s)?a=1:!t&&s||Number.isInteger(t)&&i(s)?a=-1:t!==s&&i(t)&&i(s)?a=t.localeCompare(s):Number.isInteger(t)&&Number.isInteger(s)&&(t>s?a=1:t<s&&(a=-1)),Number.isInteger(a))break;r++}}}if(!Number.isInteger(a))throw new Error(`Failed to compare ${e} with ${n}.`);return a},isValidSemVer:d,parseSemVer:(e,n=!1)=>{if(!i(e))throw new TypeError(`Expected String but got ${r(e)}`);const t=d(e,!!n);let a,s,o,c,f;if(t){const t=n&&u||l,[,r,i,d]=e.match(t);[a,s,o]=r.split(".").map(h),i&&(c=i.split(".").map(e=>h(e,!0))),d&&(f=d.split(".").map(e=>h(e,!0)))}return{version:e,matches:t,major:a,minor:s,patch:o,pre:c,build:f}},parseVersionPart:h}},function(e,n,t){"use strict";const r=e=>Object.prototype.toString.call(e).slice(8,-1),i=e=>"string"==typeof e||e instanceof String;e.exports={escapeChar:(e,n)=>i(e)&&n&&n.global&&e.replace(n,(e,n)=>`\\${n}`)||null,getType:r,isString:i,logErr:e=>(console.error(e),!1),logMsg:e=>(e&&console.log(e),e),logWarn:e=>(e&&console.warn(e),!1),parseStringifiedInt:(e,n=!1)=>{if(!i(e))throw new TypeError(`Expexted String but got ${r(e)}`);if(!n&&!/^-?(?:0|[1-9]\d*)$/.test(e))throw new Error(`${e} is not a stringified integer.`);return parseInt(e)},stringifyPositiveInt:(e,n=!1)=>Number.isSafeInteger(e)&&(n&&e>=0||e>0)&&`${e}`||null,stripHtmlTags:e=>{for(;/^\n*<(?:[^>]+:)?[^>]+?>|<\/(?:[^>]+:)?[^>]+>\n*$/.test(e);)e=e.replace(/^\n*<(?:[^>]+:)?[^>]+?>/,"").replace(/<\/(?:[^>]+:)?[^>]+>\n*$/,"\n");return e.replace(/<\/(?:[^>]+:)?[^>]+>\n*<!--.*-->\n*<(?:[^>]+:)?[^>]+>/g,"\n\n").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&amp;/g,"&")},throwErr:e=>{throw e}}},function(e,n,t){var r=t(11);const i=t(77);const a={log:t(7)};var s=function(e,n){var t=this;if(t.clientScope=e,t.pc=e._currentSession.session.connection,t.xcallUUID=e._currentSession.callUUID,t.callUUID=e._currentSession.sipCallID,t.corelationId=e._currentSession.sipCallID,t.userName=e.userName,t.storage=e.storage,t.callstatskey=e.callstatskey,t.statsioused=e.statsioused,!t.pc||!t.callUUID)return!t.pc&&a.log.error("pc obj is null, webrtc stats error"),void(!t.callUUID&&a.log.error("callUUID is null, webrtc stats error"));t.baseStatsCollected=!1,t.packets={};const s=new MediaStream;s.addTrack(t.pc.getSenders()[0].track);const o=new MediaStream;o.addTrack(t.pc.getReceivers()[0].track),t.localAudioLevelHelper=new i(s),t.remoteAudioLevelHelper=new i(o);try{var c=t.pc.remoteDescription.sdp.match(/rtpmap:.*/)[0].split(" ")[1].split("/")[0]}catch(e){a.log.debug("Error fetching codec from remote description sdp message",e)}this.statsTimer=setInterval(function(){var r={codec:"",local:{},remote:{},networkType:""};"chrome"==e.browserDetails.browser?t.pc.getStats(function(e){e.result().forEach(function(e){if("localcandidate"!==e.type)"ssrc"==e.type&&(e.stat("bytesSent")&&e.names().forEach(function(n){r.local[n]=e.stat(n)}),e.stat("bytesReceived")&&e.names().forEach(function(n){r.remote[n]=e.stat(n)}),e.stat("googCodecName")&&(r.codec=e.stat("googCodecName")));else{if("host"===e.stat("candidateType")&&r.gotNetworkType)return;switch(e.stat("networkType")){case"wlan":r.networkType="wifi";break;case"lan":r.networkType="ethernet";default:r.networkType=e.stat("networkType")}"host"!==e.stat("candidateType")&&(r.gotNetworkType=!0)}}),r.local.audioInputLevel=t.localAudioLevelHelper.getAudioLevel(),r.remote.audioOutputLevel=t.remoteAudioLevelHelper.getAudioLevel(),t.processStats(r,n)},null,function(e){a.log.error("peerConnection rtpstats getStats error",e)}):"firefox"==e.browserDetails.browser?(r.codec=c||"",t.pc.getSenders()[0].getStats().then(function(e){Array.from(e.values()).forEach(function(e){if("outbound-rtp"==e.type&&(r.local=e),"remote-inbound-rtp"==e.type){const n=e;r.local.rtt=n.roundTripTime,r.local.jitter=n.jitter,r.local.packetsLost=n.packetsLost}}),t.pc.getReceivers()[0].getStats().then(function(e){Array.from(e.values()).forEach(function(e){"inbound-rtp"==e.type&&(r.remote=e,r.local.audioInputLevel=t.localAudioLevelHelper.getAudioLevel(),r.remote.audioOutputLevel=t.remoteAudioLevelHelper.getAudioLevel(),t.processStats(r,n))})}).catch(e=>{a.log.debug("Error in getStats RemoteStreams API ",e)})}).catch(e=>{a.log.debug("Error in getStats LocalStreams API ",e)})):a.log.error(`Unsuppported browser is being used. Plivo supports only ${e.supportedBrowsers()}`)},r.GETSTATS_INTERVAL)};s.prototype.processStats=function(e,n){var t=this;t.collected={msg:"CALL_STATS",callstats_key:t.callstatskey,local:{},remote:{},codec:e.codec,xcallUUID:t.xcallUUID,callUUID:t.callUUID,corelationId:t.corelationId,userName:t.userName,timeStamp:Date.now(),domain:r.DOMAIN,source:r.STATS_SOURCE,version:r.STATS_VERSION,networkType:e.networkType||"unknown",networkEffectiveType:navigator.connection?navigator.connection.effectiveType:"unknown",networkDownlinkSpeed:navigator.connection?navigator.connection.downlink:-1,statsIOUsed:t.statsioused},t.collected.local.audioLevel=t.handleNull(e.local.audioInputLevel,"int"),t.collected.remote.audioLevel=t.handleNull(e.remote.audioOutputLevel,"int"),"chrome"==t.clientScope.browserDetails.browser?(t.collected.local.rtt=t.handleNull(e.local.googRtt,"float"),t.collected.local.jitter=t.handleNull(e.local.googJitterReceived,"float"),t.collected.remote.jitter=t.handleNull(e.remote.googJitterReceived,"float")):"firefox"==t.clientScope.browserDetails.browser&&(t.collected.local.rtt=t.handleNull(e.local.rtt,"float"),t.collected.local.jitter=t.handleNull(e.local.jitter,"float"),t.collected.remote.jitter=t.handleNull(e.remote.jitter,"float")),t.collected.remote.packetsReceived=t.handleNull(e.remote.packetsReceived,"int"),t.collected.local.packetsSent=t.handleNull(e.local.packetsSent,"int"),t.collected.remote.bytesReceived=t.handleNull(e.remote.bytesReceived,"int"),t.collected.local.bytesSent=t.handleNull(e.local.bytesSent,"int"),t.collected.remote.packetsLost=t.handleNull(e.remote.packetsLost,"int"),t.collected.local.packetsLost=t.handleNull(e.local.packetsLost,"int"),t.collected.remote.ssrc=t.handleNull(e.remote.ssrc,"int"),t.collected.local.ssrc=t.handleNull(e.local.ssrc,"int"),t.calculateStats(e),n(t.collected)},s.prototype.calculateStats=function(e){var n=this;function t(e){n.packets.prePacketsReceived=n.handleNull(n.handlePrePackets(e.remote.packetsReceived),"int"),n.packets.prePacketsSent=n.handleNull(n.handlePrePackets(e.local.packetsSent),"int"),n.packets.preRemotePacketsLoss=n.handleNull(n.handlePrePackets(e.remote.packetsLost),"int"),n.packets.preLocalPacketsLoss=n.handleNull(n.handlePrePackets(e.local.packetsLost),"int")}if(!n.baseStatsCollected){var r=n.handleNull(e.local.packetsLost,"int"),i=n.handleNull(e.remote.packetsLost,"int"),s=n.handleNull(e.local.packetsSent,"int"),o=n.handleNull(e.remote.packetsReceived,"int")+i;return n.collected.local.fractionLoss=0==r&&0==s?0:0==s?1:n.handleNull((r/s).toFixed(3),"int"),n.collected.remote.fractionLoss=0==i&&0==o?0:0==o?1:n.handleNull((i/o).toFixed(3),"int"),t(e),void(n.baseStatsCollected=!0)}var c=n.handleNull(e.local.packetsLost,"int")-n.packets.preLocalPacketsLoss,l=n.handleNull(e.local.packetsSent,"int")-n.packets.prePacketsSent;n.collected.local.fractionLoss=0==c&&0==l?0:0==l?1:n.handleNull((c/l).toFixed(3),"int");var u=n.handleNull(e.remote.packetsLost,"int")-n.packets.preRemotePacketsLoss,d=n.handleNull(e.remote.packetsReceived,"int")-n.packets.prePacketsReceived+u;function h(e,t,r,i){var s=n.storage[e];if(null==r||null==i||isNaN(i)||0==Number(t||0))n.collected.local.mos=null;else{if(2==s.length){c();var o=s.filter(function(e,n){return e<3});if(o.length>=2){(o.reduce(function(e,n){return e+n})/o.length).toFixed(3);n.storage.warning[e]=!0,a.log.debug(e+" : getting low mos : ",n,s)}else n.storage.warning[e]&&(n.storage.warning[e]=!1)}else c();3==s.length&&s.splice(0,2)}function c(){var o,c,l=0,u="opus"==n.storage.audioCodec?95:93.2;l=(o=t+2*r+10)<160?u-o/40:u-(o-120)/10,c=(l-=100*i*2.5)<=0?1:l<100?(c=1+.035*l+7e-6*l*(l-60)*(100-l)).toFixed(3):4.5,s.push(c),a.log.debug("mos "+e,c),"mosLocalMeasures"==e&&(n.collected.local.mos=Number(c||0)),"mosRemoteMeasures"==e&&(n.collected.local.mos=Math.min(Number(c||0),n.collected.local.mos))}}return n.collected.remote.fractionLoss=0==u&&0==d?0:0==d?1:n.handleNull((u/d).toFixed(3),"int"),h("mosLocalMeasures",n.collected.local.rtt,n.collected.local.jitter,n.collected.local.fractionLoss),h("mosRemoteMeasures",n.collected.local.rtt,n.collected.remote.jitter,n.collected.remote.fractionLoss),t(e),!0},s.prototype.stop=function(){this.localAudioLevelHelper.stop(),this.remoteAudioLevelHelper.stop()},s.prototype.handleNull=function(e,n){return null==e||isNaN(e)?e:(returnValue="int"==n?Number(e):Number(e).toFixed(3),returnValue)},s.prototype.handlePrePackets=function(e){return isNaN(e)?null:e},e.exports={getRTPStats:s}},function(e,n,t){var r=t(7);function i(){this.AudioContext=window.AudioContext||window.webkitAudioContext,this.audioContext=null,this.audioContextCount=0}i.prototype.getAudioContext=function(){return this.audioContext||(this.audioContext=new AudioContext),this.audioContextCount+=1,this.audioContext},i.prototype.stop=function(){this.audioContext&&(this.audioContextCount-=1,0===this.audioContextCount&&(this.audioContext.close(),this.audioContext=null,r.debug("AudioContext no longer needed so closed")))};const a=new i;function s(e){this.volumeLevel=-100,this.fftBins=null,this.analyser=null,this.stopped=!1;const n=a.getAudioContext();this.analyser=n.createAnalyser(),this.analyser.fftSize=1024,this.analyser.minDecibels=-100,this.analyser.maxDecibels=0,this.analyser.smoothingTimeConstant=.1,this.fftBins=new Float32Array(this.analyser.frequencyBinCount),this.sourceNode=n.createMediaStreamSource(e),this.sourceNode.connect(this.analyser)}s.prototype.getAudioLevel=function(){let e=-100;const n=this.fftBins;this.analyser.getFloatFrequencyData(n);for(var t=4,r=n.length;t<r;t++)n[t]>e&&n[t]<0&&(e=n[t]);return e},s.prototype.stop=function(){this.stopped||(this.stopped=!0,this.analyser.disconnect(),this.sourceNode.disconnect(),a.stop())},e.exports=s},function(e,n,t){var r=t(7),i=t(11),a=t(12);const s={log:r};var o=function(e,n){this.url=i.STATSSOCKET_URL,this.ws=null,this.userName=e.userName,this.callstatskey=n,this.connect()};function c(e){s.log.debug("statsSocket "+this.url+" error: "+e)}o.prototype.heartbeat=function(e){if(this.isConnected()){var n=JSON.stringify({heartbeat:"healthy",username:e.userName});return this.ws.send(n),s.log.debug("sent heartbeat to statsSocket :",n),!0}return s.log.error("unable to send heartbeat, statsSocket is not open"),!1},o.prototype.addCallInfo=function(e,n){return n.callstats_key=this.callstatskey,n.callUUID=e.sipCallID,n.corelationId=e.sipCallID,n.xcallUUID=e.callUUID,n.timeStamp=Date.now(),n.userName=this.userName,n.domain=i.DOMAIN,n.source=i.STATS_SOURCE,n.version=i.STATS_VERSION,n},o.prototype.connect=function(e){if(!this.ws){s.log.debug("opening statsSocket");try{this.ws=new WebSocket(this.url),this.ws.onopen=function(){s.log.debug("statsSocket "+this.url+" connected")}.bind(this),this.ws.onclose=function(e){s.log.debug("statsSocket close()",e);var n=this;s.log.debug("statsSocket "+this.url+" closed"),!1===e.wasClean&&(s.log.debug("statsSocket abrupt disconnection,  reconnecting in ",i.STATSSOCKET_RECONNECT_SEC/1e3+" sec"),this.isConnected()||setTimeout(function(){n.connect()},i.STATSSOCKET_RECONNECT_SEC))}.bind(this),this.ws.onmessage=function(e){s.log.info("received statsSocket message: ",e.data)}.bind(this),this.ws.onerror=c.bind(this)}catch(e){s.log.error("statsSocket open error : ",e),c.call(this,e)}}},o.prototype.disconnect=function(e){s.log.debug("statsSocket disconnect()",e),this.ws&&(this.ws.onopen=function(){},this.ws.onclose=function(){},this.ws.onmessage=function(){},this.ws.onerror=function(){},this.ws.close(),this.ws=null)},o.prototype.send=function(e){if(this.isConnected()){s.log.debug("stats : ",e);var n=JSON.stringify(e);return this.ws.send(n),s.log.debug("stats send success"),!0}return s.log.error("unable to send message, statsSocket is not open"),!1},o.prototype.isConnected=function(){return this.ws.readyState===this.ws.OPEN},o.prototype.signallingEvent=function(e){i.SIP_ERROR_CODE[e]},o.prototype.onIceFailure=function(e,n){if(e.callUUID&&this.callstatskey){var t={msg:"ICE_FAILURE",error:n};t=this.addCallInfo(e,t),this.send(t)}},o.prototype.onMediaFailure=function(e,n){if(e.callUUID&&this.callstatskey){var t={msg:"MEDIA_FAILURE",error:n};t=this.addCallInfo(e,t),this.send(t)}},o.prototype.onSDPfailure=function(e,n){if(e.callUUID&&this.callstatskey){var t={msg:"SDP_FAILURE",error:n};t=this.addCallInfo(e,t),this.send(t)}},o.prototype.onToggleMute=function(e,n){if(e.callUUID&&this.callstatskey){var t={msg:"TOGGLE_MUTE",action:n};t=this.addCallInfo(e,t),this.send(t)}},o.prototype.qualityFeedback=function(e,n){if(e.callUUID&&this.callstatskey){var t={msg:"FEEDBACK",info:n};(t=this.addCallInfo(e,t)).sdkVersion=a.version,this.send(t)}},e.exports={statsSocket:o}}]);